/*
 * Copyright (C) 2008-2015 Search Solution Corporation. All rights reserved by Search Solution.
 *
 *   This program is free software; you can redistribute it and/or modify
 *   it under the terms of the GNU General Public License as published by
 *   the Free Software Foundation; either version 3 of the License, or 
 *   (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
*/
if(typeof String.fulltrim==="undefined"){String.prototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")}}if(typeof Array.hasValue==="undefined"){Array.prototype.hasValue=function(a){for(var b=0;b<this.length;b++){if(this[b]===a){return true}}return false}}if(typeof String.split_config=="undefined"){String.prototype.split_config=function(g,d){var c=this.fulltrim();var b=[];var h=true;var f=0;for(var a=0;a<this.length;a++){var e=this.substring(a,a+1);if(h){if(e===" "||g.hasValue(e)){continue}else{h=false;f=a}}else{if(e===" "||g.hasValue(e)){b.push(this.substring(f,a));h=true}else{continue}}}if(f<a){b.push(this.substring(f,a))}return b.length>0?b:[this]}}function ConfigToJson(f){var d=new Array();for(var c=0;c<f.length;c++){var b=f[c];if(typeof b==="undefined"||b===null||b.length<=0){continue}var e=/^#/;if(TrimLeft(b).match(e)){continue}var a=b.split_config(["="," ","\t"],2);var g=new Object();g.pn=a[0];g.pv=a[1]||"";d.push(g)}return d}function TrimLeft(b){for(var a=0;a<b.length;a++){if(b.charAt(a)!==" "){return b.substring(a,b.length)}}return b}function TrimRight(b){for(var a=b.length-1;a<0;a--){if(b.charAt(a)!==" "){return b.substring(0,a)}}return b}function IniToJson(e){var h=new Array();var g=function(){this.type="parameter";this.pn=new Object();this.pv=new Object()};g.prototype.SetNodeType=function(i){this.type=i};g.prototype.Parse=function(k){var m=/^\[.+\]$/;var n=k.indexOf("[")+1;var i=k.indexOf("]");if(k.match(m)){this.type="node";this.pn=k.substring(n,i);if(this.pn.charAt(0)==="%"){this.pn=this.pn.substring(1,this.pn.length)}this.pv=new Array();return this}else{this.type="parameter";var l=k.split_config(["="," ","\t"],2);this.pn=l[0];this.pv=l[1]||"";return this}};g.prototype.AddNode=function(i){this.pv.push(i)};for(var d=0;d<e.length;d++){var j=e[d];if(typeof j==="undefined"||j===null||j.length<=0){continue}var b=/^#/;if(j.match(b)){continue}var c=new g();var f=c.Parse(TrimLeft(j)).type;var a={};if(h.length>0){a=h[h.length-1]}if(f==="parameter"&&a instanceof g&&a.type==="node"){a.AddNode(c)}else{h.push(c)}}return h}(function(){var a=function(){if(!(this instanceof a)){return new a()}this._callbacks={};this._fired={}};a.prototype.addListener=function(c,d){this._callbacks=this._callbacks||{};this._callbacks[c]=this._callbacks[c]||[];this._callbacks[c].push(d);return this};a.prototype.bind=a.prototype.addListener;a.prototype.on=a.prototype.addListener;a.prototype.await=a.prototype.addListener;a.prototype.removeListener=function(f,h){var e=this._callbacks,d,c;if(!f){this._callbacks={}}else{if(e){if(!h){e[f]=[]}else{var g=e[f];if(!g){return this}c=g.length;for(d=0;d<c;d++){if(h===g[d]){g[d]=null;break}}}}}return this};a.prototype.unbind=a.prototype.removeListener;a.prototype.removeAllListeners=function(c){return this.unbind(c)};a.prototype.trigger=function(f,d){var g,n,k,m,h,e,c;var j=2;if(!(n=this._callbacks)){return this}while(j--){k=j?f:"all";g=n[k];if(g){for(e=0,c=g.length;e<c;e++){if(!(m=g[e])){g.splice(e,1);e--;c--}else{h=j?Array.prototype.slice.call(arguments,1):arguments;m.apply(this,h)}}}}return this};a.prototype.emit=a.prototype.trigger;a.prototype.fire=a.prototype.trigger;a.prototype.once=function(d,f){var c=this,e=function(){f.apply(c,arguments);c.unbind(d,e)};this.bind(d,e);return this};a.prototype.immediate=function(c,e,d){this.bind(c,e);this.trigger(c,d);return this};var b=function(h,g,i,e){var n=this,f,k=0,j=arguments.length,m,c,p,q,o,d=0,l={};if(j<3){return this}q=Array.prototype.slice.apply(arguments,[0,j-2]);p=arguments[j-2];o=arguments[j-1];if(typeof p!=="function"){return this}f=q.length;m=function(r){var s=o?"once":"bind";n[s](r,function(t){n._fired[r]=n._fired[r]||{};n._fired[r].data=t;if(!l[r]){l[r]=true;d++}})};for(k=0;k<f;k++){m(q[k])}c=function(){if(d<f){return}var r=[];for(k=0;k<f;k++){r.push(n._fired[q[k]].data)}if(o){n.unbind("all",c)}p.apply(null,r)};n.bind("all",c)};a.prototype.all=function(f,e,c){var d=Array.prototype.concat.apply([],arguments);d.push(true);b.apply(this,d);return this};a.prototype.assign=a.prototype.all;a.prototype.tail=function(){var c=Array.prototype.concat.apply([],arguments);c.push(false);b.apply(this,c);return this};a.prototype.assignAll=a.prototype.tail;a.prototype.assignAlways=a.prototype.tail;a.prototype.after=function(d,g,h){if(g===0){h.call(null,[]);return this}var e=this,c=[],f;f=function(i,j){if(i===d){g--;c.push(j);if(g<1){e.unbind("all",f);h.apply(null,[c])}}};e.bind("all",f);return this};a.prototype.any=function(){var g=this,e,i,c=arguments.length,j=arguments[c-1],f=Array.prototype.slice.apply(arguments,[0,c-1]),h=f.length,d=f.join("_");g.once(d,j);i=function(k){g.bind(k,function(l){g.trigger(d,{data:l,eventName:k})})};for(e=0;e<h;e++){i(f[e])}};a.prototype.not=function(c,e){var d=this;d.bind("all",function(f,g){if(f!==c){e(g)}})};a.create=function(){var c=new a();if(arguments.length){c.assign.apply(c,Array.prototype.slice.call(arguments))}return c};if(typeof exports!=="undefined"){exports.EventProxy=a}else{this.EventProxy=a}}());(function(){var a=function(){if(!(this instanceof a)){return new a()}this._queue=[];this._events=[{name:"start",fn:function(){}},{name:"end",fn:function(){}}];this._execIdx=0};a.prototype.reset=function(){this._queue=[];this._events=[{name:"start",fn:function(){}},{name:"end",fn:function(){}}];this._execIdx=0};a.prototype.push=function(){if(arguments.length>=1){if(typeof arguments[0]!=="function"){throw Error("JSEX.push method need a function at first argument")}else{var b=[];for(var c=1;c<arguments.length;c++){b.push(arguments[c])}this._queue.push({fn:arguments[0],args:b})}}else{throw Error("JSEX.push method need a function at first argument")}};a.prototype.exec=function(){var b=this._execIdx;if(b===0){this.raiseEvent("start")}var c=this._queue[b].args;var d=this._queue[b].fn;d.apply(d,c)};a.prototype.next=function(){this._execIdx++;if(this._execIdx>=this._queue.length){this.raiseEvent("end")}else{for(var b=0;b<arguments.length;b++){this._queue[this._execIdx].args.push(arguments[b])}this.exec()}};a.prototype.raiseEvent=function(c){for(var b=0;b<this._events.length;b++){if(c===this._events[b].name){this._events[b].fn();break}}};a.prototype.end=function(){this.raiseEvent("end");this.reset()};a.prototype.addEventHander=function(f,d){if(typeof f!=="string"||typeof d!="function"){throw Error("JSEX addEventHander arguments error")}var b=false;for(var c=0;c<this._events.length;c++){if(f===this._events[c].name){b=true;this._events[c].fn=d;break}}if(!b){this._events.push({name:f,fn:d})}};if(typeof exports!=="undefined"){exports.JSEX=a}else{this.JSEX=a}}());Ext.define("cwm.common.CookieUtil",{extend:"Ext.Base",singleton:true,setToken:function(a){Ext.util.Cookies.set("token",a)},setTokenAndExpireMinutes:function(c,a){var b=a*60*1000;var d=new Date();d.setTime(d.getTime()+b);Ext.util.Cookies.set("token",c,d)},getToken:function(){return Ext.util.Cookies.get("token")},clearToken:function(){Ext.util.Cookies.clear("token")},setDbmtUserName:function(a){Ext.util.Cookies.set("dbmtUserName",a)},getDbmtUserName:function(){return Ext.util.Cookies.get("dbmtUserName")},clearDbmtUserName:function(){Ext.util.Cookies.clear("dbmtUserName")},setLastDbmtUserName:function(a){var b=new Date();b.setTime(b.getTime()+20*365*24*60*60*1000);Ext.util.Cookies.set("lastDbmtUserName",a,b)},getLastDbmtUserName:function(){return Ext.util.Cookies.get("lastDbmtUserName")},clearLastDbmtUserName:function(){Ext.util.Cookies.clear("lastDbmtUserName")},setDbName:function(a){Ext.util.Cookies.set("dbName",a)},getDbName:function(){return Ext.util.Cookies.get("dbName")},clearDbName:function(){Ext.util.Cookies.clear("dbName")},setDbInfo:function(d){var b=this.getDbInfo();var a=this.getDbInfoByDbName(d.dbname);var c=false;if(!b){b=[];b.push(d)}else{if(a){if(typeof d.username==="string"){this.setDbUserName(d.dbname,d.username)}if(typeof d.password==="string"){this.setDbUserPwd(d.dbname,d.password)}if(typeof d.bip==="string"){this.setDbBrokerIp(d.dbname,d.bip)}if(typeof d.bport==="number"){this.setDbBrokerPort(d.dbname,d.bport)}if(typeof d.remember!=="undefined"){this.setDbUserRemember(d.dbname,d.remember)}if(typeof d.logstatus!=="undefined"){this.setDbLoginStatus(d.dbname,d.logstatus)}if(typeof d.isdba==="boolean"){this.setDbUserIsDba(d.dbname,d.isdba)}c=true}else{b.push(d)}}if(!c){b=Ext.encode(b);Ext.util.Cookies.set("dbinfo",b)}},getDbInfo:function(){try{var a=Ext.util.Cookies.get("dbinfo");return Ext.decode(a)}catch(b){}},getDbInfoByDbName:function(d){if(!d){return}var b=this.getDbInfo();if(!b){return}var a=null;for(var c=0;c<b.length;c++){if(d==b[c].dbname){a=b[c];break}}return a},setDbinfoParamByName:function(d,f,h){if(!d){return}var b=this.getDbInfo();var g=false;if(b){var a=null;for(var c=0;c<b.length;c++){if(d==b[c]["dbname"]){a=b[c];a[f]=h;g=true;break}}}else{b=[]}if(!g){var e=new Object();e.dbname=d;e[f]=h;b.push(e)}b=Ext.encode(b);Ext.util.Cookies.set("dbinfo",b)},getDbinfoParamByName:function(b,c){if(!b){return}if(!c){return}var a=this.getDbInfoByDbName(b);if(!a){return}return a[c]},setDbLoginStatus:function(b,a){this.setDbinfoParamByName(b,"logstatus",a)},getDbLoginStatus:function(a){return this.getDbinfoParamByName(a,"logstatus")},setDbUserIsDba:function(b,a){this.setDbinfoParamByName(b,"isdba",a)},getDbUserIsDba:function(a){return this.getDbinfoParamByName(a,"isdba")},setDbUserName:function(a,b){this.setDbinfoParamByName(a,"username",b)},getDbUserName:function(a){return this.getDbinfoParamByName(a,"username")},setDbUserPwd:function(b,a){this.setDbinfoParamByName(b,"password",a)},getDbUserPwd:function(a){var b=this.getDbinfoParamByName(a,"password");if(b&&b.length==0){b=""}return b},setDbBrokerIp:function(b,a){this.setDbinfoParamByName(b,"bip",a)},getDbBrokerIp:function(a){return this.getDbinfoParamByName(a,"bip")},setDbBrokerPort:function(a,b){this.setDbinfoParamByName(a,"bport",b)},getDbBrokerPort:function(a){var b=this.getDbinfoParamByName(a,"bport");try{if(typeof b!=="number"){b=parseInt(b)}}catch(c){Ext.Trace(c)}return b},setDbUserRemember:function(a,b){this.setDbinfoParamByName(a,"remember",b)},getDbUserRemember:function(a){return this.getDbinfoParamByName(a,"remember")},clearDbInfo:function(){Ext.util.Cookies.clear("dbinfo")},clearDbInfoByDbName:function(d){if(!d){return}var b=this.getDbInfo();if(b){var a=null;for(var c=0;c<b.length;c++){if(d==b[c].dbname){a=b.splice(c,1);break}}}b=Ext.encode(b);Ext.util.Cookies.set("dbinfo",b)},setAllBrokers:function(b){var a=Ext.encode(b);Ext.util.Cookies.set("allbrokers",a)},getAllBrokers:function(){var a=Ext.util.Cookies.get("allbrokers");return Ext.decode(a)},clearAllBrokers:function(){Ext.util.Cookies.clear("allbrokers")},setValidBrokers:function(b){var a=Ext.encode(b);Ext.util.Cookies.set("validbrokers",a)},getValidBrokers:function(){var a=Ext.util.Cookies.get("validbrokers");return Ext.decode(a)},clearValidBrokers:function(){Ext.util.Cookies.clear("validbrokers")},setEnvInfo:function(b){var a=Ext.encode(b);Ext.util.Cookies.set("envinfo",a)},getEnvInfo:function(){var a=Ext.util.Cookies.get("envinfo");return Ext.decode(a)},clearEnvInfo:function(){Ext.util.Cookies.clear("envinfo")},setBrokerHistory:function(a){var b=new Date();b.setTime(b.getTime()+20*365*24*60*60*1000);Ext.util.Cookies.set("brokerHistory",Ext.encode(a),b)},getBrokerHistory:function(){var a=Ext.util.Cookies.get("brokerHistory");if(a==null||a==""){return{}}return Ext.decode(a)},clearBrokerHistory:function(){Ext.util.Cookies.clear("brokerHistory")},setLang:function(b){var a=new Date();a.setTime(a.getTime()+20*365*24*60*60*1000);Ext.util.Cookies.set("lang",b,a)},getLang:function(){return Ext.util.Cookies.get("lang")},clearLang:function(){Ext.util.Cookies.clear("lang")},clearSessionCookies:function(){this.clearDbInfo();this.clearDbmtUserName();this.clearDbName();this.clearToken();this.clearAllBrokers();this.clearValidBrokers();this.clearEnvInfo()}});Ext.cookieUtil=cwm.common.CookieUtil;Ext.cwm.cubVersion=null;Ext.cwm.isVersionRegistered=false;Ext.cwm.version={};Ext.cwm.version.VER_8_4_1="8.4.1";Ext.cwm.version.VER_8_4_3="8.4.3";Ext.cwm.version.VER_8_4_4="8.4.4";Ext.cwm.version.VER_8_4_9="8.4.9";Ext.cwm.version.VER_9_0_0="9.0.0";Ext.cwm.version.VER_9_1_0="9.1.0";Ext.cwm.version.VER_9_2_0="9.2.0";Ext.cwm.version.VER_9_2_1="9.2.1";Ext.cwm.version.VER_9_3_0="9.3.0";Ext.cwm.version.VER_9_4_0="9.4.0";Ext.cwm.version.VER_10_0_0="10.0.0";Ext.cwm.isAfter843=function(a){return Ext.cwm.compareVersion(a,Ext.cwm.version.VER_8_4_3)>=0};Ext.cwm.isAfter900=function(a){return Ext.cwm.compareVersion(a,Ext.cwm.version.VER_9_0_0)>=0};Ext.cwm.isAfter910=function(a){return Ext.cwm.compareVersion(a,Ext.cwm.version.VER_9_1_0)>=0};Ext.cwm.isAfter920=function(a){return Ext.cwm.compareVersion(a,Ext.cwm.version.VER_9_2_0)>=0};Ext.cwm.compareVersion=function(d,c){var f=/^\d\.\d.\d$/;if(!f.test(d)&&!f.test(c)){return 0}else{if(!f.test(d)){return -1}else{if(!f.test(c)){return 1}}}var b=d.split(".");var h=c.split(".");var e;var a;var g;for(e=0;e<3;e++){a=parseInt(b[e]);g=parseInt(h[e]);if(a!=g){return a-g}}return 0};Ext.cwm.registerCubVerion=function(){if(!Ext.isEmpty(Ext.cwm.cubVersion)){return}var b=Ext.cookieUtil.getEnvInfo();if(Ext.isEmpty(b)){throw ("unable to register CUBRID Version")}cubVersion=b.CUBRIDVER;if(typeof cubVersion!=="string"){throw ("unable to register CUBRID Version")}var a="";if(cubVersion.indexOf("(")!=-1&&cubVersion.indexOf(")")!=-1){a=cubVersion.substring(cubVersion.indexOf("(")+1,cubVersion.indexOf(")"));Ext.cwm.cubVersion=a.substring(0,a.lastIndexOf("."))}};Ext.cwm.isCreateDbNeedCharset=function(){if(!Ext.cwm.isVersionRegistered){Ext.cwm.registerCubVerion();Ext.cwm.isVersionRegistered=true}return Ext.cwm.isAfter920(Ext.cwm.cubVersion)};Ext.cwm.isExportDbSupportPath=function(){if(!Ext.cwm.isVersionRegistered){Ext.cwm.registerCubVerion();Ext.cwm.isVersionRegistered=true}var a=true;if((Ext.cwm.isAfter843(Ext.cwm.cubVersion)&&!Ext.cwm.isAfter900(Ext.cwm.cubVersion))||Ext.cwm.isAfter910(Ext.cwm.cubVersion)){a=false}return a};function checkUpdate(a){try{var b=a.CubridWebManager;var d="";if(b.version==Ext.cwm.prodVersion){d=I18N_Util.getMsg("msgLatestVersion",{version:b.version})}else{d=I18N_Util.getMsg("msgNewVersion",{version:b.version,url:b.download})}Ext.getCmp("cwm-update-info").update("&nbsp;&nbsp;"+d)}catch(c){}}function loadRemoteScript(d){var b=document.getElementsByTagName("head")[0];var a=document.getElementById("upgradeJs");if(a!=null&&a.parentNode!=null){a.parentNode.removeChild(a)}var c=document.createElement("script");c.setAttribute("id","remoteAdhocJs");c.setAttribute("src",d);b.appendChild(c)}function doCWMVersionUpdate(){try{Ext.getCmp("cwm-update-info").update("&nbsp;&nbsp;"+I18N_Util.getMsg("msgChecking")+" <img height=14 data-qtip=\"<span class='long_tip'>"+I18N_Util.getMsg("msgFailUpdate")+'</span>" data-qwidth="300" src="'+Ext.ImagePath+'b_docs.png">');loadRemoteScript(checkUpdateJSUrl)}catch(a){}}Ext.columnTypeTransfer=function(b){if(typeof b!=="string"){return}var a;if(b.match(/^multiset_of/)){a=b.replace(/^multiset_of/,"multiset")}else{if(b.match(/^sequence_of/)){a=b.replace(/^sequence_of/,"sequence")}else{if(b.match(/^set_of/)){a=b.replace(/^set_of/,"set")}else{a=b}}}if(a.match(/national\scharacter/)){a=a.replace(/national\scharacter/,"nchar")}else{if(a.match(/character\svarying/)){a=a.replace(/character\svarying/,"varchar")}else{if(a.match(/character/)){a=a.replace(/character/,"char")}}}return a.toUpperCase()};Ext.cciColumnTypeTransfer=function(b){if(typeof b!=="string"){return}var a;if(b==="VARBIT"){a="BIT VARYING"}else{if(b==="STRING"){a="VARCHAR"}else{if(b==="VARNCHAR"){a="NCHAR VARYING"}else{if(b==="SHORT"){a="SMALLINT"}else{a=b}}}}return a};Ext.DbUtil={};Ext.DbUtil.TranslateDefaultValue=function(c,e){var a=c.toUpperCase();var d="";switch(a){case"DATE":case"DATETIME":case"TIME":case"TIMESTAMP":var b=Ext.String.trim(e.toUpperCase()).replace(/\s/g,"");if(b==="SYS_DATETIME"||b==="SYS_DATETIME"||b==="CURRENT_DATETIME"||b==="CURRENT_DATETIME()"||b==="NOW()"){d=e}else{d="'"+e.replace(/\'/g,"''")+"'"}break;case"CHAR":case"STRING":case"VARCHAR":d="'"+e.replace(/\'/g,"''")+"'";break;case"BLOB":case"CLOB":d=null;break;case"NCHAR":case"NCHAR VARYING":var b=e.toUpperCase();if(b.indexOf("N'")===0){d=e}else{d="N'"+e.replace(/\'/g,"''")+"'"}break;case"BIT":case"BIT VARYING":case"SET":case"MULTISET":case"SEQUENCE":case"BIGINT":case"SMALLINT":case"SHORT":case"INTEGER":case"FLOAT":case"DOUBLE":case"NUMERIC":case"MONETARY":default:d=e}return d};Ext.DbUtil.TranslateFieldValue=function(b,d){var a="";if(b.indexOf("(")>-1){a=b.substring(0,b.indexOf("(")).toUpperCase()}else{a=b.toUpperCase()}var c="";switch(a){case"SEQUENCE_OF":c="SEQUENCE";break;case"SET_OF":c="SET";break;case"MULTISET_OF":c="MULTISET";break;default:c=a;break}return Ext.DbUtil.TranslateDefaultValue(c,d)};Ext.getTypeClause=function(c,a){var e="";var d=a;var b=false;if(typeof d=="undefined"||d==null||d==0){b=true}switch(c){case"CHAR":case"BIT":case"NCHAR":if(b){d="1"}e=c+"("+d+") ";break;case"BIT VARYING":case"NCHAR VARYING":case"VARCHAR":if(b){d="4096"}e=c+"("+d+") ";break;case"NUMERIC":if(b){d="15,0"}e=c+"("+d+") ";break;case"SET":case"SEQUENCE":case"MULTISET":if(b){d=""}e=c+"("+d+") ";break;default:e=c+" ";break}return e};Ext.createWaitWin=function(){var a=Ext.Msg.show({msg:'<span style="background : transparent"><img width=24 height=24 src="resources/images/loading.gif" style="marigin-right:10px"/></span><div align=center>&nbsp;&nbsp; '+I18N_Util.getMsg("msgWaiting")+"</div>",width:80,height:40});return a};Ext.showSuccessWin=function(b,c){if(typeof b!=="string"){Ext.Trace("Err: invaild param for Ext.showSuccessWin()!");return}var a={title:I18N_Util.getMsg("titleSuccess"),msg:b,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO};if(b.length<40){a.width=300}else{if(b.length>80){a.width=600;a.msg='<div class="msg_long_text">'+b+"</div>"}}if(typeof c==="function"){a.fn=c;a.closable=false}Ext.Msg.show(a)};Ext.showFailureWin=function(b,c){if(typeof b!=="string"){Ext.Trace("Err: invaild param for Ext.showFailureWin()!");return}var a={title:I18N_Util.getMsg("titleFailure"),msg:b,buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING};if(b.length<40){a.width=300}else{if(b.length>80){a.width=600;a.msg='<div class="msg_long_text">'+b+"</div>"}}if(typeof c==="function"){a.fn=c;a.closable=false}Ext.Msg.show(a)};Ext.showWarningWin=function(b,c){if(typeof b!=="string"){Ext.Trace("Err: invaild param for Ext.showWarningWin()!");return}var a={title:I18N_Util.getMsg("titleWarning"),msg:b,buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING};if(b.length<40){a.width=300}else{if(b.length>80){a.width=600;a.msg='<div class="msg_long_text">'+b+"</div>"}}if(typeof c==="function"){a.fn=c;a.closable=false}Ext.Msg.show(a)};Ext.showErrorWin=function(b,c){if(typeof b!=="string"){Ext.Trace("Err: invaild param for Ext.showErrorWin()!");return}var a={title:I18N_Util.getMsg("titleError"),msg:b,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR};if(b.length<40){a.width=300}else{if(b.length>80){a.width=600;a.msg='<div class="msg_long_text">'+b+"</div>"}}if(typeof c==="function"){a.fn=c;a.closable=false}Ext.Msg.show(a)};Ext.showConfirmWin=function(d,e,b){if(typeof d!=="string"||typeof e!=="function"){Ext.Trace("Err: invaild param for Ext.showConfirmWin()!");return}var a=d.length;if(Ext.isNumber(b)){a=b}var c={title:I18N_Util.getMsg("titleConfirm"),closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:e};if(a<40){c.width=300;c.msg=d}else{if(a>80){c.width=600;c.msg='<div class="msg_long_text">'+d+"</div>"}else{c.msg=d}}Ext.Msg.show(c)};Ext.cwm.isHashMap=function(a){if(typeof a==="object"&&typeof a.containsKey==="function"&&typeof a.indexOf==="undefined"){return true}else{return false}};Ext.setUserNameAndPassword=function(b,d,a,c){Ext.cookieUtil.setDbInfo({dbname:b,username:d,password:a,remember:c})};Ext.getUserNameAndPassword=function(a){return Ext.cookieUtil.getDbInfoByDbName(a)};Ext.Trace=function(c){try{var a=navigator.appName.indexOf("Microsoft")!=-1;if(a){if(window.console){window.console.log(c)}}else{if(console){console.log(c)}}}catch(b){}};Ext.checkDbLoginStatusWhenCCI=function(a,b){if((a==-20001||a==-1)&&typeof b==="string"){var c=b+"<br>"+I18N_Util.getMsg("msgReconnectPrompt");Ext.showErrorWin(c,function(){Ext.cookieUtil.setDbLoginStatus(Ext.currentDb,false);var h=Ext.getCmp("LeftPanelToolBar");if(h){h.fireEvent("GotoHome",h,null);var g=Ext.getCmp("AddUserWin");if(g){g.close()}var f=Ext.getCmp("EditUserWin");if(f){f.close()}var d=Ext.getCmp("create-table-window");if(d){d.close()}var e=Ext.getCmp("SQLQueryWin");if(e){e.close()}}});return false}else{return true}};Ext.checkTokenStatus=function(a){if(typeof a==="string"&&a.indexOf("Request is rejected due to invalid token")>=0){Ext.showWarningWin(a,function(){Ext.cookieUtil.clearSessionCookies();location.reload(false)});return false}else{return true}};Ext.DropColumns=function(l,b,r,g){if(!Ext.isArray(r)){return}var t=new Array();var c=Ext.getDbIndex(l);var a=Ext.getTableIndx(l,b);var h=Ext.dblist[c].tables[a].indexes;var m=[];var o=null;var s=function(v){var D=Ext.getDbIndex(l);var A=Ext.getTableIndx(l,b);var y=Ext.dblist[D].tables[A].fields;var B=3+b.length+1;var u=v.substring(B,v.length);var C=new Array();for(var w=0;w>=y.length;w++){for(var x=0;x<y.length;x++){var z=y[x].name;var E=u.substring(0,z.length);if(u.substring(0,z.length)===z){C.push(z);u=u.substring(z.length+1,u.length);break}}if(u==null||u.length===0){break}}return C};for(var n=0;n<h.length;n++){o=h[n].idxname;var j=/^pk_/;if(o.match(j)!=null){var f=b.length+4;m=s(o);break}}function k(v,u){if(typeof v=="undefined"||v==null||!Ext.isArray(v)){return false}if(typeof u=="undefined"||u==null){return false}if(Ext.isArray(u)){for(var x=0;x<v.length;x++){for(var w=0;w<u.length;w++){if(v[x]==u[w]){return true}}}}else{for(var x=0;x<v.length;x++){if(v[x]==u){return true}}}return false}function e(z,u){if(typeof z=="undefined"||z==null||!Ext.isArray(z)||typeof u=="undefined"||u==null){return}if(Ext.isArray(u)){for(var y=0;y<u.length;y++){var v=u[y];for(var w=0;w<z.length;w++){var x=z.shift();if(x==v){break}z.push(x)}}}else{for(var y=0;y<z.length;y++){var x=z.shift();if(x==u){break}z.push(x)}}}if(m!=null&&k(m,r&&false)){e(m,r);var d='ALTER TABLE "'+b+'" DROP CONSTRAINT "'+o+'"';t.push(d);for(var n=0;n<r.length;n++){var q='ALTER TABLE "'+b+'" DROP  COLUMN "'+r[n]+'"';t.push(q)}var p='ALTER TABLE "'+b+'" ADD PRIMARY KEY(';for(var n=0;n<m.length;n++){p+='"'+m[n]+'",'}p=p.substr(0,p.length-1);p+=")";t.push(p);Ext.QueryByCCI(l,t,g)}else{for(var n=0;n<r.length;n++){var q='ALTER TABLE "'+b+'" DROP  COLUMN "'+r[n]+'"';t.push(q)}Ext.QueryByCCI(l,t,g)}};Ext.CreateUniques=function(g,a,e,h){if(!Ext.isArray(e)){return}var d="u_"+a+"_";var c="";for(var b=0;b<e.length;b++){d+=e[b]+"_";c+='"'+e[b]+'",'}d=d.substring(0,d.length-1);c=c.substring(0,c.length-1);var f='CREATE UNIQUE INDEX "'+d+'" ON "'+a+'"('+c+")";Ext.QueryByCCI(g,[f],h)};Ext.DropUniques=function(f,a,d,g){if(!Ext.isArray(d)){return}var c=new Array();for(var b=0;b<d.length;b++){var e='DROP UNIQUE INDEX ON "'+a+'"("'+d[b]+'" ASC)';c.push(e)}Ext.QueryByCCI(f,c,g)};Ext.CreateIndexes=function(g,a,d,h){if(!Ext.isArray(d)){return}var f="i_"+a+"_";var c="";for(var b=0;b<d.length;b++){f+=d[b]+"_";c+='"'+d[b]+'",'}f=f.substring(0,f.length-1);c=c.substring(0,c.length-1);var e='CREATE INDEX "'+f+'" ON "'+a+'"('+c+")";Ext.QueryByCCI(g,[e],h)};Ext.DropIndexes=function(f,a,d,g){if(!Ext.isArray(d)){return}var c=new Array();for(var b=0;b<d.length;b++){var e='DROP INDEX ON "'+a+'"("'+d[b]+'" ASC)';c.push(e)}Ext.QueryByCCI(f,c,g)};Ext.AddPrimaryKey=function(e,c,a,f){if(!Ext.isArray(a)){return}var d='ALTER TABLE "'+c+'" ADD PRIMARY KEY(';for(var b=0;b<a.length;b++){d+='"'+a[b]+'",'}d=d.substr(0,d.length-1);d+=")";Ext.QueryByCCI(e,[d],f);return};Ext.GetIndexes=function(c,a,d){var b="SELECT a.index_name, a.is_unique, a.is_reverse, a.is_primary_key, a.is_foreign_key, a.key_count, GROUP_CONCAT(key_attr_name) key_attr_name, GROUP_CONCAT(key_order) key_order, GROUP_CONCAT(key_attr_name || ' ' ||asc_desc) asc_desc FROM db_index a, db_index_key b WHERE a.index_name=b.index_name AND a.class_name=b.class_name AND a.class_name='"+a.replace(/\'/gi,"''")+"' GROUP BY b.index_name";Ext.QueryByCCI(c,[b],d)};Ext.VerifyTextInput=function(a){if(typeof a==="undefined"||a===null||a===""){return false}if(a.indexOf(" ")>=0){return false}if(a==="."||a===".."){return false}if(a.charAt(0)==="#"||a.charAt(0)==="-"){return false}var b=/^[\w-]+$/;if(a.match(b)){return true}return false};Ext.QueryByCCI=function(e,c,g){if(!Ext.isArray(c)){return}var b=Ext.cookieUtil.getDbUserName(e);var a=Ext.cookieUtil.getDbUserPwd(e);var d=new Object();d.task="sql";d.bip=Ext.cookieUtil.getDbBrokerIp(e);d.bport=Ext.cookieUtil.getDbBrokerPort(e);d.dbname=e;d.dbid=b;d.dbpasswd=a;d.charset="UTF-8";d.stmt=c;d.fetch_size=0;d.error_continue=0;if(arguments.length>=4){d.autocommit=arguments[3]}else{d.autocommit=0}var f=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cciApi,jsonData:Ext.encode(d),success:function(h,i){f.close();if(h.status==200){var k=Ext.decode(h.responseText);if(k.status!=1000){if(Ext.checkDbLoginStatusWhenCCI(k.status,k.note)){Ext.showErrorWin(Ext.htmlEncode(k.note))}return}try{if(g&&typeof g.success==="function"){g.success(h,i)}}catch(j){Ext.Trace(j)}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+h.responseText)}},failure:function(h,i){f.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+h.responseText)}})};Ext.QueryByCCIWithWaitBox=function(f,d,h,c){if(!Ext.isArray(d)){return}var b=Ext.cookieUtil.getDbUserName(f);var a=Ext.cookieUtil.getDbUserPwd(f);var e=new Object();e.task="sql";e.bip=Ext.cookieUtil.getDbBrokerIp(f);e.bport=Ext.cookieUtil.getDbBrokerPort(f);e.dbname=f;e.dbid=b;e.dbpasswd=a;e.charset="UTF-8";e.stmt=d;e.fetch_size=0;e.error_continue=0;if(arguments.length>=4){e.autocommit=arguments[3]}else{e.autocommit=0}var g=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cciApi,timeout:(c==null)?Ext.Ajax.timeout:c,jsonData:Ext.encode(e),success:function(i,k){g.close();if(h&&typeof h.success==="function"){h.success(i,k)}else{var j=Ext.decode(i.responseText);if(j&&j.status!==1000&&Ext.checkDbLoginStatusWhenCCI(resp.status,resp.note)){Ext.showErrorWin(Ext.htmlEncode(resp.note))}}},failure:function(i,j){g.close();if(h&&typeof h.failure==="function"){h.failure(i,j)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+i.responseText)}}})};Ext.QueryByCCINoErrorRollback=function(e,c,f){if(!Ext.isArray(c)){return}var b=Ext.cookieUtil.getDbUserName(e);var a=Ext.cookieUtil.getDbUserPwd(e);var d=new Object();d.task="sql";d.bip=Ext.cookieUtil.getDbBrokerIp(e);d.bport=Ext.cookieUtil.getDbBrokerPort(e);d.dbname=e;d.dbid=b;d.dbpasswd=a;d.charset="utf-8";d.stmt=c;d.fetch_size=0;d.error_continue=1;d.autocommit=0;Ext.Ajax.request({method:"POST",url:Ext.cciApi,jsonData:Ext.encode(d),success:function(g,i){if(f&&typeof f.success==="function"){f.success(g,i)}else{var h=Ext.decode(g.responseText);if(h&&h.status!==1000&&Ext.checkDbLoginStatusWhenCCI(resp.status,resp.note)){Ext.showErrorWin(Ext.htmlEncode(h.note))}}},failure:function(g,h){if(f&&typeof f.failure==="function"){f.failure(g,h)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+g.responseText)}}})};Ext.RefreshDatabaseList=function(){try{var f=Ext.getCmp("leftPanel");if(f){f.refresh()}var d=Ext.getCmp("dbListViewGrid");if(d){var c=d.getStore();c.loadData(Ext.createDbListObj())}var a=Ext.getCmp("AutomationView");if(a){a.refreshDbList()}var b=Ext.getCmp("ReportView");if(b){b.refreshDbList()}}catch(g){Ext.Trace(g)}};Ext.getTableIndx=function(e,c){var d=Ext.getDbIndex(e);if(-1==d){return -1}var b=Ext.dblist[d].tables;for(var a=0;a<b.length;a++){if(c===b[a].name){return a}}return -1};Ext.getTableInfo=function(c,a,e){var b=new Object();b.task="class";b.token=Ext.cookieUtil.getToken();b.dbname=c;b.classname=a;var d=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(b),success:function(r,j){d.close();try{if(r.status==200){var i=Ext.decode(r.responseText);if(i.status=="success"){var l=Ext.getDbIndex(c);if(-1==l){throw ("getTableInfo: can not found database:"+c)}var f=Ext.getTableIndx(c,a);if(-1==f){throw ("getTableInfo: can not found the table:"+a+"in database :"+c)}var g=Ext.dblist[l].tables[f].fields;g.splice(0,g.length);if(Ext.isArray(i.classinfo[0].attribute)){var p=i.classinfo[0].attribute;for(var h=0;h<p.length;h++){p[h].index=h+1;p[h].type=Ext.columnTypeTransfer(p[h].type);g.push(p[h])}}if(g.length<=0){if(e&&typeof e.success==="function"){e.success(r,j)}return}var n=this;var o={success:function(u,y){var w=Ext.decode(u.responseText);if(w!=null&&w.status==1000){var z=w.result[0].values;if(z!=null){var t=new Ext.util.HashMap();for(var x=0;x<z.length;x++){var v=new Object();v.att_name=z[x][0];v.aiSeed=z[x][1];v.aiIncrement=z[x][2];v.aiCurrentVal=z[x][3];t.add(v.att_name,v)}if(t.getCount()>0){for(var s=0;s<g.length;s++){var v=t.get(g[s].name);if(v==null){g[s].autoIncrement="n";continue}g[s].autoIncrement="y";g[s].aiSeed=v.aiSeed;g[s].aiIncrement=v.aiIncrement;g[s].aiCurrentVal=v.aiCurrentVal}}}}if(e&&typeof e.success==="function"){e.success(n.result,n.request)}}};var q=["SELECT att_name, min_val, increment_val, current_val FROM db_serial WHERE class_name = '"+a.replace(/\'/gi,"''")+"'"];Ext.QueryByCCI(c,q,o)}else{if(Ext.checkTokenStatus(i.note)){Ext.showFailureWin(i.note)}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+r.responseText)}}catch(k){Ext.Trace(k);Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+r.responseText)}},failure:function(f,g){d.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}})};Ext.getTableInfoByCCI=function(f,b,g){if(typeof f!=="string"||typeof b!=="string"){Ext.Trace("Err: fail to get table info via cci cased by unacceptable parameters!");return}var c="SELECT b.attr_name, b.data_type, b.prec, b.scale, b.set_data_type, b.set_prec, b.set_scale, b.default_value, b.is_nullable, c.min_val, c.increment_val, c.current_val FROM (SELECT * FROM (SELECT attr_name, attr_type, data_type, prec, scale, default_value, is_nullable FROM db_attribute WHERE class_name='"+b.replace(/\'/gi,"''")+"' ORDER BY def_order) a LEFT JOIN (SELECT attr_name as set_attr_name, data_type AS set_data_type, prec AS set_prec, scale AS set_scale FROM db_attr_setdomain_elm WHERE class_name='"+b.replace(/\'/gi,"''")+"') s ON a.attr_name=s.set_attr_name) b LEFT JOIN (SELECT att_name AS incr_att_name, min_val, increment_val, current_val FROM db_serial WHERE class_name = '"+b.replace(/\'/gi,"''")+"') c ON b.attr_name=c.incr_att_name";var e="SELECT a.index_name, a.is_unique, a.is_reverse, a.is_primary_key, a.is_foreign_key, a.key_count, GROUP_CONCAT(key_attr_name) key_attr_name, GROUP_CONCAT(key_order) key_order, GROUP_CONCAT(key_attr_name || ' ' ||asc_desc) asc_desc FROM db_index a, db_index_key b WHERE a.index_name=b.index_name AND a.class_name=b.class_name AND a.class_name='"+b.replace(/\'/gi,"''")+"' GROUP BY b.index_name";var a="SELECT * FROM db_partition WHERE class_name='"+b.replace(/\'/gi,"''")+"'";var d=[c,e,a];Ext.QueryByCCI(f,d,{success:function(l,o){try{var n=Ext.getDbIndex(f);if(-1==n){throw ("getTableInfo: can not found database:"+f)}var m=Ext.getTableIndx(f,b);if(-1==m){throw ("getTableInfo: can not found the table:"+b+"in database :"+f)}var u=Ext.decode(l.responseText);var x=u.result[0]["values"];var p=u.result[1]["values"];var q=u.result[2]["values"];var A,s,t,v=new Array(),r=new Array(),w=new Array();if(Ext.isArray(x)){for(A=0;A<x.length;A++){s=Ext.dealCCIClassRec(x[A]);s.index=A+1;v.push(s)}}else{Ext.Trace("There is no column in table:"+b)}if(Ext.isArray(p)){for(var y=0;y<p.length;y++){t=new Object();t.idxname=p[y][0];t.unique=p[y][1];t.reverse=p[y][2];t.pk=p[y][3];t.fk=p[y][4];t.keycount=p[y][5];t.columns=p[y][6];t.colOrder=p[y][7];t.idxRules=p[y][8];r.push(t);if(t.pk==="YES"){var h=t.columns.split(",");for(var z=0;z<h.length;z++){for(A=0;A<v.length;A++){if(h[z]===v[A]["name"]){v[A]["pkey"]=true;break}}}}}}else{Ext.Trace("There is no index in table:"+b)}if(Ext.isArray(q)){for(A=0;A<q.length;A++){s=new Object();s.classname=q[A][0];s.part_name=q[A][1];s.part_classname=q[A][2];s.type=q[A][3];s.expr=q[A][4];s.values=q[A][5];w.push(s)}}else{Ext.Trace("There is no partition class inherit from table:"+b)}Ext.dblist[n].tables[m]["fields"]=v;Ext.dblist[n].tables[m]["indexes"]=r;Ext.dblist[n].tables[m]["partitions"]=w;if(g&&Ext.isFunction(g.success)){g.success(l,o)}}catch(B){Ext.Trace(B)}}})};Ext.dealCCIClassRec=function(b){var a={"default":"",name:"",notnull:"n",type:"",autoIncrement:"n",aiSeed:"",aiIncrement:"",aiCurrentVal:""};if(Ext.isArray){a.name=b[0];b[1]=Ext.cciColumnTypeTransfer(b[1]);if(typeof b[7]==="string"){a["default"]=b[7]}switch(b[1]){case"SET":case"SEQUENCE":case"MULTISET":b[4]=Ext.cciColumnTypeTransfer(b[4]);switch(b[4]){case"BIT":case"BIT VARYING":case"CHAR":case"VARCHAR":case"NCHAR":case"NCHAR VARING":a.type=b[1]+"("+b[4]+"("+b[5]+"))";break;case"NUMERIC":a.type=b[1]+"("+b[4]+"("+b[5]+","+b[6]+"))";default:a.type=b[1]+"("+b[4]+")"}break;case"BIT":case"BIT VARYING":case"NCHAR":case"NCHAR VARING":a.type=b[1]+"("+b[2]+")";break;case"CHAR":case"VARCHAR":a.type=b[1]+"("+b[2]+")";if(typeof b[7]==="string"){a["default"]=b[7].substring(1,a["default"].length-1);a["default"]=a["default"].replace(/'{2}/g,"'")}break;case"NUMERIC":a.type=b[1]+"("+b[2]+","+b[3]+")";break;default:a.type=b[1];break}a.notnull=b[8]==="YES"?"n":"y";if(b[9]||b[10]||b[11]){a.autoIncrement="y";a.aiSeed=b[9];a.aiIncrement=b[10];a.aiCurrentVal=b[11]}}return a};Ext.ShowFileDownloadWin=function(c){if(c==null){return}var b=I18N_Util.getMsg("msgDownloadFile")+"<br>";for(var a=0;a<c.length;a++){b+='<br><a style="color:blue" target="blank" href="'+Ext.htmlEncode(c[a].path)+'">'+Ext.htmlEncode(Ext.htmlEncode(c[a].name))+"</a>"}b+="<br>";Ext.Msg.show({title:I18N_Util.getMsg("msgInfo"),msg:b,buttons:Ext.Msg.CANCEL,icon:Ext.Msg.INFO})};Ext.ImportTables=function(b,d,f,i,j){var h=Ext.cookieUtil.getEnvInfo();var e=h.CUBRID+"/tmp/";var c=new Object();c.task="loaddb";c.token=Ext.cookieUtil.getToken();c.dbname=b;var a=Ext.getUserNameAndPassword(b);c.user=a.username;c.period="none";c.estimated="none";c.oiduse="no";c.nolog="no";c.index=(typeof i!="undefined"&&i!=null&&i.length>0)?(e+i):"none";c.errorcontrolfile="none";c.ignoreclassfile="none";c.delete_orignal_files="y";if(typeof d!="undefined"&&d!=null&&d.length>0){c.schema=e+d;c.checkoption="schema"}else{c.schema=""}if(typeof f!="undefined"&&f!=null&&f.length>0){c.object=e+f;if(typeof c.checkoption!="undefined"&&c.checkoption!=null){c.checkoption="both"}else{c.checkoption="object"}}else{c.object=""}var g=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(c),success:function(k,l){g.close();try{var n=Ext.decode(k.responseText);if(n.status==="success"){if(j&&typeof j.success==="function"){j.success(k,l)}}else{if(Ext.checkTokenStatus(n.note)){Ext.showFailureWin(n.note)}}}catch(m){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+k.responseText)}},failure:function(k,l){g.close();if(k==null||k.statusText==null||k.statusText==""){return}Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+k.responseText)}})};Ext.DeleteFile=function(a,c){var b=new Object();b.task="removefiles";b.token=Ext.cookieUtil.getToken();b.files=[a];Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(b),success:function(d,e){if(d.status===200){var f=Ext.decode(d.responseText);if(f.status==="success"){if(c&&typeof c.success==="function"){c.success(d,e)}}else{if(Ext.checkTokenStatus(f.note)){Ext.showErrorWin(Ext.htmlEncode(f.note));if(c&&typeof c.failure==="function"){c.failure(d,e)}}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText);if(c&&typeof c.failure==="function"){c.failure(d,e)}}},failure:function(d,e){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText);if(c&&typeof c.failure==="function"){c.failure(d,e)}}})};Ext.ImportDb=function(b,k,g,f,i){var e=Ext.cookieUtil.getEnvInfo();var h=e.CUBRID+"/tmp/";var j=(g===0)?".sql":".csv";var c=new Object();c.task="importdb";c.bip=Ext.cookieUtil.getDbBrokerIp(b);c.bport=Ext.cookieUtil.getDbBrokerPort(b);c.dbname=b;var a=Ext.getUserNameAndPassword(b);c.dbid=a.username;c.dbpasswd=a.password;if(typeof k!=="undefined"&&k!==null){c.classname=k}c.import_type=g;c.import_filename=f;var d=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cciApi,jsonData:Ext.encode(c),success:function(l,n){d.close();if(l.status===200){var o=Ext.decode(l.responseText);if(o.status===1000){if(i&&typeof i.success==="function"){i.success(l,n)}}else{var m=(o.note==null)?"":o.note;Ext.showErrorWin('<div style="overflow:auto; height:260px">'+m.replace(/<end>/g,"<br>")+"</div>");if(i&&typeof i.failure==="function"){i.failure(l,n)}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+l.responseText)}},failure:function(l,m){d.close();if(l==null||l.statusText==null||l.statusText==""){return}Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+l.responseText)}})};Ext.ExportDb=function(c,a,m,j,i,f,l){var e=new Object();e.task="exportdb";e.bip=Ext.cookieUtil.getDbBrokerIp(c);e.bport=Ext.cookieUtil.getDbBrokerPort(c);e.dbname=c;var b=Ext.getUserNameAndPassword(c);e.dbid=b.username;e.dbpasswd=b.password;e["class"]=m;e.export_size=i;e.export_type=j;e.export_flag=f;if(Ext.cwm.isExportDbSupportPath()){var h=Ext.cookieUtil.getEnvInfo();var k=(j===0)?".sql":".csv";var d=h.CUBRID+Ext.cwm.exportPath;e.export_path=d+Ext.htmlEncode(a)+k}var g=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cciApi,jsonData:Ext.encode(e),success:function(n,o){g.close();if(n.status===200){var p=Ext.decode(n.responseText);if(p.status===1000){if(l&&typeof l.success==="function"){l.success(n,o)}}else{if(Ext.checkDbLoginStatusWhenCCI(p.status,p.note)){Ext.showErrorWin(Ext.htmlEncode(p.note))}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+n.responseText)}},failure:function(n,o){g.close();if(n==null||n.statusText==null||n.statusText==""){return}Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+n.responseText)}})};Ext.ExportTables=function(a,c,h,f,j){var g=Ext.cookieUtil.getEnvInfo();var b=new Object();b.task="unloaddb";b.token=Ext.cookieUtil.getToken();b.dbname=a;b.targetdir="+D";b.usehash="no";b.target=h;b.ref="no";b.classonly=(c===null?"no":"yes");b.delimit="no";b.estimate="none";b.prefix=Ext.htmlEncode(f);b.cach="none";if(Ext.isArray(c)){b["class"]=[];for(var d=0;d<c.length;d++){b["class"].push({classname:c[d]})}}var e=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(b),success:function(i,k){e.close();try{var m=Ext.decode(i.responseText);if(m.status==="success"){if(j&&typeof j.success==="function"){j.success(i,k)}}else{if(Ext.checkTokenStatus(m.note)){Ext.showErrorWin(Ext.htmlEncode(m.note))}}}catch(l){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+i.responseText)}},failure:function(i,k){e.close();if(i==null||i.statusText==null||i.statusText==""){return}Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+i.responseText)}})};Ext.userLogin=function(d,a,b,e){var c=new Object();c.task="dbmtuserlogin";c.token=Ext.cookieUtil.getToken();c.targetid=Ext.cookieUtil.getDbmtUserName();c.dbname=d;c.dbuser=a;c.dbpasswd=b;Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(c),success:function(f,g){try{if(f.status==200){var i=Ext.decode(f.responseText);if(i.status=="success"){if(e&&typeof e.success==="function"){e.success(f,g)}}else{if(Ext.checkTokenStatus(i.note)){Ext.showErrorWin(I18N_Util.getMsg("msgFailLogin")+"<br>"+Ext.htmlEncode(i.note))}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgFailConnServer")+"<br>"+f.responseText)}}catch(h){Ext.Trace(h)}},failure:function(f,g){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}})};Ext.checkDbPass=function(d,a,b,e){var c=new Object();c.task="dbmtuserlogin";c.token=Ext.cookieUtil.getToken();c.targetid=Ext.cookieUtil.getDbmtUserName();c.dbname=d;c.dbuser=a;c.dbpasswd=b;Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(c),success:function(f,h){if(e&&typeof e.success==="function"){e.success(f,h)}else{var g=Ext.decode(f.responseText);if(g&&g.status!=="success"){if(Ext.checkTokenStatus(g.note)){Ext.showFailureWin(Ext.htmlEncode(g.note))}}}},failure:function(f,g){if(e&&typeof e.failure==="function"){e.failure(f,g)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}}})};Ext.VerifyAdminPassword=function(b,c,d){var a=new Object();a.task="login";a.id=b;a.password=c;a.clientver="8.4";Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(a),success:function(f,g){try{if(f.status==200){var i=Ext.decode(f.responseText);if(i.status=="success"){Ext.cookieUtil.setToken(i.token);if(typeof d==="function"){d(true)}}else{if(typeof d==="function"){d(false)}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}}catch(h){Ext.Trace(h)}},failure:function(f,g){try{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText);if(callback&&typeof callback.failure==="function"){callback.failure(f,g)}}catch(h){Ext.Trace(h)}}})};Ext.connectCMServer=function(c,b,d,e){var a=new Object();a.task="login";a.id=Ext.dbmtUserName;a.password=Ext.dbmtUserPwd;a.clientver="8.4";Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(a),success:function(f,g){try{if(f.status==200){var i=Ext.decode(f.responseText);if(i.status=="success"){if(c===true){Ext.create("cwm.widget.ChangeUserPassword",{hintInfo:I18N_Util.getMsg("msgChangeDeftCmsUserPass"),loginId:Ext.dbmtUserName,oldPass:Ext.dbmtUserPwd,loginResponse:f,loginRequest:g,login:b,appController:d})}else{if(e&&typeof e.success==="function"){e.success(f,g)}}}else{Ext.showFailureWin(I18N_Util.getMsg("msgFailLogin")+"<br>"+i.note)}}else{Ext.showErrorWin(I18N_Util.getMsg("msgFailConnServer")+"<br>"+f.responseText)}}catch(h){Ext.Trace(h)}},failure:function(f,g){try{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText);if(e&&typeof e.failure==="function"){e.failure(f,g)}}catch(h){Ext.Trace(h)}}})};Ext.runDb=function(c,a,e){var b=new Object();if(a){b.task="startdb"}else{b.task="stopdb"}b.token=Ext.cookieUtil.getToken();b.dbname=c;var d=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(b),success:function(f,g){d.close();try{if(f.status==200){var i=Ext.decode(f.responseText);if(i.status=="success"){if(e&&typeof e.success==="function"){e.success(f,g)}}else{if(Ext.checkTokenStatus(i.note)){if(i.note==null||i.note==""){i.note=I18N_Util.getMsg("msgErrUnknownInServer")}Ext.showErrorWin(i.note)}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}}catch(h){Ext.Trace(h)}},failure:function(f,g){d.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}})};Ext.getEnv=function(a){var b=new Object();b.task="getenv";b.token=Ext.cookieUtil.getToken();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(b),success:function(c,d){if(c.status==200){try{var g=Ext.decode(c.responseText);if(g.status=="success"){Ext.cookieUtil.setEnvInfo(g);if(typeof a==="function"){a()}}else{if(Ext.checkTokenStatus(g.note)){Ext.showErrorWin(g.note)}}}catch(f){Ext.Trace(f)}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}},failure:function(c,d){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}})};Ext.getCMSEnv=function(a){var b=new Object();b.task="getcmsenv";b.token=Ext.cookieUtil.getToken();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(b),success:function(c,d){if(c.status==200){try{var g=Ext.decode(c.responseText);if(g.status=="success"){Ext.util.Cookies.set("cmsEnvInfo",Ext.encode(g));if(typeof a==="function"){a()}}else{if(Ext.checkTokenStatus(g.note)){Ext.showErrorWin(g.note)}}}catch(f){Ext.Trace(f)}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}},failure:function(c,d){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}})};Ext.GetAllSysParam=function(b,a,d){var c=new Object();c.task=b;c.token=Ext.cookieUtil.getToken();c.confname=a;Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(c),success:function(f,g){if(f.status==200){try{var i=Ext.decode(f.responseText);if(i.status==="success"){if(d&&typeof d.success==="function"){d.success(f,g)}}else{if(Ext.checkTokenStatus(i.note)){Ext.showErrorWin(i.note)}}}catch(h){Ext.Trace(h)}}},failure:function(e,f){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})},Ext.checkDbOpenState=function(c){try{for(var a=0;a<Ext.dblist.length;a++){if(Ext.dblist[a].name==c){return Ext.dblist[a].isOpened}}}catch(b){Ext.Trace(b)}return false};Ext.deleteDb=function(b,c,a){if(a){Ext.runDb(b,false,{success:function(d,e){Ext.dropDb(b,c)},failure:function(d,e){}})}else{Ext.dropDb(b,c)}};Ext.dropDb=function(b,d){var a=new Object();a.task="deletedb";a.token=Ext.cookieUtil.getToken();a.dbname=b;a.delbackup="y";var c=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(a),success:function(f,g){c.close();try{if(f.status==200){var i=Ext.decode(f.responseText);if(i.status=="success"){if(d&&typeof d.success==="function"){d.success(f,g)}}else{if(Ext.checkTokenStatus(i.note)){Ext.showErrorWin(i.note)}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}}catch(h){Ext.Trace(h)}},failure:function(f,g){c.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText);try{if(d&&typeof d.failure==="function"){d.failure(f,g)}}catch(h){Ext.Trace(h)}}})};Ext.createDb=function(d,g,f){var b=Ext.cookieUtil.getEnvInfo();var c=new Object();c.task="createdb";c.token=Ext.cookieUtil.getToken();c.dbname=d;c.numpage=10240;c.pagesize=4096;c.logsize=10240;c.logpagesize=4096;c.genvolpath=b.CUBRID_DATABASES+"/"+d;c.logvolpath=c.genvolpath;c.exvol=new Array();if(Ext.cwm.isCreateDbNeedCharset()){c.charset=g}var a=new Object();a[d+"_data_x001"]="data;1280;"+c.genvolpath;a[d+"_index_x001"]="index;1280;"+c.genvolpath;a[d+"_temp_x001"]="temp;1280;"+c.genvolpath;a[d+"_generic_x001"]="generic;1280;"+c.genvolpath;c.exvol.push(a);c.overwrite_config_file="YES";var e=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(c),success:function(h,i){e.close();if(h.status==200){try{var k=Ext.decode(h.responseText);if(k.status=="success"){if(f&&typeof f.success==="function"){f.success(h,i)}}else{if(Ext.checkTokenStatus(k.note)){Ext.showErrorWin(k.note)}}}catch(j){Ext.Trace(j)}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+h.responseText)}},failure:function(h,i){e.close();try{if(f&&typeof f.failure==="function"){f.failure(h,i)}}catch(j){Ext.Trace(j)}Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+h.responseText)}})};Ext.getDbIndex=function(b){for(var a=0;a<Ext.dblist.length;a++){if(Ext.dblist[a].name===b){return a}}return -1};Ext.TruncateTables=function(f,c){if(!Ext.isArray(c)){return}var d=new Array();for(var b=0;b<c.length;b++){var e;e='TRUNCATE TABLE "'+c[b]+'"';d.push(e)}var a={success:function(g,l){var h=Ext.decode(g.responseText);if(h==null||h.status!=1000){Ext.showErrorWin(Ext.htmlEncode(h.note));return}if(h.result==null){return}var k="";for(var j=0;j<h.result.length;j++){if(h.result[j].status!=0){k+=h.result[j].note+"<br>"}}if(k==""){Ext.showSuccessWin(I18N_Util.getMsg("msgSucTruncate"))}else{Ext.showErrorWin('<span style="color:red">'+I18N_Util.getMsg("msgErrOccur")+"</span><br><br>"+I18N_Util.getMsg("msgErrDetail")+'<br><br><div style="overflow:auto; height:100px">'+k+"</div>")}}};Ext.QueryByCCI(f,d,a)};Ext.addOrUpdateBackupPlan=function(b,i,f,g){var d=new Object();if(i){d.task="addbackupinfo"}else{d.task="setbackupinfo"}d.token=Ext.cookieUtil.getToken();d.dbname=b;var h=function(j){if(j==="Every Month"){return"Monthly"}else{if(j==="Every Week"){return"Weekly"}else{if(j==="Every Day"){return"Daily"}else{return"Special"}}}};var c=function(j){if(j.type==="Every Month"){return j.day}else{if(j.type==="Every Week"){return j.week}else{if(j.type==="Every Day"){return"nothing"}else{return j.date}}}};var e=function(j){if(j){return"ON"}else{return"OFF"}};var a=function(j){var k=j.toString();if(k.length<2){k="0"+k}return k};d.backupid=f.id;d.path=f.path;d.period_type=h(f.type);d.period_date=c(f);d.time=a(f.hour)+a(f.min);d.level=f.level.slice(0,1);d.archivedel=e(f.delvolumns);d.updatestatus=e(f.updateinfo);d.storeold=e(f.storeold);d.zip=f.compress?"y":"n";d.check=f.checkconsis?"y":"n";d.onoff=(f.mode==="online")?"ON":"OFF";d.mt=f.numberthread;d.bknum=f.bkfilenumber;Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(d),success:function(j,k){try{if(j.status=200){var m=Ext.decode(j.responseText);if(m.status==="success"){if(g&&typeof g.success==="function"){g.success(j,k)}}else{if(Ext.checkTokenStatus(m.note)){Ext.showErrorWin(Ext.htmlEncode(m.note))}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+j.responseText)}}catch(l){Ext.Trace("Ext.addBackupPlan:"+l)}},failure:function(j,k){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+j.responseText)}})};Ext.DeleteBackupPlan=function(b,d,c){var a=new Object();a.task="deletebackupinfo";a.token=Ext.cookieUtil.getToken();a.dbname=b;a.backupid=d;Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(a),success:function(f,g){try{if(f.status=200){var i=Ext.decode(f.responseText);if(i.status==="success"){if(typeof c.success==="function"){c.success(f,g)}}else{if(Ext.checkTokenStatus(i.note)){Ext.showFailureWin(Ext.htmlEncode(i.note))}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}}catch(h){Ext.Trace("Ext.DeleteBackupPlan:"+h)}},failure:function(e,f){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.getBackupInfos=function(b,c){var a=new Object();a.task="getbackupinfo";a.token=Ext.cookieUtil.getToken();a.dbname=b;Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(a),success:function(d,f){try{if(d.status=200){var h=Ext.decode(d.responseText);if(h.status==="success"){if(typeof c.success==="function"){c.success(d,f)}}else{if(Ext.checkTokenStatus(h.note)){Ext.showFailureWin(Ext.htmlEncode(h.note))}}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}}catch(g){Ext.Trace("Ext.getBackupInfos:"+g)}},failure:function(d,e){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}})};Ext.sortArray=function(b,a){if(Ext.isArray(b)){var c=function(d){return function(h,g){var f,e;if(typeof h==="object"&&typeof g==="object"&&h.hasOwnProperty(d)&&g.hasOwnProperty(d)){f=h[d];e=g[d];if(f===e){return 0}return f<e?-1:1}else{throw ("sort by function error")}}};b.sort(c(a))}};Ext.getTables=function(b,c){var a=new Object();a.task="classinfo";a.token=Ext.cookieUtil.getToken();a.dbname=b;Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(a),success:function(d,k){try{if(d.status=200){var m=Ext.decode(d.responseText);if(m.status=="success"){var h=Ext.getDbIndex(b);if(h==-1&&c&&typeof c.failure==="function"){c.failure(d,k);throw ("can not found the database: "+b)}Ext.dblist[h].tables.splice(0,Ext.dblist[h].tables.length);if(m.userclass.length>0&&typeof m.userclass[0]["class"]!="undefined"){var g=m.userclass[0]["class"];for(var f=0;f<g.length;f++){if(g[f].virtual!="normal"){continue}var j=new Object();j.name=g[f].classname;j.owner=g[f].owner;j.virtual=g[f].virtual;j.type="table";j.icon=Ext.ImagePath+"b_browse.png";j.fields=new Array();j.indexes=new Array();Ext.dblist[h].tables.push(j)}}Ext.sortArray(Ext.dblist[h].tables,"name");if(c&&typeof c.success==="function"){c.success(d,k)}}else{if(Ext.checkTokenStatus(m.note)){Ext.showErrorWin(Ext.htmlEncode(m.note))}}}}catch(l){Ext.Trace("Ext.getTables:"+l)}},failure:function(d,e){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}})};Ext.getTableList=function(c,d){var b="SELECT class_name,owner_name,class_type,is_system_class,partitioned FROM db_class AS a WHERE LOWER(a.class_name) NOT IN (SELECT LOWER(partition_class_name) FROM db_partition) AND is_system_class='NO' ORDER BY class_name";var a=[b];Ext.QueryByCCI(c,a,{success:function(f,l){try{var n=Ext.decode(f.responseText);if(n.status!==1000){return}else{if(n.status===1000){var h=n.result[0]["values"];var j=Ext.getDbIndex(c);if(j==-1&&d&&typeof d.failure==="function"){d.failure(result,l);throw ("can not found the database: "+c)}Ext.dblist[j].tables.splice(0,Ext.dblist[j].tables.length);if(Ext.isArray(h)){for(var g=0;g<h.length;g++){if(h[g][2]!="CLASS"){continue}var k=new Object();k.name=h[g][0];k.owner=h[g][1];k.virtual=h[g][2];k.partitioned=h[g][4];k.type="table";k.icon=Ext.ImagePath+"b_browse.png";k.fields=new Array();k.indexes=new Array();Ext.dblist[j].tables.push(k)}}if(d&&typeof d.success==="function"){d.success(f,l)}}}}catch(m){Ext.Trace("Ext.getTables:"+m)}}})};Ext.getTablesByCCI=function(c){var b="SELECT class_name FROM db_class AS a WHERE LOWER(a.class_name) NOT IN (SELECT LOWER(partition_class_name) FROM db_partition) AND is_system_class='NO' ORDER BY class_name";var a=[b];Ext.QueryByCCIWithWaitBox(Ext.currentDb,a,{success:function(d,e){if(c&&typeof c.success==="function"){c.success(d,e)}else{}},failure:function(d,e){if(c&&typeof c.failure==="function"){c.failure(d,e)}else{}}})};Ext.getCurCmUserAuthInfo=function(b){var a=Ext.cookieUtil.getDbmtUserName();Ext.getDbmtUserInfo({success:function(c,f){var d=Ext.decode(c.responseText);var g=new JSEX();var h=function(){var q=false;if(d&&d.status==="success"){var m;if(Ext.isArray(d.userlist)&&d.userlist.length>0&&Ext.isArray(d.userlist[0].user)){var s=d.userlist[0].user;for(var p=0;p<s.length;p++){if(s[p]["@id"]===a){m=s[p];m["@passwd"]="";Ext.cwm.curCmUserAuth=m;break}}if(a!=="admin"){var l;var j=Ext.getCmp("cubrid-manager-home-view");if(j){j.refreshCtabBar()}var o=Ext.getCmp("BrokerView");if(o){if(m&&m.casauth==="none"){l=I18N_Util.getMsg("msgBeRemovedAuth",{name:I18N_Util.getMsg("lblBrokers")});Ext.showErrorWin(l,function(){var i=Ext.getCmp("LeftPanelToolBar");if(i){i.fireEvent("GotoHome",i,null)}g.next()});q=true}else{if(m){o.refreshAuth()}}}var k=Ext.getCmp("AutomationView");if(k){k.checkBrokerAuth()}var n=Ext.getCmp("ReportView");if(n){n.checkBrokerAuth()}var r=Ext.getCmp("monitorView");if(r){if(m&&m.statusmonitorauth==="none"){l=I18N_Util.getMsg("msgBeRemovedAuth",{name:I18N_Util.getMsg("lblMonitors")});Ext.showErrorWin(l,function(){var i=Ext.getCmp("LeftPanelToolBar");if(i){i.fireEvent("GotoHome",i,null)}g.next()});q=true}}}}}if(q!==true){g.next()}};var e=function(){if(b&&typeof b.success==="function"){b.success(c,f);g.end()}};g.push(h);g.push(e);g.exec()}})};Ext.getCurCmUserDbAuth=function(){var a;if(Ext.cwm.curCmUserAuth&&Ext.isArray(Ext.cwm.curCmUserAuth.dbauth)&&Ext.cwm.curCmUserAuth.dbauth.length>0&&Ext.cwm.curCmUserAuth.dbauth[0]&&Ext.cwm.curCmUserAuth.dbauth[0]["auth_info"]){a=Ext.cwm.curCmUserAuth.dbauth[0]["auth_info"]}return a};Ext.getCurCmUserDbAuthByDbName=function(e){var b=Ext.getCurCmUserDbAuth();var a={dbid:"",bip:"",bport:""};if(Ext.isArray(b)){for(var d=0;d<b.length;d++){if(b[d]["dbname"]===e){var c=b[d]["dbbrokeraddress"].split(",");a.dbid=b[d]["@dbid"];if(Ext.isArray(c)&&c.length===2){a.bip=c[0];a.bport=c[1]}return a}}}return a};Ext.getCurCmUserBrokerAuth=function(){var a;var b=Ext.cookieUtil.getDbmtUserName();if(b==="admin"){a="admin"}else{if(Ext.cwm.curCmUserAuth&&Ext.cwm.curCmUserAuth.casauth){a=Ext.cwm.curCmUserAuth.casauth}}return a};Ext.getDatabaseList=function(d){var a=new Object();a.task="startinfo";var b=Ext.cookieUtil.getToken();a.token=b;var c=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(a),success:function(t,k){c.close();try{if(t.status==200){var h=Ext.decode(t.responseText);if(h.status=="failure"){if(Ext.checkTokenStatus(h.note)){Ext.showFailureWin(h.note)}return}Ext.cmStatus=0;var q=null;var r=new Array();if(Ext.isArray(h.activelist)&&h.activelist.length>0){if(h.activelist[0]!=null&&!!h.activelist[0].active){for(var l=0;l<h.activelist[0].active.length;l++){r.push(h.activelist[0].active[l].dbname)}}}if(Ext.isArray(h.dblist)&&h.dblist.length>0){q=h.dblist[0].dbs}var g=function(i,j){for(var e=0;e<i.length;e++){if(i[e]==j){return true}}return false};Ext.dblist.splice(0,Ext.dblist.length);var s=Ext.cookieUtil.getDbmtUserName();var n=Ext.getCurCmUserDbAuth();if(Ext.isArray(q)){if(s==="admin"){for(var m=0;m<q.length;m++){var f=new Object();f.name=q[m].dbname;f.path=q[m].dbdir;f.type="db";f.tables=new Array();f.isOpened=g(r,f.name);if(f.isOpened){f.icon=Ext.ImagePath+"database_start.png"}else{f.icon=Ext.ImagePath+"database_stop.png"}Ext.dblist.push(f)}}else{if(Ext.isArray(n)){var o=n.length;for(var m=0;m<q.length;m++){for(var l=0;l<n.length&&o>0;l++){if(q[m]["dbname"]===n[l]["dbname"]){var f=new Object();f.name=q[m].dbname;f.path=q[m].dbdir;f.type="db";f.tables=new Array();f.isOpened=g(r,f.name);if(f.isOpened){f.icon=Ext.ImagePath+"database_start.png"}else{f.icon=Ext.ImagePath+"database_stop.png"}Ext.dblist.push(f);o--;break}}}}}Ext.sortArray(Ext.dblist,"name")}if(d&&typeof d.success==="function"){d.success(t,k)}}}catch(p){Ext.Trace(p)}},failure:function(f,g){c.close();try{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText);if(d&&typeof d.failure==="function"){d.failure(f,g)}}catch(h){Ext.Trace(h)}}})};Ext.getDbLists=function(d){var a=new Object();a.task="startinfo";var b=Ext.cookieUtil.getToken();a.token=b;var c=Ext.createWaitWin();Ext.Ajax.request({method:"POST",url:Ext.cmApi,jsonData:Ext.encode(a),success:function(e,g){c.close();if(d&&typeof d.success==="function"){d.success(e,g)}else{var f=Ext.decode(e.responseText);if(f&&f.status!=="success"){if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}}},failure:function(e,f){c.close();if(d&&typeof d.failure==="function"){d.failure(e,f)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}}})};Ext.isAuthedDb=function(b){for(var a=0;a<Ext.dblist.length;a++){if(b===Ext.dblist[a]["name"]){return true}}return false};Ext.getDatabaseListWithRetry=function(b){for(var a=0;a<Ext.cmRetryTimes;a++){Ext.getDatabaseList(b);if(Ext.cmStatus==0){break}else{Ext.connectCmServer()}}if(Ext.cmStatus>0){Ext.Trace("get database list from cubrid manager api failed");Ext.cmStatus=0}};Ext.createDbListObj=function(){var c=new Array();for(var b=0;b<Ext.dblist.length;b++){var a=new Object();a.name=Ext.dblist[b].name;a.isOpened=Ext.dblist[b].isOpened;c.push(a)}return c};Ext.getUserInfo=function(b){var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"userinfo",dbname:Ext.currentDb,token:a},success:function(c,e){if(b&&typeof b.success==="function"){b.success(c,e)}else{var d=Ext.decode(c.responseText);if(Ext.checkTokenStatus(d.note)){Ext.showFailureWin(Ext.htmlEncode(d.note))}}},failure:function(c,d){if(b&&typeof b.failure==="function"){b.failure(c,d)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}}})};Ext.isDbaUser=function(e,a){if(!a){return}var b=a.toUpperCase();var d="SELECT COUNT(*) FROM db_user d WHERE {'DBA'} SUBSETEQ (SELECT SET{'"+b+"'}+COALESCE(SUM(SET{t.g.name}), SET{}) FROM db_user u, TABLE(groups) AS t(g) WHERE u.name = d.name) AND d.name='"+b+"'";var c=[d];Ext.QueryByCCI(e,c,{success:function(i,l){try{var j=Ext.decode(i.responseText);if(j&&j.status==1000){var f=j.result;if(Ext.isArray(f)&&f[0].status===0){var h=f[0].values;var k=parseInt(h[0][0]);var g=false;if(k>0){g=true}else{g=false}Ext.cookieUtil.setDbUserIsDba(e,g);Ext.cwm.curDbUserIsDba=g}}}catch(m){Ext.Trace(m)}}})};Ext.getBrokerInfo=function(b){var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"getbrokersinfo",token:a},success:function(c,e){if(b&&typeof b.success==="function"){b.success(c,e)}else{var d=Ext.decode(c.responseText);if(Ext.checkTokenStatus(d.note)){Ext.showFailureWin(d.note)}}},failure:function(c,d){if(b&&typeof b.failure==="function"){b.failure(c,d)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}}})};Ext.getBrokerStatus=function(a,c){if(!a){return}var b=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"getbrokerstatus",token:b,bname:a},success:function(d,f){if(c&&typeof c.success==="function"){c.success(d,f)}else{var e=Ext.decode(d.responseText);if(Ext.checkTokenStatus(e.note)){Ext.showFailureWin(e.note)}}},failure:function(d,e){if(c&&typeof c.failure==="function"){c.failure(d,e)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}}})};Ext.startBroker=function(a,d){var b=Ext.cookieUtil.getToken();var c=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"broker_start",token:b,bname:a},success:function(e,g){c.close();if(d&&typeof d.success==="function"){d.success(e,g)}else{var f=Ext.decode(e.responseText);if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){c.close();if(d&&typeof d.failure==="function"){d.failure(e,f)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}}})};Ext.stopBroker=function(a,d){var b=Ext.cookieUtil.getToken();var c=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"broker_stop",token:b,bname:a},success:function(e,g){c.close();if(d&&typeof d.success==="function"){d.success(e,g)}else{var f=Ext.decode(e.responseText);if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){c.close();if(d&&typeof d.failure==="function"){d.failure(e,f)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}}})};Ext.startAllBrokers=function(c){var a=Ext.cookieUtil.getToken();var b=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"startbroker",token:a},success:function(d,e){b.close();if(c&&typeof c.success==="function"){c.success(d,e)}else{if(Ext.checkTokenStatus(json.note)){Ext.showFailureWin(json.note)}}},failure:function(d,e){b.close();if(c&&typeof c.failure==="function"){c.failure(d,e)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}}})};Ext.stopAllBrokers=function(c){var a=Ext.cookieUtil.getToken();var b=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"stopbroker",token:a},success:function(d,f){b.close();if(c&&typeof c.success==="function"){c.success(d,f)}else{var e=Ext.decode(d.responseText);if(Ext.checkTokenStatus(e.note)){Ext.showFailureWin(e.note)}}},failure:function(d,e){b.close();if(c&&typeof c.failure==="function"){c.failure(d,e)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}}})};Ext.getAllBrokersNameAndPort=function(a){Ext.getBrokerInfo({success:function(c,d){try{var m=Ext.decode(c.responseText);if(!m){return}if(m.status=="success"){var b=m.brokersinfo;var g=b[0].broker;var k=new Array();for(var h=0;h<g.length;h++){var f=new Object();f.name=g[h].name;var l=g[h].port;if(typeof l!=="number"){l=parseInt(l)}f.port=l;k.push(f)}Ext.cookieUtil.setAllBrokers(k);if(typeof a==="function"){a(k)}}}catch(j){Ext.Trace(j)}},failure:function(b,c){Ext.Msg.alert("Error","Communication with server error! Get all brokers info failure.")}})};Ext.getValidBrokerNameAndPort=function(a){Ext.getBrokerInfo({success:function(c,d){try{var m=Ext.decode(c.responseText);if(!m){return}if(m.status=="success"){var b=m.brokersinfo;var h=b[0].broker;var f=new Array();for(var j=0;j<h.length;j++){if(h[j].state=="ON"){var g=new Object();g.name=h[j].name;var l=h[j].port;if(typeof l!=="number"){l=parseInt(l)}g.port=l;f.push(g)}}Ext.cookieUtil.setValidBrokers(f);if(typeof a==="function"){a()}}else{if(Ext.checkTokenStatus(m.note)){Ext.showFailureWin(m.note)}}}catch(k){Ext.Trace(k)}},failure:function(b,c){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+b.responseText)}})};Ext.updateUser=function(e,b,a,d){Ext.Trace("Warning: You are calling a deprecated function!");var c=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"updateuser",dbname:Ext.currentDb,token:c,username:e,userpass:b,groups:a,authorization:[]},success:function(f,h){if(d&&typeof d.success==="function"){d.success(f,h)}else{var g=Ext.decode(f.responseText);if(Ext.checkTokenStatus(g.note)){Ext.showFailureWin(g.note)}}},failure:function(f,g){if(d&&typeof d.failure==="function"){d.failure(f,g)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}}})};Ext.getBrokerDiagData=function(b){var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",timeout:Ext.cwm.monitorTaskTimeout,jsonData:{task:"getbrokerdiagdata",token:a},success:function(c,e){if(b&&typeof b.success==="function"){b.success(c,e)}else{var d=Ext.decode(c.responseText);if(Ext.checkTokenStatus(d.note)){Ext.showFailureWin(d.note)}}},failure:function(c,d){if(b&&typeof b.failure==="function"){b.failure(c,d)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}}})};Ext.getDbProcStat=function(c,d){var b=Ext.cookieUtil.getToken();var a={task:"getdbprocstat",token:b,dbname:c};if(typeof c==="undefined"||c===null||c==="All Databases"||c===""){a={task:"getdbprocstat",token:b}}Ext.Ajax.request({url:Ext.cmApi,method:"post",timeout:Ext.cwm.monitorTaskTimeout,jsonData:a,success:function(e,g){if(d&&typeof d.success==="function"){d.success(e,g)}else{var f=Ext.decode(e.responseText);if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){if(d&&typeof d.failure==="function"){d.failure(e,f)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}}})};Ext.getHostStat=function(b){var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",timeout:Ext.cwm.monitorTaskTimeout,jsonData:{task:"gethoststat",token:a},success:function(c,e){if(b&&typeof b.success==="function"){b.success(c,e)}else{var d=Ext.decode(c.responseText);if(Ext.checkTokenStatus(d.note)){Ext.showFailureWin(d.note)}}},failure:function(c,d){if(b&&typeof b.failure==="function"){b.failure(c,d)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}}})};Ext.getStatDump=function(b,c){if(!b){return}var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",timeout:Ext.cwm.monitorTaskTimeout,jsonData:{task:"statdump",token:a,dbname:b},success:function(d,f){if(c&&typeof c.success==="function"){c.success(d,f)}else{var e=Ext.decode(d.responseText);if(Ext.checkTokenStatus(e.note)){Ext.showFailureWin(e.note)}}},failure:function(d,e){if(c&&typeof c.failure==="function"){c.failure(d,e)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}}})};Ext.getDbSpaceInfo=function(b,d){if(!b){return}var a=Ext.cookieUtil.getToken();var c=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"dbspaceinfo",token:a,dbname:b},success:function(e,g){c.close();var f=Ext.decode(e.responseText);if(!f){return}if(f.status==="success"){if(d&&Ext.isFunction(d.success)){d.success(e,g)}}else{if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){c.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.getDbSpace=function(c,b){if(!Ext.isArray(c)){return}var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"dbspace",token:a,dblist:c},success:function(d,f){if(b&&typeof b.success==="function"){b.success(d,f)}else{var e=Ext.decode(d.responseText);if(Ext.checkTokenStatus(e.note)){Ext.showFailureWin(e.note)}}},failure:function(d,e){if(b&&typeof b.failure==="function"){b.failure(d,e)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}}})};Ext.getSysDiskInfo=function(b){var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"getsysdiskinfo",token:a},success:function(c,e){if(b&&typeof b.success==="function"){b.success(c,e)}else{var d=Ext.decode(c.responseText);if(Ext.checkTokenStatus(d.note)){Ext.showFailureWin(d.note)}}},failure:function(c,d){if(b&&typeof b.failure==="function"){b.failure(c,d)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}}})};Ext.getDbmtUserInfo=function(b){var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"getdbmtuserinfo",token:a},success:function(c,e){if(b&&typeof b.success==="function"){b.success(c,e)}else{var d=Ext.decode(c.responseText);if(Ext.checkTokenStatus(d.note)){Ext.showFailureWin(d.note)}}},failure:function(c,d){if(b&&typeof b.failure==="function"){b.failure(c,d)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}}})};Ext.addDbmtUser=function(b,c){if(typeof b.targetid!=="string"||typeof b.password!=="string"||typeof b.casauth!=="string"||typeof b.dbcreate!=="string"||typeof b.statusmonitorauth!=="string"){return}var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"adddbmtuser",token:a,targetid:b.targetid,password:b.password,casauth:b.casauth,dbcreate:b.dbcreate,statusmonitorauth:b.statusmonitorauth},success:function(d,f){if(c&&typeof c.success==="function"){c.success(d,f)}else{var e=Ext.decode(d.responseText);if(Ext.checkTokenStatus(e.note)){Ext.showFailureWin(e.note)}}},failure:function(d,e){if(c&&typeof c.failure==="function"){c.failure(d,e)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}}})};Ext.updateDbmtUser=function(b,c){if(typeof b.targetid!=="string"||!Ext.isArray(b.dbauth)||typeof b.casauth!=="string"||typeof b.dbcreate!=="string"||typeof b.statusmonitorauth!=="string"){return}var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"updatedbmtuser",token:a,targetid:b.targetid,dbauth:b.dbauth,casauth:b.casauth,dbcreate:b.dbcreate,statusmonitorauth:b.statusmonitorauth},success:function(d,f){if(c&&typeof c.success==="function"){c.success(d,f)}else{var e=Ext.decode(d.responseText);if(Ext.checkTokenStatus(e.note)){Ext.showFailureWin(e.note)}}},failure:function(d,e){if(c&&typeof c.failure==="function"){c.failure(d,e)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}}})};Ext.deleteDbmtUser=function(b,c){if(typeof b!=="string"||b==""){return}var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"deletedbmtuser",token:a,targetid:b},success:function(d,f){if(c&&typeof c.success==="function"){c.success(d,f)}else{var e=Ext.decode(d.responseText);if(Ext.checkTokenStatus(e.note)){Ext.showFailureWin(e.note)}}},failure:function(d,e){if(c&&typeof c.failure==="function"){c.failure(d,e)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}}})};Ext.isRecordedFavorName=function(a){if(typeof a!=="string"){return}try{for(var b=0;b<Ext.cwm.favorites.length;b++){if(a.toLowerCase()===Ext.cwm.favorites[b]["name"].toLowerCase()){return true}}return false}catch(c){Ext.Trace(c);return false}};Ext.openFavorSite=function(c){if(c>=Ext.cwm.favorites.length){Ext.Trace("Err: fail to open favorite cased by wrong id:"+c+", which is not smaller than records length:"+Ext.cwm.favorites.length);return}var a=Ext.cwm.favorites[c]["url"];if(!a.match(/^(mailto\:|(news|(ht|f)tp(s?))\:\/\/)/i)){a="http://"+a}var b=window.open(a);if(typeof b==="undefined"){Ext.showFailureWin(I18N_Util.getMsg("msgFail2OpenFavorite"))}};Ext.delFavorSite=function(a){if(a>=Ext.cwm.favorites.length){Ext.Trace("Err: fail to delete favorite cased by wrong id:"+a+", which is not smaller than records length:"+Ext.cwm.favorites.length);return}Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmDelFavorite",{name:Ext.htmlEncode(Ext.cwm.favorites[a]["name"])}),width:250,buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(b,c){if(b=="yes"){Ext.cwm.favorites.splice(a,1);Ext.setFavorites(Ext.encode(Ext.cwm.favorites),function(){var d=Ext.getCmp("FavoritesWidget");if(d){d.refresh()}})}}})};Ext.setFavorites=function(b,d){var a=Ext.cookieUtil.getToken();var c=Ext.cookieUtil.getDbmtUserName();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"writeprivatedata",token:a,confname:"favor_"+c,confdata:b},success:function(e,g){var f=Ext.decode(e.responseText);if(!f){return}if(f.status==="success"){if(Ext.isFunction(d)){d()}}else{if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.getFavorites=function(c){var a=Ext.cookieUtil.getToken();var b=Ext.cookieUtil.getDbmtUserName();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"readprivatedata",token:a,confname:"favor_"+b},success:function(d,h){var g=Ext.decode(d.responseText);if(!g){return}if(g.status==="success"){try{if(!Ext.isArray(g.confdata)){throw ("No vaild favorites data!")}var j="";for(var f=0;f<g.confdata.length;f++){j+=g.confdata[f]}Ext.cwm.favorites=Ext.decode(j)}catch(k){Ext.Trace(k)}if(Ext.isFunction(c)){c()}}else{if(Ext.checkTokenStatus(g.note)){if(g.note==="open favor_"+b+" failed!"&&Ext.isFunction(c)){c()}else{Ext.showFailureWin(g.note)}}}},failure:function(d,e){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}})};Ext.setAutoAddVol=function(b,d){if(typeof b.dbname!=="string"||typeof b.data!=="string"||typeof b.index!=="string"){Ext.Trace("Err: fail to setautoaddvol cased by unacceptable parameters!");return}var a=Ext.cookieUtil.getToken();var c=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"setautoaddvol",token:a,dbname:b.dbname,data:b.data,data_warn_outofspace:b.data_warn_outofspace,data_ext_page:b.data_ext_page,index:b.index,index_warn_outofspace:b.index_warn_outofspace,index_ext_page:b.index_ext_page},success:function(e,g){c.close();var f=Ext.decode(e.responseText);if(!f){return}if(f.status==="success"){if(d&&Ext.isFunction(d.success)){d.success(e,g)}}else{if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){c.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.getAutoAddVol=function(b,d){if(typeof b!=="string"){Ext.Trace("Err: fail to getautoaddvol cased by miss dbname!");return}var a=Ext.cookieUtil.getToken();var c=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"getautoaddvol",token:a,dbname:b},success:function(e,g){c.close();var f=Ext.decode(e.responseText);if(!f){return}if(f.status==="success"){if(d&&Ext.isFunction(d.success)){d.success(e,g)}}else{if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){c.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.setAutoStart=function(c,b,e){if(typeof c!=="string"||c===""||!Ext.isArray(b)){Ext.Trace("Err: fail to setautostart cased by unacceptable parameters!");return}var a=Ext.cookieUtil.getToken();var d=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"setautostart",token:a,service:c,auto_start:b},success:function(f,h){d.close();var g=Ext.decode(f.responseText);if(!g){return}if(g.status==="success"){if(e&&Ext.isFunction(e.success)){e.success(f,h)}}else{if(Ext.checkTokenStatus(g.note)){Ext.showFailureWin(g.note)}}},failure:function(f,g){d.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}})};Ext.getAutoStart=function(c){var a=Ext.cookieUtil.getToken();var b=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"getautostart",token:a},success:function(d,f){b.close();var e=Ext.decode(d.responseText);if(!e){return}if(e.status==="success"){if(e.auto_start){if(Ext.isArray(e.auto_start["brokers"])){Ext.cwm.autoStartupBrokers=e.auto_start["brokers"]}if(Ext.isArray(e.auto_start["databases"])){Ext.cwm.autoStartupDbs=e.auto_start["databases"]}}if(c&&Ext.isFunction(c.success)){c.success(d,f)}}else{if(Ext.checkTokenStatus(e.note)){Ext.showFailureWin(e.note)}}},failure:function(d,e){b.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}})};Ext.getAutoStartLog=function(a,c,e){if(typeof a!=="string"||a===""||typeof c!=="string"||c===""){Ext.Trace("Err: fail to get autojobs.log cased by unacceptable parameters!");return}var b=Ext.cookieUtil.getToken();var d=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"readprivatedata",token:b,confname:"autojobs.log"},success:function(h,j){d.close();var r=Ext.decode(h.responseText);if(!r){return}var f=new Array();if(r.status==="success"){try{var m=r.confdata;if(!Ext.isArray(m)){throw ("no auto job log!")}var l,q,p,o,g;for(var k=0;k<m.length;k++){l=new Object();q=m[k].indexOf(" ");l.time=m[k].substring(0,q);g=Ext.Date.parse(l.time,"Ymd_H:i:s");l.time=Ext.Date.format(g,"Y/m/d H:i:s");p=m[k].indexOf(" ",q+1);l.type=m[k].substring(q+1,p);o=m[k].indexOf(" ",p+1);l.name=m[k].substring(p+1,o);if(l.name!==a||l.type!==c){continue}l.desc=m[k].substring(o+3,m[k].length);f.push(l)}if(Ext.isFunction(e)){e(f)}}catch(n){Ext.Trace(n);if(Ext.isFunction(e)){e(f)}}}else{if(Ext.checkTokenStatus(r.note)){if(r.note==="File(?) open error"&&Ext.isFunction(e)){e(f)}else{Ext.showFailureWin(r.note)}}}},failure:function(f,g){d.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}})};Ext.setAutoJobConf=function(c,a,e){var b=Ext.cookieUtil.getToken();var d=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"setautojobconf",token:b,service:c,jobconf:a},success:function(f,h){d.close();var g=Ext.decode(f.responseText);if(!g){return}if(g.status==="success"){if(e&&Ext.isFunction(e.success)){e.success(f,h)}}else{if(Ext.checkTokenStatus(g.note)){Ext.showFailureWin(g.note)}}},failure:function(f,g){d.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText)}})};Ext.getAutoJobConf=function(b,d){var a=Ext.cookieUtil.getToken();var c=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"getautojobconf",token:a,service:b},success:function(e,g){c.close();var f=Ext.decode(e.responseText);if(d&&Ext.isFunction(d.success)){d.success(e,g)}else{if(f.status!=="success"&&Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){c.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.sendMail=function(b,d){if(!(b&&typeof b.sender==="string"&&typeof b.smtp_server==="string"&&typeof b.password==="string"&&typeof b.receiver==="string")){return}var a=Ext.cookieUtil.getToken();var c=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"sendmail",token:a,username:b.sender,password:b.password,sender:b.sender,receiver:b.receiver,smtp_server:b.smtp_server,body_type:1,authtype:typeof b.authtype==="number"?b.authtype:2,msg_header:typeof b.msg_header==="string"?b.msg_header:"CUBRID Log Report",msg_body:typeof b.msg_body==="string"?b.msg_body:""},success:function(e,g){c.close();var f=Ext.decode(e.responseText);if(!f){return}if(f.status==="success"){if(d&&Ext.isFunction(d.success)){d.success(e,g)}}else{if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){c.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.getDbLockInfo=function(c){var b=new JSEX();for(var a=0;a<Ext.dblist.length;a++){if(a===0){b.push(function(){Ext.lockDb(Ext.dblist[0].name,{success:function(d,e){var f=Ext.decode(d.responseText);if(f.status==="success"){if(Ext.isArray(f.lockinfo)&&f.lockinfo[0]&&Ext.isArray(f.lockinfo[0]["transaction"])){Ext.dblist[0]["lockNum"]=f.lockinfo[0]["transaction"].length}else{Ext.dblist[0]["lockNum"]=0}}b.next(1)},failure:function(d,e){b.next(1)}})})}else{b.push(function(d){Ext.lockDb(Ext.dblist[d].name,{success:function(e,f){var g=Ext.decode(e.responseText);if(g.status==="success"){if(Ext.isArray(g.lockinfo)&&g.lockinfo[0]&&Ext.isArray(g.lockinfo[0]["transaction"])){Ext.dblist[d]["lockNum"]=g.lockinfo[0]["transaction"].length}else{Ext.dblist[d]["lockNum"]=0}}if(d<Ext.dblist.length){b.next(++d)}else{b.next()}},failure:function(e,f){if(d<Ext.dblist.length){b.next(++d)}else{b.next()}}})})}}b.push(function(){if(Ext.isFunction(c)){c()}});b.exec()};Ext.lockDb=function(b,d){if(typeof b!=="string"){Ext.Trace("Fail to get lock info for invalid DB name");return}var a=Ext.cookieUtil.getToken();var c=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"lockdb",token:a,dbname:b},success:function(e,g){c.close();var f=Ext.decode(e.responseText);if(d&&Ext.isFunction(d.success)){d.success(e,g)}else{if(f.status!=="success"){Ext.checkTokenStatus(f.note)}}},failure:function(e,f){c.close();if(d&&Ext.isFunction(d.failure)){d.failure(e,f)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}}})};Ext.isTimeOutOfRange=function(c,a,b){if(Ext.isDate(c)&&Ext.isDate(a)&&Ext.isNumber(b)){if(a.getTime()-c.getTime()>b*24*60*60*1000){return 1}else{return 0}}else{return -1}};Ext.getMailBody=function(j,m,a,c,d,g){var n="<br>";n+="This is a log report mail of CUBRID @ '"+location.hostname+"'.<br><br>";var b="";try{c=Ext.Date.parse(c,"YmdHis");d=Ext.Date.parse(d,"YmdHis");if(Ext.isDate(c)&&Ext.isDate(d)){c=Ext.Date.format(c,"Y/m/d H:i:s");d=Ext.Date.format(d,"Y/m/d H:i:s");b+="Start time: "+c+"<br>End time: "+d+"<br>"}}catch(h){Ext.Trace("Err in parse date.")}var l='<table border="1" style="border-collapse:collapse;">',f;if(j==="db"){n+="Database: "+a+"<br>";if(m==="addvol"){n+="Log type: auto add volumn log<br>";n+=b+"<br>";l+="<tr><th>Database</th><th>Purpose</th><th>Page</th><th>Volume Name</th><th>Time</th><th>Description</th></tr>";for(f=0;f<g.length;f++){l+="<tr><td>"+g[f]["dbname"]+"</td><td>"+g[f]["purpose"]+"</td><td>"+g[f]["page"]+"</td><td>"+g[f]["volname"]+"</td><td>"+g[f]["time"]+"</td><td>"+g[f]["outcome"]+"</td></tr>"}l+="</table>"}else{if(m==="backup"){n+="Log type: auto backup plan log<br>";n+=b+"<br>";l+="<tr><th>Database</th><th>Backup ID</th><th>Auto Backup Time</th><th>Description</th></tr>";for(f=0;f<g.length;f++){l+="<tr><td>"+g[f]["dbname"]+"</td><td>"+g[f]["backupid"]+"</td><td>"+g[f]["error_time"]+"</td><td>"+g[f]["error_desc"]+"</td></tr>"}l+="</table>"}else{if(m==="err"){n+="Log type: error log<br>";n+=b+"<br>";l+="<tr><th>Time</th><th>Error Type</th><th>Error Code</th><th>Tran ID</th><th>Error ID</th><th>Error Message</th></tr>";for(f=0;f<g.length;f++){l+="<tr><td>"+g[f]["time"]+"</td><td>"+g[f]["type"]+"</td><td>"+g[f]["code"]+"</td><td>"+g[f]["tranid"]+"</td><td>"+g[f]["errid"]+"</td><td>"+g[f]["msg"]+"</td></tr>"}l+="</table>"}}}}else{if(j==="broker"){n+="Broker<br>";if(m==="start-stop"){n+="Log type: start/stop log<br>";n+=b+"<br>";l+="<tr><th>Broker</th><th>Time</th><th>Description</th></tr>";for(f=0;f<g.length;f++){l+="<tr><td>"+g[f]["name"]+"</td><td>"+g[f]["time"]+"</td><td>"+g[f]["desc"]+"</td></tr>"}l+="</table>"}}}n+=l+"<br><br>";var k=Ext.getAbsoluteUrl();n+='Your can see more information from: <a href="'+k+'">'+k+"</a>.";return n};Ext.getAbsoluteUrl=function(b){var a=location.protocol+"//"+location.host;var c=location.pathname;a+=c.substring(0,c.lastIndexOf("/")+1);a+=typeof b==="string"?b:"";return a};Ext.isPositiveNumeric=function(b){var a=parseFloat(b);if(isFinite(b)&&!isNaN(b)&&b>0){return true}else{return false}};Ext.getAutoAddVolLog=function(f,i,h,b){if(typeof f!=="string"){Ext.Trace("Err: Fail to getautoaddvollog cased by miss param!");return}var c=Ext.cookieUtil.getToken();var a={task:"getautoaddvollog",token:c};if(typeof h==="string"&&typeof b==="string"){try{h=Ext.Date.parse(h,"YmdHis");b=Ext.Date.parse(b,"YmdHis");if(Ext.isDate(h)&&Ext.isDate(b)){a.start_time=Ext.Date.format(h,"Y-m-d,H:i:s");a.end_time=Ext.Date.format(b,"Y-m-d,H:i:s")}else{Ext.Trace("Request break cased by invalid time param!");return}}catch(d){Ext.Trace(d);return}}var g=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:a,success:function(e,m){g.close();var l=Ext.decode(e.responseText);if(!l){return}if(l.status==="success"){var k=new Array(),n;if(Ext.isArray(l.log)){for(var j=0;j<l.log.length;j++){n=new Object();if(f===l.log[j]["dbname"]){n=l.log[j];k.push(n)}}}l=null;if(Ext.isFunction(i)){i(k)}}else{if(Ext.checkTokenStatus(l.note)){Ext.showFailureWin(l.note)}}},failure:function(e,j){g.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.getAutoBackupDbErrLog=function(g,f,b){var c=Ext.cookieUtil.getToken();var a={task:"getautobackupdberrlog",token:c};if(typeof f==="string"&&typeof b==="string"){try{f=Ext.Date.parse(f,"YmdHis");b=Ext.Date.parse(b,"YmdHis");if(Ext.isDate(f)&&Ext.isDate(b)){a.start_time=Ext.Date.format(f,"Y/m/d H:i:s");a.end_time=Ext.Date.format(b,"Y/m/d H:i:s")}else{Ext.Trace("Request break cased by invalid time param!");return}}catch(d){Ext.Trace(d);return}}Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:a,success:function(e,i){if(g&&typeof g.success==="function"){g.success(e,i)}else{var h=Ext.decode(e.responseText);if(h&&h.status!=="success"){if(Ext.checkTokenStatus(h.note)){Ext.showFailureWin(h.note)}}}},failure:function(e,h){if(g&&typeof g.failure==="function"){g.failure(e,h)}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}}})};Ext.getDbErrLog=function(d,h,a,g){var b=Ext.cookieUtil.getToken();try{h=Ext.Date.parse(h,"YmdHis");a=Ext.Date.parse(a,"YmdHis");if(Ext.isDate(h)&&Ext.isDate(a)){h=Ext.Date.format(h,"Y/m/d H:i:s");a=Ext.Date.format(a,"Y/m/d H:i:s")}else{Ext.Trace("Request break cased by invalid time param!");return}}catch(c){Ext.Trace(c);return}var f=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"getdberrorlog",token:b,start_time:h,end_time:a,dbname:d},success:function(k,m){f.close();var r=Ext.decode(k.responseText);if(!r){return}var e,s,o,q;var p=new Array();if(r.status==="success"){if(Ext.isArray(r.result)){for(var n=0;n<r.result.length;n++){if(Ext.isArray(r.result[n]["logs"])){e=r.result[n]["logs"];for(var l=0;l<e.length;l++){s=e[l];if(Ext.String.trim(s).length>0&&"***"!==(s.substring(0,3))){if(s.toLowerCase().indexOf("time:")===0){o=new Object();o.time=s.substring(6,s.indexOf(" - "));o.type=s.substring(s.indexOf(" - ")+3,s.indexOf(" *** "));if(s.indexOf("*** ERROR CODE = ")>=0){o.code=s.substring(s.indexOf("*** ERROR CODE = ")+17,s.indexOf(", Tran = "));if(s.indexOf(", EID = ")===-1){o.tranid=s.substring(s.indexOf(", Tran = ")+9);o.errid=""}else{o.tranid=s.substring(s.indexOf(", Tran = ")+9,s.indexOf(", ",s.indexOf(", Tran = ")+9));o.errid=s.substring(s.indexOf(", EID = ")+8)}if(l+1<e.length&&e[l+1].toLowerCase().indexOf("time:")!==0){o.msg=e[l+1]}}else{if(l+1<e.length&&e[l+1].toLowerCase().indexOf("time:")!==0){q=e[l+1];l++}else{q=""}o.msg=s.substring(s.indexOf("*** file ")+4)+" : "+q}p.push(o)}else{o=new Object();o.msg=s;p.push(o)}}}}}}if(r.overflow===1){Ext.showWarningWin(I18N_Util.getMsg("msgRecOverflow"),function(){if(g&&Ext.isFunction(g)){g(p)}})}else{if(g&&Ext.isFunction(g)){g(p)}}}else{Ext.showFailureWin(r.note)}},failure:function(e,i){f.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.getBrokerLog=function(g,a,f){var b=Ext.cookieUtil.getToken();try{g=Ext.Date.parse(g,"YmdHis");a=Ext.Date.parse(a,"YmdHis");if(Ext.isDate(g)&&Ext.isDate(a)){g=Ext.Date.format(g,"Y/m/d H:i:s");a=Ext.Date.format(a,"Y/m/d H:i:s")}else{Ext.Trace("Request break cased by invalid time param!");return}}catch(c){Ext.Trace(c);return}var d=Ext.createWaitWin();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"getbrokerlog",token:b,start_time:g,end_time:a},success:function(e,i){d.close();var h=Ext.decode(e.responseText);if(!h){return}if(h.status==="success"){if(f&&Ext.isFunction(f.success)){f.success(e,i)}}else{Ext.showFailureWin(h.note)}},failure:function(e,h){d.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.storeSharedLog=function(d,b,c){var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"writeprivatedata",token:a,confname:d+".tmp",confdata:b},success:function(e,g){var f=Ext.decode(e.responseText);if(!f){return}if(f.status==="success"){if(Ext.isFunction(c)){c()}}else{if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}},failure:function(e,f){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}})};Ext.getTempLog=function(c,b){if(typeof c!=="string"){Ext.Trace("Err: unaccept param!");return}var a=Ext.cookieUtil.getToken();Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"readprivatedata",token:a,confname:c+".tmp"},success:function(d,f){var e=Ext.decode(d.responseText);if(!e){return}if(e.status==="success"){if(b&&Ext.isFunction(b.success)){b.success(d,f)}}else{if(e.note==="open "+c+".tmp failed!"){Ext.showFailureWin(I18N_Util.getMsg("msgFail2GetLog"))}else{Ext.showFailureWin(e.note)}}},failure:function(d,e){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}})};Ext.isAcceptLogType=function(c,b){var a=false;if(c==="db"){if(b==="addvol"||b==="backup"||b==="err"){a=true}}else{if(c==="broker"){if(b==="start-stop"){a=true}}}return a};CodeMirror.defineMode("cubrid",function(b){var e=b.indentUnit;var k;function g(m){return new RegExp("^(?:"+m.join("|")+")$","i")}var a=g(["str","lang","langmatches","datatype","bound","sameterm","isiri","isuri","isblank","isliteral","a"]);var d=g([("ABS"),("ABSOLUTE"),("ACTION"),("ACTIVE"),("ADD"),("ADD_MONTHS"),("AFTER"),("ALIAS"),("ALL"),("ALLOCATE"),("ALTER"),("ANALYZE"),("AND"),("ANY"),("ARE"),("AS"),("ASC"),("ASSERTION"),("ASYNC"),("AT"),("ATTACH"),("ATTRIBUTE"),("AUDIT"),("AUTHORIZATION"),("AUTOCOMMIT"),("AUTO_INCREMENT"),("AVG"),("BEFORE"),("BEGIN"),("BETWEEN"),("BIGINT"),("BIT"),("BIT_LENGTH"),("BIT_TO_BLOB"),("BLOB"),("BLOB_FROM_FILE"),("BLOB_LENGTH"),("BLOB_TO_BIT"),("CLOB_FROM_FILE"),("CLOB_LENGTH"),("CLOB_TO_CHAR"),("BOOLEAN"),("BOTH"),("BREADTH"),("BY"),("CACHE"),("CALL"),("CASCADE"),("CASCADED"),("CASE"),("CAST"),("CATALOG"),("CEIL"),("CHANGE"),("CHAR"),("CHARACTER"),("CHARACTER_LENGTH"),("CHAR_LENGTH"),("CHECK"),("CHR"),("CLASS"),("CLOB"),("CLASSES"),("COLUMNS"),("CLOSE"),("CLUSTER"),("COALESCE"),("COLLATE"),("COLLATION"),("COLUMN"),("COMMIT"),("COMMITTED"),("COMPLETION"),("CONNECT"),("CONNECTION"),("CONNECT_BY_ISCYCLE"),("CONNECT_BY_ISLEAF"),("CONNECTION_BY_ROOT"),("CONSTRAINT"),("CONSTRAINTS"),("CONTINUE"),("CONVERT"),("CORRESPONDING"),("COST"),("COUNT"),("CREATE"),("CROSS"),("CURRENT"),("CURRENT_DATE"),("CURRENT_DATETIME"),("CURRENT_TIME"),("CURRENT_TIMESTAMP"),("CURRENT_USER"),("CURRENT_VALUE"),("CURRVAL"),("CURSOR"),("CYCLE"),("DATA"),("DATA_TYPE"),("DATE"),("DAYOFWEEK"),("DAYOFMONTH"),("DAYOFYEAR"),("DATETIME"),("DAY"),("DAY_MILLISECOND"),("DEALLOCATE"),("DEC"),("DECIMAL"),("DECLARE"),("DECODE"),("DECREMENT"),("DEFAULT"),("DEFERRABLE"),("DEFERRED"),("DELETE"),("DEPTH"),("DESC"),("DESCRIBE"),("DESCRIPTOR"),("DIAGNOSTICS"),("DICTIONARY"),("DIFFERENCE"),("DISCONNECT"),("DISTINCT"),("DOMAIN"),("DOUBLE"),("DROP"),("EACH"),("ELSE"),("ELSEIF"),("ELT"),("END"),("EQUALS"),("ESCAPE"),("EVALUATE"),("EXCEPT"),("EXCEPTION"),("EXCLUDE"),("EXEC"),("EXECUTE"),("EXISTS"),("EXPLAIN"),("EXTERNAL"),("EXTRACT"),("FALSE"),("FETCH"),("FILE"),("FIRST"),("FLOAT"),("FLOOR"),("FOR"),("FROM"),("FROM_DAYS"),("FOREIGN"),("FOUND"),("FROM_UNIXTIME"),("FULL"),("FUNCTION"),("GENERAL"),("GET"),("GE_INF"),("GE_LE"),("GE_LT"),("GLOBAL"),("GO"),("GOTO"),("GRANT"),("GRANTS"),("GREATEST"),("GROUP"),("GROUP_CONCAT"),("GROUPBY_NUM"),("GROUPS"),("GT_INF"),("GT_LE"),("GT_LT"),("HASH"),("HAVING"),("HOUR"),("HOUR_MILLISECOND"),("IDENTITY"),("IF"),("IGNORE"),("IMMEDIATE"),("IN"),("INACTIVE"),("INCREMENT"),("INDEX"),("INDEXES"),("INDEX_CARDINALITY"),("INDICATOR"),("INFINITE"),("INF_LE"),("INF_LT"),("INHERIT"),("INITIALLY"),("INNER"),("INOUT"),("INPUT"),("INSERT"),("INSTANCES"),("INSTR"),("INSTRB"),("INST_NUM"),("INT"),("INTEGER"),("INTERSECT"),("INTERSECTION"),("INTERVAL"),("INTO"),("INVALIDATE"),("IS"),("ISOLATION"),("JAVA"),("JOIN"),("KEY"),("KEYLIMIT"),("KEYS"),("LANGUAGE"),("LAST"),("LAST_DAY"),("LDB"),("LEADING"),("LEAST"),("LEAVE"),("LEFT"),("LENGTH"),("LENGTHB"),("LESS"),("LEVEL"),("LIKE"),("LIKE_MATCH_LOWER_BOUND"),("LIKE_MATCH_UPPER_BOUND"),("LIMIT"),("LIST"),("LOCAL"),("LOCAL_TRANSACTION_ID"),("LOCK"),("LOOP"),("LOWER"),("LPAD"),("LTRIM"),("MAKEDATE"),("MAKETIME"),("MATCH"),("MAX"),("MAXIMUM"),("MAXVALUE"),("MD5"),("MEDIUMINT"),("MEMBERS"),("METHOD"),("MILLISECOND"),("MIN"),("MINUTE"),("MINUTE_MILLISECOND"),("MINVALUE"),("MOD"),("MODIFY"),("MODULE"),("MONETARY"),("MONTH"),("MONTHS_BETWEEN"),("MULTISET"),("MULTISET_OF"),("NA"),("NAME"),("NAMES"),("NATIONAL"),("NATURAL"),("NCHAR"),("NEW"),("NEXT"),("NEXTVAL"),("NEXT_VALUE"),("NO"),("NOCACHE"),("NOCYCLE"),("NOMAXVALUE"),("NOMINVALUE"),("NONE"),("NOT"),("NULL"),("NULLIF"),("NUMERIC"),("NVL"),("NVL2"),("OBJECT"),("OCTET_LENGTH"),("OF"),("OFF"),("OID"),("OLD"),("ON"),("ONLY"),("OPEN"),("OPERATION"),("OPERATORS"),("OPTIMIZATION"),("OPTION"),("OR"),("ORDER"),("ORDERBY_NUM"),("OTHERS"),("OUT"),("OUTER"),("OUTPUT"),("OVERLAPS"),("PARAMETERS"),("PARTIAL"),("PARTITION"),("PARTITIONING"),("PARTITIONS"),("PASSWORD"),("PENDANT"),("POSITION"),("POWER"),("PRECISION"),("PREORDER"),("PREPARE"),("PRESERVE"),("PRIMARY"),("PRINT"),("PRIOR"),("PRIORITY"),("PRIVATE"),("PRIVILEGES"),("PROCEDURE"),("PROTECTED"),("PROXY"),("QUERY"),("RANDOM"),("RANGE"),("REPEAT"),("READ"),("REAL"),("RECURSIVE"),("REF"),("REFERENCES"),("REFERENCING"),("REGISTER"),("REJECT"),("RELATIVE"),("REMOVE"),("RENAME"),("REORGANIZE"),("REPEATABLE"),("REPLACE"),("RESIGNAL"),("RESTRICT"),("RETAIN"),("RETURN"),("RETURNS"),("REVERSE"),("REVOKE"),("REUSE_OID"),("RIGHT"),("ROLE"),("ROLLBACK"),("ROUND"),("ROUTINE"),("ROW"),("ROWNUM"),("ROWS"),("RPAD"),("RTRIM"),("SAVEPOINT"),("SCHEMA"),("SCOPE"),("SCROLL"),("SEARCH"),("SECOND"),("SECOND_MILLISECOND"),("SEC_TO_TIME"),("SECTION"),("SELECT"),("SENSITIVE"),("SEPARATOR"),("SEQUENCE"),("SEQUENCE_OF"),("SERIAL"),("SERIALIZABLE"),("SESSION"),("SESSION_USER"),("SET"),("SETEQ"),("SETNEQ"),("SET_OF"),("SHARED"),("SHORT"),("SHOW"),("SIBLINGS"),("SIGN"),("SIGNAL"),("SIMILAR"),("SIZE"),("SMALLINT"),("SOME"),("SPACE"),("SQL"),("SQLCODE"),("SQLERROR"),("SQLEXCEPTION"),("SQLSTATE"),("SQLWARNING"),("STABILITY"),("START"),("STATEMENT"),("STATISTICS"),("STATUS"),("STDDEV"),("STDDEV_POP"),("STDDEV_SAMP"),("STRING"),("STRUCTURE"),("SUBCLASS"),("SUBSET"),("SUBSETEQ"),("SUBSTR"),("SUBSTRB"),("SUBSTRING"),("SUBSTRING_INDEX"),("SUM"),("SUPERCLASS"),("SUPERSET"),("SUPERSETEQ"),("SYSDATE"),("SYSDATETIME"),("SYSTEM"),("SYSTEM_USER"),("SYSTIME"),("SYSTIMESTAMP"),("SYS_CONNECT_BY_PATH"),("SYS_DATE"),("SYS_DATETIME"),("SYS_TIME"),("SYS_TIMESTAMP"),("SYS_USER"),("TABLE"),("TABLES"),("TEMPORARY"),("TEST"),("THAN"),("THEN"),("THERE"),("TIME"),("TIME_TO_SEC"),("TIMEDIFF"),("TIMEOUT"),("TIMESTAMP"),("TIMEZONE_HOUR"),("TIMEZONE_MINUTE"),("TINYINT"),("TO"),("TO_CHAR"),("TO_DATE"),("TO_DAYS"),("TO_NUMBER"),("TO_TIME"),("TO_TIMESTAMP"),("TRACE"),("TRAILING"),("TRANSACTION"),("TRANSLATE"),("TRANSLATION"),("TRIGGER"),("TRIGGERS"),("TRIM"),("TRUE"),("TRUNC"),("TYPE"),("TYPEOF"),("UNCOMMITTED"),("UNDER"),("UNION"),("UNIQUE"),("UNKNOWN"),("UPDATE"),("UPPER"),("USAGE"),("USE"),("USER"),("USING"),("UTC_TIME"),("UTC_DATE"),("UTIME"),("VALUE"),("VALUES"),("VARCHAR"),("VARIABLE"),("VARIANCE"),("VAR_POP"),("VAR_SAMP"),("VARYING"),("VCLASS"),("VERSION"),("VIEW"),("VIRTUAL"),("VISIBLE"),("WHERE"),("WAIT"),("WEEKDAY"),("WHEN"),("WHENEVER"),("WHILE"),("WITH"),("WITHOUT"),("WORK"),("WORKSPACE"),("WRITE"),("YEAR"),("ZONE"),("ACOS"),("ADDDATE"),("ASIN"),("ATAN"),("ATAN2"),("BIT_AND"),("BIT_OR"),("BIT_XOR"),("BIT_COUNT"),("CEILING"),("CONCAT"),("CONCAT_WS"),("COS"),("COT"),("CURDATE"),("CURRENT_DATE"),("CURTIME"),("CURRENT_TIME"),("CURRENT_TIMESTAMP"),("DATABASE"),("DATE_ADD"),("DATEDIFF"),("DATE_FORMAT"),("DATE_SUB"),("DAY_HOUR"),("DAY_MINUTE"),("DAY_SECOND"),("DEGREES"),("DISTINCTROW"),("DIV"),("DO"),("DUPLICATE"),("FIELD"),("FORMAT"),("HOUR_MINUTE"),("HOUR_SECOND"),("IFNULL"),("ISNULL"),("LAST_INSERT_ID"),("LCASE"),("LN"),("LOCALTIME"),("LOCALTIMESTAMP"),("LOG2"),("LOG10"),("LOCATE"),("MID"),("MINUTE_SECOND"),("NOW"),("PI"),("POW"),("QUARTER"),("RADIANS"),("RAND"),("ROW_COUNT"),("ROLLUP"),("SIN"),("SQRT"),("STRCMP"),("STR_TO_DATE"),("SUBDATE"),("TAN"),("TIME_FORMAT"),("TRUNCATE"),("UCASE"),("UNIX_TIMESTAMP"),("WEEK"),("XOR"),("YEAR_MONTH")]);var f=/[*+\-<>=&|]/;function c(q,o){var n=q.next();k=null;if(n=="$"||n=="?"){q.match(/^[\w\d]*/);return"variable-2"}else{if(n=="<"&&!q.match(/^[\s\u00a0=]/,false)){q.match(/^[^\s\u00a0>]*>?/);return"atom"}else{if(n=='"'||n=="'"){o.tokenize=l(n);return o.tokenize(q,o)}else{if(n=="`"){o.tokenize=i(n);return o.tokenize(q,o)}else{if(/[{}\(\),\.;\[\]]/.test(n)){k=n;return null}else{if(n=="-"){ch2=q.next();if(ch2=="-"){q.skipToEnd();return"comment"}}else{if(f.test(n)){q.eatWhile(f);return null}else{if(n==":"){q.eatWhile(/[\w\d\._\-]/);return"atom"}else{q.eatWhile(/[_\w\d]/);if(q.eat(":")){q.eatWhile(/[\w\d_\-]/);return"atom"}var p=q.current(),m;if(a.test(p)){return null}else{if(d.test(p)){return"keyword"}else{return"variable"}}}}}}}}}}}function l(m){return function(q,o){var p=false,n;while((n=q.next())!=null){if(n==m&&!p){o.tokenize=c;break}p=!p&&n=="\\"}return"string"}}function i(m){return function(q,o){var p=false,n;while((n=q.next())!=null){if(n==m&&!p){o.tokenize=c;break}p=!p&&n=="\\"}return"variable-2"}}function h(o,n,m){o.context={prev:o.context,indent:o.indent,col:m,type:n}}function j(m){m.indent=m.context.indent;m.context=m.context.prev}return{startState:function(m){return{tokenize:c,context:null,indent:0,col:0}},token:function(o,n){if(o.sol()){if(n.context&&n.context.align==null){n.context.align=false}n.indent=o.indentation()}if(o.eatSpace()){return null}var m=n.tokenize(o,n);if(m!="comment"&&n.context&&n.context.align==null&&n.context.type!="pattern"){n.context.align=true}if(k=="("){h(n,")",o.column())}else{if(k=="["){h(n,"]",o.column())}else{if(k=="{"){h(n,"}",o.column())}else{if(/[\]\}\)]/.test(k)){while(n.context&&n.context.type=="pattern"){j(n)}if(n.context&&k==n.context.type){j(n)}}else{if(k=="."&&n.context&&n.context.type=="pattern"){j(n)}else{if(/atom|string|variable/.test(m)&&n.context){if(/[\}\]]/.test(n.context.type)){h(n,"pattern",o.column())}else{if(n.context.type=="pattern"&&!n.context.align){n.context.align=true;n.context.col=o.column()}}}}}}}}return m},indent:function(q,m){var p=m&&m.charAt(0);var o=q.context;if(/[\]\}]/.test(p)){while(o&&o.type=="pattern"){o=o.prev}}var n=o&&p==o.type;if(!o){return 0}else{if(o.type=="pattern"){return o.col}else{if(o.align){return o.col+(n?0:1)}else{return o.indent+(n?0:e)}}}}}});CodeMirror.defineMIME("text/x-cubrid","cubrid");Ext.define("cwm.model.AddFields",{extend:"Ext.data.Model",fields:[{name:"colname",type:"string"},{name:"type",type:"string"},{name:"lenVal",type:"string"},{name:"default",type:"string"},{name:"notnull",type:"boolean"},{name:"index",type:"string"},{name:"unique",type:"boolean"}]});Ext.define("cwm.model.AutoAddVolLog",{extend:"Ext.data.Model",fields:[{name:"dbname",type:"string"},{name:"purpose",type:"string"},{name:"page",type:"string"},{name:"volname",type:"string"},{name:"time",type:"string"},{name:"outcome",type:"string"}]});Ext.define("cwm.model.AutoBackupLog",{extend:"Ext.data.Model",fields:[{name:"backupid",type:"string"},{name:"dbname",type:"string"},{name:"error_desc",type:"string"},{name:"error_time",type:"string"}]});Ext.define("cwm.model.AutoLogReport",{extend:"Ext.data.Model",fields:["index","receiver","type","dbname","log_type","period_type","next_exec"]});Ext.define("cwm.model.AutoStartupLog",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"time",type:"string"},{name:"desc",type:"string"}]});Ext.define("cwm.model.BackupPlan",{extend:"Ext.data.Model",fields:[{name:"backupid",type:"string"},{name:"level",type:"string"},{name:"path",type:"string"},{name:"period_type",type:"string"},{name:"period_date",type:"string"},{name:"time",type:"string"},{name:"storeold",type:"string"},{name:"archivedel",type:"string"},{name:"updatestatus",type:"string"},{name:"check",type:"string"},{name:"zip",type:"string"},{name:"mt",type:"string"},{name:"bknum",type:"string"},{name:"onoff",type:"string"}]});Ext.define("cwm.model.Broker",{extend:"Ext.data.Model",fields:["name",{name:"state",defaultValue:"OFF"},"pid","port","as","jq","req","tran","query"]});Ext.define("cwm.model.BrokerDetailInf",{extend:"Ext.data.Model",fields:["pid","port","jq","auto","sqll","ses","keep_conn","access_mode"]});Ext.define("cwm.model.BrokerDetailStatus",{extend:"Ext.data.Model",fields:["as_id","as_pid","as_num_query","as_num_tran","as_psize","as_status","as_dbname"]});Ext.define("cwm.model.BrokerDiagData",{extend:"Ext.data.Model",fields:["date",{name:"maxValue",type:"int",defaultValue:10},{name:"session",type:"int"},{name:"trans",type:"int"},{name:"query",type:"int"},{name:"request",type:"int"},{name:"activeSession",type:"int"},{name:"errorQuery",type:"int"},{name:"longQuery",type:"int"},{name:"longTrans",type:"int"}]});Ext.define("cwm.model.BrokerLog",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"time",type:"string"},{name:"desc",type:"string"}]});Ext.define("cwm.model.CMUserList",{extend:"Ext.data.Model",fields:["@id","@passwd","dbcreate","casauth","statusmonitorauth","dbauth"]});Ext.define("cwm.model.CpuChart",{extend:"Ext.data.Model",fields:["date","sysUserCpuUsage","sysKernelCpuUsage","sysIoWaitUsage","sysTotalCpuUsage","dbUserCpuUsage","dbKernelCpuUsage","dbTotalCpuUsage","sysTotalCpuUsageForShow"]});Ext.define("cwm.model.CpuGrid",{extend:"Ext.data.Model",fields:["type","group","userCpuUsage","kernelCpuUsage","IoWaitUsage","totalCpuUsage"]});Ext.define("cwm.model.createTableWindow",{extend:"Ext.data.Model",fields:[{name:"colname",type:"string"},{name:"type",type:"string"},{name:"lenVal",type:"string"},{name:"defaulttype",type:"string"},{name:"defaultval",type:"string"},{name:"attributes",type:"string"},{name:"nullval",type:"boolean"},{name:"index",type:"string"},{name:"ai",type:"boolean"},{name:"comments",type:"string"}]});Ext.define("cwm.model.DbAuth",{extend:"Ext.data.Model",fields:["table",{name:"SELECT",type:"bool"},{name:"INSERT",type:"bool"},{name:"UPDATE",type:"bool"},{name:"DELETE",type:"bool"},{name:"ALTER",type:"bool"},{name:"INDEX",type:"bool"},{name:"EXECUTE",type:"bool"},{name:"GRANT_SELECT",type:"bool"},{name:"GRANT_INSERT",type:"bool"},{name:"GRANT_UPDATE",type:"bool"},{name:"GRANT_DELETE",type:"bool"},{name:"GRANT_ALTER",type:"bool"},{name:"GRANT_INDEX",type:"bool"},{name:"GRANT_EXECUTE",type:"bool"},"isSystemClass"]});Ext.define("cwm.model.DbAuthForCMUser",{extend:"Ext.data.Model",fields:[{name:"dbname"},{name:"connected",type:"string",defaultValue:"No"},{name:"@dbid",type:"string"},{name:"brokerip",type:"string"},{name:"brokerport",type:"string"}]});Ext.define("cwm.model.DbErrLog",{extend:"Ext.data.Model",fields:["time","type","code","tranid","errid","msg"]});Ext.define("cwm.model.DbListView",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"isOpened",type:"boolean"}]});Ext.define("cwm.model.DbProcStat",{extend:"Ext.data.Model",fields:["date","dbname","CPU User (%)","CPU Kernel (%)","CPU Total (%)","memPhysical","memVirtual","Physical Memory (%)"]});Ext.define("cwm.model.DbStatDump",{extend:"Ext.data.Model",fields:["date","data_page_buffer_hit_ratio","num_btree_deletes","num_btree_inserts","num_btree_updates","num_data_page_dirties","num_data_page_fetches","num_data_page_ioreads","num_data_page_iowrites","num_file_creates","num_file_ioreads","num_file_iosynches","num_file_iowrites","num_file_removes","num_log_append_records","num_log_archives","num_log_page_ioreads","num_log_page_iowrites","num_network_requests","num_object_locks_acquired","num_object_locks_converted","num_object_locks_re_requested","num_object_locks_waits","num_page_locks_acquired","num_page_locks_converted","num_page_locks_re_requested","num_page_locks_waits","num_query_deletes","num_query_inserts","num_query_iscans","num_query_lscans","num_query_methscans","num_query_mjoins","num_query_nljoins","num_query_objfetches","num_query_selects","num_query_setscans","num_query_sscans","num_query_updates","num_tran_commits","num_tran_end_topops","num_tran_interrupts","num_tran_rollbacks","num_tran_savepoints","num_tran_start_topops","maxValue"]});Ext.define("cwm.model.DbStatus",{extend:"Ext.data.Model",fields:["dbname","status","cpuPct","memPct","cascnt","qps","lqs","tranLock","data","index","generic","temp","activeLog"]});Ext.define("cwm.model.DbUserGroup",{extend:"Ext.data.Model",fields:["user","groups","members"]});Ext.define("cwm.model.HostStat",{extend:"Ext.data.Model",fields:["date","CPU User (%)","CPU Kernel (%)","cpuTotalUsage","IO Wait (%)","CPU Idle (%)","Physical Memory Free","Physical Memory Used","memPhyTotal","Physical Memory Used (%)","memSwapFree","memSwapUsed","memSwapUsage","memSwapTotal"]});Ext.define("cwm.model.IndexTable",{extend:"Ext.data.Model",fields:[{name:"idxname",type:"string"},{name:"unique",type:"string"},{name:"reverse",type:"string"},{name:"pk",type:"string"},{name:"fk",type:"string"},{name:"keycount",type:"int"}]});Ext.define("cwm.model.MemChart",{extend:"Ext.data.Model",fields:["date","sysPhyMemFree","sysPhyMemUsed","sysPhyMemTotal","dbPhyMemUsed","sysPhyUsage","dbPhyUsage","sysPhyMemUsedForShow"]});Ext.define("cwm.model.MemGrid",{extend:"Ext.data.Model",fields:["type","group","phyMemFree","phyMemUsed","phyMemTotal","swapMemFree","swapMemUsed","swapMemTotal","virtualMemUsed"]});Ext.define("cwm.model.MonitorDbList",{extend:"Ext.data.Model",fields:["dbname","status"]});Ext.define("cwm.model.Partition",{extend:"Ext.data.Model",fields:[{name:"classname",type:"string"},{name:"part_name",type:"string"},{name:"part_classname",type:"string"},{name:"type",type:"string"},{name:"expr",type:"string"},{name:"values",type:"string"}]});Ext.define("cwm.model.SpaceChart",{extend:"Ext.data.Model",fields:["date","dbUsedSize","sysFreeSize","sysUsedSize","sysTotalSize","sysUsedSizeForShow","dbSpaceUsage","sysSpaceUsage"]});Ext.define("cwm.model.SpaceGrid",{extend:"Ext.data.Model",fields:["group","type","totalsize","freesize","usedsize","usage","freepage","usedpage","totalpage"]});Ext.define("cwm.model.TableListView",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"owner",type:"string"},{name:"virtual",type:"string"}]});Ext.define("cwm.model.TableStructure",{extend:"Ext.data.Model",fields:[{name:"index",type:"string"},{name:"name",type:"string"},{name:"type",type:"string"},{name:"notnull",type:"string"},{name:"default",type:"string"},{name:"pkey",type:"boolean"}]});Ext.define("cwm.model.UsersList",{extend:"Ext.data.Model",fields:["name","isdba","pwd"]});Ext.define("cwm.store.BackupLevel",{extend:"Ext.data.Store",storeId:"backuplevelstore",fields:["name"],data:[{name:I18N_Util.getMsg("lblBackupLevel0")},{name:I18N_Util.getMsg("lblBackupLevel1")},{name:I18N_Util.getMsg("lblBackupLevel2")}],proxy:{type:"memory",reader:{type:"json"}}});Ext.define("cwm.store.BackupPeriodDetail",{extend:"Ext.data.Store",fields:["name"],data:[],proxy:{type:"memory",reader:{type:"json"}}});Ext.define("cwm.store.BackupPeriodHour",{extend:"Ext.data.Store",fields:["name"],data:[],proxy:{type:"memory",reader:{type:"json"}}});Ext.define("cwm.store.BackupPeriodMin",{extend:"Ext.data.Store",fields:["name"],data:[],proxy:{type:"memory",reader:{type:"json"}}});Ext.define("cwm.store.BackupPeriodType",{extend:"Ext.data.Store",fields:["name"],data:[{name:"Every Month"},{name:"Every Week"},{name:"Every Day"},{name:"Fixed Date"}],proxy:{type:"memory",reader:{type:"json"}}});Ext.define("cwm.store.BackupPlan",{extend:"Ext.data.Store",requires:["cwm.model.BackupPlan"],storeId:"backupplanstore",model:"cwm.model.BackupPlan",data:[],proxy:{type:"memory",reader:{type:"json"}}});Ext.define("cwm.widget.AutoAddVolWin",{extend:"Ext.window.Window",alias:"widget.autoAddVolWin",autoShow:true,bodyStyle:"border:0;background:transparent;",style:"border:0;background:#F3F3F3;",title:I18N_Util.getMsg("titleAutoAddVolEditor",{name:"undefined"}),bodyPadding:10,modal:true,resizable:false,dbname:"",addItems:function(){var b=this;var a=Ext.create("Ext.form.Panel",{id:"FavoriteForm",bodyStyle:"border:0;background:transparent;",bodyPadding:5,buttonAlign:"center",fieldDefaults:{labelWidth:220,width:400},items:[{xtype:"fieldset",title:I18N_Util.getMsg("titleVolData"),collapsible:false,defaultType:"textfield",items:[{xtype:"checkbox",boxLabel:I18N_Util.getMsg("lblUseAutoAddVol"),name:"data",itemId:"DataCheckbox",checked:true,listeners:{change:function(k,j,f){try{var c=k.up("fieldset");var i=c.down("#DataWarnOutOfSpace");var g=c.down("#DataVolSize");var d=j===true?false:true;i.setDisabled(d);g.setDisabled(d)}catch(h){Ext.Trace(h)}}}},{xtype:"numberfield",fieldLabel:I18N_Util.getMsg("lblWarnOutOfSpace"),name:"data_warn_outofspace",itemId:"DataWarnOutOfSpace",allowBlank:false,allowDecimals:false,minValue:b.RATEMIN,maxValue:b.RATEMAX,value:b.DEFAULT_RATE},{fieldLabel:I18N_Util.getMsg("lblVolSize"),name:"dataVolSize",itemId:"DataVolSize",value:b.DEFAULT_SIZE,validator:function(c){if(Ext.isPositiveNumeric(c)){return true}else{return I18N_Util.getMsg("msgInvalidVolSize")}}}]},{xtype:"fieldset",title:I18N_Util.getMsg("titleVolIndex"),collapsible:false,defaultType:"textfield",items:[{xtype:"checkbox",boxLabel:I18N_Util.getMsg("lblUseAutoAddVol"),name:"index",itemId:"IndexCheckbox",checked:true,listeners:{change:function(k,j,f){try{var c=k.up("fieldset");var i=c.down("#IndexWarnOutOfSpace");var g=c.down("#IndexVolSize");var d=j===true?false:true;i.setDisabled(d);g.setDisabled(d)}catch(h){Ext.Trace(h)}}}},{xtype:"numberfield",fieldLabel:I18N_Util.getMsg("lblWarnOutOfSpace"),name:"index_warn_outofspace",itemId:"IndexWarnOutOfSpace",allowBlank:false,allowDecimals:false,minValue:b.RATEMIN,maxValue:b.RATEMAX,value:b.DEFAULT_RATE},{fieldLabel:I18N_Util.getMsg("lblVolSize"),name:"indexVolSize",itemId:"IndexVolSize",value:b.DEFAULT_SIZE,validator:function(c){if(Ext.isPositiveNumeric(c)){return true}else{return I18N_Util.getMsg("msgInvalidVolSize")}}}]}],buttons:[{text:I18N_Util.getMsg("btnSave"),handler:function(d){var e=d.up("form");if(e){var c=e.getValues();b.submit(c)}}},{text:I18N_Util.getMsg("btnCancel"),handler:function(c){b.close()}}]});b.add(a)},getData:function(){var d=this;var f;for(var b=0;b<Ext.dblist.length;b++){if(Ext.dblist[b]["name"]===d.dbname){f=Ext.dblist[b];break}}var e=new JSEX();var a=function(){Ext.getDbSpaceInfo(d.dbname,{success:function(g,i){var h=Ext.decode(g.responseText);d.pagesize=parseInt(h.pagesize);d.pagesize=isFinite(d.pagesize)?d.pagesize:1;f.pagesize=d.pagesize;e.next()}})};var c=function(){Ext.getAutoAddVol(d.dbname,{success:function(m,n){var s=Ext.decode(m.responseText);var k=d.down("#DataCheckbox");var h=d.down("#DataWarnOutOfSpace");var l=d.down("#DataVolSize");var p=0,j=0;if(s.data==="ON"){k.setValue(true);p=parseFloat(s.data_warn_outofspace);p=isFinite(p)?p*100:0;h.setValue(p);j=s.data_ext_page;j=isFinite(j)?Math.round(j*d.pagesize*100/d.MULTIRATE)/100:0;l.setValue(j)}else{k.setValue(false)}var o=d.down("#IndexCheckbox");var r=d.down("#IndexWarnOutOfSpace");var i=d.down("#IndexVolSize");var g=0,q=0;if(s.index==="ON"){o.setValue(true);g=parseFloat(s.index_warn_outofspace);g=isFinite(g)?g*100:0;r.setValue(g);q=s.index_ext_page;q=isFinite(j)?Math.round(q*d.pagesize*100/d.MULTIRATE)/100:0;i.setValue(q)}else{o.setValue(false)}}})};if(f&&typeof f.pagesize==="number"){d.pagesize=f.pagesize}else{e.push(a)}e.push(c);e.exec()},submit:function(b){if(!b){Ext.Trace("Err: can't get form values");return}var e=this,d="",f={dbname:e.dbname,data:"OFF",data_warn_outofspace:"0",data_ext_page:"0",index:"OFF",index_warn_outofspace:"0",index_ext_page:"0"},h,a,c,g;if(b.data==="on"){h=parseInt(b.data_warn_outofspace);if(!Ext.isPositiveNumeric(b.dataVolSize)){d=I18N_Util.getMsg("msgInvalidVolSize")}else{if(h>e.RATEMAX||h<e.RATEMIN){d=I18N_Util.getMsg("msgInvalidRate",{max:e.RATEMAX,min:e.RATEMIN})}}if(d!==""){Ext.showWarningWin(d);return}else{a=parseFloat(b.dataVolSize);f.data="ON";f.data_warn_outofspace=""+h/100;f.data_ext_page=""+Math.round(a*e.MULTIRATE/e.pagesize)}}if(b.index==="on"){c=parseInt(b.index_warn_outofspace);if(!Ext.isPositiveNumeric(b.indexVolSize)){d=I18N_Util.getMsg("msgInvalidVolSize")}else{if(c>e.RATEMAX||c<e.RATEMIN){d=I18N_Util.getMsg("msgInvalidRate",{max:e.RATEMAX,min:e.RATEMIN})}}if(d!==""){Ext.showWarningWin(d);return}else{g=parseFloat(b.indexVolSize);f.index="ON";f.index_warn_outofspace=""+c/100;f.index_ext_page=""+Math.round(g*e.MULTIRATE/e.pagesize)}}Ext.setAutoAddVol(f,{success:function(i,j){Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){e.close()})}})},initComponent:function(){var b=this;b.callParent(arguments);b.RATEMIN=5;b.RATEMAX=30;b.DEFAULT_RATE=15;b.DEFAULT_SIZE=512;b.MULTIRATE=1024*1024;b.pagesize=1;b.addItems();var a=new Ext.util.DelayedTask(function(){b.getData()});a.delay(300)}});Ext.define("cwm.widget.AutoLogWin",{extend:"Ext.window.Window",alias:"widget.autoLogWin",title:I18N_Util.getMsg("titleAutoStartLog",{name:"undefined"}),bodyStyle:"border: 0; background: #F3F3F3",bodyPadding:"10px",height:350,width:600,autoShow:true,modal:true,resizable:false,name:"",type:"",logType:"",backupId:"",addBackupLog:function(){var a=this;Ext.getAutoBackupDbErrLog({success:function(c,h){var f=Ext.decode(c.responseText);var j=new Array();if(!f){Ext.showFailureWin(I18N_Util.getMsg("msgFail2GetAutoBackupLog"))}else{if(f.status==="success"){var g=Ext.isArray(f.error);if(a.backupId===""){for(var e=0;g&&e<f.error.length;e++){if(f.error[e]["dbname"]===a.name){j.push(f.error[e])}}}else{for(var e=0;g&&e<f.error.length;e++){if(f.error[e]["backupid"]===a.backupId&&f.error[e]["dbname"]===a.name){j.push(f.error[e])}}}}else{if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(Ext.htmlEncode(f.note))}}}if(j.length===0){var b=Ext.create("Ext.panel.Panel",{cls:"infoPanel",title:I18N_Util.getMsg("titleLog"),width:a.winWidth-200,items:[{html:I18N_Util.getMsg("msgNoAutoBackupLog"),border:0,cls:"dbauth_info",bodyStyle:"body"}]});a.add(b)}else{var d=Ext.create("Ext.grid.Panel",{cls:"infoPanel",title:I18N_Util.getMsg("titleLog"),autoScroll:true,height:a.winHeight-50,width:a.winWidth-30,sortableColumns:false,enableColumnMove:false,enableColumnHide:false,store:Ext.create("Ext.data.Store",{model:"cwm.model.AutoBackupLog",autoDestroy:true}),columns:[{text:I18N_Util.getMsg("lblDb"),dataIndex:"dbname"},{text:I18N_Util.getMsg("lblBackupId"),sortable:a.backupId===""?true:false,dataIndex:"backupid"},{text:I18N_Util.getMsg("lblAutoBackupTime"),sortable:true,width:150,dataIndex:"error_time"},{text:I18N_Util.getMsg("lblDescription"),dataIndex:"error_desc",width:200,renderer:function(i){if(!i){return""}else{return i.replace(/<end>/g," ")}}}]});a.add(d);d.getStore().loadData(j)}}})},addStartupLog:function(){var a=this;Ext.getAutoStartLog(a.name,a.type,function(d){if(d.length<1){var b=Ext.create("Ext.panel.Panel",{cls:"infoPanel",title:I18N_Util.getMsg("titleLog"),width:a.winWidth-200,items:[{html:I18N_Util.getMsg("msgNoAutoStartLog"),border:0,cls:"dbauth_info",bodyStyle:"body"}]});a.add(b)}else{var c=Ext.create("Ext.grid.Panel",{cls:"infoPanel",title:I18N_Util.getMsg("titleLog"),autoScroll:true,height:a.winHeight-50,width:a.winWidth-30,sortableColumns:false,enableColumnMove:false,enableColumnHide:false,store:Ext.create("Ext.data.Store",{model:"cwm.model.AutoStartupLog",autoDestroy:true}),columns:[{text:a.type==="databases"?I18N_Util.getMsg("lblDb"):I18N_Util.getMsg("lblBroker"),dataIndex:"name"},{text:I18N_Util.getMsg("lblTime"),sortable:true,width:150,dataIndex:"time"},{text:I18N_Util.getMsg("lblDescription"),dataIndex:"desc",width:300,renderer:function(e){if(!e){return""}else{return e.replace(/<end>/g," ")}}}]});a.add(c);c.getStore().loadData(d)}})},addVolLog:function(){var a=this;Ext.getAutoAddVolLog(a.name,function(d){if(d.length<1){var b=Ext.create("Ext.panel.Panel",{cls:"infoPanel",title:I18N_Util.getMsg("titleLog"),width:a.winWidth-200,items:[{html:I18N_Util.getMsg("msgNoAutoAddVolLog"),border:0,cls:"dbauth_info",bodyStyle:"body"}]});a.add(b)}else{var c=Ext.create("Ext.grid.Panel",{cls:"infoPanel",title:I18N_Util.getMsg("titleLog"),autoScroll:true,height:a.winHeight-50,width:a.winWidth-30,sortableColumns:false,enableColumnMove:false,enableColumnHide:false,store:Ext.create("Ext.data.Store",{model:"cwm.model.AutoAddVolLog",autoDestroy:true}),columns:[{text:I18N_Util.getMsg("lblDb"),dataIndex:"dbname"},{text:I18N_Util.getMsg("lblPurpose"),sortable:true,width:60,dataIndex:"purpose"},{text:I18N_Util.getMsg("lblPage"),width:60,dataIndex:"page"},{text:I18N_Util.getMsg("lblVolName"),sortable:true,width:150,dataIndex:"volname"},{text:I18N_Util.getMsg("lblTime"),sortable:true,width:150,dataIndex:"time"},{text:I18N_Util.getMsg("lblDescription"),dataIndex:"outcome",width:200,renderer:function(e){if(!e){return""}else{return e.replace(/<end>/g," ")}}}]});a.add(c);c.getStore().loadData(d)}})},initComponent:function(){var b=this;b.callParent(arguments);b.winHeight=350;b.winWidth=600;var a=new Ext.util.DelayedTask(function(){if(b.logType==="backup"){b.addBackupLog()}else{if(b.logType==="startup"){b.addStartupLog()}else{if(b.logType==="addVol"){b.addVolLog()}}}});a.delay(300)}});Ext.define("cwm.widget.SendLogToMailWin",{extend:"Ext.window.Window",alias:"widget.sendLogToMailWin",title:I18N_Util.getMsg("titleSendLogToMail"),bodyStyle:"border: 0; background: #F3F3F3",bodyPadding:"10px",autoShow:true,modal:true,resizable:false,type:"instant",addForm:function(){var g=this;var f;if(g.type==="period"){f=I18N_Util.getMsg("btnSave")}else{f=I18N_Util.getMsg("btnSend")}var c={bodyStyle:"border:0;background:transparent;",margin:10,buttonAlign:"center",layout:{type:"table",columns:2},fieldDefaults:{width:300,labelAlign:"left",labelWidth:100},items:[{xtype:"textfield",itemId:"Sender",fieldLabel:I18N_Util.getMsg("lblSender"),name:"sender",disabled:true,labelWidth:100,width:300},{xtype:"button",icon:Ext.ImagePath+"b_edit.png",tooltip:I18N_Util.getMsg("msgEditMailSender"),margin:"0 0 4px 3px",handler:function(h){g.createSenderSettingWin()}},{xtype:"textfield",itemId:"Receiver",fieldLabel:I18N_Util.getMsg("lblReceiver"),name:"receiver",labelWidth:100,width:300,colspan:2}],buttons:[{text:f,itemId:"OkBtn",disabled:true,formBind:true,handler:function(h){g.submit()}},{text:I18N_Util.getMsg("btnCancel"),handler:function(h){g.close()}}]};if(g.type==="period"){var d=new Array();var a;for(var b=0;b<Ext.dblist.length;b++){a=new Object();a.name=Ext.dblist[b]["name"];d.push(a)}c.items.push({xtype:"fieldset",title:I18N_Util.getMsg("titleDbLog"),collapsible:false,defaultType:"textfield",colspan:2,items:[{xtype:"checkbox",boxLabel:I18N_Util.getMsg("lblUseDbLog"),name:"dblog",itemId:"UseDbCheckBox",checked:true,listeners:{change:function(m,j,i){var h=g.down("#DbCombo");var k=g.down("#DbLogTypeCombo");var l=g.down("#DbPeriodType");if(h&&k&&l){if(j===true){h.setDisabled(false);k.setDisabled(false);l.setDisabled(false)}else{h.setDisabled(true);k.setDisabled(true);l.setDisabled(true)}}}}},{xtype:"combo",itemId:"DbCombo",store:Ext.create("Ext.data.Store",{fields:["name"],data:d,autoDestroy:true}),name:"dbname",fieldLabel:I18N_Util.getMsg("lblDb"),queryMode:"local",editable:false,displayField:"name",valueField:"name",value:d.length===0?"":d[0]["name"],colspan:2},{xtype:"combo",itemId:"DbLogTypeCombo",store:Ext.create("Ext.data.Store",{fields:["name","value"],data:g.dbLogType,autoDestroy:true}),name:"dblogtype",fieldLabel:I18N_Util.getMsg("lblLogType"),queryMode:"local",editable:false,displayField:"name",valueField:"value",forceSelection:true,listeners:{afterrender:function(h){h.setValue(h.store.getAt(0))}}},{xtype:"combo",itemId:"DbPeriodType",store:Ext.create("Ext.data.Store",{fields:["name","value"],data:g.periodType,autoDestroy:true}),fieldLabel:I18N_Util.getMsg("lblPeriodType"),name:"dbPeriodType",queryMode:"local",editable:false,displayField:"name",valueField:"value",forceSelection:true,listeners:{afterrender:function(h){h.setValue(h.store.getAt(2))}}}]});c.items.push({xtype:"fieldset",title:I18N_Util.getMsg("titleBrokerLog"),collapsible:false,defaultType:"textfield",colspan:2,items:[{xtype:"checkbox",boxLabel:I18N_Util.getMsg("lblUseBrokerLog"),name:"brokerlog",itemId:"UseBrokerCheckBox",checked:true,listeners:{change:function(k,j,h){var l=g.down("#BrokerLogTypeCombo");var i=g.down("#BrokerPeriodType");if(l&&i){if(j===true){l.setDisabled(false);i.setDisabled(false)}else{l.setDisabled(true);i.setDisabled(true)}}}}},{xtype:"combo",itemId:"BrokerLogTypeCombo",store:Ext.create("Ext.data.Store",{fields:["name","value"],data:g.brokerLogType,autoDestroy:true}),name:"brokerlogtype",fieldLabel:I18N_Util.getMsg("lblLogType"),queryMode:"local",editable:false,displayField:"name",valueField:"value",forceSelection:true,listeners:{afterrender:function(h){h.setValue(h.store.getAt(0))}}},{xtype:"combo",itemId:"BrokerPeriodType",store:Ext.create("Ext.data.Store",{fields:["name","value"],data:g.periodType,autoDestroy:true}),fieldLabel:I18N_Util.getMsg("lblPeriodType"),name:"brokerPeriodType",queryMode:"local",editable:false,displayField:"name",valueField:"value",forceSelection:true,listeners:{afterrender:function(h){h.setValue(h.store.getAt(2))}}}]});c.items.push({xtype:"fieldset",title:I18N_Util.getMsg("titleAutoReportTime"),collapsible:false,colspan:2,items:[{xtype:"checkbox",boxLabel:I18N_Util.getMsg("lblConfReportTime"),name:"confReportTime",itemId:"ReportTimeCheckbox",checked:false,listeners:{change:function(k,j,i){var h=g.down("#ReportTime");if(h){if(j===true){h.setDisabled(false)}else{h.setDisabled(true);h.setValue(g.defaultReportTime)}}}}},{xtype:"timefield",itemId:"ReportTime",name:"reportTime",fieldLabel:I18N_Util.getMsg("lblTime"),increment:60,anchor:"100%",disabled:true,allowBlank:false,format:g.reportTimeFormat,value:g.defaultReportTime}]})}var e=Ext.create("Ext.form.Panel",c);g.add(e)},setMailConfig:function(a,d){if(!(a&&typeof a.email==="string"&&typeof a.smtp==="string"&&typeof a.pass==="string")){return}var b=this;var c="";if(!a.email.match(b.mailRegExp)){c=I18N_Util.getMsg("msgInvalidEmail")}else{if(!a.smtp.match(b.smtpRegExp)){c=I18N_Util.getMsg("msgInvalidSmtp")}}if(c!==""){Ext.showWarningWin(c)}else{Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmChangeMailSender"),width:300,buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(f,g){if(f=="yes"){var e={auth_type:2,onoff:1,password:a.pass,sender:a.email,smtp_server:a.smtp,username:a.email};Ext.setAutoJobConf("mail_config",e,{success:function(h,i){Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){b.getMailConfig();try{d.close()}catch(j){Ext.Trace(j)}})}})}}})}},getMailConfig:function(){var a=this;Ext.getAutoJobConf("mail_config",{success:function(c,f){var g=Ext.decode(c.responseText);var b=a.down("#Sender");var e=a.down("#Receiver");var d=a.down("#OkBtn");if(g.jobconf&&g.jobconf["onoff"]===1){a.isSetSender=true;a.mailConf=g.jobconf;if(b&&e&&d){b.setValue(g.jobconf["sender"]);e.setDisabled(false);d.setDisabled(false)}}}})},submit:function(){var h=this;if(h.isSetSender!==true){Ext.showWarningWin(I18N_Util.getMsg("msgNeedSetSender"));return}var c=h.down("form");var j=c.getValues();if(!j.receiver.match(h.mailRegExp)){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidEmail"));return}if(h.type==="period"){if(j.dblog!=="on"&&j.brokerlog!=="on"){Ext.showWarningWin(I18N_Util.getMsg("msgMissLog"));return}var b=new Array(),d;var i=new Date();if(j.confReportTime==="on"){var k=j.reportTime.split(":");i.setHours(parseInt(k[0]),parseInt(k[1]),0,0);i.setDate(i.getDate()+1)}else{i.setHours(0,0,0,0);i.setDate(i.getDate()+1)}var g=Ext.Date.format(i,"Y/m/d H:i:s");var f=Ext.Date.clone(i);var a=Ext.Date.clone(i);switch(j.dbPeriodType){case 0:f.setDate(f.getDate()-1);break;case 1:f.setDate(f.getDate()-7);break;case 2:f.setMonth(f.getMonth()-1);break;default:}var e=Ext.Date.format(f,"Y/m/d H:i:s");switch(j.brokerPeriodType){case 0:a.setDate(a.getDate()-1);break;case 1:a.setDate(a.getDate()-7);break;case 2:a.setMonth(a.getMonth()-1);break;default:}var l=Ext.Date.format(a,"Y/m/d H:i:s");if(j.dblog==="on"){d=new Object();d.receiver=j.receiver;d.dbname=j.dbname;d.log_type=0;d.period_type=j.dbPeriodType;d.url_prefix=Ext.getAbsoluteUrl();d.next_exec=g;d.prev_exec=e;b.push(d)}if(j.brokerlog==="on"){d=new Object();d.receiver=j.receiver;d.dbname="";d.log_type=1;d.period_type=j.brokerPeriodType;d.url_prefix=Ext.getAbsoluteUrl();d.next_exec=g;d.prev_exec=l;b.push(d)}if(h.callback&&Ext.isFunction(h.callback.addAutoJob)){h.callback.addAutoJob(b)}}else{if(h.callback&&Ext.isFunction(h.callback.sendMail)){h.callback.sendMail({sender:h.mailConf.sender,smtp_server:h.mailConf.smtp_server,password:h.mailConf.password,receiver:j.receiver})}}},createSenderSettingWin:function(){var d=this;var b="",f="",c="";if(d.mailConf){b=d.mailConf.sender;f=d.mailConf.smtp_server;c=d.mailConf.password}var e=Ext.create("Ext.window.Window",{autoShow:true,bodyStyle:"border:0;background:transparent;",style:"border:0;background:#F3F3F3;",title:"Sender Email Setting",bodyPadding:10,modal:true,resizable:false,items:[{xtype:"form",id:"FavoriteForm",bodyStyle:"border:0;background:transparent;",bodyPadding:5,buttonAlign:"center",fieldDefaults:{labelWidth:100,width:300},items:[{xtype:"textfield",fieldLabel:I18N_Util.getMsg("lblEmail"),itemId:"Email",name:"email",value:b},{xtype:"textfield",fieldLabel:I18N_Util.getMsg("lblSmtpServer"),itemId:"Smtp",name:"smtp",value:f},{xtype:"textfield",fieldLabel:I18N_Util.getMsg("lblPassword"),itemId:"Pass",name:"pass",inputType:"password",value:c}],buttons:[{text:I18N_Util.getMsg("btnSave"),handler:function(h){var i=h.up("form");if(i){var g=i.getValues();d.setMailConfig(g,e)}}},{text:I18N_Util.getMsg("btnCancel"),handler:function(g){e.close()}}]}]});var a=e.down("#Email");if(!d.mailConf&&a){a.focus(true,300)}},initComponent:function(){var a=this;a.callParent(arguments);a.winHeight=350;a.winWidth=600;a.mailConf=null;a.mailRegExp=/^[-_a-z0-9]+(.[-_a-z0-9]+)*@[-a-z0-9]+(.[-a-z0-9]+)*(.[a-z]{2,4})$/;a.smtpRegExp=/^\S+/;a.isSetSender=false;a.defaultReportTime="00:00";a.reportTimeFormat="H:i";if(a.type==="period"){a.dbLogType=[{name:I18N_Util.getMsg("lblError"),value:"err"}];a.brokerLogType=[{name:I18N_Util.getMsg("lblStartOrStop"),value:"start-stop"}];a.periodType=[{name:I18N_Util.getMsg("lblDaily"),value:0},{name:I18N_Util.getMsg("lblWeekly"),value:1},{name:I18N_Util.getMsg("lblMonthly"),value:2}]}a.addForm();a.getMailConfig()}});Ext.define("cwm.widget.AutoLogReportManage",{extend:"Ext.grid.Panel",alias:"widget.autoLogReportManage",cls:"infoPanel",width:700,margin:"0 0 10px 0",addDockedItems:function(){var a=this;a.addDocked({xtype:"toolbar",style:"background: transparent; border: 0;",dock:"bottom",ui:"footer",items:[{text:I18N_Util.getMsg("btnAddJob"),handler:function(b){a.addSendLogMailWin()}}]})},addSendLogMailWin:function(){var a=this;var b=Ext.create("cwm.widget.SendLogToMailWin",{title:I18N_Util.getMsg("titleAutoLogReportJob"),type:"period"});b.callback={addAutoJob:function(d){if(!Ext.isArray(d)){return}var c;for(c=0;c<a.autoJobList.length;c++){delete a.autoJobList[c]["index"]}for(c=0;c<d.length;c++){a.autoJobList.push(d[c])}Ext.setAutoJobConf("mail_report",a.autoJobList,{success:function(e,f){var g=Ext.decode(e.responseText);if(g&&g.status==="success"){Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){b.close();a.refreshData()})}else{if(g&&Ext.checkTokenStatus(g.note)){Ext.showFailureWin(I18N_Util.getMsg("msgFail2AddAutoJob")+"<br>"+g.note)}}}})}}},addColumns:function(){var a=this;a.store=Ext.create("Ext.data.Store",{model:"cwm.model.AutoLogReport",autodestroy:true});a.columns=[{header:I18N_Util.getMsg("lblAction"),sortable:false,width:50,xtype:"actioncolumn",items:[{icon:Ext.ImagePath+"b_drop.png",tooltip:I18N_Util.getMsg("msgRemoveAutoReportJob"),handler:function(d,f,c){var e=a.store.getAt(f);var b=e.get("index");Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmRemoveAutoJob"),width:300,buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(g,h){if(g=="yes"){a.delAutoJob(b)}}})}}]},{text:I18N_Util.getMsg("lblReceiver"),width:150,dataIndex:"receiver"},{text:I18N_Util.getMsg("lblType"),dataIndex:"dbname",renderer:function(b){if(b!==""){return I18N_Util.getMsg("lblDb").toLowerCase()}else{return I18N_Util.getMsg("lblBroker").toLowerCase()}}},{text:I18N_Util.getMsg("lblDb"),dataIndex:"dbname",renderer:function(b){if(b===""){return"--"}else{return b}}},{text:I18N_Util.getMsg("lblLogType"),dataIndex:"log_type",renderer:function(b){if(b===0){return I18N_Util.getMsg("lblError").toLowerCase()}else{if(b===1){return I18N_Util.getMsg("lblStartOrStop").toLowerCase()}else{return"--"}}}},{text:I18N_Util.getMsg("lblPeriodType"),dataIndex:"period_type",renderer:function(b){if(b===0){return I18N_Util.getMsg("lblDaily").toLowerCase()}else{if(b===1){return I18N_Util.getMsg("lblWeekly").toLowerCase()}else{if(b===2){return I18N_Util.getMsg("lblMonthly").toLowerCase()}else{return"--"}}}}},{text:I18N_Util.getMsg("lblNextExecTime"),width:150,dataIndex:"next_exec"}]},refreshData:function(){var a=this;Ext.getAutoJobConf("mail_report",{success:function(b,d){var e=Ext.decode(b.responseText);if(Ext.isArray(e.jobconf)){for(var c=0;c<e.jobconf.length;c++){e.jobconf[c]["index"]=c}a.getStore().loadData(e.jobconf);a.autoJobList=e.jobconf}}})},delAutoJob:function(a){var c=this;if(typeof a!=="number"){Ext.Trace("Err: Fail to delete auto job caused by invalid index");return}c.autoJobList.splice(a,1);for(var b=0;b<c.autoJobList.length;b++){delete c.autoJobList[b]["index"]}Ext.setAutoJobConf("mail_report",c.autoJobList,{success:function(d,e){var f=Ext.decode(d.responseText);if(f&&f.status==="success"){Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){c.refreshData()})}else{if(f&&Ext.checkTokenStatus(f.note)){Ext.showFailureWin(I18N_Util.getMsg("msgFail2RemoveAutoJob")+"<br>"+f.note)}}}})},initComponent:function(){var a=this;a.addColumns();a.callParent(arguments);a.autoJobList=new Array();a.addDockedItems();a.refreshData()}});Ext.define("cwm.widget.ColumnEditorGrid",{extend:"Ext.panel.Panel",alias:"widget.colEditorGrid",rowHeight:36,headerHeight:24,autoScroll:true,createHeader:function(){var b=this;var c=Ext.create("Ext.panel.Panel",{width:910,height:b.headerHeight,bodyStyle:"background : #cccccc;",margin:"5 0 5 0",border:0,layout:{type:"hbox",align:"stretch"},createColHeader:function(e,d){this.add(Ext.create("Ext.panel.Panel",{border:0,bodyStyle:"background: transparent; border :none",width:d,margin:"0 0 0 3",height:b.headerHeight,padding:"3 0 3 0",html:e}))}});for(var a=0;a<this.columns.length;a++){c.createColHeader(this.columns[a].text||this.columns[a].header,typeof this.columns[a].width==="undefined"?100:this.columns[a].width)}c.addListener("render",function(){for(var d=0;d<c.items.length-1;d++){var e=c.getComponent(d);e.border="0 1 0 0"}});this.add(c)},insertGridRow:function(d){var b=this;var c=Ext.create("Ext.panel.Panel",{width:910,height:b.rowHeight,border:0,layout:{type:"hbox",align:"stretch"},offset:d,createCol:function(h,i,g){var f=h.editor;var e=null;var j=null;if(typeof f!=="undefined"&&f!==null){j=f.xtype||"edit"}f.margin="4 0 3 3";if(j==="edit"){f.width=g;f.height=b.rowHeight;e=Ext.create("Ext.form.field.Text",f)}else{if(j==="numberfield"){f.width=g;f.height=b.rowHeight;e=Ext.create("Ext.form.field.Number",f)}else{if(j==="combobox"){f.width=g;f.height=b.rowHeight;e=Ext.create("Ext.form.ComboBox",f)}else{if(j==="checkbox"){f.width=g;f.height=b.rowHeight;e=Ext.create("Ext.form.field.Checkbox",f)}else{e=Ext.create("Ext.panel.Panel",{border:0,width:g,margin:"4 0 3 3",height:b.rowHeight,html:i})}}}}e.on("change",function(l,n,k,m){b.getStore().getAt(c.offset).set(h.dataIndex,n)});if(j===null){e.update(b.getStore().getAt(this.offset).get(h.dataIndex))}else{e.setValue(b.getStore().getAt(this.offset).get(h.dataIndex))}e.bodyStyle="background : transparent; border : none";if(typeof e!=="undefined"&&e!==null){this.add(e)}}});for(var a=0;a<this.columns.length;a++){c.createCol(this.columns[a],this.columns[a].text,typeof this.columns[a].width==="undefined"?100:this.columns[a].width)}this.add(c)},getStore:function(){return this.store},removeAllRow:function(){var a=this.items.length;for(var b=1;b<a;b++){var c=this.getComponent(1);this.remove(c,true)}},setBackground:function(){var a=this.items.length;for(var b=2;b<a;b+=2){var c=this.getComponent(b);if(typeof c!=="undefined"){c.addCls("mygrid-row")}}},focusLastRow:function(){var d=this;var a=d.items.length;var c=d.getComponent(a-1);if(c){var b=c.getComponent(0);if(b&&b.xtype.indexOf("field")){b.focus(true,300)}}},initComponent:function(){this.callParent(arguments);var b=this;this.createHeader();for(var a=0;a<this.store.getCount();a++){this.insertGridRow(a)}this.setBackground();this.store.on("add",function(d,c,e,g){if(Ext.isArray(c)){for(var f=0;f<c.length;f++){b.insertGridRow(e+f)}b.setBackground()}else{b.insertGridRow(e);b.setBackground()}})}});Ext.define("cwm.widget.Favorites",{extend:"Ext.panel.Panel",alias:"widget.favorites",id:"FavoritesWidget",width:920,height:300,bodyStyle:"background: transparent;",margin:10,defaults:{border:0},initComponent:function(){var a=this;a.callParent(arguments);a.maxrecs=25;a.maxNameLen=50;a.maxUrlLen=1024;var b=Ext.create("Ext.panel.Panel",{bodyCls:"monitor_grid_title",items:[{xtype:"label",cls:"element",text:I18N_Util.getMsg("titleMyFavorites")},{xtype:"button",icon:Ext.ImagePath+"b_insrow.png",tooltip:I18N_Util.getMsg("msgAddFavorite"),handler:function(){if(Ext.cwm.favorites.length>=a.maxrecs){Ext.showWarningWin(I18N_Util.getMsg("msgFailMaxFavorRecs",{max:a.maxrecs}));return}a.createFavoriteWin()}}]});a.add(b);a.store;a.addDataView()},addDataView:function(){var c=this;c.store=Ext.create("Ext.data.Store",{fields:["name","url","time"],autoDestory:true});var b=Ext.create("Ext.panel.Panel",{border:0,height:270,bodyStyle:"overflow-y: auto;"});var a=Ext.create("Ext.view.View",{store:c.store,id:"favorites",deferInitialRefresh:false,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="favorites">','<tpl if="values.url.length &gt; 200">','<span class="text" onclick="Ext.openFavorSite({[xindex-1]});" title="{[values.name]}\n{[values.url.substring(0,200)]}...">{[Ext.htmlEncode(values.name)]}</span>',"</tpl>",'<tpl if="values.url.length &lt;= 200">','<span class="text" onclick="Ext.openFavorSite({[xindex-1]});" title="{[values.name]}\n{[values.url]}">{[Ext.htmlEncode(values.name)]}</span>',"</tpl>",'<span class="shadowIcon" onclick="Ext.delFavorSite({[xindex-1]});" title="'+I18N_Util.getMsg("msgDelFavor")+'"></span>',"</div>","</tpl>"),itemSelector:"div.favorites",overItemCls:"favorites_hover",trackOver:true,multiSelect:true,autoScroll:true});c.add(b);b.add(a);if(Ext.isArray(Ext.cwm.favorites)){c.store.loadData(Ext.cwm.favorites)}},createFavoriteWin:function(){var a=this;var c=Ext.create("Ext.window.Window",{autoShow:true,bodyStyle:"border:0;background:transparent;",style:"border:0;background:#F3F3F3;",title:I18N_Util.getMsg("titleAddFavorite"),bodyPadding:10,modal:true,resizable:false,items:[{xtype:"form",id:"FavoriteForm",bodyStyle:"border:0;background:transparent;",bodyPadding:5,buttonAlign:"center",fieldDefaults:{labelWidth:60,width:250},items:[{xtype:"textfield",itemId:"Name",maxLength:a.maxNameLen,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblName"),name:"name"},{xtype:"textfield",itemId:"URL",maxLength:a.maxUrlLen,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblURL"),name:"url",value:"http://"}],buttons:[{text:I18N_Util.getMsg("btnAdd"),handler:function(e){var f=e.up("form");if(f){var d=f.getValues();a.addFavorite(d,e)}}},{text:I18N_Util.getMsg("btnCancel"),handler:function(d){var e=d.up("window");if(e){e.close()}}}]}]});var b=c.down("#Name");if(b){b.focus(true,300)}},refresh:function(){var a=this;Ext.getFavorites(function(){if(Ext.isArray(Ext.cwm.favorites)){a.store.loadData(Ext.cwm.favorites)}else{Ext.cwm.favorites=Ext.cwm.defaultFavorites;a.store.loadData(Ext.cwm.favorites)}})},addFavorite:function(a,c){if(!(a&&typeof a.name==="string"&&typeof a.url==="string")){Ext.Trace("Fail to get values:");return}var e=this;var d="";if(a.name.match(/^\s*$/)){d=I18N_Util.getMsg("msgInvalidName")}else{if(a.name.match(/"+/)){d=I18N_Util.getMsg("msgInvalidName")+I18N_Util.getMsg("msgUnacceptChar",{"char":'"'})}else{if(Ext.isRecordedFavorName(a.name)){d=I18N_Util.getMsg("msgDuplicateFavorName")}else{if(a.url.match(/^\s*$/)){d=I18N_Util.getMsg("msgInvalidURL")}else{if(a.url.match(/"+/)){d=I18N_Util.getMsg("msgInvalidURL")+I18N_Util.getMsg("msgUnacceptChar",{"char":'"'})}}}}}if(d!==""){Ext.showWarningWin(d)}else{var b={name:a.name,url:a.url,time:Ext.Date.format(new Date(),"Y/m/d H:i:s")};Ext.cwm.favorites.push(b);Ext.setFavorites([Ext.encode(Ext.cwm.favorites)],function(){var f=c.up("window");if(f){f.close()}e.refresh()})}}});Ext.define("cwm.widget.FieldsEditor",{extend:"Ext.panel.Panel",alias:"widget.fieldseditor",cls:"infoPanel",requires:["cwm.widget.ColumnEditorGrid"],layout:"fit",component:{fieldGrid:0},createGrid:function(){var c=this;var a=Ext.create("Ext.data.Store",{model:"cwm.model.AddFields",data:new Array(),proxy:{type:"memory",reader:{type:"json"}}});var b=Ext.create("cwm.widget.ColumnEditorGrid",{enableColumnHide:false,autoFill:true,bodyStyle:"background : transparent; border : none",store:a,columns:[{text:I18N_Util.getMsg("lblColumn"),dataIndex:"colname",sortable:false,editor:{allowBlank:false,invalidText:"Invalid column name",regex:/^[\w-]+$/}},{text:I18N_Util.getMsg("lblType"),dataIndex:"type",width:120,sortable:false,editor:{xtype:"combobox",itemId:"typeBox",typeAhead:true,name:"fdType",editable:true,forceSelection:true,selectOnTab:true,lazyRender:true,listClass:"x-combo-list-small",store:Ext.cwm.ColumnTypes,listConfig:{maxHeight:800,height:800},listeners:{change:function(m,g,n){var h=m.up("panel");if(h==null){return}var j=h.down("#lengthBox");var f=h.down("#defaultBox");var l=g;j.enable();j.setValue("");j.getStore().loadData([]);f.setValue("");f.enable();switch(l){case"BLOB":case"CLOB":f.disable();break;case"CHAR":case"BIT":case"NCHAR":j.setValue("1");break;case"BIT VARYING":case"NCHAR VARYING":case"VARCHAR":j.setValue("4096");break;case"NUMERIC":j.setValue("15,0");break;case"SEQUENCE":case"MULTISET":case"SET":var k=Ext.cwm.ColumnSetSubTypes;j.getStore().loadData(k);j.expand();f.setValue("{}");break;default:j.disable();break}var i=h.down("#autoIncreChk");var e=h.down("#seedNum");var d=h.down("#increNum");i.setValue(false);switch(l){case"BIGINT":case"INTEGER":case"NUMERIC":case"SMALLINT":i.enable();e.setValue(1);d.setValue(1);break;default:i.disable();e.setValue("");d.setValue("");break}}}}},{text:I18N_Util.getMsg("lblLength"),dataIndex:"lenVal",sortable:false,width:120,editor:{itemId:"lengthBox",name:"lengthBox",allowBlank:true,xtype:"combobox",editable:true,hideTrigger:true,disabled:true,queryMode:"local",listConfig:{maxHeight:800,height:800},listeners:{change:function(i,g,f){var j=i.up("panel");if(j==null){return}var h=j.down("#typeBox").getValue();if(h=="NUMERIC"){var e=j.down("#autoIncreChk");if(g==null){e.enable();return}var d=g.split(",",2);if(d[1]==null){e.enable();return}if(d[1]-0!=0){e.disable();e.setValue(false);return}e.enable()}},select:function(e,d){e.setRawValue(d[0].get("value"))}},displayField:"name",valueField:"value",store:Ext.create("Ext.data.Store",{fields:["name","value"],data:[]})}},{text:I18N_Util.getMsg("lblNotNull"),dataIndex:"notnull",sortable:false,width:60,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor"}},{text:I18N_Util.getMsg("lblAutoIncrement"),dataIndex:"autoIncrement",sortable:false,editor:{xtype:"checkbox",cls:"x-grid-checkheader-editor",itemId:"autoIncreChk",disabled:true,listeners:{change:function(g,f,e){var j=g.up("panel");if(j==null){return}var i=j.down("#seedNum");var d=j.down("#increNum");var h=j.down("#defaultBox");if(f){i.enable();d.enable();h.setValue("");h.disable()}else{i.disable();d.disable();h.enable()}}}}},{text:I18N_Util.getMsg("lblSeed"),dataIndex:"aiSeed",sortable:false,width:70,editor:{xtype:"numberfield",itemId:"seedNum",allowDecimals:false,value:1,disabled:true}},{text:I18N_Util.getMsg("lblIncrement"),dataIndex:"aiIncrement",sortable:false,width:70,editor:{xtype:"numberfield",itemId:"increNum",allowDecimals:false,value:1,minValue:1,disabled:true}},{text:I18N_Util.getMsg("lblDefault"),dataIndex:"default",sortable:false,editor:{itemId:"defaultBox",allowBlank:true}},{text:I18N_Util.getMsg("lblKeyOrIndex"),dataIndex:"index",width:110,sortable:false,editor:{xtype:"combobox",typeAhead:true,editable:false,selectOnTab:true,queryMode:"local",lazyRender:true,listClass:"x-combo-list-small",setHiddenValue:function(f){var j=this,h;if(!j.hiddenDataEl){return}f=Ext.Array.from(f);var l=j.hiddenDataEl.dom,k=l.childNodes,e=k[0],d=f.length,g=k.length;if(!e&&d>0){j.hiddenDataEl.update(Ext.DomHelper.markup({tag:"input",type:"hidden",name:j.name+"-hidden"}));g=1;e=l.firstChild}while(g>d){l.removeChild(k[0]);--g}while(g<d){l.appendChild(e.cloneNode(true));++g}for(h=0;h<d;h++){k[h].value=f[h]}},store:[["None","None"],["PRIMARY","PRIMARY"],["UNIQUE","UNIQUE"],["INDEX","INDEX"],["REVERSE UNIQUE","REVERSE UNIQUE"],["REVERSE INDEX","REVERSE INDEX"]]}}],insertRow:function(e,f){var d=this.getStore();if(f){this.removeAllRow()}d.add(e)},getRecords:function(){var f=new Array();try{var j=this.getStore().getCount();var d=this.getStore();for(var h=0;h<j;h++){var g=d.getAt(h);var k=new Object();k.colname=g.get("colname");k.type=g.get("type");k.lenVal=g.get("lenVal");k["default"]=g.get("default");k.notnull=g.get("notnull");k.index=g.get("index");k.unique=g.get("unique");k.autoIncrement=g.get("autoIncrement");k.aiSeed=g.get("aiSeed");k.aiIncrement=g.get("aiIncrement");f.push(k)}}catch(l){Ext.Trace(l)}return f}});return b},insertRow:function(c,d){try{var a=this.getComponent(this.component.fieldGrid);a.insertRow(c,d)}catch(b){Ext.Trace(b)}},insertBlankRow:function(b){var a=new Object();a.colname="";a.type="";a.lenVal="";a["default"]="";a.notnull=false;a.index="None";a.unique=false;this.insertRow(a,b)},getTypeClause:function(b,a){return Ext.getTypeClause(b,a)},getSqls:function(f,p,m,c){try{var d=this.getComponent(this.component.fieldGrid).getRecords();var n=true;var k=0;for(var g=0;g<d.length;g++){if(d[g].colname.length!=null&&d[g].colname.length>0){k++;if(!/^[\w-]+$/.test(d[g].colname)){n=false;break}if(d[g].type==null||d[g].type==""){n=false;break}}}if(k<=0&&!f){Ext.showWarningWin(I18N_Util.getMsg("msgNoField"));return null}if(!n){Ext.showWarningWin(I18N_Util.getMsg("msgColIncomplete"));return null}if(f){var b=new Array();var t='CREATE TABLE "'+p+'"(';for(var h=0;h<d.length;h++){if(d[h].colname==""){continue}if(d[h].index=="PRIMARY"){b.push(d[h].colname)}t+='"'+d[h].colname+'" ';t+=this.getTypeClause(d[h].type,d[h].lenVal);if(d[h].notnull){t+=" NOT NULL "}if(d[h].autoIncrement){t+=" AUTO_INCREMENT ";if(d[h].aiSeed!=null&&d[h].aiIncrement!=null){t+=" ("+d[h].aiSeed+","+d[h].aiIncrement+") "}}if(d[h]["default"]!=null&&d[h]["default"].length>0){var q=Ext.DbUtil.TranslateDefaultValue(d[h].type,d[h]["default"]);t+=" DEFAULT "+q+" "}if(d[h].index==="UNIQUE"){t+="UNIQUE "}t+=","}t=t.substr(0,t.length-1);if(b.length>0){t+=", CONSTRAINT ";var a="pk_"+p;for(var g=0;g<b.length;g++){a+="_"+b[g]}t+=a;t+=" PRIMARY KEY(";for(var g=0;g<b.length;g++){t+='"'+b[g]+'"';if(g<(b.length-1)){t+=","}}t+=")"}if(k>0){t+=");"}var s=[];s.push(t);for(var h=0;h<d.length;h++){if(d[h].index==="INDEX"){var t='CREATE  INDEX ON "'+p+'"("'+d[h].colname+'");';s.push(t);continue}if(d[h].index==="REVERSE UNIQUE"){var t='CREATE REVERSE UNIQUE INDEX ON "'+p+'"("'+d[h].colname+'" DESC);';s.push(t);continue}if(d[h].index==="REVERSE INDEX"){var t='CREATE  REVERSE INDEX ON "'+p+'"("'+d[h].colname+'" DESC);';s.push(t);continue}}return s}else{var s=new Array();var r=false;var o="";if(typeof(m)!="undefined"&&m!=null){if(m=="FIRST"){r=true}else{if(m=="AFTER"&&(typeof(c)!="undefined"&&c!=null)){r=true;o=c}}}for(var h=0;h<d.length;h++){if(d[h].colname==""||d[h].colname==undefined){continue}var t='ALTER TABLE "'+p+'" ADD COLUMN ';t+='"'+d[h].colname+'" ';t+=this.getTypeClause(d[h].type,d[h].lenVal);if(d[h].notnull){t+=" NOT NULL "}if(d[h].autoIncrement){t+=" AUTO_INCREMENT ";if(d[h].aiSeed!=null&&d[h].aiIncrement!=null){t+=" ("+d[h].aiSeed+","+d[h].aiIncrement+") "}}if(d[h]["default"]!=null&&d[h]["default"].length>0){var q=Ext.DbUtil.TranslateDefaultValue(d[h].type,d[h]["default"]);t+=" DEFAULT "+q+" "}if(d[h].index==="UNIQUE"){t+="UNIQUE "}if(r){if(m=="FIRST"){t+=m+" "}else{t+=m+" ";t+='"'+o+'";';if(m=="AFTER"){o=d[h].colname}}}s.push(t)}for(var h=0;h<d.length;h++){if(d[h].index==="INDEX"){var t='CREATE  INDEX ON "'+p+'"("'+d[h].colname+'");';s.push(t);continue}if(d[h].index==="REVERSE UNIQUE"){var t='CREATE REVERSE UNIQUE INDEX ON "'+p+'"("'+d[h].colname+'" DESC);';s.push(t);continue}if(d[h].index==="REVERSE INDEX"){var t='CREATE  REVERSE INDEX ON "'+p+'"("'+d[h].colname+'" DESC);';s.push(t);continue}if(d[h].index==="PRIMARY"){var t='ALTER TABLE "'+p+'" ADD PRIMARY KEY ("'+d[h].colname+'");';s.push(t);continue}}return s}}catch(l){Ext.Trace(l)}return new Array()},initComponent:function(){this.callParent(arguments);var a=this.createGrid();this.add(a)}});Ext.define("cwm.widget.BackupPlanEditor",{extend:"Ext.panel.Panel",alias:"widget.planeditor",border:0,bodyStyle:"background : transparent;",dbname:"",addAttr:function(c,b){for(var a in b){c[a]=b[a]}},setValue:function(c){for(var a=0;a<this.items.length;a++){var b=this.getComponent(a);if(typeof b.setValue==="function"){b.setValue(c)}}},getValue:function(){var d=new Object;for(var b=0;b<this.items.length;b++){var c=this.getComponent(b);if(typeof c.getValue==="function"){var a=c.getValue();this.addAttr(d,a)}}return d},addItems:function(){var b=this;var a=[{xtype:"panel",title:I18N_Util.getMsg("titleGeneral"),width:650,cls:"infoPanel",style:"background : transparent;",broder:0,margin:"0 0 10 0",itemId:"backupinfo",setValue:function(c){if("id" in c){this.getComponent("backupid").setValue(c.id)}if("level" in c){this.getComponent("backuplv").setValue(c.level)}if("path" in c){this.getComponent("backuppath").setValue(c.path)}},getValue:function(){var c=new Object();c.id=this.getComponent("backupid").getValue();c.level=this.getComponent("backuplv").getValue();c.path=this.getComponent("backuppath").getValue();return c},items:[{xtype:"textfield",regex:/^[\w-]+$/,margin:10,allowBlank:false,itemId:"backupid",invalidText:I18N_Util.getMsg("msgInvalidBackupId"),fieldLabel:I18N_Util.getMsg("lblBackupId")},{xtype:"combobox",store:"BackupLevel",editable:false,displayField:"name",valueField:"name",name:"BackupLevel-id",itemId:"backuplv",queryMode:"local",margin:10,value:"0 (Full)",fieldLabel:I18N_Util.getMsg("lblBackupLevel")},{xtype:"textfield",margin:10,width:550,itemId:"backuppath",fieldLabel:I18N_Util.getMsg("lblBackupPath")}]},{xtype:"panel",width:650,margin:"0 0 10 0",itemId:"period-editor",cls:"infoPanel",title:I18N_Util.getMsg("titleBackupPeriod"),bodyStyle:"padding: 10px",layout:{type:"table",columns:2},defaults:{bodyStyle:"padding:3px; border : none"},setValue:function(c){if("type" in c){this.getComponent("periodtype").setValue(c.type);this.getComponent("periodtype").createDetail(c.type);this.getComponent("period-detail").setValue(c)}if("hour" in c){this.getComponent("period-hour").setValue(c.hour)}if("min" in c){this.getComponent("period-min").setValue(c.min)}},getValue:function(){var d=new Object();d.hour=this.getComponent("period-hour").getValue();d.min=this.getComponent("period-min").getValue();d.type=this.getComponent("periodtype").getValue();var c=this.getComponent("period-detail").getValue(d.type);this.up("planeditor").addAttr(d,c);return d},items:[{xtype:"combobox",store:"BackupPeriodType",editable:false,displayField:"name",valueField:"name",itemId:"periodtype",queryMode:"local",name:"BackupPeriodType-id",value:"Every Month",fieldLabel:I18N_Util.getMsg("lblPeriodType"),createDetail:function(c){if(c==="Every Month"){this.up("panel").getComponent("period-detail").createDays()}else{if(c==="Every Week"){this.up("panel").getComponent("period-detail").createWeeks()}else{if(c==="Every Day"){this.up("panel").getComponent("period-detail").removeItems()}else{this.up("panel").getComponent("period-detail").createFixDate()}}}},listeners:{render:function(c){c.on("select",function(d,e,f){c.createDetail(d.getValue())})}}},{xtype:"panel",border:0,itemId:"period-detail",setValue:function(c){if(c.type==="Every Month"){if("day" in c){this.getComponent("perioddays").setValue(c.day)}}else{if(c.type==="Every Week"){if("week" in c){this.getComponent("periodweeks").setValue(c.week)}}else{if(c.type==="Every Day"){}else{if("date" in c){this.getComponent("fixdate").setValue(c.date)}}}}},getValue:function(d){var e=new Object();if(d==="Every Month"){e.day=this.getComponent("perioddays").getValue()}else{if(d==="Every Week"){e.week=this.getComponent("periodweeks").getValue()}else{if(d==="Every Day"){}else{var c=this.getComponent("fixdate").getValue();e.date=Ext.Date.format(c,"Y-m-d")}}}return e},removeItems:function(){var c=this.items.length;for(var d=0;d<c;d++){var e=this.getComponent(d);this.remove(e,true)}},createDays:function(){this.removeItems();var f=Ext.create("Ext.form.field.ComboBox",{margin:"0 5 0 2",store:"BackupPeriodDetail",value:"1",regex:/^[\d]+$/,displayField:"name",itemId:"perioddays",valueField:"name",editable:false,name:"BackupPeriodDetail-id",queryMode:"local",fieldLabel:I18N_Util.getMsg("lblPeriodDetail")});var c=new Array();for(var d=1;d<=31;d++){var e=new Object();e.name=d;c.push(e)}f.getStore().loadData(c);this.add(f)},createWeeks:function(){this.removeItems();var d=Ext.create("Ext.form.field.ComboBox",{margin:"0 5 0 2",store:"BackupPeriodDetail",value:"Sunday",editable:false,displayField:"name",valueField:"name",itemId:"periodweeks",queryMode:"local",name:"BackupPeriodDetail-id",fieldLabel:I18N_Util.getMsg("lblPeriodDetail")});var c=new Array();c.push({name:"Sunday"});c.push({name:"Monday"});c.push({name:"Tuesday"});c.push({name:"Wednesday"});c.push({name:"Thursday"});c.push({name:"Friday"});c.push({name:"Saturday"});d.getStore().loadData(c);this.add(d)},createFixDate:function(){this.removeItems();var c=Ext.create("Ext.form.field.Date",{margin:"0 5 0 2",fieldLabel:I18N_Util.getMsg("lblPeriodDetail"),showToday:false,editable:false,itemId:"fixdate",value:new Date()});this.add(c)}},{xtype:"combobox",store:"BackupPeriodHour",itemId:"period-hour",value:"12",regex:/^[\d]+$/,displayField:"name",valueField:"name",queryMode:"local",margin:"5 5 5 0",editable:false,name:"BackupPeriodHour-id",border:0,fieldLabel:I18N_Util.getMsg("lblPeriodHour")},{xtype:"combobox",store:"BackupPeriodMin",itemId:"period-min",value:"30",editable:false,regex:/^[\d]+$/,displayField:"name",valueField:"name",queryMode:"local",margin:5,name:"BackupPeriodMin-id",fieldLabel:I18N_Util.getMsg("lblPeriodMin")}]},{xtype:"panel",title:I18N_Util.getMsg("titleOptions"),width:650,cls:"infoPanel",broder:0,margin:"0 0 10 0",layout:{type:"table",columns:2},defaults:{bodyStyle:"padding:3px; border : none"},itemId:"backupoptions",setValue:function(c){if("storeold" in c){this.getComponent("storeold").setValue(c.storeold)}if("delvolumns" in c){this.getComponent("delvolumns").setValue(c.delvolumns)}if("updateinfo" in c){this.getComponent("updateinfo").setValue(c.updateinfo)}if("checkconsis" in c){this.getComponent("checkconsis").setValue(c.checkconsis)}if("compress" in c){this.getComponent("compress").setValue(c.compress)}if("numberthread" in c){this.getComponent("numberthread").setValue(c.numberthread)}if("bkfilenumber" in c){this.getComponent("bkfilenumber").setValue(c.bkfilenumber)}},getValue:function(){var c={};c.storeold=this.getComponent("storeold").getValue();c.delvolumns=this.getComponent("delvolumns").getValue();c.updateinfo=this.getComponent("updateinfo").getValue();c.checkconsis=this.getComponent("checkconsis").getValue();c.compress=this.getComponent("compress").getValue();c.numberthread=this.getComponent("numberthread").getValue();c.bkfilenumber=this.getComponent("bkfilenumber").getValue();return c},items:[{xtype:"checkbox",margin:5,width:300,itemId:"storeold",boxLabel:I18N_Util.getMsg("lblStoreOldBackupFile",{tag:""})},{xtype:"checkbox",margin:5,itemId:"delvolumns",boxLabel:I18N_Util.getMsg("lblDelArchiveVol",{tag:" "})},{xtype:"checkbox",margin:5,itemId:"updateinfo",width:300,boxLabel:I18N_Util.getMsg("lblUpdateStatisticInfo",{tag:" "})},{xtype:"checkbox",itemId:"checkconsis",margin:5,boxLabel:I18N_Util.getMsg("lblCheckingDbConsist",{tag:" "})},{xtype:"checkbox",margin:5,itemId:"compress",width:300,boxLabel:I18N_Util.getMsg("lblUserCompress")},{xtype:"panel"},{xtype:"numberfield",margin:5,allowBlank:false,allowDecimals:false,value:0,minValue:0,maxValue:64,itemId:"numberthread",labelWidth:140,width:190,fieldLabel:"<img data-qtip=\"<span class='long_tip'>"+I18N_Util.getMsg("msgSetThreadNum")+'</span>" data-qwidth="250" src="'+Ext.ImagePath+'b_docs.png">&nbsp;'+I18N_Util.getMsg("lblThreadNum")},{xtype:"numberfield",margin:5,allowBlank:false,allowDecimals:false,value:1,minValue:1,maxValue:30,itemId:"bkfilenumber",width:210,labelWidth:160,fieldLabel:"<img data-qtip=\"<span class='long_tip'>"+I18N_Util.getMsg("msgSetMaxBackupFile")+'</span>" data-qwidth="250" src="'+Ext.ImagePath+'b_docs.png">&nbsp;'+I18N_Util.getMsg("lblBackupFileNum")}]},{xtype:"panel",title:I18N_Util.getMsg("lblOnOrOffLine"),width:650,cls:"infoPanel",broder:0,margin:"0 0 10 0",defaults:{bodyStyle:"padding:3px; border : none"},setValue:function(c){if("mode" in c){if(c.mode==="online"){this.getComponent(0).setValue(true)}else{this.getComponent(1).setValue(true)}}},getValue:function(){var c=new Object();if(this.getComponent(0).getValue()){c.mode="online"}else{c.mode="offline"}return c},items:[{xtype:"radio",name:"mode",checked:true,margin:5,boxLabel:I18N_Util.getMsg("lblOnlineBackup")},{xtype:"radio",name:"mode",margin:5,boxLabel:I18N_Util.getMsg("lblOfflineBackup")}]},{xtype:"panel",border:0,bodyStyle:"background : transparent;",margin:"20 0 20 0",items:[{xtype:"button",text:I18N_Util.getMsg("btnSave"),handler:function(){var g=this.up("panel").up("planeditor").getValue();if(g.id.length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgMissBackupId"));return}else{if(!g.id.match(/^[\w-]+$/)){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidBackupId"));return}}if(g.numberthread>64||g.numberthread<0){Ext.showWarningWin(I18N_Util.getMsg("msgThreadNumRange"));return}if(g.bkfilenumber>30||g.bkfilenumber<1){Ext.showWarningWin(I18N_Util.getMsg("msgBackupFileNumRange"));return}var c=this.up("panel").up("planeditor");var d=function(){Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){c.fireEvent("onok")})};var e=(typeof c.initVal==="undefined"||c.initVal==null);var f=b.dbname!==""?b.dbname:Ext.currentDb;Ext.addOrUpdateBackupPlan(f,e,g,{success:function(h,i){d()}})}},{xtype:"button",text:I18N_Util.getMsg("btnCancel"),margin:"0 0 0 20",handler:function(){var c=this.up("panel").up("planeditor");c.fireEvent("onok")}}]}];b.add(a)},initComponent:function(){this.callParent(arguments);this.addItems();this.addEvents("onok");var k=this.down("#backupid");if(k){k.focus(false,300)}this.getComponent("period-editor").getComponent("period-detail").createDays();var l=new Array();for(var f=0;f<24;f++){var g=new Object();g.name=f;l.push(g)}this.getComponent("period-editor").getComponent("period-hour").getStore().loadData(l);var b=new Array();for(var f=0;f<60;f++){var e=new Object();e.name=f;b.push(e)}this.getComponent("period-editor").getComponent("period-min").getStore().loadData(b);if(typeof this.initVal==="undefined"||this.initVal==null){var c={};var j=Ext.cookieUtil.getEnvInfo();var a="/";var d=j.CUBRID_DATABASES;if(d.indexOf("/")<0){a="\\"}if(this.dbname===""){c.path=d+a+Ext.currentDb+a+"backup"}else{c.path=d+a+this.dbname+a+"backup"}this.setValue(c)}else{this.setValue(this.initVal);this.getComponent("backupinfo").getComponent("backupid").setDisabled(true)}}});Ext.define("cwm.widget.BackupPanel",{extend:"Ext.panel.Panel",alias:"widget.backupinfo",title:I18N_Util.getMsg("titleAutoBackupPlan"),cls:"infoPanel",create:function(){var b=this;var a=Ext.create("Ext.panel.Panel",{border:0,itemId:"container",createGrid:function(){var d=this.getComponent("plangrid");if(typeof d==="undefined"||d===null){this.removeAll();var c=Ext.create("cwm.store.BackupPlan",{});var d=Ext.create("Ext.grid.Panel",{enableColumnHide:false,autoFill:true,border:0,itemId:"plangrid",store:c,columns:[{sortable:false,xtype:"actioncolumn",header:I18N_Util.getMsg("lblAction"),width:80,items:[{icon:Ext.ImagePath+"b_edit.png",tooltip:I18N_Util.getMsg("msgEdit"),handler:function(e,k,m){var h=e.getStore().getAt(k);var l={};l.id=h.get("backupid");l.level=h.get("level");l.path=h.get("path");var j=h.get("period_type");if(j==="Monthly"){l.type="Every Month";l.day=h.get("period_date")}else{if(j==="Weekly"){l.type="Every Week";l.week=h.get("period_date")}else{if(j==="Daily"){l.type="Every Day"}else{l.type="Fixed Date";var i=h.get("period_date");var g=new Date();var n=i.split("-");g.setFullYear(n[0]);g.setMonth(parseInt(n[1])-1);g.setDate(n[2]);l.date=g}}}var f=h.get("time");l.hour=parseInt(f.slice(0,2));l.min=parseInt(f.slice(2,4));l.storeold=(h.get("storeold")==="ON");l.delvolumns=(h.get("archivedel")==="ON");l.updateinfo=(h.get("updatestatus")==="ON");l.checkconsis=(h.get("check")==="y");l.compress=(h.get("zip")==="y");l.numberthread=h.get("mt");l.bkfilenumber=h.get("bknum");l.mode=(h.get("onoff")==="ON")?"online":"offline";b.fireEvent("addbkupplan",l)}},{icon:Ext.ImagePath+"auto_log.png",tooltip:I18N_Util.getMsg("msgShowBackupLog"),handler:function(g,i,f){var h="";var e=g.getStore();if(e){h=e.getAt(i).get("backupid")}b.createBackupLogWin(h)}},{icon:Ext.ImagePath+"b_drop.png",tooltip:I18N_Util.getMsg("msgDel"),handler:function(g,j,f){var h=g.getStore().getAt(j);var i=h.get("backupid");var e=function(k){Ext.DeleteBackupPlan(Ext.currentDb,i,{success:function(l,m){b.getPlans(Ext.currentDb);Ext.showSuccessWin(I18N_Util.getMsg("msgSucDelBackupPlan",{id:Ext.htmlEncode(i)}))}})};Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmDelBackupPlan",{id:Ext.htmlEncode(i)}),closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(l,m,k){if(l=="yes"){e(i)}}})}}]},{sortable:false,text:I18N_Util.getMsg("lblBackupId"),width:100,dataIndex:"backupid",renderer:function(e){if(e===null){return""}return Ext.htmlEncode(e)}},{sortable:false,text:I18N_Util.getMsg("lblBackupLevel"),width:120,dataIndex:"level",renderer:function(e){var g=parseInt(e);var f="";switch(g){case 0:f=e+"(Full)";break;case 1:f=e+"(First incremental)";break;case 2:default:f=e+"(Second incremental)";break}return f}},{sortable:false,text:I18N_Util.getMsg("lblBackupPath"),width:200,dataIndex:"path",renderer:function(e){if(e===null){return""}return Ext.htmlEncode(e)}},{sortable:false,text:I18N_Util.getMsg("lblPeriodType"),width:80,dataIndex:"period_type",renderer:function(e){if(e=="Special"){return"Fixed Date"}return e}},{sortable:false,text:I18N_Util.getMsg("lblPeriodDetail"),width:80,dataIndex:"period_date"},{sortable:false,text:I18N_Util.getMsg("lblTime"),width:50,dataIndex:"time",renderer:function(e){return e.slice(0,2)+":"+e.slice(2,4)}},{sortable:false,text:I18N_Util.getMsg("lblStoreOldBackupFile",{tag:"<br>"}),hidden:true,width:65,height:50,dataIndex:"storeold"},{sortable:false,text:I18N_Util.getMsg("lblDelArchiveVol",{tag:"<br>"}),hidden:true,width:80,height:50,dataIndex:"archivedel"},{sortable:false,text:I18N_Util.getMsg("lblUpdateStatisticInfo",{tag:"<br>"}),hidden:true,width:85,height:50,dataIndex:"updatestatus"},{sortable:false,text:I18N_Util.getMsg("lblCheckingDbConsist",{tag:"<br>"}),hidden:true,width:90,height:50,dataIndex:"check",renderer:function(e){if(e==="y"){return"Yes"}else{return"No"}}},{sortable:false,text:I18N_Util.getMsg("lblCompress"),width:70,dataIndex:"zip",renderer:function(e){if(e==="y"){return"Yes"}else{return"No"}}},{sortable:false,text:I18N_Util.getMsg("lblThread"),width:80,dataIndex:"mt"},{sortable:false,text:I18N_Util.getMsg("lblBackupFile"),width:80,dataIndex:"bknum"},{sortable:false,text:I18N_Util.getMsg("lblOnOrOffLine"),width:80,dataIndex:"onoff",renderer:function(e){return(e==="ON")?"online":"offline"}}],viewConfig:{stripeRows:true}});this.add(d)}},createBlankpage:function(){var c=this.getComponent("blankpage");if(typeof c==="undefined"||c===null){this.removeAll();var d=Ext.create("Ext.panel.Panel",{border:0,itemId:"blankpage",bodyStyle:"background : none",padding:10,html:I18N_Util.getMsg("msgNoBackupPlan")});this.add(d)}},removeAll:function(){var c=this.items.length;for(var d=0;d<c;d++){var e=this.getComponent(d);this.remove(e,true)}},items:[],dockedItems:[{xtype:"toolbar",dock:"bottom",border:0,cls:"struct-grid-toolbar",ui:"footer",items:[{xtype:"button",text:I18N_Util.getMsg("btnAdd"),icon:Ext.ImagePath+"b_insrow.png",cls:"struct-grid-toolbar-btn",handler:function(){b.fireEvent("addbkupplan",null)}}]}]});this.add(a)},createBackupLogWin:function(c){var d=this;var b=350;var a=600;var e=Ext.create("Ext.window.Window",{autoShow:true,resizable:false,modal:true,width:a,height:b,bodyStyle:"border: 0; background: #F3F3F3",bodyPadding:"10px",title:I18N_Util.getMsg("titleAutoBackupLog")});Ext.getAutoBackupDbErrLog({success:function(g,m){var k=Ext.decode(g.responseText);var n=new Array();if(!k){Ext.showFailureWin(I18N_Util.getMsg("msgFail2GetAutoBackupLog"))}else{if(k.status==="success"){var l=Ext.isArray(k.error);for(var j=0;l&&j<k.error.length;j++){if(k.error[j]["backupid"]===c&&k.error[j]["dbname"]===Ext.currentDb){n.push(k.error[j])}}}else{if(Ext.checkTokenStatus(k.note)){Ext.showFailureWin(Ext.htmlEncode(k.note))}}}if(n.length===0){var f=Ext.create("Ext.panel.Panel",{cls:"infoPanel",title:I18N_Util.getMsg("titleLog"),width:a-200,items:[{html:I18N_Util.getMsg("msgNoAutoBackupLog"),border:0,cls:"dbauth_info",bodyStyle:"body"}]});e.add(f)}else{var h=Ext.create("Ext.grid.Panel",{cls:"infoPanel",title:I18N_Util.getMsg("titleLog"),autoScroll:true,height:b-50,width:a-30,sortableColumns:false,enableColumnMove:false,enableColumnHide:false,store:Ext.create("Ext.data.Store",{model:"cwm.model.AutoBackupLog",autoDestroy:true}),columns:[{text:I18N_Util.getMsg("lblDb"),dataIndex:"dbname"},{text:I18N_Util.getMsg("lblBackupId"),dataIndex:"backupid"},{text:I18N_Util.getMsg("lblAutoBackupTime"),sortable:true,width:150,dataIndex:"error_time"},{text:I18N_Util.getMsg("lblDescription"),dataIndex:"error_desc",width:200,renderer:function(i){if(!i){return""}else{return i.replace(/<end>/g," ")}}}]});e.add(h);h.getStore().loadData(n)}}})},getPlans:function(b){var a=this;Ext.getBackupInfos(b,{success:function(c,e){var g=Ext.decode(c.responseText);var f=g[g.dbname];var d=a.getComponent("container");if(Ext.isArray(f)&&f.length>0){d.createGrid();d.getComponent("plangrid").getStore().removeAll();d.getComponent("plangrid").getStore().loadData(f)}else{d.createBlankpage()}}})},initComponent:function(){this.callParent(arguments);this.create();this.addEvents("addbkupplan")}});Ext.define("cwm.widget.BackupWin",{extend:"Ext.window.Window",alias:"widget.backupWin",requires:["cwm.widget.BackupPlanEditor"],bodyStyle:"border: 0; background: #F3F3F3",bodyPadding:"10px",autoShow:true,modal:true,width:800,height:400,dbname:"",create:function(){var b=this;var a=Ext.create("Ext.panel.Panel",{title:I18N_Util.getMsg("titleAutoBackupPlan"),cls:"infoPanel",border:0,itemId:"container",createGrid:function(){var d=this.getComponent("plangrid");if(typeof d==="undefined"||d===null){this.removeAll();var c=Ext.create("cwm.store.BackupPlan",{});var d=Ext.create("Ext.grid.Panel",{enableColumnHide:false,autoFill:true,border:0,itemId:"plangrid",store:c,columns:[{sortable:false,xtype:"actioncolumn",header:I18N_Util.getMsg("lblAction"),width:80,items:[{icon:Ext.ImagePath+"b_edit.png",tooltip:I18N_Util.getMsg("msgEdit"),handler:function(e,k,m){var h=e.getStore().getAt(k);var l={};l.id=h.get("backupid");l.level=h.get("level");l.path=h.get("path");var j=h.get("period_type");if(j==="Monthly"){l.type="Every Month";l.day=h.get("period_date")}else{if(j==="Weekly"){l.type="Every Week";l.week=h.get("period_date")}else{if(j==="Daily"){l.type="Every Day"}else{l.type="Fixed Date";var i=h.get("period_date");var g=new Date();var n=i.split("-");g.setFullYear(n[0]);g.setMonth(parseInt(n[1])-1);g.setDate(n[2]);l.date=g}}}var f=h.get("time");l.hour=parseInt(f.slice(0,2));l.min=parseInt(f.slice(2,4));l.storeold=(h.get("storeold")==="ON");l.delvolumns=(h.get("archivedel")==="ON");l.updateinfo=(h.get("updatestatus")==="ON");l.checkconsis=(h.get("check")==="y");l.compress=(h.get("zip")==="y");l.numberthread=h.get("mt");l.bkfilenumber=h.get("bknum");l.mode=(h.get("onoff")==="ON")?"online":"offline";b.createEditor(l)}},{icon:Ext.ImagePath+"auto_log.png",tooltip:I18N_Util.getMsg("msgShowBackupLog"),handler:function(g,i,f){var h="";var e=g.getStore();if(e){h=e.getAt(i).get("backupid")}b.createLogWin(h)}},{icon:Ext.ImagePath+"b_drop.png",tooltip:I18N_Util.getMsg("msgDel"),handler:function(g,j,f){var h=g.getStore().getAt(j);var i=h.get("backupid");var e=function(k){Ext.DeleteBackupPlan(b.dbname,i,{success:function(l,m){b.getPlans(b.dbname);Ext.showSuccessWin(I18N_Util.getMsg("msgSucDelBackupPlan",{id:Ext.htmlEncode(i)}))}})};Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmDelBackupPlan",{id:Ext.htmlEncode(i)}),closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(l,m,k){if(l=="yes"){e(i)}}})}}]},{sortable:false,text:I18N_Util.getMsg("lblBackupId"),width:100,dataIndex:"backupid",renderer:function(e){if(e===null){return""}return Ext.htmlEncode(e)}},{sortable:false,text:I18N_Util.getMsg("lblBackupLevel"),width:120,dataIndex:"level",renderer:function(e){var g=parseInt(e);var f="";switch(g){case 0:f=e+"(Full)";break;case 1:f=e+"(First incremental)";break;case 2:default:f=e+"(Second incremental)";break}return f}},{sortable:false,text:I18N_Util.getMsg("lblBackupPath"),width:200,dataIndex:"path",renderer:function(e){if(e===null){return""}return Ext.htmlEncode(e)}},{sortable:false,text:I18N_Util.getMsg("lblPeriodType"),width:80,dataIndex:"period_type",renderer:function(e){if(e=="Special"){return"Fixed Date"}return e}},{sortable:false,text:I18N_Util.getMsg("lblPeriodDetail"),width:80,dataIndex:"period_date"},{sortable:false,text:I18N_Util.getMsg("lblTime"),width:50,dataIndex:"time",renderer:function(e){return e.slice(0,2)+":"+e.slice(2,4)}},{sortable:false,text:I18N_Util.getMsg("lblStoreOldBackupFile"),hidden:true,width:65,height:50,dataIndex:"storeold"},{sortable:false,text:I18N_Util.getMsg("lblDelArchiveVol"),hidden:true,width:80,height:50,dataIndex:"archivedel"},{sortable:false,text:I18N_Util.getMsg("lblUpdateStatisticInfo"),hidden:true,width:85,height:50,dataIndex:"updatestatus"},{sortable:false,text:I18N_Util.getMsg("lblCheckingDbConsist"),hidden:true,width:90,height:50,dataIndex:"check",renderer:function(e){if(e==="y"){return"Yes"}else{return"No"}}},{sortable:false,text:I18N_Util.getMsg("lblCompress"),width:70,dataIndex:"zip",renderer:function(e){if(e==="y"){return"Yes"}else{return"No"}}},{sortable:false,text:I18N_Util.getMsg("lblThread"),width:80,dataIndex:"mt"},{sortable:false,text:I18N_Util.getMsg("lblBackupFile"),width:80,dataIndex:"bknum"},{sortable:false,text:I18N_Util.getMsg("lblOnOrOffLine"),width:80,dataIndex:"onoff",renderer:function(e){return(e==="ON")?"online":"offline"}}],viewConfig:{stripeRows:true}});this.add(d)}},createBlankpage:function(){var c=this.getComponent("blankpage");if(typeof c==="undefined"||c===null){this.removeAll();var d=Ext.create("Ext.panel.Panel",{border:0,itemId:"blankpage",bodyStyle:"background : none",padding:10,html:I18N_Util.getMsg("msgNoBackupPlan")});this.add(d)}},removeAll:function(){var c=this.items.length;for(var d=0;d<c;d++){var e=this.getComponent(d);this.remove(e,true)}},items:[],dockedItems:[{xtype:"toolbar",dock:"bottom",border:0,cls:"struct-grid-toolbar",ui:"footer",items:[{xtype:"button",text:I18N_Util.getMsg("btnAdd"),icon:Ext.ImagePath+"b_insrow.png",cls:"struct-grid-toolbar-btn",handler:function(){b.createEditor(null)}}]}]});this.add(a)},getPlans:function(b){var a=this;Ext.getBackupInfos(b,{success:function(c,e){var g=Ext.decode(c.responseText);var f=g[g.dbname];var d=a.getComponent("container");if(Ext.isArray(f)&&f.length>0){d.createGrid();d.getComponent("plangrid").getStore().removeAll();d.getComponent("plangrid").getStore().loadData(f)}else{d.createBlankpage()}}})},createEditor:function(a){var b=this;var c=Ext.create("Ext.window.Window",{title:I18N_Util.getMsg("titleBackupEditor",{name:b.dbname}),bodyStyle:"border: 0; background: #F3F3F3",bodyPadding:"10px",autoShow:true,modal:true,resizable:false,items:[{xtype:"planeditor",initVal:a,dbname:b.dbname,listeners:{onok:function(){c.close();b.getPlans(b.dbname)}}}]})},createLogWin:function(a){if(typeof a!=="string"||a===""){Ext.Trace("Err: Failure to create window cased by wrong id");return}var b=this;var c=Ext.create("cwm.widget.AutoLogWin",{title:I18N_Util.getMsg("titleAutoBackupLogAtDb",{name:b.dbname}),name:b.dbname,logType:"backup",backupId:a})},initComponent:function(){var a=this;a.callParent(arguments);a.create();a.getPlans(a.dbname);a.addEvents("addbkupplan")}});Ext.define("cwm.widget.BreadCrumb",{extend:"Ext.panel.Panel",alias:"widget.breadcrumb",height:35,margin:"10 10 5 10",bodyStyle:"background : #f7f7f7",layout:{type:"column",align:"left"},id:"bread-crumb-navigator",sendEvent:function(b,a){this.fireEvent("CrumbClicked",b,a)},clear:function(){var a=this.items.length;for(var b=1;b<a;b++){var c=this.getComponent(1);this.remove(c,true)}},setDatabase:function(b){this.clear();var a=this.createNavObject("db",b);this.add(a)},setTable:function(c,a){this.clear();var d=this.createNavObject("db",c);this.add(d);var b=this.createNavObject("table",a);this.add(b)},createNavObject:function(g,e,a){var c=this;var d=null;var f="";if(g==="db"){f="resources/images/s_db.png"}else{if(g==="table"){f="resources/images/s_tbl.png"}else{if(g==="host"){f="resources/images/s_host.png"}}}var b=Ext.htmlEncode(e);if(e.length>70){b=Ext.htmlEncode(e.substring(0,70))+"..."}if(typeof a!="undefined"&&a!=null&&a==true){d=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",layout:"column",padding:10,textlen:e.length+3,items:[{xtype:"image",src:f},{xtype:"panel",bodyStyle:"background : transparent; border : none",html:'<font color="#363636">&nbsp;'+b+"</font>"}]})}else{d=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",layout:"column",padding:10,textlen:e.length>70?78:(e.length+5),items:[{xtype:"image",src:"resources/images/item_ltr.png",margin:"5 10 0 0"},{xtype:"image",src:f},{xtype:"panel",bodyStyle:"background : transparent; border : none",html:'<font color="#363636">&nbsp;'+b+"</font>"}]})}d.addListener("render",function(h){h.body.on("click",function(i){c.sendEvent(g,e)});h.body.on("mouseover",function(){h.body.setStyle("cursor","pointer")})});d.addListener("beforerender",function(h){h.setWidth(22+h.textlen*8)});return d},createCrumb:function(e,c){var f=e.text;var b=this.bodyStyle;var a=this;var d=this.createNavObject("host",f,true);this.add(d)},initComponent:function(){this.addEvents("CrumbClicked");this.callParent(arguments)}});Ext.define("cwm.widget.CForm",{extend:"Ext.form.FieldSet",alias:"widget.cform",cls:"cform",initComponent:function(){this.callParent(arguments)}});Ext.define("cwm.widget.ChangeUserPassword",{extend:"Ext.window.Window",alias:"widget.changeuserpwd",autoShow:true,closable:false,preventHeader:true,bodyStyle:"border:0;background:#F3F3F3",style:"border:0;background:#F3F3F3",bodyPadding:"20px",resizable:false,modal:true,hintInfo:"",oldPass:"",loginId:"",loginResponse:null,loginRequest:null,login:null,appController:null,addItems:function(){var a=Ext.create("Ext.form.Panel",{xtype:"form",buttonAlign:"center",bodyStyle:"border:0;background:transparent",fieldDefaults:{labelAlign:"left",labelWidth:120,anchor:"100%",labelHeight:20,msgTarget:"under"},items:[{html:"<h3>"+I18N_Util.getMsg("msgChangeCmsUserPass")+"</h3>",bodyStyle:"text-align: left; border:0;background:transparent",padding:"10px 0"},{html:this.hintInfo,bodyStyle:"text-align: left; border:0;background:transparent",padding:"0 0 10px 10px"},{xtype:"textfield",fieldLabel:I18N_Util.getMsg("lblUserName"),value:this.oldPass===""?Ext.cookieUtil.getDbmtUserName():this.loginId,disabled:Ext.isIE9!==true,readOnly:!!(Ext.isIE9===true),cls:"x-item-disabled"},{name:"oldPassword",itemId:"OldPass",xtype:"textfield",inputType:"password",autoEl:{onpaste:"return false;"},maxLength:32,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblOldPass"),value:this.oldPass,disabled:this.oldPass===""?false:true,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var f=this.up("changeuserpwd");if(f){var b=f.down("button[action=submit]");if(b){b.fireEvent("click",this,null)}}}}}},{name:"newPassword",itemId:"NewPass",xtype:"textfield",inputType:"password",autoEl:{onpaste:"return false;"},maxLength:32,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblNewPass"),listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var f=this.up("changeuserpwd");if(f){var b=f.down("button[action=submit]");if(b){b.fireEvent("click",this,null)}}}}}},{name:"confirmpassword",xtype:"textfield",inputType:"password",autoEl:{onpaste:"return false;"},maxLength:32,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblConfirmPass"),listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var f=this.up("changeuserpwd");if(f){var b=f.down("button[action=submit]");if(b){b.fireEvent("click",this,null)}}}}}}],buttons:[{text:I18N_Util.getMsg("btnOK"),action:"submit"},{text:I18N_Util.getMsg("btnCancel"),action:"cancel"}]});this.add(a)},initComponent:function(){var b=this;b.callParent(arguments);b.addItems();var a;if(b.oldPass===""){a=b.down("#OldPass")}else{a=b.down("#NewPass")}if(a){a.focus(true,300)}},submitForm:function(){var f=this;var e=f.down("form");if(e&&e.getValues()){var c=e.getValues();var a=typeof c.oldPassword==="string"?c.oldPassword:"";var b=typeof c.newPassword==="string"?c.newPassword:"";var d=typeof c.confirmpassword==="string"?c.confirmpassword:"";if(f.oldPass===""&&typeof a==="string"&&Ext.String.trim(a)===""){Ext.showWarningWin(I18N_Util.getMsg("msgInputOldPass"),function(g,h){f.clearFieldsValue("old")})}else{if(!b.match(/^\S{4,}$/)||b==="admin"){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidPassPrompt"),function(g,h){f.clearFieldsValue("new")})}else{if(b!==d){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidConfirmPass"),function(g,h){f.clearFieldsValue("cfm")})}else{if(f.oldPass===""){f.checkOldPassword(a,b,{success:function(g){f.setdbmtpasswd(b)}})}else{if(f.oldPass!==""){f.setdbmtpasswd(b)}}}}}}},checkOldPassword:function(a,b,d){var c=this;Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"login",id:Ext.cookieUtil.getDbmtUserName(),password:a,clientver:"8.4"},success:function(e,g){var f=Ext.decode(e.responseText);if(f&&f.status=="success"){Ext.cmToken=f.token;Ext.cookieUtil.setToken(f.token);if(d&&typeof d.success==="function"){d.success(e)}}else{if(f&&Ext.checkTokenStatus(f.note)){Ext.showErrorWin(I18N_Util.getMsg("msgErrInOldPass"),function(h,i){c.clearFieldsValue("old")})}}},failure:function(e,f){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText);c.destroy()}})},setdbmtpasswd:function(b){var d=this;var c="";var g=Ext.cookieUtil.getDbmtUserName();try{if(d.oldPass===""){c=Ext.cookieUtil.getToken()}else{var a=Ext.decode(d.loginResponse.responseText);c=a.status==="success"?a.token:c;g=Ext.dbmtUserName}}catch(f){Ext.Trace(f)}Ext.Ajax.request({url:Ext.cmApi,method:"post",jsonData:{task:"setdbmtpasswd",targetid:g,newpassword:b,token:c},success:function(e,i){var h=Ext.decode(e.responseText);if(h&&h.status=="success"){Ext.showSuccessWin(I18N_Util.getMsg("msgSucChangePass"));d.close();if(d.oldPass!==""){d.changeDefaultSuccess()}}else{if(Ext.checkTokenStatus(h.note)){Ext.showFailureWin(I18N_Util.getMsg("msgFail2ChangePass")+"<br>"+h.note);d.close()}}},failure:function(e,h){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText);d.close()}})},changeDefaultSuccess:function(){var c=this;if(c.oldPass===""){return}try{var a=Ext.decode(c.loginResponse.responseText);if(a.status=="failure"){throw (a.note)}Ext.cookieUtil.setToken(a.token);Ext.cookieUtil.setDbmtUserName(Ext.dbmtUserName);Ext.cookieUtil.setLastDbmtUserName(Ext.dbmtUserName);var b=a.note;if(a.status!="failure"&&c.login&&c.appController){c.login.destroy();c.appController.showLoginView()}else{Ext.Msg.alert("Error",b)}Ext.getEnv(function(){Ext.getCMSEnv(function(){var e=Ext.getCmp("cubrid-manager-home-view");if("setEnv" in e){e.setEnv()}})})}catch(d){Ext.Trace(d);location.reload(false)}},clearFieldsValue:function(b){var d,c,a;if(b==="old"){d=this.down('textfield[name="oldPassword"]');d.reset();d.focus(true,300)}else{if(b==="new"){c=this.down('textfield[name="newPassword"]');c.reset();c.focus(true,300)}else{if(b==="cfm"){a=this.down('textfield[name="confirmpassword"]');a.reset();a.focus(true,300)}else{c=this.down('textfield[name="newPassword"]');a=this.down('textfield[name="confirmpassword"]');c.reset();a.reset();if(this.oldPass===""){d=this.down('textfield[name="oldPassword"]');d.reset()}}}}}});Ext.define("cwm.widget.ChartBox",{extend:"Ext.panel.Panel",alias:"widget.chartbox",border:0,listeners:{render:function(a){a.body.on("click",function(){a.fireEvent("click",a,{id:a.id})});a.body.on("mouseover",function(){a.fireEvent("mouseover",a,{id:a.id})});a.body.on("mouseout",function(){a.fireEvent("mouseout",a,{id:a.id})})}},initComponent:function(){this.addEvents("click","mouseover","mouseout");this.callParent(arguments)}});Ext.define("cwm.widget.ColumnEditor",{extend:"Ext.panel.Panel",alias:"widget.coleditor",bodyStyle:"background : transparent; border : none",oldValue:{},newValue:{},itemId:"panelColumnEditor",createTitle:function(b){var a=Ext.create("Ext.panel.Panel",{cls:"infoPanel",title:b});this.add(a)},createColumnName:function(b){var a=this;var c=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none;",layout:"column",margin:"5 0 5 0",width:a.width,getValue:function(){a.newValue.colname=this.down("textfield").getValue()},items:[{xtype:"panel",margin:3,bodyStyle:"background : transparent; border : none",width:150,html:I18N_Util.getMsg("lblColumn")},{xtype:"textfield",margin:3,value:b,regex:/^[\w-]+$/,invalidText:I18N_Util.getMsg("msgInvalidColumnName"),listeners:{render:function(d){d.on("change",function(e,g,f){a.newValue.colname=g})}}}]});this.add(c)},createType:function(b){var a=this;var c=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",layout:"column",margin:"5 0 5 0",width:a.width,getValue:function(){a.newValue.coltype=this.down("combobox").getValue()},items:[{xtype:"panel",margin:3,bodyStyle:"background : transparent; border : none",width:150,html:I18N_Util.getMsg("lblType")},{xtype:"combobox",itemId:"typeBox",typeAhead:true,editable:true,forceSelection:true,margin:3,name:" ",value:b,selectOnTab:true,lazyRender:true,listClass:"x-combo-list-small",store:Ext.cwm.ColumnTypes,listeners:{change:function(k,e,l){var f=k.up("#panelColumnEditor");if(f==null){return}var h=f.down("#lengthBox");var d=f.down("#defaultBox");var j=e;h.getStore().loadData([]);h.setValue("");h.enable();d.setValue("");d.enable();switch(j){case"BLOB":case"CLOB":d.disable();break;case"CHAR":case"BIT":case"NCHAR":h.setValue("1");break;case"BIT VARYING":case"NCHAR VARYING":case"VARCHAR":h.setValue("4096");break;case"NUMERIC":h.setValue("15,0");break;case"SEQUENCE":case"MULTISET":case"SET":var i=Ext.cwm.ColumnSetSubTypes;h.getStore().loadData(i);h.expand();d.setValue("{}");break;default:h.disable();break}var g=f.down("#autoIncreChk");g.setValue(false);switch(j){case"BIGINT":case"INTEGER":case"NUMERIC":case"SMALLINT":g.enable();break;default:g.disable();break}}}}]});this.add(c)},createLenValue:function(g){var a=this;var d=a.oldValue.type;var e=false;var c=[];switch(d){case"SEQUENCE":case"MULTISET":case"SET":c=Ext.cwm.ColumnSetSubTypes;case"CHAR":case"BIT":case"NCHAR":case"BIT VARYING":case"NCHAR VARYING":case"VARCHAR":case"NUMERIC":e=true;break;default:break}var f=new Array();for(var b=0;b<c.length;b++){f.push({name:c[b][0],value:c[b][1]})}var h=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none;",layout:"column",margin:"5 0 5 0",width:a.width,getValue:function(){a.newValue.lenVal=this.down("textfield").getValue()},items:[{xtype:"panel",margin:3,bodyStyle:"background : transparent; border : none",width:150,html:I18N_Util.getMsg("lblLength")},{margin:3,value:g,xtype:"combobox",itemId:"lengthBox",name:"lengthBox",allowBlank:true,editable:true,hideTrigger:true,disabled:!e,queryMode:"local",listeners:{change:function(n,l,k){var o=n.up("#panelColumnEditor");if(o==null){return}var m=o.down("#typeBox").getValue();if(m=="NUMERIC"){var j=o.down("#autoIncreChk");if(l==null){j.enable();return}var i=l.split(",",2);if(i[1]==null){j.enable();return}if(i[1]-0!=0){j.disable();j.setValue(false);return}j.enable()}},select:function(j,i){j.setRawValue(i[0].get("value"))}},displayField:"name",valueField:"value",store:Ext.create("Ext.data.Store",{fields:["name","value"],data:f})}]});this.add(h)},createAutoIncrement:function(g){var c=this;var f=true;switch(g.type){case"BIGINT":case"INTEGER":case"NUMERIC":case"SMALLINT":break;default:f=false;break}var e=g.autoIncrement;var d=1,b=1,a=g.aiCurrentVal;if(e){d=g.aiSeed-0;b=g.aiIncrement-0}var h=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none;",layout:"column",margin:"5 0 5 0",width:c.width,getValue:function(){c.newValue.autoIncrement=this.down("#autoIncreChk").getValue();c.newValue.aiSeed=this.down("#seedNum").getValue();c.newValue.aiIncrement=this.down("#increNum").getValue()},items:[{xtype:"panel",margin:3,bodyStyle:"background : transparent; border : none",width:150,html:I18N_Util.getMsg("lblAutoIncrement")},{xtype:"checkbox",itemId:"autoIncreChk",margin:"2 0 0 3",disabled:!f,checked:e,listeners:{change:function(l,k,j){var o=l.up("#panelColumnEditor");if(o==null){return}var n=o.down("#seedNum");var i=o.down("#increNum");var m=o.down("#defaultBox");if(k){n.enable();i.enable();m.setValue("");m.disable()}else{n.disable();i.disable();m.enable()}}}},{xtype:"numberfield",itemId:"seedNum",margin:"0 0 0 7",width:130,labelWidth:60,fieldLabel:I18N_Util.getMsg("lblSeed"),labelAlign:"right",allowDecimals:false,disabled:!e,value:d},{xtype:"numberfield",itemId:"increNum",margin:"0 0 0 10",width:130,labelWidth:60,fieldLabel:I18N_Util.getMsg("lblIncrement"),labelAlign:"right",allowDecimals:false,disabled:!e,minValue:1,value:b}]});this.add(h)},createNotNull:function(c){var a=this;var b=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none;",layout:"column",margin:"5 0 5 0",width:a.width,getValue:function(){a.newValue.notnull=this.down("checkbox").getValue()},items:[{xtype:"panel",margin:3,bodyStyle:"background : transparent; border : none",width:150,html:I18N_Util.getMsg("lblNotNull")},{xtype:"checkbox",margin:"2 0 0 3",checked:c}]});this.add(b)},createDefalutVal:function(c){var a=this;var b=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none;",layout:"column",margin:"5 0 5 0",width:a.width,getValue:function(){a.newValue.defVal=this.down("textfield").getValue()},items:[{xtype:"panel",margin:3,bodyStyle:"background : transparent; border : none",width:150,html:I18N_Util.getMsg("lblDefault")},{xtype:"textfield",itemId:"defaultBox",margin:3,disabled:this.oldValue.autoIncrement||this.oldValue.type=="CLOB"||this.oldValue.type=="BLOB",value:c,listeners:{render:function(d){d.on("change",function(e,g,f){a.newValue.defVal=g})}}}]});this.add(b)},createPosition:function(b,g){var e=this;var a=[];for(var f=0;f<b.length;f++){a.push(b[f])}var c=Ext.create("Ext.data.Store",{fields:["name"],data:a});var h="";if(a!=null&&a[0]!=null){h=a[0].name}var d=Ext.create("Ext.panel.Panel",{border:0,margin:"0 0 10 0",layout:"column",getValue:function(){var i=this.getComponent("cmbfn").getValue();if(this.getComponent("chkbegin").getValue()===true||(i===null||i.length<=0)){e.newValue.isBegin=true}else{e.newValue.after=this.getComponent("cmbfn").getValue()}},items:[{xtype:"panel",margin:3,html:I18N_Util.getMsg("lblPosition"),bodyStyle:"background : transparent; border : none;",width:150},{xtype:"radio",name:"pose",itemId:"chkbegin",margin:"0 0 0 10",boxLabel:I18N_Util.getMsg("lblAtBegining")},{xtype:"radio",margin:"0 10 0 10",name:"pose",itemId:"chkafter",boxLabel:I18N_Util.getMsg("lblAfterCol")},{xtype:"combo",store:c,value:h,editable:true,forceSelection:true,typeAhead:true,itemId:"cmbfn",margin:"0 10 0 0",queryMode:"local",displayField:"name",valueField:"name",tpl:'<tpl for="."><div class="x-boundlist-item combo_item" role="option">{[Ext.htmlEncode(values.name)]}</div></tpl>',listConfig:{cls:(Ext.isIE9||Ext.isIE7)?"cwm_combo_boundlist":""},listeners:{focus:function(i){i.ownerCt.down("#chkafter").setValue(true)}},setHiddenValue:function(l){var o=this,n;if(!o.hiddenDataEl){return}l=Ext.Array.from(l);var q=o.hiddenDataEl.dom,p=q.childNodes,k=p[0],j=l.length,m=p.length;if(!k&&j>0){o.hiddenDataEl.update(Ext.DomHelper.markup({tag:"input",type:"hidden",name:o.name+"-hidden"}));m=1;k=q.firstChild}while(m>j){q.removeChild(p[0]);--m}while(m<j){q.appendChild(k.cloneNode(true));++m}for(n=0;n<j;n++){p[n].value=l[n]}}}],init:function(){if(!Ext.isArray(a)){return}var k=this.getComponent("cmbfn");if(typeof a[0]==="undefined"||a[0].name===g){this.getComponent("chkbegin").setValue(true);this.getComponent("chkafter").setValue(false);if(a.length>1){k.setValue(a[1].name)}else{this.getComponent("chkafter").setVisible(false);k.setVisible(false)}k.getStore().removeAt(0)}else{this.getComponent("chkbegin").setValue(false);this.getComponent("chkafter").setValue(true);for(var j=0;j<a.length;j++){if(a[j].name===g){k.setValue(a[j-1].name);k.getStore().removeAt(j);break}}}}});d.init();this.add(d)},setItemsBkgr:function(){var a=this.items.length;for(var b=2;b<a;b+=2){var c=this.getComponent(b);if(typeof c!=="undefined"){c.bodyStyle="background:#EFEFEF; border : none"}}},updateData:function(){if(typeof this.newValue==="undefined"){this.newValue=new Object()}for(var b=0;b<this.items.length;b++){var a=this.getComponent(b);if("getValue" in a){a.getValue()}}},getSqls:function(){this.updateData();var b=new Array();if(Ext.VerifyTextInput(this.newValue.colname)){var d=this.newValue.isBegin?" FIRST ":(' AFTER "'+this.newValue.after+'" ');if(this.oldValue.colname==this.newValue.after){d=""}var c='ALTER TABLE "'+this.tbname+'" CHANGE "'+this.oldValue.colname+'" "'+this.newValue.colname+'" ';c+=Ext.getTypeClause(this.newValue.coltype,this.newValue.lenVal);if(this.newValue.notnull){c+=" NOT NULL "}if(this.newValue.autoIncrement){c+=" AUTO_INCREMENT ";if(this.newValue.aiSeed!=null&&this.newValue.aiIncrement!=null){c+=" ("+this.newValue.aiSeed+","+this.newValue.aiIncrement+") "}}if(this.newValue.defVal!=null&&this.newValue.defVal.length>0){var a=Ext.DbUtil.TranslateDefaultValue(this.newValue.coltype,this.newValue.defVal);c+=" DEFAULT "+a+" "}c+=d;c+=";";b.push(c)}return b},initComponent:function(){this.callParent(arguments);if(typeof this.viewtitle!="undefined"){this.createTitle(this.viewtitle)}this.createColumnName(this.oldValue.colname||"");this.createType(this.oldValue.type||"");this.createLenValue(this.oldValue.lenValue||"");this.createNotNull(this.oldValue.notNullValue||false);this.createAutoIncrement(this.oldValue);this.createDefalutVal(this.oldValue.defValue||"");this.createPosition(this.oldValue.fdnames||[],this.oldValue.colname||"");this.setItemsBkgr()}});Ext.define("cwm.widget.createTableWnd",{extend:"Ext.window.Window",width:960,height:400,minWidth:400,minHeight:300,modal:true,closable:true,stateful:false,id:"create-table-window",requires:["cwm.widget.FieldsEditor"],component:{tableName:0,tableFields:1},layout:"anchor",insertBlankRow:function(c){try{var a=this.getComponent(this.component.tableFields);a.insertBlankRow(c)}catch(b){Ext.Trace(b)}},getSqls:function(){var a=this.getComponent(this.component.tableName).getTableName();var b=this.getComponent(this.component.tableFields);return b.getSqls(true,a)},items:[{xtype:"panel",title:I18N_Util.getMsg("titleTableSetting"),cls:"infoPanel",itemId:"tbnamepanel",margin:10,component:{tableName:0},getTableName:function(){return this.getComponent(this.component.tableName).getValue()},setTableName:function(a){this.getComponent(this.component.tableName).setValue(a)},items:[{xtype:"textfield",itemId:"tbnameedit",margin:"5 0 5 5",fieldLabel:I18N_Util.getMsg("lblTableName"),allowBlank:false,regex:/^[\w-]+$/,invalidText:I18N_Util.getMsg("msgInvalidTableName")}]},{xtype:"fieldseditor",anchor:"100% -100",margin:10,title:I18N_Util.getMsg("titleColumnSetting"),id:"create-table_wnd-grid"},{xtype:"panel",bodyStyle:"background : transparent; border : none",layout:"column",items:[{xtype:"displayfield",value:"&nbsp;&nbsp;&nbsp;&nbsp;"},{xtype:"button",text:I18N_Util.getMsg("btnSave"),id:"create-table-wnd-save",handler:function(){try{var a=Ext.getCmp("create-table-window");if(!!a){var d=a.getComponent("tbnamepanel").getComponent("tbnameedit");if(!d.isValid()){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidTableName"));return}var b=a.getSqls();if(b==null||b.length==0){throw ("createTableWnd: no sql clauses")}Ext.QueryByCCI(Ext.currentDb,b,{success:function(e,f){var g=Ext.decode(e.responseText);if(g.status==1000&&g.result[0].status==0){Ext.showSuccessWin(I18N_Util.getMsg("msgSucCreateTable"),function(){Ext.getTableList(Ext.currentDb,{success:function(h,l){var k=Ext.getCmp("create-table-window");if(k){k.close()}var i=Ext.getCmp("leftPanel");if(i){i.refresh()}var j=Ext.getCmp("rightPanel");if(j){j.refresh()}}})})}else{Ext.showErrorWin(Ext.htmlEncode(g.result[0].note))}}})}}catch(c){Ext.Trace(c)}}},{xtype:"displayfield",value:"&nbsp;&nbsp;&nbsp;&nbsp;"},{xtype:"button",text:I18N_Util.getMsg("btnAdd"),handler:function(){try{var b=Ext.getCmp("create-table-window-add-field-count");if(b==null||!b.isValid()){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidColumnNum"));return}var f=Ext.getCmp("create-table-window");if(!!b&&!!f){var d=b.getValue();for(var c=0;c<d;c++){if(c===d-1){f.insertBlankRow(false);var a=f.down("colEditorGrid");if(a){a.focusLastRow()}}else{f.insertBlankRow(false)}}}}catch(g){Ext.Trace(g)}}},{xtype:"displayfield",value:"&nbsp;"},{xtype:"numberfield",width:40,allowBlank:false,allowDecimals:false,minValue:1,maxValue:20,value:1,id:"create-table-window-add-field-count"},{xtype:"displayfield",value:"&nbsp;"+I18N_Util.getMsg("lblColumns")},{xtype:"displayfield",value:"&nbsp;&nbsp;&nbsp;&nbsp;"},{xtype:"button",text:I18N_Util.getMsg("btnCancel"),handler:function(){var a=Ext.getCmp("create-table-window");if(a!=null){a.close()}}}]}],initComponent:function(){this.callParent(arguments);this.getComponent(this.component.tableName).setTableName(this.tbname)}});Ext.define("cwm.widget.CTab",{extend:"Ext.panel.Panel",alias:"widget.ctab",bodyStyle:{background:"url(resources/images/tab_bg.png) repeat-x scroll 0 0 transparent",border:"#cccccc solid 1px"},tabActive:false,setActive:function(a){if(a===undefined||a==false){this.tabActive=false;this.body.setStyle("background","url(resources/images/tab_bg.png) repeat-x scroll 0 0 transparent ")}else{this.tabActive=true;this.body.setStyle("background","white");this.body.setStyle("border-bottom","0px")}},listeners:{render:function(a){var a=this;a.body.on("mouseover",function(){a.body.setStyle("background","white");a.body.setStyle("cursor","pointer")});a.body.on("mouseout",function(){if(!a.tabActive){a.body.setStyle("background","url(resources/images/tab_bg.png) repeat-x scroll 0 0 transparent ")}else{a.body.setStyle("background","white");a.body.setStyle("border-bottom","0px")}});a.body.on("click",function(){a.fireEvent("click")})}},initComponent:function(){var a=this.icon;var c=this.text;var b={xtype:"panel",bodyStyle:"background : transparent",border:0,layout:"column",padding:10,items:[{xtype:"imagecomponent",src:a,width:16},{xtype:"panel",html:"&nbsp;"+c,border:0,bodyStyle:"background : transparent; font: bold 14px Arial, san-serif; color : #656565"}]};if(Ext.isChrome||Ext.isSafari){b.layout="table"}this.items=[b];this.addEvents("click");this.callParent(arguments)}});Ext.define("cwm.widget.CTabbar",{extend:"Ext.panel.Panel",alias:"widget.ctabbar",height:40,margin:"0 10 12 10",bodyStyle:"background : url(resources/images/tab_bg.png) repeat-x scroll 0 0 transparent; border : 0px; border-top : #999999 solid 1px; border-bottom:3px solid #2194c0;",layout:"column",setActive:function(a){try{for(var b=0;b<this.items.length;b++){this.getComponent(b).setActive(false)}this.getComponent(a).setActive(true);this.doLayout()}catch(c){Ext.Trace(c)}},setActiveById:function(d){try{for(var b=0;b<this.items.length;b++){this.getComponent(b).setActive(false)}var a=this.down("#"+d);if(a){a.setActive(true)}this.doLayout()}catch(c){Ext.Trace(c)}},initComponent:function(){this.addEvents("click");this.callParent(arguments)}});Ext.define("cwm.widget.DbList",{extend:"Ext.panel.Panel",alias:"widget.dblist",bodyStyle:"background : transparent",border:0,fields:["icon","name","type","isOpened"],sendEvent:function(b,a){this.fireEvent(b,a)},removeList:function(){for(var a=0;a<this.items.length;a++){var b=this.getComponent(a);if(b){this.remove(b,true)}}},refresh:function(){this.removeAll(true);this.createList()},createList:function(){var a=this.data;var g=this;try{for(var b=0;b<a.length;b++){var d=a[b][this.fields[0]];var h=a[b][this.fields[1]];var f=a[b][this.fields[2]];var k=a[b][this.fields[3]];var j=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent",alias:"widget.lplistitem",layout:"column",height:20,border:0,margin:"5 0 5 0",padding:"0 10 0 10",items:[{xtype:"imagecomponent",src:d},{html:"&nbsp;&nbsp;",border:0,bodyStyle:"background : transparent"},{border:0,bodyStyle:"background : transparent; white-space: nowrap;",width:100,tipText:Ext.htmlEncode(h),html:Ext.htmlEncode(h),listeners:{render:function(e){e.tip=Ext.create("Ext.tip.ToolTip",{target:e.el,trackMouse:true,listeners:{beforeshow:function i(l){l.update(e.tipText)}}})},afterrender:function(l){l.tm=new Ext.util.TextMetrics(l.getEl());var i=l.tm.getWidth(l.tipText);if(i>l.width){var e=i/l.tipText.length;var m=85/e;var n=l.tipText.substr(0,m)+"...";l.update(n)}},beforedestroy:function(i,l){i.tip.destroy()}}}],listeners:{render:function(e){e.body.on("click",function(i){g.sendEvent("LpListItemClicked",{name:e.itemName,type:e.type,opened:e.isOpened})});e.body.on("mouseover",function(i){e.body.setStyle("background","#cccccc");e.body.setStyle("cursor","pointer")});e.body.on("mouseout",function(){e.body.setStyle("background","transparent")})}}});j.itemName=h;j.type=f;j.isOpened=k;this.add(j)}}catch(c){Ext.Trace("DbList: create:"+c)}this.addEvents("LpListItemClicked")},initComponent:function(){this.callParent(arguments)}});Ext.define("cwm.widget.DbLogin",{extend:"Ext.window.Window",border:0,title:I18N_Util.getMsg("titleLoginDb"),bodyStyle:"background : #F3F3F3; border : none",resizable:false,modal:true,requires:["cwm.common.CookieUtil"],cancel:function(){if(typeof this.cancel==="function"){this.cancel()}},login:function(){var b=this;try{var j=this.down("#unameField");if(!j.isValid()){return}var d=j.getValue();var k=this.down("#pwdField").getValue();var c=this.down("#brokerField").getValue();var i=Ext.brokerIp;var f=this.down("#customBrokerSet");if(f.checkboxCmp.getValue()){var a=f.down("#cusBrokerIp");var h=f.down("#cusBrokerPort");if(!a.isValid()||!h.isValid()){return}i=a.getValue();c=h.getValue()}Ext.userLogin(this.dbname,d,k,{success:function(e,q){var p=b.down("#saveField");var o=false;if(typeof p!="undefined"&&"getValue" in p){o=p.getValue()}if(o){Ext.setUserNameAndPassword(b.dbname,d,k,true)}else{Ext.setUserNameAndPassword(b.dbname,d,k,false)}Ext.cwm.curDbUser=d;var m=Ext.decode(e.responseText);var l=false;if(m.authority==="isdba"){l=true}Ext.cookieUtil.setDbUserIsDba(b.dbname,l);Ext.cwm.curDbUserIsDba=l;if(c>0){Ext.cookieUtil.setDbBrokerPort(b.dbname,c);Ext.cookieUtil.setDbBrokerIp(b.dbname,i);var n={success:function(r,u){var v=Ext.decode(r.responseText);if(v.status!=1000){Ext.showErrorWin(I18N_Util.getMsg("msgFailDbLogin")+"<br>"+Ext.htmlEncode(v.note));return}Ext.cookieUtil.setDbLoginStatus(b.dbname,true);if(f.checkboxCmp.getValue()){if(f.down("#cusBrokerSave").getValue()){var t=Ext.cookieUtil.getBrokerHistory();var s=t[b.dbname];if(s==null){s={}}s[i+":"+c]={ip:i,port:c};t[b.dbname]=s;Ext.cookieUtil.setBrokerHistory(t)}}if(typeof b.callback=="function"){b.callback(e,u)}b.close()},failure:function(r,s){Ext.showErrorWin(I18N_Util.getMsg("msgFailDbLogin")+"<br>"+r.responseText)}};Ext.QueryByCCIWithWaitBox(b.dbname,[],n,Ext.cwm.dbLoginTimeout)}}})}catch(g){Ext.Trace(g)}},items:[{xtype:"panel",bodyStyle:"background : transparent; border : none",margin:10,items:[{xtype:"displayfield",fieldLabel:I18N_Util.getMsg("lblDb"),width:150,itemId:"dbField",value:""},{xtype:"textfield",itemId:"unameField",fieldLabel:I18N_Util.getMsg("lblUserName"),validator:function(a){if(Ext.String.trim(a)==""){return"Please input user name!"}return true}},{xtype:"textfield",itemId:"pwdField",fieldLabel:I18N_Util.getMsg("lblPassword"),inputType:"password",autoEl:{onpaste:"return false;"},listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){var a=this.up("window");if(a){a.login()}}}}},{xtype:"combo",itemId:"brokerField",store:Ext.create("Ext.data.Store",{requires:["cwm.common.CookieUtil"],fields:["name","port"],data:[]}),name:"Broker",fieldLabel:I18N_Util.getMsg("lblLocalBroker"),queryMode:"local",editable:false,displayField:"name",valueField:"port"},{xtype:"fieldset",itemId:"customBrokerSet",title:I18N_Util.getMsg("titleRemoteBroker"),checkboxToggle:true,collapsed:true,defaults:{width:230},layout:{type:"table",columns:2},setExpanded:function(a){var c=this,d=c.checkboxCmp,e=c.toggleCmp,b;a=!!a;if(d){d.setValue(a)}if(e){e.setType(a?"up":"down")}if(a){b="expand";c.removeCls(c.baseCls+"-collapsed")}else{b="collapse";c.addCls(c.baseCls+"-collapsed")}c.collapsed=!a;c.doComponentLayout();c.fireEvent(b,c);return c},listeners:{expand:function(b){if(b.ownerCt==null){return}var d=b.ownerCt.down("#brokerField");d.disable();var e=b.down("#cusBrokerIp");var c=b.down("#cusBrokerPort");var a=e.getValue();if(a==null||Ext.String.trim(a)==""||Ext.String.trim(a)==Ext.brokerIp){e.setValue(Ext.brokerIp);c.setValue(d.getValue())}e.focus(true,300)},collapse:function(a){if(a.ownerCt==null){return}var b=a.ownerCt.down("#brokerField");b.enable()}},items:[{xtype:"textfield",fieldLabel:I18N_Util.getMsg("lblBrokerIp"),colspan:2,itemId:"cusBrokerIp",name:"cusBrokerIp",margin:"5 0 5 0",validator:function(a){if(Ext.String.trim(a)==""){return"Please input broker IP or host name!"}return true},value_unused:Ext.brokerIp},{xtype:"combo",fieldLabel:I18N_Util.getMsg("lblBrokerPort"),colspan:2,itemId:"cusBrokerPort",name:"cusBrokerPort",validator:function(b){b=Ext.String.trim(b);var a=parseInt(b);if(isNaN(a)||a<=0||""+a!=b){return"Invalid port number!"}return true},hideTrigger:false,queryMode:"local",store:[30000,33000],value_unused:30000},{xtype:"checkboxfield",fieldLabel:I18N_Util.getMsg("lblSaveInHistory"),itemId:"cusBrokerSave",name:"cusBrokerSave",width:150,checked:true},{xtype:"button",width:80,itemId:"btnClearHistory",margin:"0 0 5 0",text:I18N_Util.getMsg("btnCleanHistory"),handler:function(a){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmCleanBrokerHistory"),closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(h,j,f){if(h=="yes"){try{var b=a.up("window");var d=b.dbname;var g=Ext.cookieUtil.getBrokerHistory();delete g[d];if(Ext.Object.getSize(g)<=0){Ext.cookieUtil.clearBrokerHistory()}else{Ext.cookieUtil.setBrokerHistory(g)}var c=a.ownerCt.down("#cusSelBrokerIp");c.reset();c.getStore().removeAll();c.disable();a.disable()}catch(i){Ext.Trace(i)}}}})}},{xtype:"combo",fieldLabel:I18N_Util.getMsg("lblFromHistory"),colspan:2,itemId:"cusSelBrokerIp",name:"cusSelBrokerIp",margin:"0 0 5 0",hideTrigger:false,forceSelection:true,matchFieldWidth:false,listConfig:{width:140},queryMode:"local",store:Ext.create("Ext.data.Store",{fields:["id","ip","port"],data:[]}),displayField:"id",valueField:"id",listeners:{change:function(c,d,b){if(!d){return}var a=c.getStore().getById(d);c.ownerCt.down("#cusBrokerIp").setValue(a.get("ip"));c.ownerCt.down("#cusBrokerPort").setValue(a.get("port"))}}}]}]},{xtype:"checkbox",itemId:"saveField",boxLabel:I18N_Util.getMsg("lblSaveUNameAndPass"),hidden:true,margin:"0 0 0 10"},{xtype:"panel",layout:"column",bodyStyle:"background : transparent; border : none",margin:"0 0 0 10",items:[{xtype:"button",text:I18N_Util.getMsg("btnLogin"),width:50,handler:function(){try{var a=this.up("panel").up("panel");if(a){a.login()}}catch(b){Ext.Trace(b)}}},{xtype:"button",text:I18N_Util.getMsg("btnCancel"),width:50,margin:"0 0 15 10",handler:function(){try{var a=this.up("panel").up("panel");if(a){a.cancel();a.close()}}catch(b){Ext.Trace(b)}}}]}],convertBrokerHistoryToStoreArray:function(c){var d=Ext.cookieUtil.getBrokerHistory();var e=new Array();var b=d[c];if(b!=null){for(var a in b){b[a].id=a;e.push(b[a])}}return e},initComponent:function(){this.callParent(arguments);try{if(Ext.cookieUtil.getDbmtUserName()!=="admin"){var g,k,b,d,m,h,s;this.down("#customBrokerSet").expand();g=this.down("#unameField");k=this.down("#brokerField");customBrokerSet=this.down("#customBrokerSet");b=this.down("#cusBrokerIp");d=this.down("#cusBrokerPort");m=this.down("#cusBrokerSave");h=this.down("#btnClearHistory");s=this.down("#cusSelBrokerIp");customBrokerSet.checkboxCmp.setDisabled(true);var c=Ext.getCurCmUserDbAuthByDbName(this.dbname);g.setValue(c.dbid);b.setValue(c.bip);d.setValue(c.bport);g.setDisabled(true);b.setDisabled(true);d.setDisabled(true);k.hide();m.hide();h.hide();s.hide()}else{var f=Ext.getUserNameAndPassword(this.dbname);var q=Ext.cookieUtil.getDbUserRemember(this.dbname);this.down("#dbField").setValue(this.dbname);if(!q){this.down("#unameField").setValue("dba");this.down("#pwdField").setValue("")}else{this.down("#unameField").setValue(f.username);this.down("#pwdField").setValue(f.password);this.down("#saveField").setValue(true)}var p=Ext.cookieUtil.getValidBrokers();for(var n=0;n<p.length;n++){p[n].name+="["+p[n].port+"]"}var j=this.down("#brokerField");j.getStore().loadData(p);if(p[0]!=null){j.setValue(p[0].port)}else{this.down("#customBrokerSet").expand()}var l=this.down("#cusSelBrokerIp");l.getStore().loadData(this.convertBrokerHistoryToStoreArray(this.dbname));var a=l.getStore().getAt(0);if(a!=null){var t=this.down("#cusBrokerIp");var u=this.down("#cusBrokerPort");t.setValue(a.get("ip"));u.setValue(a.get("port"))}else{this.down("#btnClearHistory").disable();l.disable()}}var o=this.down("#pwdField");o.focus(true,300)}catch(r){Ext.Trace(r)}}});Ext.define("cwm.widget.DropDbVerify",{extend:"Ext.window.Window",alias:"dropverify",id:"adminAuthWin",border:0,bodyStyle:"background : #F3F3F3; border : none",resizable:false,modal:true,setUsesName:function(b,a){var c=this.getComponent("user");c.disabled=(typeof a!=="undefined"&&a!=null&&a==true)?true:false;c.setValue(b)},items:[{xtype:"textfield",fieldLabel:I18N_Util.getMsg("lblUserName"),value:"admin",itemId:"user",regex:/^[\w-]+$/,invalidText:I18N_Util.getMsg("msgInvalidUserName"),margin:10},{xtype:"textfield",itemId:"password",inputType:"password",autoEl:{onpaste:"return false;"},allowBlank:true,fieldLabel:I18N_Util.getMsg("lblPassword"),margin:10},{xtype:"panel",margin:10,bodyStyle:"background : transparent; border : none",items:[{xtype:"button",width:80,text:I18N_Util.getMsg("btnOK"),handler:function(){var b=this.up("panel").up("panel");var c=b.getComponent("password").getValue();var a=b.getComponent("user").getValue();if(!Ext.VerifyTextInput(a)){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidUserName"));return}if("fn" in b){b.fn("ok",a,c)}}},{xtype:"button",width:80,margin:"0 0 0 20",text:I18N_Util.getMsg("btnCancel"),handler:function(){var a=this.up("panel").up("panel");a.close()}}]},{xtype:"panel",bodyStyle:"background : transparent; border : none",html:"&nbsp"}],initComponent:function(){this.callParent(arguments);this.setUsesName(this.username,true)}});Ext.define("cwm.widget.DynamicChart",{extend:"Ext.chart.Chart",alias:"widget.dynamicchart",initParams:function(){this.data=new Array();this.dataElementLimit=Ext.cwm.chartTimeLength;this.isLoaded=false},getStore:function(){return this.store},getTimeAxis:function(){var a=this.axes.get(1);if(a.type!=="Time"){return null}return a},updateTime:function(e){var d=this.getTimeAxis(),a=d.toDate,c,b;if(!e&&this.data.length===0){return}else{if(!e&&this.data.length>0){var e=Ext.clone(this.data[this.data.length-1]);e.date=Ext.Date.add(Ext.Date.clone(e.date),Ext.Date.SECOND,Ext.cwm.monitorInterval*1)}}this.data.push(e);this.removeRedundantData();this.store.loadData(this.data);c=this.data[this.data.length-1];b=c.date;d.toDate=b;d.fromDate=Ext.Date.add(Ext.Date.clone(b),Ext.Date.SECOND,Ext.cwm.monitorInterval*(1-Ext.cwm.chartTimeLength));this.redraw()},updateTimeAxis:function(){var c=this.getTimeAxis(),b,a;b=this.data[this.data.length-1];a=b.date;this.store.loadData(this.data);c.toDate=a;c.fromDate=Ext.Date.add(Ext.Date.clone(a),Ext.Date.SECOND,Ext.cwm.monitorInterval*(1-Ext.cwm.chartTimeLength));this.redraw()},removeRedundantData:function(){var a=this.data.length-this.dataElementLimit;if(a>0){Ext.Array.splice(this.data,0,a)}else{return}},initComponent:function(){this.callParent(arguments);this.initParams()}});Ext.define("cwm.widget.InputWindow",{extend:"Ext.window.Window",alias:"inputbox",border:0,title:I18N_Util.getMsg("titleLoginDb"),bodyStyle:"background : #F3F3F3; border : none",resizable:false,modal:true,items:[{xtype:"panel",itemId:"message",bodyStyle:"background : transparent; border : none",margin:10,html:""},{xtype:"textfield",itemId:"inputedit",minWidth:200,margin:10,regex:/^[\w-]+$/,invalidText:I18N_Util.getMsg("msgInvalidInput")},{xtype:"panel",margin:10,bodyStyle:"background : transparent; border : none",items:[{xtype:"button",width:80,margin:"0 0 10 0",text:I18N_Util.getMsg("btnOK"),handler:function(){var a=this.up("panel").up("panel");var c=a.getComponent("inputedit");var b=c.getValue();a.close();if("fn" in a){a.fn("ok",b)}}},{xtype:"button",width:80,margin:"0 0 10 20",text:I18N_Util.getMsg("btnCancel"),handler:function(){var a=this.up("panel").up("panel");a.close();if("fn" in a){a.fn("cancel")}}}]}],initComponent:function(){this.callParent(arguments);this.getComponent("message").update(this.message)}});Ext.define("cwm.widget.LeftPanelToolBar",{extend:"Ext.toolbar.Toolbar",alias:"widget.lptoolbar",width:180,cls:"lptoolbarclass",initComponent:function(){var g=Ext.create("Ext.Action",{icon:"resources/images/b_home.png",scope:this,tooltip:I18N_Util.getMsg("msgHome"),handler:function(){this.fireEvent("GotoHome",this,null)}});var a=Ext.create("Ext.Action",{icon:"resources/images/s_loggoff.png",scope:this,tooltip:I18N_Util.getMsg("msgLogoutSys"),handler:function(){this.fireEvent("Logout",this,null)}});var b=Ext.create("Ext.Action",{icon:"resources/images/s_passwd.png",scope:this,tooltip:I18N_Util.getMsg("msgChangeCMSUserPass"),handler:function(){this.fireEvent("ChangePasswd",this,null)}});var f=Ext.create("Ext.Action",{icon:"resources/images/b_selboard.png",id:"shortcutBtnSql",scope:this,hidden:true,tooltip:I18N_Util.getMsg("msgQueryWin"),handler:function(){this.fireEvent("GotoQueryWin",this,null)}});var e=Ext.create("Ext.Action",{icon:"resources/images/b_docs.png",scope:this,tooltip:I18N_Util.getMsg("msgCDoc"),handler:function(){this.fireEvent("GotoDoc",this,null)}});var c=Ext.create("Ext.Action",{icon:"resources/images/bug.gif",scope:this,tooltip:I18N_Util.getMsg("msgReportBug"),handler:function(){window.open("http://jira.cubrid.org/browse/TOOLS")}});var d=Ext.create("Ext.Action",{icon:"resources/images/s_reload.png",scope:this,tooltip:I18N_Util.getMsg("msgRefresh"),handler:function(){this.fireEvent("LeftPanelRefresh",this,null)}});this.items=[g,a,b,f,e,c,d];this.addEvents("GotoHome","Logout","ChangePasswd","GotoQueryWin","GotoCwmDoc","GotoDoc","LeftPanelRefresh");this.callParent(arguments)}});Ext.define("cwm.widget.Login",{extend:"Ext.window.Window",alias:"widget.login",autoShow:true,closable:false,preventHeader:true,bodyStyle:"border: 0px; background:#F3F3F3",style:"border: 0px; background: #FFFFFF; box-shadow: 0 0 0 0 #FFFFFF inset;",resizable:false,shadow:true,autoDestroy:true,width:380,addItems:function(){var d=this;var c=Ext.cwm.langList[0]["value"];if(Ext.cwm.lang!==""){for(var b=0;b<Ext.cwm.langList.length;b++){if(Ext.cwm.langList[b]["key"]===Ext.cwm.lang){c=Ext.cwm.langList[b]["value"];break}}}var e=Ext.cookieUtil.getLastDbmtUserName();e=typeof e==="string"?e:"admin";var a=16;if(Ext.isIE7||Ext.isIE8){a=25}d.items=[{html:'<div class="login_logo"><h1>CUBRID<sup>TM</sup> Web Manager</h1></div>',bodyStyle:"border:0px;"},{xtype:"form",buttonAlign:"right",bodyStyle:"border:0px;background:transparent;",padding:"20 50 10 50",layout:{type:"table",columns:2},fieldDefaults:{width:250,labelAlign:"right",labelWidth:80,anchor:"100%",labelHeight:20},items:[{name:"username",xtype:"textfield",fieldLabel:I18N_Util.getMsg("lblUserName"),value:e,allowBlank:true,colspan:2,listeners:{specialkey:function(i,h){if(h.getKey()==h.ENTER){var f=this.up("login");if(f){var g=f.down("button[action=submit]");if(g){g.fireEvent("click",this,null)}}}},blur:function(g){var f=g.up("form");if(f){var h=f.down("#PassTip");if(h){if(g.getValue()==="admin"){h.show()}else{h.hide()}}}}}},{name:"password",itemId:"passwordBox",xtype:"textfield",inputType:"password",autoEl:{onpaste:"return false;"},fieldLabel:I18N_Util.getMsg("lblPassword"),allowBlank:true,listeners:{specialkey:function(i,h){if(h.getKey()==h.ENTER){var f=this.up("login");if(f){var g=f.down("button[action=submit]");if(g){g.fireEvent("click",this,null)}}}}}},{type:"label",width:20,itemId:"PassTip",hidden:e==="admin"?false:true,bodyStyle:"border: 0; background:transparent;",margin:"0 0 4px 3px",html:'<img title="'+I18N_Util.getMsg("msgDefAdminPass")+'" width=16 height=16 src="'+Ext.ImagePath+'b_docs.png"/>'},{name:"lang",itemId:"LangCombo",fieldLabel:I18N_Util.getMsg("lblLang"),xtype:"combo",store:Ext.create("Ext.data.Store",{fields:["key","value"],data:Ext.cwm.langList,autoLoad:true,autoDestroy:true}),displayField:"value",valueField:"key",value:c,editable:false,colspan:2,listeners:{change:function(h,g,f){if(h.getRawValue()!==f){Ext.cookieUtil.setLang(g);location.reload(false)}}}}],buttons:[{text:I18N_Util.getMsg("btnLogin"),action:"submit"},{xtype:"tbspacer",width:a}]}]},initComponent:function(){this.addItems();this.callParent(arguments);var a=this.down("#passwordBox");if(a!=null){a.focus(false,300)}}});Ext.define("cwm.widget.LogPeriodForm",{extend:"Ext.form.Panel",alias:"widget.logperiodform",cls:"infoPanel",buttonAlign:"left",margin:"0 0 15 0",bodyStyle:"padding: 0 0 0 5px;",fieldDefaults:{labelWidth:80,margin:5},layout:{type:"table",columns:2},idPrefix:"",logType:new Array(),periodDays:365,buttons:[{text:I18N_Util.getMsg("btnGo"),disabled:true,formBind:true,listeners:{click:function(a){var b=a.up("form");if(b){b.submit()}}}}],addItems:function(){var m=this;var g=new Date();g.setDate(g.getDate()-1);g.setMinutes(0,0,0);var n=new Date();n.setMinutes(0,0,0);if(m.idPrefix==="db"){var l=new Array();var o;for(var f=0;f<Ext.dblist.length;f++){o=new Object();o.name=Ext.dblist[f]["name"];l.push(o)}var e=Ext.create("Ext.form.field.ComboBox",{itemId:m.idPrefix+"DbCombo",store:Ext.create("Ext.data.Store",{fields:["name"],data:l,autoDestroy:true}),name:"name",fieldLabel:I18N_Util.getMsg("lblDb"),queryMode:"local",editable:false,displayField:"name",valueField:"name",value:l.length===0?"":l[0]["name"],colspan:2});m.add(e)}var d=Ext.create("Ext.form.field.ComboBox",{itemId:m.idPrefix+"LogTypeCombo",store:m.logTypeStore,name:"logtype",fieldLabel:I18N_Util.getMsg("lblLogType"),queryMode:"local",editable:false,displayField:"name",valueField:"value",forceSelection:true,colspan:2,listeners:{afterrender:function(i){i.setValue(i.store.getAt(0))}}});var k=Ext.create("Ext.form.field.ComboBox",{itemId:m.idPrefix+"PeriodTypeCombo",store:m.periodTypeStore,name:"periodType",fieldLabel:I18N_Util.getMsg("lblPeriodType"),queryMode:"local",displayField:"name",valueField:"value",editable:false,colspan:2,forceSelection:true,listeners:{afterrender:function(i){i.setValue(i.store.getAt(0))},change:function(q,p,i){m.setTime(p)}}});var c=Ext.create("Ext.form.field.Date",{itemId:m.idPrefix+"StartDate",fieldLabel:I18N_Util.getMsg("lblStartDate"),name:"startDate",allowBlank:false,format:m.dateFormat,listeners:{change:function(q,p,i){m.fireEvent("TimeChange",m)}}});var b=Ext.create("Ext.form.field.Time",{itemId:m.idPrefix+"StartTime",name:"startTime",increment:60,anchor:"100%",allowBlank:false,format:m.timeFormat,listeners:{change:function(q,p,i){m.fireEvent("TimeChange",m)}}});var j=Ext.create("Ext.form.field.Date",{itemId:m.idPrefix+"EndDate",fieldLabel:I18N_Util.getMsg("lblEndDate"),name:"endDate",allowBlank:false,format:m.dateFormat,listeners:{change:function(q,p,i){m.fireEvent("TimeChange",m)}}});var h=Ext.create("Ext.form.field.Time",{itemId:m.idPrefix+"EndTime",name:"endTime",increment:60,anchor:"100%",allowBlank:false,format:m.timeFormat,listeners:{change:function(q,p,i){m.fireEvent("TimeChange",m)}}});m.add(d);m.add(k);m.add(c);m.add(b);m.add(j);m.add(h);var a=new Ext.util.DelayedTask(function(){m.setTime()});a.delay(300)},setTime:function(f){f=typeof f==="string"?f:"day";var g=this;var a=g.down("#"+g.idPrefix+"StartDate");var e=g.down("#"+g.idPrefix+"StartTime");var h=g.down("#"+g.idPrefix+"EndDate");var c=g.down("#"+g.idPrefix+"EndTime");if(a&&e&&h&&c){var b=new Date(),d;if(b.getMinutes()>0){b.setHours(b.getHours()+1,0,0,0)}else{b.setMinutes(0,0,0)}d=Ext.Date.clone(b);if(f==="day"){d.setDate(d.getDate()-1)}else{if(f==="week"){d.setDate(d.getDate()-7)}else{if(f==="month"){d.setMonth(d.getMonth()-1)}}}a.setValue(Ext.Date.format(d,g.dateFormat));e.setValue(Ext.Date.format(d,g.timeFormat));a.setMaxValue(b);h.setValue(Ext.Date.format(b,g.dateFormat));c.setValue(Ext.Date.format(b,g.timeFormat));h.setMaxValue(b)}},submit:function(){var f=this;var c=f.getValues();if(!c){Ext.Trace("Err: fail to get form values");return}var e=c.startDate+c.startTime;var b=c.endDate+c.endTime;e=Ext.Date.parse(e,f.dateFormat+f.timeFormat);b=Ext.Date.parse(b,f.dateFormat+f.timeFormat);var g=new JSEX();var a=function(){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmQueryTooMoreDay",{days:f.periodDays}),width:300,buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(h,i){if(h=="yes"){g.next()}}})};var d=function(){var h=f.up("report");if(h){var i=typeof c.name==="string"?c.name:"";e=Ext.Date.format(e,h.commonTimeFormat);b=Ext.Date.format(b,h.commonTimeFormat);h.addLogGrid(f.idPrefix,i,c.logtype,e,b)}};if(Ext.isTimeOutOfRange(e,b,f.periodDays)===1){g.push(a)}g.push(d);g.exec()},refreshDbList:function(){var d=this;if(d.idPrefix!=="db"){return}var e=d.down("#"+d.idPrefix+"DbCombo");if(e){var c=new Array();var a;for(var b=0;b<Ext.dblist.length;b++){a=new Object();a.name=Ext.dblist[b]["name"];c.push(a)}e.store.loadData(c);e.setValue(e.store.getAt(0))}},initComponent:function(){var a=this;a.addEvents("TimeChange");a.callParent(arguments);a.dateFormat="Y/m/d";a.timeFormat="H:i";a.periodType=[{name:I18N_Util.getMsg("lblLastDay"),value:"day"},{name:I18N_Util.getMsg("lblLastWeek"),value:"week"},{name:I18N_Util.getMsg("lblLastMonth"),value:"month"}];a.periodTypeStore=Ext.create("Ext.data.Store",{fields:["name","value"],data:a.periodType,autoDestroy:true});a.logTypeStore=Ext.create("Ext.data.Store",{fields:["name","value"],data:a.logType,autoDestroy:true});a.addItems()}});Ext.define("cwm.widget.LogReportGrid",{extend:"Ext.grid.Panel",alias:"widget.logreportgrid",uses:["Ext.ux.exporter.Exporter"],requires:["Ext.ux.exporter.Button"],enableColumnMove:false,sortableColumns:false,enableColumnHide:false,cls:"infoPanel",width:700,height:350,type:"",logType:"",name:"",start:"",end:"",addDbAddVolCol:function(){var a=this;a.store=Ext.create("Ext.data.Store",{model:"cwm.model.AutoAddVolLog",autoDestroy:true});a.columns=[{text:I18N_Util.getMsg("lblDb"),dataIndex:"dbname"},{text:I18N_Util.getMsg("lblPurpose"),sortable:true,width:60,dataIndex:"purpose"},{text:I18N_Util.getMsg("lblPage"),width:60,dataIndex:"page"},{text:I18N_Util.getMsg("lblVolName"),sortable:true,width:120,dataIndex:"volname"},{text:I18N_Util.getMsg("lblTime"),sortable:true,width:150,dataIndex:"time"},{text:I18N_Util.getMsg("lblDescription"),dataIndex:"outcome",width:200,renderer:function(b){if(!b){return""}else{return b.replace(/<end>/g," ")}}}]},addDbBackupCol:function(){var a=this;a.store=Ext.create("Ext.data.Store",{model:"cwm.model.AutoBackupLog",autoDestroy:true});a.columns=[{text:I18N_Util.getMsg("lblDb"),dataIndex:"dbname"},{text:I18N_Util.getMsg("lblBackupId"),sortable:a.backupId===""?true:false,dataIndex:"backupid"},{text:I18N_Util.getMsg("lblAutoBackupTime"),sortable:true,width:150,dataIndex:"error_time"},{text:I18N_Util.getMsg("lblDescription"),dataIndex:"error_desc",width:200,renderer:function(b){if(!b){return""}else{return b.replace(/<end>/g," ")}}}]},addDbErrCol:function(){var a=this;a.store=Ext.create("Ext.data.Store",{model:"cwm.model.DbErrLog",autoDestroy:true});a.columns=[{text:I18N_Util.getMsg("lblTime"),width:120,dataIndex:"time"},{text:I18N_Util.getMsg("lblErrType"),sortable:true,width:80,dataIndex:"type"},{text:I18N_Util.getMsg("lblErrCode"),width:80,dataIndex:"code"},{text:I18N_Util.getMsg("lblTranId"),sortable:true,width:80,dataIndex:"tranid"},{text:I18N_Util.getMsg("lblErrId"),sortable:true,width:80,dataIndex:"errid"},{text:I18N_Util.getMsg("lblErrMsg"),dataIndex:"msg",width:200,renderer:function(b){if(!b){return""}else{return b.replace(/<end>/g," ")}}}]},addBrokerStartStopCol:function(){var a=this;a.store=Ext.create("Ext.data.Store",{model:"cwm.model.BrokerLog",autoDestroy:true});a.columns=[{text:I18N_Util.getMsg("lblBroker"),sortable:true,dataIndex:"name"},{text:I18N_Util.getMsg("lblTime"),sortable:true,width:150,dataIndex:"time"},{text:I18N_Util.getMsg("lblDescription"),dataIndex:"desc",width:300}]},addDockedItems:function(){var d=this;var b=Ext.cookieUtil.getLastDbmtUserName();var a=true;if(b==="admin"){a=false}var c='<div style="text-align:center; margin: 3px 0;"><a target="_blank" href="http://www.adobe.com/products/flashplayer/" title="'+I18N_Util.getMsg("msgTipInstallFlash")+'">'+I18N_Util.getMsg("btnExport")+"</a></div>";d.addDocked({xtype:"toolbar",style:"background: #F1F1F1; border: 0;",items:[{xtype:"exporterbutton",html:'<p data-qtip="'+I18N_Util.getMsg("msgExport2Excel")+'">'+c+"<p>"},{text:I18N_Util.getMsg("btnShartWithUrl"),tooltip:I18N_Util.getMsg("msgShartWithUrl"),handler:function(){var e=new Array();var f;if(Ext.isArray(d.data)){for(var g=0;g<d.data.length;g++){f=Ext.encode(d.data[g]);e.push(f)}}Ext.storeSharedLog(d.tempId,e);d.shareUrlWin(d.tempId)}},{text:I18N_Util.getMsg("btnSend2Mail"),hidden:a,handler:function(){d.addSendLogMailWin()}}]})},getDataFromFile:function(a){var b=this;Ext.getTempLog(a,{success:function(c,f){var j=Ext.decode(c.responseText);try{var k=j.confdata;var h=new Array();for(var d=0;d<k.length;d++){h.push(Ext.decode(k[d]))}b.getStore().loadData(h)}catch(g){Ext.Trace(g)}}})},getDataFromSys:function(b,d,a){if(typeof b!=="string"||typeof d!=="string"||typeof a!=="string"){Ext.Trace("Err: invalid params!");return}var c=this;if(c.type==="db"){c.tempId=c.type+"_"+c.logType+"_"+d+"_"+a+"_"+b;if(c.logType==="err"){c.getDbErrLog(b,d,a)}else{if(c.logType==="backup"){c.getDbBackupLog(b,d,a)}else{if(c.logType==="addvol"){c.getDbAddVolLog(b,d,a)}}}}else{if(c.type==="broker"){c.tempId=c.type+"_"+c.logType+"_"+d+"_"+a;if(c.logType==="start-stop"){c.getBrokerStartStopLog(b,d,a)}}}},getDbAddVolLog:function(b,d,a){var c=this;Ext.getAutoAddVolLog(b,function(e){c.getStore().loadData(e);c.data=e;c.refreshDockedItem()},d,a)},getDbBackupLog:function(b,d,a){var c=this;Ext.getAutoBackupDbErrLog({success:function(e,j){var g=Ext.decode(e.responseText);if(g&&g.status==="success"){var h=Ext.isArray(g.error);var k=new Array();for(var f=0;h&&f<g.error.length;f++){if(g.error[f]["dbname"]===b){k.push(g.error[f])}}c.getStore().loadData(k);c.data=k;c.refreshDockedItem()}}},d,a)},getDbErrLog:function(b,d,a){var c=this;Ext.getDbErrLog(b,d,a,function(e){c.getStore().loadData(e);c.data=e;c.refreshDockedItem()})},getBrokerStartStopLog:function(b,d,a){var c=this;Ext.getBrokerLog(d,a,{success:function(f,h){var l=Ext.decode(f.responseText);var k=new Array();var e,j;if(Ext.isArray(l.log)){for(var g=0;g<l.log.length;g++){e=new Object();j=l.log[g].split(" ");if(j.length===3){e.name=I18N_Util.getMsg("lblAllBroker");e.time=j[0]+" "+j[1];e.desc=j[2];k.push(e)}else{if(j.length===4){e.name=j[2];e.time=j[0]+" "+j[1];e.desc=j[3];k.push(e)}}}if(l.overflow===1){Ext.showWarningWin(I18N_Util.getMsg("msgRecOverflow"),function(){c.getStore().loadData(k);c.data=k;c.refreshDockedItem()})}else{c.getStore().loadData(k);c.data=k;c.refreshDockedItem()}}}})},shareUrlWin:function(){var b=this;var a=Ext.getAbsoluteUrl("logs.html?id="+b.tempId);if(typeof Ext.cwm.lang==="string"&&Ext.cwm.lang!==""&&Ext.cwm.lang!=="en"){a+="&lang="+Ext.cwm.lang}var c=Ext.create("Ext.window.Window",{autoShow:true,bodyStyle:"border:0;background:transparent;",style:"border:0;background:#F3F3F3;",title:I18N_Util.getMsg("titleShareUrl"),bodyPadding:10,modal:true,resizable:false,items:[{xtype:"displayfield",labelWidth:250,fieldLabel:I18N_Util.getMsg("lblSharedUrlPath")},{xtype:"textarea",name:"url",itemId:"URL",labelWidth:60,width:250,value:a,readOnly:true}],buttons:[{text:I18N_Util.getMsg("btnOK"),handler:function(d){c.close()}},{text:I18N_Util.getMsg("btnCancel"),handler:function(d){c.close()}}]})},addSendLogMailWin:function(){var a=this;var b=Ext.create("cwm.widget.SendLogToMailWin",{title:I18N_Util.getMsg("titleSendLogToMail")});b.callback={sendMail:function(c){if(typeof c!=="object"||c===null){return}c.msg_body=Ext.getMailBody(a.type,a.logType,a.name,a.start,a.end,a.data);c.msg_header="CUBRID Log Report";Ext.sendMail(c,{success:function(d,f){var e=Ext.decode(d.responseText);if(Ext.isArray(e.response)&&e.response[0]){if(e.response[0].message.indexOf("2")===0){Ext.showSuccessWin(I18N_Util.getMsg("msgSucSendMail"),function(){b.close()})}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrSendMail")+"<br><br>"+I18N_Util.getMsg("lblErrMsg")+":<br>"+e.response[0].message)}}}})}}},refreshDockedItem:function(){var b=this;if(b.data.length<1){var a=b.down("exporterbutton");if(a){a.hide()}}},initComponent:function(){var a=this;if(a.type==="db"){if(a.logType==="addvol"){a.addDbAddVolCol()}else{if(a.logType==="backup"){a.addDbBackupCol()}else{if(a.logType==="err"){a.addDbErrCol()}}}}else{if(a.type==="broker"){if(a.logType==="start-stop"){a.addBrokerStartStopCol()}}}a.callParent(arguments);if(a.needDocked!==false){a.addDockedItems()}a.data=new Array();a.tempId=""}});Ext.define("cwm.widget.MonitorDetailWin",{extend:"Ext.window.Window",alias:"widget.monitordetailwin",autoShow:true,modal:true,bodyStyle:"border:0; background: white;",shadow:true,autoScroll:true,autoDestroy:true,initComponent:function(){this.callParent(arguments)}});Ext.define("cwm.widget.Selector",{extend:"Ext.Component",autoEl:{tag:"select",cls:"x-font-select",multiple:"multiple",style:"border: 1px solid #AAAAAA; border-radius: 2px 2px 2px 2px;  box-shadow: 0 1px 2px #DDDDDD;    color: #333333;    padding: 3px;"},selectAll:function(b){var c=this.getEl().dom;if(c.type==="select-multiple"){for(var a=0;a<c.options.length;a++){c.options[a].selected=b}}},getSelected:function(){var d=this.getEl().dom;var b=new Array();for(var a=0;a<d.options.length;a++){if(d.options[a].selected){var c=d.options[a].value;b.push(c)}}return b},onRender:function(){var a=this;var b=new Array();for(var c=0;c<this.items.length;c++){var d=this.items[c];b.push('<option value="'+Ext.htmlEncode(d)+'">'+Ext.htmlEncode(d)+"</option>")}b.join("");this.autoEl=Ext.apply({},this.initialConfig,this.autoEl);this.autoEl.html=b;this.callParent(arguments);this.el.on("load",this.onLoad,this);this.el.on("change",function(){var e=a.getSelected();a.fireEvent("selectChange",e)})},initComponent:function(){this.callParent(arguments);this.addEvents("selectChange")}});Ext.define("cwm.widget.SqlMessage",{extend:"Ext.panel.Panel",margin:10,bodyStyle:"background : #EBF8A4",layout:"column",items:[{xtype:"image",padding:"10 0 10 10",src:Ext.ImagePath+"s_success.png"},{xtype:"panel",padding:"10 10 10 4",border:0,bodyStyle:"background : transparent",html:""}],initComponent:function(){this.callParent(arguments);if(this.result.status==0){this.getComponent(0).setSrc(Ext.ImagePath+"s_success.png");if(typeof this.result!="undefined"){this.getComponent(1).update("1 row inserted")}}else{this.getComponent(0).setSrc(Ext.ImagePath+"s_error.png");if(typeof this.result!="undefined"){this.getComponent(1).update("<div>"+I18N_Util.getMsg("msgErrSqlInfo",{status:this.result.status,note:Ext.htmlEncode(this.result.note)})+"</div><div>"+I18N_Util.getMsg("msgErrSqlStmt",{sql:Ext.htmlEncode(this.result.stmt)})+"</div>")}}}});Ext.define("cwm.widget.TableLists",{extend:"Ext.panel.Panel",alias:"widget.lptblist",bodyStyle:"background : transparent;",requires:["cwm.widget.DbList"],childcomp:{dbListCombbox:0,tableList:1,createButton:2},createCombobox:function(e){var c=new Array();var b=Ext.getDbIndex(e);for(var a=0;a<Ext.dblist[b].tables.length;a++){var d=new Object();d.value=Ext.dblist[b].tables[a].name;d.name=d.value;c.push(d)}this.states=Ext.create("Ext.data.Store",{fields:["name","value"],data:c});this.combox=Ext.create("Ext.form.ComboBox",{store:this.states,id:"dbselector",border:0,margin:"20 0 10 0",name:"tblistCombo",typeAhead:true,queryMode:"local",displayField:"name",valueField:"value",emptyText:I18N_Util.getMsg("msgSelectTable"),tpl:'<tpl for="."><div class="x-boundlist-item combo_item" role="option">{[Ext.htmlEncode(values.name)]}</div></tpl>',listConfig:{cls:(Ext.isIE9||Ext.isIE7)?"cwm_combo_boundlist":""},refresh:function(){var h=Ext.getDbIndex(Ext.currentDb);var g=new Array();for(var f=0;f<Ext.dblist[h].tables.length;f++){var j=new Object();j.value=Ext.dblist[h].tables[f].name;j.name=j.value;g.push(j)}this.getStore().loadData(g)}});return this.combox},refresh:function(){this.tableList.refresh();this.combox.refresh()},createList:function(){var b=Ext.getDbIndex(Ext.currentDb);if(-1==b){return}var a=Ext.create("cwm.widget.DbList",{width:170,height:450,autoScroll:true,data:Ext.dblist[b].tables});a.createList();return a},initComponent:function(){this.tableList=this.createList();var b=this;var a=Ext.create("Ext.Button",{scope:this,icon:Ext.ImagePath+"b_snewtbl.png",text:I18N_Util.getMsg("btnAddNewTable"),margin:"10 0 0 10",textAlign:"left",handler:function(){this.fireEvent("createNewTable","")}});var c=this.createCombobox(Ext.currentDb);c.on("select",function(f,h,i){var g=f.getValue();try{b.fireEvent("tableChange",g)}catch(j){Ext.Trace("dbselector:select:"+j)}});var d=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none; margin-right : 10px; padding: 3px",layout:"column",component:{name:1},listener:{beforerender:function(e){e.getComponent(e.component.name).setWidth(e.textlen*10+30)}},items:[{xtype:"button",icon:"resources/images/exit.png",tooltip:I18N_Util.getMsg("msgLogoutDB"),handler:function(){b.fireEvent("dbLogout",Ext.currentDb)}},{xtype:"panel",html:'<span data-qtip="'+Ext.cookieUtil.getDbUserName(Ext.currentDb)+"@&nbsp;"+Ext.currentDb+'">'+Ext.cookieUtil.getDbUserName(Ext.currentDb)+"@&nbsp;"+Ext.currentDb+"</span>",bodyStyle:"background : #D9EFF7; border : none; padding: 3px",width:119,listener:{beforerender:function(e){e.setWidth(e.textlen*10)}}}]});this.items=[d,c,this.tableList,a];this.addEvents("createNewTable","tableChange","dbLogout");this.callParent(arguments)}});Ext.define("cwm.widget.broker.GroupStatus",{extend:"Ext.grid.Panel",alias:"widget.brokergpstatus",bodyStyle:"background: transparent; border: 0",cls:"infoPanel",enableColumnMove:false,sortableColumns:false,enableColumnHide:false,addColumns:function(){var a=this;a.columns=[{text:I18N_Util.getMsg("lblBName"),minWidth:80,dataIndex:"name"},{text:I18N_Util.getMsg("lblBStatus"),minWidth:80,dataIndex:"state"},{header:I18N_Util.getMsg("lblAction"),sortable:false,xtype:"actioncolumn",items:[{icon:Ext.ImagePath+"broker_start.png",tooltip:I18N_Util.getMsg("msgStartBroker"),getClass:function(e,b,f){if(a.brokerAuth!=="admin"){return"x-hide-display"}var d=f.get("state");var c=d==="ON"?true:false;if(c===true){return"x-item-disabled"}},handler:function(d,h,c){var g=a.store.getAt(h);var f=g.get("state");var b=g.get("name");var e=f==="ON"?true:false;if(e===false){a.start(b)}}},{icon:Ext.ImagePath+"broker_stop.png",tooltip:I18N_Util.getMsg("msgStopBroker"),getClass:function(e,b,f){if(a.brokerAuth!=="admin"){return"x-hide-display"}var d=f.get("state");var c=(a.groupStatus==="OFF"||d==="OFF")?true:false;if(c===true){return"x-item-disabled"}},handler:function(d,h,c){var g=a.store.getAt(h);var f=g.get("state");var b=g.get("name");var e=(a.groupStatus==="OFF"||f==="OFF")?true:false;if(e===false){a.stop(b)}}},{icon:Ext.ImagePath+"broker_detail.png",tooltip:I18N_Util.getMsg("msgShowDetail"),handler:function(d,g,c){var b=new Object();var e=a.store.getAt(g);b.brokerName=e.get("name");b.state=e.get("state");b.groupInfo=a.brokersInfo;var f=a.up("brokers");if(f){f.showDetail(b)}}}]},{text:I18N_Util.getMsg("lblBPId"),minWidth:80,dataIndex:"pid"},{text:I18N_Util.getMsg("lblBPort"),minWidth:80,dataIndex:"port"},{text:I18N_Util.getMsg("lblBAS"),minWidth:80,dataIndex:"as"},{text:I18N_Util.getMsg("lblBJQ"),minWidth:80,dataIndex:"jq"},{text:I18N_Util.getMsg("lblBReq"),minWidth:80,dataIndex:"req"},{text:I18N_Util.getMsg("lblBTPS"),minWidth:80,dataIndex:"tran"},{text:I18N_Util.getMsg("lblBQPS"),minWidth:80,dataIndex:"query"}]},createStore:function(){this.store=Ext.create("Ext.data.Store",{model:"cwm.model.Broker",autoDestroy:true})},refreshData:function(a,b){if(!Ext.isArray(a)){return}var c=this;c.brokersInfo=a;c.getStore().loadData(a)},start:function(a){if(!a){return}var b=this;var c=b.up("brokers");if(c){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmStartBroker"),width:250,buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(d,e){if(d=="yes"){c.stopAutoRefresh();Ext.startBroker(a,{success:function(f,h){var g=Ext.decode(f.responseText);if(g&&g.status==="success"){c.refreshItems()}else{if(g){if(!Ext.checkTokenStatus(g.note)){return}else{Ext.showFailureWin(g.note)}}}c.checkAutoRefreshStatus()},failure:function(f,g){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText);c.checkAutoRefreshStatus()}})}}})}},stop:function(a){if(!a){return}var b=this;var c=b.up("brokers");if(c){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmStopBroker"),width:250,buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(d,e){if(d=="yes"){c.stopAutoRefresh();Ext.stopBroker(a,{success:function(f,h){var g=Ext.decode(f.responseText);if(g&&g.status==="success"){c.refreshItems()}else{if(g){if(!Ext.checkTokenStatus(g.note)){return}else{Ext.showFailureWin(g.note)}}}c.checkAutoRefreshStatus()},failure:function(f,g){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+f.responseText);c.checkAutoRefreshStatus()}})}}})}},refreshAuth:function(){var a=this;a.brokerAuth=Ext.getCurCmUserBrokerAuth()},initComponent:function(){var a=this;a.addEvents("BrokerStart","BrokerStop","ShowDetail");a.createStore();a.addColumns();a.callParent(arguments);a.brokersInfo=new Array();a.groupStatus="ON";a.brokerAuth=Ext.getCurCmUserBrokerAuth()}});Ext.define("cwm.widget.broker.Status",{extend:"Ext.panel.Panel",alias:"widget.brokerstatus",bodyStyle:"background: transparent; border: 0;",addItems:function(){this.createBrokerInfo();this.createBrokerStatus()},createBrokerInfo:function(){infStore=Ext.create("Ext.data.Store",{model:"cwm.model.BrokerDetailInf",autoDestroy:true});var d=Ext.create("Ext.grid.Panel",{bodyStyle:"background: transparent; border: 0",padding:"10px 0",cls:"infoPanel",title:I18N_Util.getMsg("titleBrokerStatus",{bname:this.brokerName}),id:"brokerInfoDetail",enableColumnMove:false,sortableColumns:false,enableColumnHide:false,store:infStore,columns:[{text:I18N_Util.getMsg("lblBPId"),dataIndex:"pid",width:60},{text:I18N_Util.getMsg("lblBPort"),dataIndex:"port",width:60},{text:I18N_Util.getMsg("lblBJobQueue"),dataIndex:"jq"},{text:I18N_Util.getMsg("lblBAutoAddAppServer"),dataIndex:"auto",width:170},{text:I18N_Util.getMsg("lblBSqlLogMode"),dataIndex:"sqll",width:120},{text:I18N_Util.getMsg("lblBSessionTimeout"),dataIndex:"ses",width:120},{text:I18N_Util.getMsg("lblBKeepConn"),dataIndex:"keep_conn",width:120},{text:I18N_Util.getMsg("lblBAccessMode"),dataIndex:"access_mode"}]});this.add(d);for(var b=0;b<this.groupInfo.length;b++){if(this.groupInfo[b].name===this.brokerName){var a=this.groupInfo[b];var c=[a];d.getStore().loadData(c);break}}this.doLayout()},createBrokerStatus:function(){statusStore=Ext.create("Ext.data.Store",{model:"cwm.model.BrokerDetailStatus",autoDestroy:true});var a=Ext.create("Ext.grid.Panel",{bodyStyle:"background: transparent; border: 0",cls:"infoPanel",id:"brokerStatusDetail",enableColumnMove:false,sortableColumns:false,enableColumnHide:false,store:statusStore,columns:[{text:I18N_Util.getMsg("lblBId"),dataIndex:"as_id"},{text:I18N_Util.getMsg("lblBPId"),dataIndex:"as_pid"},{text:I18N_Util.getMsg("lblBQPS"),dataIndex:"as_num_query"},{text:I18N_Util.getMsg("lblBLQS"),dataIndex:"as_long_query"},{text:I18N_Util.getMsg("lblBPSize"),dataIndex:"as_psize"},{text:I18N_Util.getMsg("lblBStatus"),dataIndex:"as_status"},{text:I18N_Util.getMsg("lblBDb"),dataIndex:"as_dbname"}]});this.add(a);this.doLayout();this.loadStatusData()},refreshData:function(c,e){if(!Ext.isArray(c)){return}var b=this.down("#brokerInfoDetail");if(b){for(var d=0;d<c.length;d++){if(c[d].name===this.brokerName){var a=c[d];var f=[a];b.getStore().loadData(f);this.status=c[d].state;break}}}this.loadStatusData(e)},loadStatusData:function(b){var c=this;var e=false;if(b==="auto"){e=true}var a=this.down("#brokerStatusDetail");if(a&&this.status==="ON"){Ext.getBrokerStatus(this.brokerName,{success:function(g,i){var h=Ext.decode(g.responseText);if(h&&h.status=="success"){var j=h.asinfo;if(e===true){c.getStatusDelta(j,Ext.cwm.oldBrokerStatus)}a.getStore().loadData(j);var f=Ext.decode(g.responseText);Ext.cwm.oldBrokerStatus=f.asinfo}else{if(h&&Ext.checkTokenStatus(h.note)){Ext.showFailureWin(h.note)}}},failure:function(f,g){}})}else{if(a&&this.status==="OFF"){var d=[];a.getStore().loadData(d)}}},getStatusDelta:function(e,h){if(!Ext.isArray(e)||!Ext.isArray(h)){return e}var f,d,g,b;for(var c=0;c<e.length;c++){for(var a=0;a<h.length;a++){if(e[c]["as_id"]===h[a]["as_id"]){f=parseInt(e[c]["as_long_query"]);d=parseInt(h[a]["as_long_query"]);g=parseInt(e[c]["as_num_query"]);b=parseInt(h[a]["as_num_query"]);if(!isNaN(f)&&!isNaN(d)){e[c]["as_long_query"]=f-d}if(!isNaN(g)&&!isNaN(b)){e[c]["as_num_query"]=g-b}if(e[c]["as_long_query"]<0){e[c]["as_long_query"]=0}if(e[c]["as_num_query"]<0){e[c]["as_num_query"]=0}break}}}},initComponent:function(){this.callParent(arguments);this.groupInfo=new Array();this.brokerName="";this.status=""}});Ext.define("cwm.widget.dbquery.FieldRow",{extend:"Ext.panel.Panel",alias:"widget.fieldrow",style:"background: transparent;",bodyStyle:"background: transparent; border: 0;",autoDestroy:true,layout:{type:"hbox"},defaults:{flex:1},fieldCount:0,addLabel:function(e,b,a){if(typeof e!=="string"){return}b=typeof b!=="string"?"":b;var d=new Object();d.margin="2";if(e.length>15){d.html='<span class="'+b+'" title = "'+Ext.htmlEncode(e)+'">'+Ext.htmlEncode(e.substring(0,15)+"...")+"</span>"}else{d.html='<span class="'+b+'">'+Ext.htmlEncode(e)+"</span>"}d.minWidth=this.labelMinWidth;d.maxWidth=this.labelMaxWidth;if(a&&typeof a.minWidth==="number"&&typeof a.maxWidth==="number"){d.minWidth=a.minWidth;d.maxWidth=a.maxWidth}var c=Ext.create("Ext.form.Label",d);this.add(c)},addFirstItem:function(b){if(b&&typeof b.createItem==="function"){var a=b.createItem();this.add(a)}else{this.addLabel("Label:","db_query_label")}},addFields:function(e){var b,d,a=new Object(),c;if(e.addType!=="added"){if(typeof e.fieldType!=="string"||typeof e.name!=="string"){return}c=this.fieldCount;this.fieldType=e.fieldType;this.fieldName=e.name;a.margin="2";if(e.fieldType.indexOf("ComboBox")){a.queryMode="local";a.store=e.store;a.displayField=e.displayField;a.valueField=e.valueField;a.editable=e.editable;a.tpl='<tpl for="."><div class="x-boundlist-item combo_item" role="option">{[xindex == 1 && values.'+e.displayField+' == "&nbsp;" ? values.'+e.displayField+" : Ext.htmlEncode(values."+e.displayField+")]}</div></tpl>";if(e.isColumnRow===true&&(Ext.isIE9||Ext.isIE7)){a.listConfig={cls:"cwm_combo_boundlist"}}}if(e.boxLabel){a.boxLabel=e.boxLabel}if(e.boxLabelAlign){a.boxLabelAlign=e.boxLabelAlign}if(e.minWidth){a.minWidth=e.minWidth}if(e.maxWidth){a.maxWidth=e.maxWidth}this.fieldConf=Ext.clone(a)}else{if(typeof e.count!=="number"){return}c=e.count;a=Ext.clone(this.fieldConf)}for(b=0;b<c;b++){a.name=this.fieldName+"_"+(this.indexCount+b);d=Ext.create(this.fieldType,a);this.add(d)}this.indexCount+=c;a=null},reset:function(e,b){if(typeof e!=="number"){return}var f=1;if(typeof b==="number"&&b>=0){f=b}var a=this.items.length;if(a<e){return}for(var c=f;c<a;c++){if(c===e+1){var d=this.getComponent(c);if(d){d.reset()}break}}},initComponent:function(){this.callParent(arguments);this.labelMinWidth=100;this.labelMaxWidth=235;this.indexCount=0;this.fieldConf;this.fieldType;this.fieldName}});Ext.define("cwm.widget.dbquery.QueryArea",{extend:"Ext.form.Panel",alias:"widget.queryarea",style:"background: #D3DCE3",bodyStyle:"background: #EEEEEE; border: 0",width:540,height:330,autoDestroy:true,defaults:{border:0},buttonAlign:"right",buttons:[{text:I18N_Util.getMsg("btnSubmitQuery"),action:"submit",handler:function(b){var a=b.up("queryarea");if(a){a.submit()}}}],addItems:function(){var b={html:'<div class="dbquery">'+I18N_Util.getMsg("titleSqlQueryOnDb",{db:Ext.currentDb})+"</div>"};var a={xtype:"textarea",name:"stmt",width:500,height:250,padding:"20px"};this.add(b);this.add(a)},submit:function(e){var g=this.getForm().getValues();var k=Ext.String.trim(g.stmt);if(k===""){var i=this.up("dbquery");if(i){var f=i.down("dbsqlcreator");if(f){f.submit()}}Ext.showFailureWin(I18N_Util.getMsg("msgFailMissSql"))}else{if(!k.match(/^select\s+/i)){var i=this.up("dbquery");if(i){var f=i.down("dbsqlcreator");if(f){f.submit()}}Ext.showFailureWin(I18N_Util.getMsg("msgFailMissColInSql"))}else{var d=this.up("dbstruct");if(d){d.removeStructure();var j=d.down('ctab[itemId="Query"]');if(j){j.setActive(false)}var a="sqlEditorPanel_dbquery";var c=k;var b=Ext.create("cwm.view.QueryEditorView",{queryTextareaDomId:a,initQueryStatements:c,bodyStyle:"border: 0;background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;"});d.add(b);var h=d.down("ctabbar");if(h){h.setActiveById("SQL")}b.showSqlEditor(false);b.runSql(b,c)}}}},setValue:function(b){if(typeof b!=="string"){b=""}var a=this.down("textarea");if(a){a.setValue(b)}},initComponent:function(){this.callParent(arguments);this.addItems()}});Ext.define("cwm.widget.dbquery.SqlCreator",{extend:"Ext.form.Panel",alias:"widget.dbsqlcreator",style:"border: 0; background: #EEEEEE;",bodyStyle:"background: #EEEEEE; border: 0; padding: 10px;",autoDestroy:true,autoScroll:true,defaults:{border:0},initComponent:function(){var a=this;a.callParent(arguments);a.initColumnNum=8;a.curColumnNum=a.initColumnNum;a.criteriaCount=2;a.criteriaSerial=a.criteriaCount-1;a.criteriaSeriList=[0,1];a.minCriteria=2;a.maxCriteria=10;a.minLabelWidth=120;a.dbColumnData;a.columnStore;a.tables;a.addColumnRow();a.addSortRow();a.addShowRow();a.addCriteriaRow();a.addAddedCriteriaRow();a.addDockedItems()},addColumnRow:function(){var b=this;var a=Ext.create("Ext.data.Store",{fields:["column","value"],data:[{column:"",value:""}],autoLoad:true});var d=Ext.create("cwm.widget.dbquery.FieldRow",{id:"ColumnRow",fieldCount:b.initColumnNum});b.add(d);d.addLabel(I18N_Util.getMsg("lblColumn")+":","db_query_label",{minWidth:b.minLabelWidth,maxWidth:d.labelMaxWidth});var c=new Object();c.fieldType="Ext.form.field.ComboBox";c.name="column";b.columnStore=c.store=a;c.displayField="column";c.valueField="value";c.editable=false;c.isColumnRow=true;d.addFields(c)},addSortRow:function(){var a=this;var c=Ext.create("cwm.widget.dbquery.FieldRow",{id:"SortRow",fieldCount:a.initColumnNum});a.add(c);c.addLabel(I18N_Util.getMsg("lblSort")+":","db_query_label",{minWidth:a.minLabelWidth,maxWidth:c.labelMaxWidth});var b=new Object();b.fieldType="Ext.form.field.ComboBox";b.name="sort";b.store=Ext.create("Ext.data.Store",{fields:["type","value"],data:[{type:"&nbsp;",value:""},{type:"Ascending",value:"ASC"},{type:"Descending",value:"DESC"}],autoLoad:true});b.displayField="type";b.valueField="value";b.editable=false;c.addFields(b)},addShowRow:function(){var a=this;var c=Ext.create("cwm.widget.dbquery.FieldRow",{id:"ShowRow",fieldCount:a.initColumnNum});a.add(c);c.addLabel(I18N_Util.getMsg("lblShow")+":","db_query_label",{minWidth:a.minLabelWidth,maxWidth:c.labelMaxWidth});var b=new Object();b.fieldType="Ext.form.field.Checkbox";b.name="show";c.addFields(b)},addCriteriaRow:function(){var a=this;var c=Ext.create("cwm.widget.dbquery.FieldRow",{id:"CriteriaRow0",fieldCount:a.initColumnNum});a.add(c);c.addLabel(I18N_Util.getMsg("lblCriteria")+":","db_query_label",{minWidth:a.minLabelWidth,maxWidth:c.labelMaxWidth});var b=new Object();b.fieldType="Ext.form.field.Text";b.name="criteria0";c.addFields(b)},addAddedCriteriaRow:function(){var a=this;var b=a.criteriaSerial;var d=Ext.create("cwm.widget.dbquery.FieldRow",{itemId:"CriteriaRow"+b,fieldCount:a.initColumnNum});a.add(d);d.addFirstItem({createItem:function(){var e=Ext.create("Ext.panel.Panel",{style:"background: transparent",bodyStyle:"background: transparent; border: 0",width:d.labelMinWidth,minWidth:a.minLabelWidth,margin:"2",layout:"hbox",items:[{xtype:"checkbox",margin:"2 2 2 0",name:"critConCheck_"+b,serial:b,checked:true,listeners:{change:function(h,g,f){if(g!==true){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmRemoveCritRow"),closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(l,n,k){if(l=="yes"){var m=h.up("fieldrow");if(m){a.criteriaCount--;for(var j=1;j<a.criteriaSeriList.length;j++){if(a.criteriaSeriList[j]===h.serial){a.criteriaSeriList.splice(j,1)}}a.remove(m,true)}}else{h.setValue(true)}}})}}}},{xtype:"radiogroup",margin:"2",width:d.labelMinWidth,minWidth:d.labelMinWidth,items:[{boxLabel:I18N_Util.getMsg("lblOr"),name:"criteriaCon_"+b,inputValue:"OR",checked:true},{boxLabel:I18N_Util.getMsg("lblAnd"),name:"criteriaCon_"+b,inputValue:"AND"}]}]});return e}});var c=new Object();c.fieldType="Ext.form.field.Text";c.name="criteria"+b;d.addFields(c)},addDockedItems:function(){var a=this;a.addDocked({xtype:"toolbar",dock:"bottom",ui:"footer",style:"background: #D3DCE3; padding: 10px;",items:[{text:I18N_Util.getMsg("btnAdd"),scope:this,handler:function(b){if(a.maxCriteria<=a.criteriaCount){Ext.showWarningWin(I18N_Util.getMsg("msgFailAtMostRow",{count:a.maxCriteria}))}else{a.criteriaCount++;a.criteriaSerial++;a.criteriaSeriList.push(a.criteriaSerial);a.addAddedCriteriaRow()}}}," "," ",{text:I18N_Util.getMsg("btnUpdateQuery"),tooltip:I18N_Util.getMsg("msgUpdateQueryStmt"),scope:this,handler:function(b){a.submit()}}]})},initColumnData:function(a){if(!Ext.isArray(a)){return}this.tables=a;var d=this;var g=null;var e=new Array();this.dbColumnData=new Array();var f=[{column:"&nbsp;",value:""}];for(var c=0;c<a.length;c++){g='DESC "'+a[c]+'"';e.push(g)}var b=a;Ext.QueryByCCIWithWaitBox(Ext.currentDb,e,{success:function(k,m){var h=Ext.decode(k.responseText);if(h&&h.status=="1000"){var r=h.result;if(b.length!==r.length){Ext.showErrorWin(I18N_Util.getMsg("msgErrUnknownInServer"));return}var o,q;for(var n=0;n<r.length;n++){o=b[n];q=new Array();q.index=n;q.tablename=o;if(Ext.isArray(r[n].values)){q.columns=new Array();q.columns.push({column:'"'+o+'".*',value:'"'+o+'".*-'+n+"-"+0});f.push({column:'"'+o+'".*',value:'"'+o+'".*-'+n+"-"+0});var p=r[n].values;for(var l=0;l<p.length;l++){q.columns.push({column:'"'+o+'"."'+p[l][0]+'"',value:'"'+o+'"."'+p[l][0]+'"-'+n+"-"+(l+1)});f.push({column:'"'+o+'"."'+p[l][0]+'"',value:'"'+o+'"."'+p[l][0]+'"-'+n+"-"+(l+1)})}d.dbColumnData.push(q)}else{d.dbColumnData.push(q)}}q=null;d.columnStore.loadData(f)}}})},submit:function(b){var d=this;d.clearDirtyFieldsAfterSubmit();var e=d.createSql();var c=d.up("dbquery");if(c){var a=c.down("queryarea");if(a){a.setValue(e)}}},createSql:function(){var x=this;var a=x.getForm().getValues();if(!a){return}var r,c="",k="",s="",o="";var t=/-\d+-\d+$/;var n=new Object();var y=new Object();var h=new Object();var w,f,v,l,b;try{for(var q=0;q<x.curColumnNum;q++){if(!a["column_"+q]||a["column_"+q]==""){continue}w=a["column_"+q].search(t);if(w==-1){continue}f=a["column_"+q].substring(0,w);v=a["column_"+q].substring(w+1);if(n[v]!==true&&a["show_"+q]){n[v]=true;c+=f+", "}l=v.split("-")[0];if(y[l]!==true){b=x.tables[parseInt(l)];y[l]=true;k+='"'+b+'", '}if(a["sort_"+q]&&h[v]!==true){h[v]=true;o+=f+" "+a["sort_"+q]+", "}}var d,m,g;for(var p=0;p<x.criteriaSeriList.length;p++){d="";m=0;g=x.criteriaSeriList[p];for(var q=0;q<x.curColumnNum;q++){if(a["criteria"+g+"_"+q]!==""){w=a["column_"+q].search(t);if(w==-1){continue}m++;f=a["column_"+q].substring(0,w);d+="("+f+" "+a["criteria"+g+"_"+q]+") AND "}}if(m>1){if(p>0){s+=a["criteriaCon_"+g]+" "}s+="("+d.substring(0,d.length-4)+") \n"}else{if(m===1){if(p>0){s+=a["criteriaCon_"+g]+" "}s+=d.substring(0,d.length-4)+" \n"}}}if(c!==""){c="SELECT "+c.substring(0,c.length-2)+" \n"}if(k!==""){k="FROM "+k.substring(0,k.length-2)+" \n"}if(s!==""){s="WHERE "+s}if(o!==""){o="ORDER BY "+o.substring(0,o.length-2)}r=c+k+s+o}catch(u){Ext.Trace(u);r=""}return r},changeRowsAndColumns:function(){var c=this.getForm().getValues();if(!c){return}var b=parseInt(c.addrows);var f;if(b==0||b>3||b<-3){return}else{if(b>0){f=this.maxCriteria-this.criteriaCount;if(b>f){b=f;Ext.showWarningWin(I18N_Util.getMsg("msgFailAtMostRow",{count:this.maxCriteria}))}for(var d=0;d<b;d++){this.criteriaCount++;this.addAddedCriteriaRow()}}else{if(b<0){f=this.minCriteria-this.criteriaCount;if(b<f){b=f;Ext.showWarningWin(I18N_Util.getMsg("msgFailAtLeastRow",{count:this.minCriteria}))}var a=this.items.length;b=-b;for(var d=0;d<b;d++){var e=this.getComponent(a-1-d);if(e){this.remove(e,true);this.criteriaCount--}}}}}},clearChangeRowAndColumnFields:function(){var a=this.down("#AddRowCombo");if(a){a.reset()}},clearDirtyFieldsAfterSubmit:function(){var b=this.getForm().getValues();if(!b){return}for(var d=0;d<this.curColumnNum;d++){if(!b["column_"+d]||b["column_"+d]==""){var a=this.items.length;for(var c=0;c<a;c++){var e=this.getComponent(c);if(e){e.reset(d)}}}else{var g=/\.\*-\d+-0$/;var f=g.exec(b["column_"+d]);if(!f){continue}var h=this.down("#SortRow");if(h){h.reset(d)}}}},clearDirtyFieldsAfterUpdateColumn:function(e){if(!Ext.isArray(e)){return}var a=this.getForm().getValues();if(!a){return}var g=/-\d+-\d+$/;var b,f,h;for(var d=0;d<this.curColumnNum;d++){if(!a["column_"+d]||a["column_"+d]==""){continue}b=a["column_"+d].search(g);if(b==-1){continue}f=a["column_"+d].substring(b+1);h=f.split("-")[0];if(!Ext.Array.contains(e,h)){var c=this.down("#ColumnRow");if(c){c.reset(d)}}}},refreshColumnData:function(b){if(!Ext.isArray(b)){return}var c=this;var d=[{column:"&nbsp;"}];for(var a=0;a<b.length;a++){var e=parseInt(b[a]);if(this.dbColumnData[e].columns){d=d.concat(this.dbColumnData[e].columns)}}c.columnStore.loadData(d);c.clearDirtyFieldsAfterUpdateColumn(b)}});Ext.define("cwm.widget.dbquery.UseTables",{extend:"Ext.panel.Panel",alias:"widget.usetables",style:"background: #D3DCE3",bodyStyle:"background: #EEEEEE; border: 0",width:200,autoDestroy:true,defaults:{border:0},buttonAlign:"center",buttons:[{text:I18N_Util.getMsg("btnUpdateQuery"),tooltip:I18N_Util.getMsg("msgUpdateTable"),action:"submit",handler:function(b){var a=b.up("usetables");if(a){a.submit()}}}],addItems:function(){var b={html:'<div class="dbquery">'+I18N_Util.getMsg("titleUseTable")+"</div>"};var a=Ext.create("Ext.panel.Panel",{bodyCls:"dbquery_selects",html:"<select id='dbquery_table' multiple='multiple' size='6' style='width:98%;'></select>"});this.add(b);this.add(a)},updateSelectsData:function(b){if(!Ext.isArray(b)){return}var a=Ext.getDom("dbquery_table");if(!a){return}var e;for(var d=0;d<b.length;d++){e=document.createElement("option");e.value=d;e.text=b[d];e.selected=true;try{a.add(e,null)}catch(c){a.add(e)}}},setSelectOptions:function(a){var d=Ext.getDom("dbquery_table");var b=d.options;for(var c=0;c<b.length;c++){b[c].selected=a}},submit:function(){try{var h=Ext.getDom("dbquery_table");var c=h.options;var f=new Array();for(var d=0;d<c.length;d++){if(c[d].selected){var a=c[d].value;f.push(a)}}var g=this.up("dbquery");if(g){var b=g.down("dbsqlcreator");if(b){b.refreshColumnData(f)}}}catch(j){Ext.Trace(j)}},initComponent:function(){this.callParent(arguments);this.addItems()}});Ext.define("cwm.widget.dbsearch.Criteria",{extend:"Ext.panel.Panel",alias:"widget.dbsearchcriteria",bodyStyle:"background: #EEEEEE; border: 0",autoDestroy:true,defaults:{border:0},width:650,addItems:function(){var d=600;var a=300;var c=I18N_Util.getMsg("msgWordSeparateBySpace");var b=[{html:'<div class="privileges"><h2>'+I18N_Util.getMsg("titleSearchInDb")+"</h2></div>"},{xtype:"form",buttonAlign:"right",bodyStyle:"border: 0; background: #EEEEEE; padding: 10px 0 0;",width:d,fieldDefaults:{labelAlign:"right",labelWidth:a,anchor:"100%",labelHeight:20,msgTarget:"under"},items:[{name:"word",xtype:"textfield",fieldLabel:I18N_Util.getMsg("lblWordToSearch")},{xtype:"radiogroup",fieldLabel:I18N_Util.getMsg("lblFind"),columns:1,defaults:{name:"type"},vertical:true,items:[{inputValue:1,boxLabel:I18N_Util.getMsg("lblAtleastOneWord")+' <img title="'+c+'" src="'+Ext.ImagePath+'b_docs.png">',width:200,checked:true},{inputValue:2,width:200,boxLabel:I18N_Util.getMsg("lblAllWords")+' <img title="'+c+'" src="'+Ext.ImagePath+'b_docs.png">'},{inputValue:3,width:200,height:20,boxLabel:I18N_Util.getMsg("lblExactPhrase")}]},{bodyCls:"dbsearch_selects",html:"<table><tr><td width='305px' valign='top' align='right'><span style='padding-right:5px'>"+I18N_Util.getMsg("lblInsideTable")+":</td><td rowspan='2'><select id='dbsearch_table' multiple='multiple' size='6' style='width:98%;*width:"+(d-a-10)+";'></select></td></tr><tr><td valign='bottom' align='right'><a id='dbsearch_table_selectall' style='padding: 0 5px'>"+I18N_Util.getMsg("lblSelectAll")+"</a>/<a id='dbsearch_table_unselectall' style='padding: 0 5px'>"+I18N_Util.getMsg("lblUnselectAll")+"</a></td></tr></table>",listeners:{render:function(){this.body.on("click",this.handleClick,this)}},handleClick:function(e,f){if(f.id=="dbsearch_table_selectall"){this.setSelectOptions(true)}if(f.id=="dbsearch_table_unselectall"){this.setSelectOptions(false)}},setSelectOptions:function(e){var h=Ext.getDom("dbsearch_table");var f=h.options;for(var g=0;g<f.length;g++){f[g].selected=e}}},{name:"column",xtype:"textfield",fieldLabel:I18N_Util.getMsg("lblInsideCol")}],buttons:[{text:I18N_Util.getMsg("btnGo"),action:"submit"}]}];this.add(b)},getTables:function(){var a=this;Ext.getTablesByCCI({success:function(d,e){var f=Ext.decode(d.responseText);if(f&&f.status=="1000"){var b=f.result;var c=b[0].values;if(Ext.isArray(c)){a.updateSelects(c)}}else{if(f){if(Ext.checkDbLoginStatusWhenCCI(f.status,f.note)){Ext.showErrorWin(Ext.htmlEncode(f.note))}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInGetTable"))}}},failure:function(b,c){Ext.showErrorWin(I18N_Util.getMsg("msgErrInGetTable")+"<br>"+b.responseText)}})},updateSelects:function(b){if(!Ext.isArray(b)){return}var a=Ext.getDom("dbsearch_table");if(!a){return}var e;for(var d=0;d<b.length;d++){e=document.createElement("option");e.value=b[d];e.text=b[d];if(d===0){e.selected=true}try{a.add(e,null)}catch(c){a.add(e)}}},submit:function(d){var c=this;if(!(d&&d.word)){Ext.showWarningWin(I18N_Util.getMsg("msgFailMissWord"));return}var b=this.getSelects();if(!(Ext.isArray(b)&&b.length>0)){Ext.showWarningWin(I18N_Util.getMsg("msgFailMissTable"));return}var a=this.up("dbsearch");if(a){a.removeResultGrid();if(typeof d.word==="string"){d.word=Ext.String.trim(d.word)}if(typeof d.column==="string"){d.column=Ext.String.trim(d.column)}this.createSqls(d.type,b,d.word,d.column,{success:function(e){if(!e){return}var f=Ext.createWaitWin();Ext.QueryByCCINoErrorRollback(Ext.currentDb,e,{success:function(j,k){f.close();var h=Ext.decode(j.responseText);if(h&&h.status=="1000"){var p=h.result;var n=new Array();if(p.length!==e.length){Ext.showErrorWin(I18N_Util.getMsg("msgErrUnknownInServer"));return}for(var m=0;m<p.length;m++){var l=new Object();l.stmt=p[m].stmt;if(p[m].status==0){try{l.count=parseInt(p[m].values[0][0]);l.result=I18N_Util.getMsg("msgResultMatchCount",{count:p[m].values[0][0],tname:Ext.htmlEncode(b[m])})}catch(o){Ext.Trace(o);l.count=0;l.result=I18N_Util.getMsg("msgResultMatchCount",{count:0,tname:Ext.htmlEncode(b[m])})}}else{l.count=0;l.result=I18N_Util.getMsg("msgResultMatchCount",{count:0,tname:Ext.htmlEncode(b[m])})}n.push(l)}if(!a.isSearchCriteriaBtnAdded){a.addCriteriaSwitchBtn()}else{a.changeCriteriaSwitchBtn(false)}var g=c.createResultTitle(d.type,d.word);a.refreshResultList(g,n);c.hide()}else{if(h&&Ext.checkDbLoginStatusWhenCCI(h.status,h.note)){Ext.showErrorWin(h.note)}}},failure:function(g,h){f.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+g.responseText)}})}})}},getSelects:function(){try{var g=Ext.getDom("dbsearch_table");var b=g.options;var d=new Array();for(var c=0;c<b.length;c++){if(b[c].selected){var a=b[c].value;d.push(a)}}return d}catch(f){Ext.Trace(f)}},createSqls:function(j,h,a,c,l){var n=new Array();var e="";var g=this;if(typeof j!="number"||!h||!a){if(l&&typeof l.success==="function"){l.success(n)}}else{if(c===""){var k=new Array();for(var d=0;d<h.length;d++){var b='desc "'+h[d]+'"';k.push(b)}Ext.QueryByCCI(Ext.currentDb,k,{success:function(r,t){var q=Ext.decode(r.responseText);if(q&&q.status=="1000"){var z=q.result;var y;try{if(h.length!==z.length){Ext.showErrorWin(I18N_Util.getMsg("msgErrUnknownInServer"));return}for(var u=0;u<z.length;u++){if(z[u].status==0){var x=z[u].values;var p=new Array();if(Ext.isArray(x)){for(var s=0;s<x.length;s++){var o=x[s][0];p.push(o)}e=g.createConditionStmt(j,a,p);var v='SELECT count(*) FROM "'+h[u]+'"';y=v+e}else{y='SELECT count(*) FROM "'+h[u]+'"'}n.push(y)}else{y="";n.push(y)}}if(l&&typeof l.success==="function"){l.success(n)}}catch(w){Ext.Trace(w)}}}})}else{e=g.createConditionStmt(j,a,c);for(var d=0;d<h.length;d++){var f='SELECT count(*) FROM "'+h[d]+'"';var m=f+e;n.push(m)}if(l&&typeof l.success==="function"){l.success(n)}}}},createConditionStmt:function(b,g,e){if(typeof b!="number"||!g||!e){return}var f="";if(g&&g.indexOf("'")>-1){g=g.replace(/'/g,"''")}if(typeof e==="string"){switch(b){case 1:if(g.indexOf(" ")>-1){var d=g.split(/\s+/);for(var c=0;c<d.length;c++){if(c===0){f+=' WHERE "'+e+"\" LIKE '%"+d[c]+"%'"}else{f+=' OR "'+e+"\" LIKE '%"+d[c]+"%'"}}}else{f=' WHERE "'+e+"\" LIKE '%"+g+"%'"}break;case 2:if(g.indexOf(" ")>-1){var d=g.split(/\s+/);for(var c=0;c<d.length;c++){if(c===0){f+=' WHERE "'+e+"\" LIKE '%"+d[c]+"%'"}else{f+=' AND "'+e+"\" LIKE '%"+d[c]+"%'"}}}else{f=' WHERE "'+e+"\" LIKE '%"+g+"%'"}break;case 3:f=' WHERE "'+e+"\" LIKE '"+g+"'";break}}else{if(Ext.isArray(e)){switch(b){case 1:for(var c=0;c<e.length;c++){if(g.indexOf(" ")>-1){var d=g.split(/\s+/);for(var a=0;a<d.length;a++){if(c===0&&a===0){f+=' WHERE "'+e[c]+"\" LIKE '%"+d[a]+"%'"}else{f+=' OR "'+e[c]+"\" LIKE '%"+d[a]+"%'"}}}else{if(c===0){f+=' WHERE "'+e[c]+"\" LIKE '%"+g+"%'"}else{f+=' OR "'+e[c]+"\" LIKE '%"+g+"%'"}}}break;case 2:for(var c=0;c<e.length;c++){if(g.indexOf(" ")>-1){var d=g.split(/\s+/);for(var a=0;a<d.length;a++){if(c===0&&a===0){f+=' WHERE "'+e[c]+"\" LIKE '%"+d[a]+"%'"}else{if(a!==0){f+=' AND "'+e[c]+"\" LIKE '%"+d[a]+"%'"}else{f+=' OR "'+e[c]+"\" LIKE '%"+d[a]+"%'"}}}}else{if(c===0){f+=' WHERE "'+e[c]+"\" LIKE '%"+g+"%'"}else{f+=' OR "'+e[c]+"\" LIKE '%"+g+"%'"}}}break;case 3:for(var c=0;c<e.length;c++){if(c===0){f+=' WHERE "'+e[c]+"\" LIKE '"+g+"'"}else{f+=' OR "'+e[c]+"\" LIKE '"+g+"'"}}break}}}return f},createResultTitle:function(a,c){if(typeof a!="number"){return}if(!c){return}var b=I18N_Util.getMsg("titleSearchResultFor")+" ";switch(a){case 1:b+=I18N_Util.getMsg("lblAtleastOneWord");break;case 2:b+=I18N_Util.getMsg("lblAllWords");break;case 3:b+=I18N_Util.getMsg("lblExactPhrase");break}b+=' "'+c+'":';return b},initComponent:function(){this.callParent(arguments);this.addItems();this.getTables()}});Ext.define("cwm.widget.dbsearch.ResultList",{extend:"Ext.panel.Panel",alias:"widget.dbresultlist",bodyStyle:"background: transparent; border: 0",autoDestroy:true,defaults:{border:0},items:[{xtype:"panel",cls:"dbsearch_resultlist",bodyCls:"dbsearch_resultlist_body",width:400,items:[{xtype:"label",text:I18N_Util.getMsg("titleSearchResult"),id:"dbSearchResultTitle"}]}],createList:function(h){if(typeof h==="undefined"){return}var k=0;var l="#DFDFDF";var c="transparent";var m=this;var a=null,p;try{for(var f=0;f<h.length;f++){if((f+1)%2==0){a=l}else{a=c}p=h[f].result;if(p.length>50){var d=p.indexOf("table")+7;var b=p.substring(0,d);var g=p.substring(d,p.length-1);p=b+'<span title="'+g+'">'+g.substring(0,50-b.length-4)+"...'</span>"}k+=parseInt(h[f].count);var o=Ext.create("Ext.toolbar.Toolbar",{ui:"footer",width:400,style:"border: 0; padding: 2px 5px; background: "+a+";",bodyStyle:"border: 0; background: "+a+";",items:[{xtype:"label",html:p},"->",{xtype:"button",text:I18N_Util.getMsg("btnBrowse"),stmt:h[f].stmt,handler:function(){var e=this.stmt;e=e.replace("count(*)","*");var i=m.up("dbsearch");if(i){i.showResultGrid(e)}}}]});this.add(o)}if(h.length>1){var n=Ext.create("Ext.toolbar.Toolbar",{ui:"footer",width:400,style:"border: 0; padding: 10px 5px; background: transparent;",bodyStyle:"border: 0; background: transparent;",items:[{xtype:"label",html:I18N_Util.getMsg("lblTotalMatchCount",{count:k})}]});this.add(n)}}catch(j){Ext.Trace(j)}},removeList:function(){var c=this.items.length;for(var a=c-1;a>0;a--){var b=this.getComponent(a);if(b){this.remove(b,true)}}},refreshItems:function(a,b){if(typeof a==="undefined"||typeof b==="undefined"){return}var c=this.down("#dbSearchResultTitle");if(c){c.setText(a)}this.removeList();this.createList(b)},initComponent:function(){this.callParent(arguments)}});Ext.define("cwm.widget.privileges.AddUser",{extend:"Ext.window.Window",alias:"widget.adduser",autoDestroy:true,autoShow:true,closable:true,bodyStyle:"border:0;background:#F3F3F3",shadow:false,autoScroll:true,width:800,height:600,y:50,modal:true,addItems:function(){var b=Ext.create("Ext.panel.Panel",{html:I18N_Util.getMsg("titleAddDbUser",{dbname:Ext.currentDb}),bodyStyle:"background: transparent; border: 0; padding: 10px 10px; font-size: 18px;"});this.add(b);this.createNewUserInf();this.createDbUserGroup();var a=Ext.create("Ext.panel.Panel",{bodyStyle:"background: transparent; border: 0",style:"border: 0; padding: 0 0 10px 10px",buttonAlign:"left",buttons:[{text:I18N_Util.getMsg("btnGo"),action:"submit"}]});this.createDbAuth(a)},createNewUserInf:function(){var a=Ext.create("cwm.widget.privileges.NewUserInf",{});this.add(a)},createDbUserGroup:function(){var b=this;var c=Ext.create("Ext.selection.CheckboxModel");var a=Ext.create("cwm.widget.privileges.DbUserGroup",{selModel:c,fatherType:b.type,userName:"",dockedItems:[{xtype:"toolbar",style:"background: transparent; border: 0;",items:[{xtype:"label",style:"padding: 3px 0 3px 10px",text:I18N_Util.getMsg("msgDftUserGroup")}]}]});this.add(a)},createDbAuth:function(c){var b=this;var e="SELECT class_name FROM db_class AS a  WHERE LOWER(a.class_name) NOT IN (SELECT LOWER(partition_class_name) FROM db_partition) AND is_system_class='NO' AND owner_name<>'PUBLIC' ORDER BY class_name";var d=[e];var a={cls:"infoPanel",title:I18N_Util.getMsg("titleTableAuth"),fatherType:this.type,border:0,style:"padding: 10px;"};Ext.QueryByCCIWithWaitBox(Ext.currentDb,d,{success:function(i,j){var m=Ext.decode(i.responseText);if(m&&m.status=="1000"){var g=m.result;var h=g[0].values;if(Ext.isArray(h)&&h.length>0){var l=Ext.create("cwm.widget.privileges.DbAuth",a);b.add(l);l.loadData(h)}else{var k=I18N_Util.getMsg("msgNoAvailableTable");b.addDbAuthPanelToContainer(k,b)}}else{if(!Ext.checkDbLoginStatusWhenCCI(m.status,m.note)){return}var f=(typeof m.note==="string")?Ext.htmlEncode(m.note):I18N_Util.getMsg("msgFail2GetTables");Ext.showErrorWin(I18N_Util.getMsg("prompt"));var k=I18N_Util.getMsg("msgFail2GetTables");b.addDbAuthPanelToContainer(k,b)}if(c){b.add(c)}},failure:function(f,g){var h=I18N_Util.getMsg("msgFail2GetTables");b.addDbAuthPanelToContainer(h,b);if(c){b.add(c)}}})},addDbAuthPanelToContainer:function(d,a){var b={cls:"infoPanel",title:I18N_Util.getMsg("titleTableAuth"),fatherType:this.type,border:0,style:"padding: 10px;",width:360};b.items=[{html:d,cls:"dbauth_info",bodyCls:"body"}];var c=Ext.create("Ext.panel.Panel",b);a.add(c)},submitForm:function(){var d=this;var e=null;var c=this.down("newuserinf");if(c){e=c.submitForm()}if(e){var b=this.down("dbusergp");var a=null;if(b){a=b.submitForm()}this.createNewDbUser(e.username,e.password,a,{success:function(g,h){var f=d.down("dbauth");if(f){f.userName=e.username;f.submitForm()}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucAddUser"),function(){var j=d.up("privileges");d.close();if(j){var i=j.down("userlist");if(i){i.refreshUserList()}}})}}})}},createNewDbUser:function(f,b,a,e){var d="";if(a){d='CREATE USER "'+f+"\" PASSWORD '"+b+"' "+a}else{d='CREATE USER "'+f+"\" PASSWORD '"+b+"' "}var c=[d];Ext.QueryByCCI(Ext.currentDb,c,{success:function(h,i){var j=Ext.decode(h.responseText);if(j&&j.status=="1000"){var g=j.result;if(g[0].status!==0){Ext.showErrorWin(Ext.htmlEncode(g[0].note))}else{if(e&&typeof e.success==="function"){e.success(h,i)}}}}})},initComponent:function(){this.callParent(arguments);this.type="adduser";this.addItems()}});Ext.define("cwm.widget.privileges.ChangeDbUserPwd",{extend:"Ext.panel.Panel",alias:"widget.changedbuserpwd",style:"border: 0; padding : 10px",bodyStyle:"background: transparent; border: 0",cls:"infoPanel",title:I18N_Util.getMsg("titleChangeUserPass"),width:360,userName:"undefined",isDba:false,loginUser:"",items:[{xtype:"form",buttonAlign:"left",padding:"10px 10px 0 0",bodyStyle:"border:0;background:transparent",width:350,fieldDefaults:{labelAlign:"left",labelWidth:120,anchor:"100%",labelHeight:20,msgTarget:"under"},items:[{name:"oldPassword",xtype:"textfield",inputType:"password",autoEl:{onpaste:"return false;"},maxLength:31,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblOldPass")},{name:"newPassword",xtype:"textfield",inputType:"password",autoEl:{onpaste:"return false;"},maxLength:31,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblNewPass")},{name:"confirmpassword",xtype:"textfield",inputType:"password",autoEl:{onpaste:"return false;"},maxLength:31,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblConfirmPass")}],buttons:[{text:I18N_Util.getMsg("btnGo"),action:"submit"}]}],isAuthUser:function(){var f=this.loginUser.toLowerCase();var d=this.userName.toLowerCase();try{if(f!==d&&f!=="dba"){var h=this.down("form");if(h){for(var c=0;c<h.items.length;c++){var g=h.getComponent(c);if(g){g.setDisabled(true)}}var b=h.down("button[action=submit]");if(b){b.setDisabled(true)}}}else{if(f!==d&&f==="dba"){var a=this.down('textfield[name="oldPassword"]');if(a){a.setDisabled(true)}}}}catch(j){Ext.Trace(j)}},initComponent:function(){this.callParent(arguments);this.isAuthUser()},submitForm:function(){var g=this;var b=g.loginUser.toLowerCase();var j=g.userName.toLowerCase();try{var k=g.down('textfield[name="oldPassword"]');var i=g.down('textfield[name="newPassword"]');var c=g.down('textfield[name="confirmpassword"]');var a=k.getValue();var d=i.getValue();var h=c.getValue();if(b!==j&&b==="dba"){if(!d.match(/^\S{4,}$/)){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidDbUserPass"),function(){g.clearFieldValue("new")})}else{if(d!=h){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidConfirmPass"),function(){g.clearFieldValue("cfm")})}else{d=d.replace(/'/g,"''");g.changeDbUserPwd(d)}}}else{if(!d.match(/^\S{4,}$/)){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidDbUserPass"),function(){g.clearFieldValue("new")})}else{if(d!=h){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidConfirmPass"),function(){g.clearFieldValue("cfm")})}else{d=d.replace(/'/g,"''");g.checkOldPwd(a,{success:function(e,l){g.changeDbUserPwd(d)}})}}}}catch(f){Ext.Trace(f)}},checkOldPwd:function(a,c){var b=this;Ext.checkDbPass(Ext.currentDb,this.userName,a,{success:function(d,f){var e=Ext.decode(d.responseText);if(e&&e.status=="success"){Ext.cookieUtil.setDbUserPwd(Ext.currentDb,a);if(c&&typeof c.success==="function"){c.success(d,f)}}else{if(e&&Ext.checkTokenStatus(e.note)){Ext.showErrorWin(I18N_Util.getMsg("msgErrInOldPass"),function(){b.clearFieldValue("old")})}}},failure:function(d,e){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText)}})},changeDbUserPwd:function(a){var d=this;var f='ALTER USER "'+this.userName+"\" PASSWORD '"+a+"'";var e=[f];var c=this.loginUser.toLowerCase();var b=this.userName.toLowerCase();Ext.QueryByCCI(Ext.currentDb,e,{success:function(h,j){var i=Ext.decode(h.responseText);if(i&&i.status=="1000"){var g=i.result;if(g[0].status==0){if(c==b){Ext.showSuccessWin(I18N_Util.getMsg("msgSucChangePass")+"<br>"+I18N_Util.getMsg("msgReconnectPrompt"),function(){var k=d.up("editUser");if(k){k.destroy()}Ext.cookieUtil.setDbLoginStatus(Ext.currentDb,false);var l=Ext.getCmp("LeftPanelToolBar");if(l){l.fireEvent("GotoHome",l,null)}})}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucChangePass"),function(){d.clearFieldValue()})}}else{Ext.showErrorWin(Ext.htmlEncode(g[0].note))}}}})},clearFieldValue:function(a){var b,c,d;if(a==="old"){b=this.down('textfield[name="oldPassword"]');if(b){b.reset();b.focus(true,300)}}else{if(a==="new"){c=this.down('textfield[name="newPassword"]');if(c){c.reset();c.focus(true,300)}}else{if(a==="cfm"){d=this.down('textfield[name="confirmpassword"]');if(d){d.reset();d.focus(true,300)}}else{b=this.down('textfield[name="oldPassword"]');c=this.down('textfield[name="newPassword"]');d=this.down('textfield[name="confirmpassword"]');if(b&&c&&d){b.reset();c.reset();d.reset()}}}}}});Ext.define("cwm.widget.privileges.DbAuth",{extend:"Ext.grid.Panel",alias:"widget.dbauth",bodyStyle:"background: transparent; border: 0",style:"padding : 10px",cls:"infoPanel",enableColumnMove:false,sortableColumns:false,enableColumnHide:false,userName:"",fatherType:"",isDba:false,loginUser:"",createColumns:function(){var c='&nbsp;<img src="'+Ext.ImagePath+'unchecked.gif" class="checkbtn">';var a=70;var b=110;this.columns=[{text:I18N_Util.getMsg("lblATable"),dataIndex:"table",renderer:function(d){if(d===null){return""}return Ext.htmlEncode(d)}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblASelect")+c,width:a,dataIndex:"SELECT",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAInsert")+c,width:a,dataIndex:"INSERT",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAUpdate")+c,width:a,dataIndex:"UPDATE",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblADelete")+c,width:a,dataIndex:"DELETE",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAAlter")+c,width:a,dataIndex:"ALTER",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAIndex")+c,width:a,dataIndex:"INDEX",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAExecute")+c,width:a,dataIndex:"EXECUTE",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAGrantSelect")+c,width:b,dataIndex:"GRANT_SELECT",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAGrantInsert")+c,width:b,dataIndex:"GRANT_INSERT",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAGrantUpdate")+c,width:b,dataIndex:"GRANT_UPDATE",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAGrantDelete")+c,width:b,dataIndex:"GRANT_DELETE",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAGrantAlter")+c,width:b,dataIndex:"GRANT_ALTER",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAGrantIndex")+c,width:b,dataIndex:"GRANT_INDEX",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}},{xtype:"checkcolumn",text:I18N_Util.getMsg("lblAGrantExecute")+c,width:b,dataIndex:"GRANT_EXECUTE",editor:{xtype:"checkbox",cls:"checkColumn_unchecked"}}]},createStore:function(){this.store=Ext.create("Ext.data.Store",{model:"cwm.model.DbAuth",autoDestroy:true})},loadData:function(b){if(!Ext.isArray(b)){return}if(this.fatherType==="editUser"){b.sort(function(f,e){return f.table.localeCompare(e.table)});this.dbAuthData=new Array();var a=false;var c;if(this.userName==="PUBLIC"){for(var d=0;d<b.length;d++){if(a===true){c=this.dbAuthData[this.dbAuthData.length-1];if(c.table===b[d]["table"]){if(c.auth!==true){this.dbAuthData.pop();this.dbAuthData.push(b[d]);b[d]["isSystemClass"]=c.isSystemClass}else{c.isSystemClass=b[d]["isSystemClass"]}a=false;continue}else{if(c.isSystemClass==="YES"){this.dbAuthData.pop();this.dbAuthData.push(b[d])}else{this.dbAuthData.push(b[d])}}}else{this.dbAuthData.push(b[d]);a=true}}}else{for(var d=0;d<b.length;d++){if(a===true){c=this.dbAuthData[this.dbAuthData.length-1];if(c.table===b[d]["table"]){if(c.auth!==true){this.dbAuthData.pop();this.dbAuthData.push(b[d]);a=false;continue}a=false;continue}else{this.dbAuthData.push(b[d])}}else{this.dbAuthData.push(b[d]);a=true}}}}else{if(this.fatherType==="adduser"){this.dbAuthData=this.createFormatData(b)}}this.store.loadData(this.dbAuthData)},createFormatData:function(b){if(!Ext.isArray(b)){return}var a=new Array();for(var c=0;c<b.length;c++){var d=new Object();d.table=b[c][0];a.push(d)}return a},submitForm:function(){var a=this;if(this.fatherType=="editUser"){this.revokeAllPrivileges({success:function(b,c){a.grantAuth()}})}else{if(this.fatherType=="adduser"){if(!this.userName){Ext.showErrorWin(I18N_Util.getMsg("msgErrMissUsername"))}this.grantAuth()}}},revokeAllPrivileges:function(e){var b=this;var c=[];if(b.userName==="PUBLIC"){for(var a=0;a<this.dbAuthData.length;a++){if(this.dbAuthData[a]["isSystemClass"]!=="YES"){var d='REVOKE ALL PRIVILEGES ON "'+b.dbAuthData[a].table+'" FROM "'+b.userName+'"';c.push(d)}}}else{for(var a=0;a<this.dbAuthData.length;a++){var d='REVOKE ALL PRIVILEGES ON "'+b.dbAuthData[a].table+'" FROM "'+b.userName+'"';c.push(d)}}Ext.QueryByCCI(Ext.currentDb,c,{success:function(f,h){var g=Ext.decode(f.responseText);if(g&&g.status=="1000"){if(e&&typeof e.success==="function"){e.success(f,h)}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer"))}}})},grantAuth:function(){var a=this;var b=this.getGrantSqlsFromSelects();if(!Ext.isArray(b)){return}if(b.length===0){a.grantSucAction();return}Ext.QueryByCCI(Ext.currentDb,b,{success:function(c,e){var d=Ext.decode(c.responseText);if(d&&d.status=="1000"){a.grantSucAction()}else{Ext.showErrorWin(d.note)}}})},grantSucAction:function(){var a=this;if(a.fatherType=="editUser"){Ext.showSuccessWin(I18N_Util.getMsg("msgSucUpdateUser"),function(){a.refreshData()})}else{if(a.fatherType=="adduser"){Ext.showSuccessWin(I18N_Util.getMsg("msgSucAddUser"),function(){var d=a.up("adduser");var c=a.up("privileges");if(d){d.close()}if(c){var b=c.down("userlist");if(b){b.refreshUserList()}}})}}},getGrantSqlsFromSelects:function(){var k=new Array();var f=this.store.getCount();var h=this.store;for(var d=0;d<f;d++){var e=h.getAt(d);if(this.userName==="PUBLIC"&&e.get("isSystemClass")==="YES"){continue}var j=e.get("table");var a="";var c="";if(e.get("GRANT_SELECT")){c+="SELECT,"}else{if(e.get("SELECT")){a+="SELECT,"}}if(e.get("GRANT_INSERT")){c+="INSERT,"}else{if(e.get("INSERT")){a+="INSERT,"}}if(e.get("GRANT_UPDATE")){c+="UPDATE,"}else{if(e.get("UPDATE")){a+="UPDATE,"}}if(e.get("GRANT_DELETE")){c+="DELETE,"}else{if(e.get("DELETE")){a+="DELETE,"}}if(e.get("GRANT_ALTER")){c+="ALTER,"}else{if(e.get("ALTER")){a+="ALTER,"}}if(e.get("GRANT_INDEX")){c+="INDEX,"}else{if(e.get("INDEX")){a+="INDEX,"}}if(e.get("GRANT_EXECUTE")){c+="EXECUTE,"}else{if(e.get("EXECUTE")){a+="EXECUTE,"}}if(a!=""){a=a.substr(0,a.length-1);var b="GRANT "+a+' ON "'+j+'" TO "'+this.userName+'"';k.push(b)}if(c!=""){c=c.substr(0,c.length-1);var g="GRANT "+c+' ON "'+j+'" TO "'+this.userName+'" WITH GRANT OPTION';k.push(g)}}return k},refreshData:function(){var a=this;var b=Ext.createWaitWin();Ext.getUserInfo({success:function(c,g){b.close();var e=Ext.decode(c.responseText);var f;if(e.status=="success"){if(Ext.isArray(e.user)){for(var d=0;d<e.user.length;d++){if(e.user[d]["@name"]===a.userName){f=e.user[d]["authorization"];break}}a.getUnauthTable(f)}else{a.getUnauthTable()}}else{if(Ext.checkTokenStatus(e.note)){Ext.showFailureWin(I18N_Util.getMsg("msgFail2RefreshAuthInfo"))}}},failure:function(c,d){b.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+I18N_Util.getMsg("msgFail2RefreshAuthInfo"))}})},getUnauthTable:function(a){var b=this,e="",c=new Array(),d;if(this.userName==="PUBLIC"){e="SELECT class_name, is_system_class FROM db_class AS a WHERE LOWER(a.class_name) NOT IN (SELECT LOWER(partition_class_name) FROM db_partition) AND owner_name<>'PUBLIC' ORDER BY class_name"}else{e="SELECT class_name FROM db_class AS a WHERE LOWER(a.class_name) NOT IN (SELECT LOWER(partition_class_name) FROM db_partition) AND is_system_class='NO' AND owner_name<>'PUBLIC' ORDER BY class_name"}c.push(e);Ext.QueryByCCI(Ext.currentDb,c,{success:function(j,m){var l=Ext.decode(j.responseText);if(l&&l.status=="1000"){var f=l.result;var h=f[0].values;if(Ext.isArray(h)&&h.length>0){d=b.createFormatAuthData(a);var n=true;if(!d){d=new Array();n=false}if(b.userName==="PUBLIC"){for(var k=0;k<h.length;k++){var g=new Object();g.table=h[k][0];g.isSystemClass=h[k][1];d.push(g)}}else{for(var k=0;k<h.length;k++){var g=new Object();g.table=h[k][0];d.push(g)}}if(n!==true){b.dbAuthData=d;b.getStore().loadData(d)}else{b.loadData(d)}}else{if(Ext.isArray(a)){d=b.createFormatAuthData(a);b.dbAuthData=d;b.getStore().loadData(d)}}}else{Ext.showFailureWin(I18N_Util.getMsg("msgFail2RefreshAuthInfo"))}},failure:function(f,g){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+I18N_Util.getMsg("msgFail2RefreshAuthInfo"))}})},createFormatAuthData:function(d){if(!Ext.isArray(d)){return}var c=this,a=new Array(),b;for(table in d[0]){b=c.authConvert(table,parseInt(d[0][table]));if(b){a.push(b)}}b=null;return a},authConvert:function(d,c){if(typeof d!=="string"||typeof c!=="number"||isNaN(c)){return}var a=new Object();a.table=d;a.auth=true;for(var b=0;b<16;b++){if((c&(1<<b))!=0){switch(b){case 0:a.SELECT=true;break;case 1:a.INSERT=true;break;case 2:a.UPDATE=true;break;case 3:a.DELETE=true;break;case 4:a.ALTER=true;break;case 5:a.INDEX=true;break;case 6:a.EXECUTE=true;break;case 8:a.GRANT_SELECT=true;break;case 9:a.GRANT_INSERT=true;break;case 10:a.GRANT_UPDATE=true;break;case 11:a.GRANT_DELETE=true;break;case 12:a.GRANT_ALTER=true;break;case 13:a.GRANT_INDEX=true;break;case 14:a.GRANT_EXECUTE=true;break;default:}}}return a},isAuthUser:function(){try{if(!this.isDba){var a=this.down("button[action=submit]");if(a){a.setDisabled(true)}}}catch(b){Ext.Trace(b)}},initComponent:function(){this.createColumns();this.createStore();this.callParent(arguments);this.dbAuthData=null;try{if(this.fatherType=="editUser"){this.isAuthUser()}}catch(a){Ext.Trace(a)}}});Ext.define("cwm.widget.privileges.DbUserGroup",{extend:"Ext.grid.Panel",alias:"widget.dbusergp",bodyStyle:"background: transparent; border: 0",style:"padding : 10px",cls:"infoPanel",title:I18N_Util.getMsg("titleDbUserGroup"),userName:"",fatherType:"",isDba:false,loginUser:"",enableColumnMove:false,sortableColumns:false,enableColumnHide:false,createColumns:function(){var a=this;a.columns=[{text:I18N_Util.getMsg("lblUser"),dataIndex:"user",renderer:function(b){if(b===null){return""}return Ext.htmlEncode(b)}},{text:I18N_Util.getMsg("lblGroups"),width:200,dataIndex:"groups"},{text:I18N_Util.getMsg("lblMembers"),width:300,dataIndex:"members",renderer:function(e,c,b,f,d){if(a.selModel&&a.fatherType==="editUser"&&Ext.isArray(e)&&Ext.Array.contains(e,a.userName)){a.groups.push(b)}if(e===null){return""}return Ext.htmlEncode(e)}}]},createStore:function(){var a=this;a.store=Ext.create("Ext.data.Store",{model:"cwm.model.DbUserGroup",autoDestroy:true})},getUsersInfo:function(){var a=this;Ext.getUserInfo({success:function(b,e){var d=Ext.decode(b.responseText);if(d&&d.status=="success"){var c=d.user;a.loadData(c)}else{if(d&&Ext.checkTokenStatus(d.note)){Ext.showFailureWin(d.note)}}},failure:function(b,c){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+b.responseText)}})},loadData:function(f){var g=this;if(!Ext.isArray(f)){return}var e=g.createFormatData(f);if(!Ext.isArray(e)){return}var a=null;if(g.fatherType==="editUser"){a=e.pop();var h=g.down("#curGroups");var b=g.down("#curMembers");if(h){h.setText(I18N_Util.getMsg("msgCurUserGroup",{members:a.groups.toString()}))}if(b){b.setText(I18N_Util.getMsg("msgCurUserMember",{members:a.members.toString()}))}g.doLayout();if(Ext.isArray(a.members)){for(var d=0;d<e.length;d++){for(var c=0;c<a.members.length;c++){if(a.members[c]===e[d]["user"]){e.splice(d,1);continue}}}}}g.store.loadData(e);if(Ext.cwm.curDbUserIsDba===true){g.selModel.select(g.groups)}},createFormatData:function(d){var e=this;if(!Ext.isArray(d)){return}var c=new Array();var a=null;for(var b=0;b<d.length;b++){var f=new Object();f.user=d[b]["@name"];if(d[b].groups){f.groups=d[b].groups[0].group}f.members=[];if(f.user===e.userName){a=f}else{if(f.user==="PUBLIC"){}else{c.push(f)}}}if(a){c.push(a);e.curGroups=Ext.isArray(a.groups)?a.groups:e.curGroups}e.findMembers(c);if(a&&!a.groups){a.groups=new Array()}return c},findMembers:function(e){if(!Ext.isArray(e)){return}for(var d=0;d<e.length;d++){var a=e[d].groups;if(a){for(var c=0;c<a.length;c++){for(var b=0;b<e.length;b++){if(a[c]==e[b].user){e[b].members.push(e[d].user)}}}}}},submitForm:function(){var d=this;var f=d.selModel;if(!f){return}var c=f.getSelection();if(d.fatherType==="adduser"){var a="";for(var b=0;b<c.length;b++){var e=c[b].get("user");if(b==0){a+='GROUPS "'+e+'",'}else{a+='"'+e+'",'}}if(a!==""){a=a.substr(0,a.length-1);return a}}else{if(d.fatherType==="editUser"){d.changeUserGroup(c)}}},changeUserGroup:function(e){if(!e){return}var d=this;var h=d.userName.toUpperCase();var a=d.loginUser.toUpperCase();var k=new Array();var g="",f="",j="";var c=0;for(var b=0;b<d.curGroups.length;b++){if(d.curGroups[b].toUpperCase()==="PUBLIC"){continue}j="temp_"+c++;g="SELECT db_user INTO "+j+" FROM db_user WHERE name='"+d.curGroups[b].toUpperCase()+"'";f="CALL drop_member('"+h+"') ON "+j;k.push(g);k.push(f)}for(var b=0;b<e.length;b++){j="temp_"+c++;g="SELECT db_user INTO "+j+" FROM db_user WHERE name='"+e[b].get("user").toUpperCase()+"'";f="CALL add_member('"+h+"') ON "+j;k.push(g);k.push(f)}if(k.length==0){Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"));return}Ext.QueryByCCI(Ext.currentDb,k,{success:function(m,o){var p=Ext.decode(m.responseText);var l=p.result;if(Ext.isArray(l)&&l.length>0){for(var n=0;n<l.length;n++){if(l[n]["status"]!==0){Ext.showErrorWin(I18N_Util.getMsg("msgFail2UpdateUserGroup"));return}}if(a===h){Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper")+"<br>"+I18N_Util.getMsg("msgReconnectPrompt"),function(){var i=d.up("editUser");if(i){i.close()}Ext.cookieUtil.setDbLoginStatus(Ext.currentDb,false);var q=Ext.getCmp("LeftPanelToolBar");if(q){q.fireEvent("GotoHome",q,null)}})}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){d.groups=new Array();d.getUsersInfo();var q=d.up("privileges");if(q){var i=q.down("userlist");if(i){i.refreshUserList()}}})}}else{Ext.showErrorWin(I18N_Util.getMsg("msgFail2UpdateUserGroup"))}}})},refreshUserGroup:function(){var a=this;a.groups=new Array();a.curGroups=new Array();a.getUsersInfo()},isAuthUser:function(){var b=this;try{if(!b.isDba||b.userName=="PUBLIC"){var a=b.down("button[action=submit]");if(a){a.setDisabled(true)}}}catch(c){Ext.Trace(c)}},initComponent:function(){var a=this;a.createColumns();a.createStore();a.callParent(arguments);if(a.fatherType==="adduser"){a.getUsersInfo()}a.groups=new Array();a.curGroups=new Array();try{if(a.fatherType==="editUser"){a.isAuthUser()}}catch(b){Ext.Trace(b)}}});Ext.define("cwm.widget.privileges.EditUser",{extend:"Ext.window.Window",alias:"widget.editUser",autoDestroy:true,width:800,height:600,y:50,closable:true,autoShow:true,bodyStyle:"border:0;background:#F3F3F3",shadow:false,autoScroll:true,modal:true,isDba:false,loginUser:"",userName:"undefined",addItems:function(){var a=this;var b=Ext.create("Ext.panel.Panel",{html:I18N_Util.getMsg("titleEditDbUser",{username:Ext.htmlEncode(this.userName),dbname:Ext.currentDb}),bodyStyle:"background: transparent; border: 0; padding: 10px 10px; font-size: 18px;"});this.add(b);if(this.userName=="DBA"){this.createChangeDbUserPwd()}else{this.createChangeDbUserPwd();var c=Ext.createWaitWin();Ext.getUserInfo({success:function(d,h){c.close();var f=Ext.decode(d.responseText);var g;if(f.status=="success"){a.createDbUserGroup(f.user);if(Ext.isArray(f.user)){for(var e=0;e<f.user.length;e++){if(f.user[e]["@name"]===a.userName){g=f.user[e]["authorization"];break}}if(typeof g==="undefined"){g=null}a.createDbAuth(g)}else{a.createDbAuth(null)}}else{if(Ext.checkTokenStatus(f.note)){Ext.showFailureWin(I18N_Util.getMsg("msgFail2GetUserInfo")+"<br>"+Ext.htmlEncode(f.note));a.createDbUserGroup();a.createDbAuth()}}},failure:function(d,e){c.close();Ext.showErrorWin(I18N_Util.getMsg("msgFail2GetUserInfo")+"<br>"+I18N_Util.getMsg("msgErrInServer"));a.createDbUserGroup();a.createDbAuth()}})}},createChangeDbUserPwd:function(){var a=Ext.create("cwm.widget.privileges.ChangeDbUserPwd",{userName:this.userName,isDba:this.isDba,loginUser:this.loginUser});this.add(a)},createDbUserGroup:function(d){var c=this;var e=Ext.create("Ext.selection.CheckboxModel");var a={userName:c.userName,fatherType:this.type,isDba:c.isDba,loginUser:c.loginUser,dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"left"},items:[{action:"submit",width:75,text:I18N_Util.getMsg("btnGo")}]},{xtype:"toolbar",style:"background: transparent; border: 0;",items:[{xtype:"label",style:"padding: 3px 0 0 10px",text:I18N_Util.getMsg("msgCurUserGroup",{members:""}),id:"curGroups"}]},{xtype:"toolbar",style:"background: transparent; border: 0;",items:[{xtype:"label",style:"padding: 0 0 3px 10px",text:I18N_Util.getMsg("msgCurUserMember",{members:""}),id:"curMembers"}]}]};if(c.isDba===true&&c.userName!=="PUBLIC"){a.selModel=e}var b=Ext.create("cwm.widget.privileges.DbUserGroup",a);this.add(b);b.loadData(d)},createDbAuth:function(d){var b=this,h="",c=new Array(),g;var a={cls:"infoPanel",title:I18N_Util.getMsg("titleTableAuth"),fatherType:this.type,userName:this.userName,border:0,style:"padding: 10px;",isDba:this.isDba,loginUser:this.loginUser,dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"left"},items:[{action:"submit",width:75,text:I18N_Util.getMsg("btnGo")}]}]};if(typeof d==="undefined"){var f=I18N_Util.getMsg("msgFail2GetAuthedTables");b.addDbAuthPanelToContainer(f,b)}else{if(this.isDba!==true){if(!Ext.isArray(d)){var f=I18N_Util.getMsg("msgNoAuthedTable");b.addDbAuthPanelToContainer(f,b)}else{g=b.createFormatAuthData(d);var e=Ext.create("cwm.widget.privileges.DbAuth",a);b.add(e);e.getStore().loadData(g)}}else{if(this.userName==="PUBLIC"){h="SELECT class_name, is_system_class FROM db_class AS a WHERE LOWER(a.class_name) NOT IN (SELECT LOWER(partition_class_name) FROM db_partition) AND owner_name<>'PUBLIC' ORDER BY class_name"}else{h="SELECT class_name FROM db_class AS a WHERE LOWER(a.class_name) NOT IN (SELECT LOWER(partition_class_name) FROM db_partition) AND is_system_class='NO' AND owner_name<>'PUBLIC' ORDER BY class_name"}c.push(h);Ext.QueryByCCI(Ext.currentDb,c,{success:function(j,k){var r=Ext.decode(j.responseText);if(r&&r.status=="1000"){var s=r.result;var o=s[0].values;if(Ext.isArray(o)&&o.length>0){g=b.createFormatAuthData(d);var m=true;if(!g){g=new Array();m=false}if(b.userName==="PUBLIC"){for(var l=0;l<o.length;l++){var q=new Object();q.table=o[l][0];q.isSystemClass=o[l][1];g.push(q)}}else{for(var l=0;l<o.length;l++){var q=new Object();q.table=o[l][0];g.push(q)}}var n=Ext.create("cwm.widget.privileges.DbAuth",a);b.add(n);if(m!==true){n.dbAuthData=g;n.getStore().loadData(g)}else{n.loadData(g)}}else{if(Ext.isArray(d)){g=b.createFormatAuthData(d);var n=Ext.create("cwm.widget.privileges.DbAuth",a);b.add(n);n.dbAuthData=g;n.getStore().loadData(g)}else{var p=I18N_Util.getMsg("msgNoAvailableUnauthedTable");b.addDbAuthPanelToContainer(p,b)}}}else{if(Ext.isArray(d)){Ext.showErrorWin(I18N_Util.getMsg("msgFail2GetUnauthedTables"));g=b.createFormatAuthData(d);var n=Ext.create("cwm.widget.privileges.DbAuth",a);b.add(n);n.dbAuthData=g;n.getStore().loadData(g)}else{Ext.showErrorWin(I18N_Util.getMsg("msgFail2GetUnauthedTables"));var p=I18N_Util.getMsg("msgFail2GetUnauthedTables");b.addDbAuthPanelToContainer(p,b)}}},failure:function(i,j){Ext.showErrorWin(I18N_Util.getMsg("msgFail2GetUnauthedTables")+"<br>"+I18N_Util.getMsg("msgErrInServer"));if(!Ext.isArray(d)){var l=I18N_Util.getMsg("msgFail2GetUnauthedTables");b.addDbAuthPanelToContainer(l,b)}else{g=b.createFormatAuthData(d);var k=Ext.create("cwm.widget.privileges.DbAuth",a);b.add(k);k.dbAuthData=g;k.getStore().loadData(g)}}})}}},addDbAuthPanelToContainer:function(d,a){var b={cls:"infoPanel",title:I18N_Util.getMsg("titleTableAuth"),fatherType:this.type,userName:this.userName,border:0,style:"padding: 10px;",width:360};b.items=[{html:d,cls:"dbauth_info",bodyCls:"body"}];var c=Ext.create("Ext.panel.Panel",b);a.add(c)},createFormatAuthData:function(d){if(!Ext.isArray(d)){return}var c=this,a=new Array(),b;for(table in d[0]){b=c.authConvert(table,parseInt(d[0][table]));if(b){a.push(b)}}b=null;return a},authConvert:function(d,c){if(typeof d!=="string"||typeof c!=="number"||isNaN(c)){return}var a=new Object();a.table=d;a.auth=true;for(var b=0;b<16;b++){if((c&(1<<b))!=0){switch(b){case 0:a.SELECT=true;break;case 1:a.INSERT=true;break;case 2:a.UPDATE=true;break;case 3:a.DELETE=true;break;case 4:a.ALTER=true;break;case 5:a.INDEX=true;break;case 6:a.EXECUTE=true;break;case 8:a.GRANT_SELECT=true;break;case 9:a.GRANT_INSERT=true;break;case 10:a.GRANT_UPDATE=true;break;case 11:a.GRANT_DELETE=true;break;case 12:a.GRANT_ALTER=true;break;case 13:a.GRANT_INDEX=true;break;case 14:a.GRANT_EXECUTE=true;break;default:}}}return a},initComponent:function(){this.callParent(arguments);this.type="editUser";this.addItems()}});Ext.define("cwm.widget.privileges.NewUserInf",{extend:"Ext.panel.Panel",alias:"widget.newuserinf",style:"border: 0; padding : 10px",bodyStyle:"background: transparent; border: 0",cls:"infoPanel",title:I18N_Util.getMsg("titleLoginInfo"),width:360,items:[{xtype:"form",buttonAlign:"right",bodyStyle:"border:0;background:transparent",padding:"10px 10px 0 0",width:350,fieldDefaults:{labelAlign:"left",labelWidth:120,anchor:"100%",labelHeight:20,msgTarget:"under"},items:[{name:"username",xtype:"textfield",maxLength:32,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblUserName")},{name:"password",xtype:"textfield",inputType:"password",autoEl:{onpaste:"return false;"},maxLength:31,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblPassword")},{name:"confirmpwd",xtype:"textfield",inputType:"password",autoEl:{onpaste:"return false;"},maxLength:31,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblConfirmPass")}]}],submitForm:function(){var d=this;var c=d.down("form");if(c){var a=c.getValues();if(!a){return}var g=typeof a.username==="string"?a.username:"";var b=typeof a.password==="string"?a.password:"";var f=typeof a.confirmpwd==="string"?a.confirmpwd:"";if(!g.match(/^[a-zA-Z_]\w*$/)){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidDbUserNamePrompt"),function(){d.clearFieldValue("uname")})}else{if(!b.match(/^\S{4,}$/)){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidDbUserPass"),function(){d.clearFieldValue("pass")})}else{if(b!==f){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidConfirmPass"),function(){d.clearFieldValue("cfmPass")})}else{var e=new Object;e.username=g;e.password=b.replace(/'/g,"''");return e}}}}},clearFieldValue:function(a){if(a==="uname"){var c=this.down('textfield[name="username"]');if(c){c.reset();c.focus(true,300)}}else{if(a==="pass"){var b=this.down('textfield[name="password"]');if(b){b.reset();b.focus(true,300)}}else{if(a==="cfmPass"){var d=this.down('textfield[name="confirmpwd"]');if(d){d.reset();d.focus(true,300)}}}}},initComponent:function(){this.callParent(arguments)}});Ext.define("cwm.widget.privileges.UserList",{extend:"Ext.grid.Panel",alias:"widget.userlist",bodyStyle:"background: transparent; border: 0",cls:"struct-grid",enableColumnMove:false,sortableColumns:false,enableColumnHide:false,columns:[{text:I18N_Util.getMsg("lblUser"),minWidth:80,dataIndex:"name",renderer:function(a){if(a===null){return""}return Ext.htmlEncode(a)}},{text:I18N_Util.getMsg("lblType"),minWidth:80,dataIndex:"type"},{header:I18N_Util.getMsg("lblAction"),sortable:false,xtype:"actioncolumn",items:[{icon:Ext.ImagePath+"user_edit.png",tooltip:I18N_Util.getMsg("msgEditUser"),handler:function(c,e,b){var a=this.up("userlist");if(!a){return}var d=a.store.getAt(e);a.up("privileges").createEditUser(d)}},{icon:Ext.ImagePath+"user_delete.png",tooltip:I18N_Util.getMsg("msgRemoveUser"),itemid:"dropUserIcon",getClass:function(c,b,d){var a=d.get("name");if(Ext.cwm.curDbUserIsDba!==true||a==="PUBLIC"||a==="DBA"||a.toLowerCase()===Ext.cwm.curDbUser.toLowerCase()){return"x-hide-display"}},handler:function(c,f,b){var a=this.up("userlist");if(!a){return}var d=a.store.getAt(f).get("name");var e='DROP USER "'+d+'"';Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmRemoveUser",{userId:Ext.htmlEncode(d)}),buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(g,h){if(g=="yes"){a.dropUser([e])}}})}}]}],getUsersInfo:function(){var c="SELECT name,case WHEN name='DBA' THEN 'DBA' WHEN counts=2 THEN 'DBA' ELSE 'Normal' END AS \"type\" FROM (SELECT name,password,groups,COUNT(name) AS counts FROM(SELECT name,password,groups FROM db_user d WHERE {'DBA'} SUBSETEQ (SELECT SET{'DBA'}+COALESCE(SUM(SET{t.g.name}), SET{}) FROM db_user u, TABLE(groups) AS t(g) WHERE u.name = d.name) UNION ALL SELECT name,password,groups FROM db_user d WHERE {'DBA'} SUBSETEQ (SELECT SET{'PUBLIC'}+COALESCE(SUM(SET{t.g.name}), SET{}) FROM db_user u, TABLE(groups) AS t(g) WHERE u.name = d.name))t GROUP BY name,password,groups) g";var a=this;var b=[c];Ext.QueryByCCI(Ext.currentDb,b,{success:function(f,g){var h=Ext.decode(f.responseText);if(h&&h.status=="1000"){var d=h.result;if(d[0].status==0){var e=d[0].values;a.loadData(e)}}}})},loadData:function(c){if(!c){return}var a=[];for(var d=0;d<c.length;d++){var b=new Object();b.name=c[d][0];b.type=c[d][1];b.pwd=c[d][2];a.push(b)}this.store.loadData(a)},dropUser:function(b){var a=this;Ext.QueryByCCIWithWaitBox(Ext.currentDb,b,{success:function(d,f){var g=Ext.decode(d.responseText);if(g&&g.status=="1000"){var c=g.result;var h=0;for(var e=0;e<c.length;e++){if(c[e].status!=0){h++}}if(h==0){Ext.showSuccessWin(I18N_Util.getMsg("msgSucRemoveUser"),function(){a.refreshUserList()})}else{Ext.showFailureWin(I18N_Util.getMsg("msgFail2RemoveUser"))}}else{if(g&&Ext.checkDbLoginStatusWhenCCI(g.status,g.note)){Ext.showErrorWin(Ext.htmlEncode(g.note))}}}})},refreshUserList:function(){this.getUsersInfo()},initComponent:function(){this.store=Ext.create("Ext.data.Store",{model:"cwm.model.UsersList",autoDestroy:true});this.callParent(arguments);this.getUsersInfo()}});Ext.define("cwm.widget.tablesearch.Criteria",{extend:"Ext.grid.Panel",alias:"widget.tbsearchcriteria",style:"border: 0; padding : 10px",bodyStyle:"background: transparent; border: 0",defaults:{border:0},iconCls:"border : 0",viewConfig:{forceFit:true},enableColumnMove:false,enableColumnResize:false,sortableColumns:false,enableColumnHide:false,columns:[{text:"Column",dataIndex:"pid",width:80},{text:"Type",dataIndex:"port",width:80},{text:"Collation",dataIndex:"jq"},{text:"Operator",dataIndex:"auto"},{text:"value",dataIndex:"sqll",width:200}],loadData:function(a){if(!a){return}this.getStore().loadData(a)},initComponent:function(){this.callParent(arguments)}});Ext.define("cwm.widget.tablesearch.Options",{extend:"Ext.panel.Panel",alias:"widget.tbsearchoptions",style:"border: 0; padding : 10px",bodyStyle:"background: transparent; border: 0",defaults:{border:0},items:[{html:"tbsearchoptions"}],loadData:function(a){if(!a){return}},initComponent:function(){this.callParent(arguments)}});Ext.define("cwm.view.AddFields",{extend:"Ext.panel.Panel",alias:"widget.addfields",id:"add-fields-view",component:{fieldseditor:0},layout:"fit",margin:10,insertBlankRow:function(a){this.getComponent(this.component.fieldseditor).insertBlankRow(a)},bodyStyle:"background : transparent; border : none",items:[{xtype:"fieldseditor",bodyStyle:"background : transparent; border : none",layout:"fit",title:I18N_Util.getMsg("titleAddCol")},{border:0,width:200,height:20,layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:I18N_Util.getMsg("btnSave"),width:60,handler:function(){try{var b=Ext.getCmp("add-fields-view");if(b){var a=b.getComponent(b.component.fieldseditor);var c=a.getSqls(false,b.tableName,b.beforeOrAfter,b.aftercol);Ext.QueryByCCI(Ext.currentDb,c,{success:function(e,h){var j=Ext.decode(e.responseText);var f="";for(var g=0;g<j.result.length;g++){if(j.result[g].status!=0){f+=Ext.htmlEncode(j.result[g].note);f+="<br>"}}if(f!=""){Ext.showErrorWin('<div style="overflow:auto; height:100px">'+f+"</div>");return}else{b.fireEvent("changeView");Ext.getTableInfoByCCI(Ext.currentDb,b.tableName,{success:function(i,k){b.fireEvent("exit",Ext.currentDb,b.tableName)}})}}})}}catch(d){Ext.Trace(d)}}},{xtype:"button",text:I18N_Util.getMsg("btnCancel"),margin:"0 0 0 10",width:60,handler:function(){try{var a=Ext.getCmp("add-fields-view");if(a){a.fireEvent("changeView");Ext.getTableInfoByCCI(Ext.currentDb,a.tableName,{success:function(c,d){a.fireEvent("exit",Ext.currentDb,a.tableName)}})}}catch(b){Ext.Trace(b)}}}]}],initComponent:function(){this.addEvents("exit");this.callParent(arguments)}});Ext.define("cwm.view.Automation",{extend:"Ext.panel.Panel",alias:"widget.automation",id:"AutomationView",bodyStyle:"border: 0;background : transparent;",style:"padding: 0 10px; border: 0; background: transparent;",defaults:{border:0},initComponent:function(){var b=this;b.callParent(arguments);b.addDbGrid();b.addBrokerGrid();b.checkBrokerAuth();var a=Ext.cookieUtil.getLastDbmtUserName();if(a==="admin"){b.addAutoLogReportManage()}Ext.getAutoStart()},addDbGrid:function(){var b=this;var c=Ext.create("Ext.data.Store",{fields:["dbname"],autoDestroy:true});var a=Ext.create("Ext.grid.Panel",{title:I18N_Util.getMsg("titleDbAutoJobManagememt"),itemId:"DbAutoJobGrid",bodyStyle:"background: transparent;",cls:"infoPanel",width:700,height:350,enableColumnMove:false,sortableColumns:false,enableColumnHide:false,store:c,columns:[{text:I18N_Util.getMsg("lblDb"),dataIndex:"dbname",width:120},{header:I18N_Util.getMsg("lblAutoStartUp"),sortable:false,xtype:"actioncolumn",items:[{icon:Ext.ImagePath+"b_edit.png",tooltip:I18N_Util.getMsg("msgEdit"),handler:function(e,h,d){var g=c.getAt(h);var f=g.get("dbname");b.editAutoStartup("database",f)}},{icon:Ext.ImagePath+"auto_log.png",tooltip:I18N_Util.getMsg("msgShowAutoJobLog"),handler:function(e,i,d){var h=c.getAt(i);var g=h.get("dbname");var f=Ext.create("cwm.widget.AutoLogWin",{title:I18N_Util.getMsg("titleAutoStartLog",{name:g}),name:g,type:"databases",logType:"startup"})}}]},{header:I18N_Util.getMsg("lblAutoAddVol"),sortable:false,xtype:"actioncolumn",width:150,items:[{icon:Ext.ImagePath+"b_edit.png",tooltip:I18N_Util.getMsg("msgEdit"),handler:function(e,i,d){var h=c.getAt(i);var g=h.get("dbname");var f=Ext.create("cwm.widget.AutoAddVolWin",{title:I18N_Util.getMsg("titleAutoAddVolEditor",{name:g}),dbname:g})}},{icon:Ext.ImagePath+"auto_log.png",tooltip:I18N_Util.getMsg("msgShowAutoJobLog"),handler:function(e,i,d){var h=c.getAt(i);var g=h.get("dbname");var f=Ext.create("cwm.widget.AutoLogWin",{title:I18N_Util.getMsg("titleAutoAddVolLog",{name:g}),name:g,logType:"addVol"})}}]},{header:I18N_Util.getMsg("lblAutoBackupPlan"),sortable:false,xtype:"actioncolumn",width:120,items:[{icon:Ext.ImagePath+"b_edit.png",tooltip:I18N_Util.getMsg("msgEdit"),handler:function(e,i,d){var h=c.getAt(i);var g=h.get("dbname");var f=Ext.create("cwm.widget.BackupWin",{title:I18N_Util.getMsg("titleBackupPlanAtDb",{name:g}),dbname:g})}},{icon:Ext.ImagePath+"auto_log.png",tooltip:I18N_Util.getMsg("msgShowAutoJobLog"),handler:function(e,i,d){var h=c.getAt(i);var g=h.get("dbname");var f=Ext.create("cwm.widget.AutoLogWin",{title:I18N_Util.getMsg("titleAutoBackupLogAtDb",{name:g}),name:g,logType:"backup"})}}]}]});b.add(a);b.refreshDbList()},addBrokerGrid:function(){var c=this;var a=Ext.create("Ext.data.Store",{fields:["name"],autoDestroy:true});var b=Ext.create("Ext.grid.Panel",{title:I18N_Util.getMsg("titleBrokerAutoJobManagememt"),itemId:"BrokerGrid",style:"padding-top: 20px;",bodyStyle:"background: transparent;",cls:"infoPanel",width:700,enableColumnMove:false,sortableColumns:false,enableColumnHide:false,store:a,columns:[{text:I18N_Util.getMsg("lblBroker"),dataIndex:"name",width:120},{header:I18N_Util.getMsg("lblAutoStartUp"),sortable:false,width:120,xtype:"actioncolumn",items:[{icon:Ext.ImagePath+"b_edit.png",tooltip:I18N_Util.getMsg("msgEdit"),handler:function(e,h,d){var g=a.getAt(h);var f=g.get("name");c.editAutoStartup("broker",f)}},{icon:Ext.ImagePath+"auto_log.png",tooltip:I18N_Util.getMsg("msgShowAutoJobLog"),handler:function(e,i,d){var h=a.getAt(i);var g=h.get("name");var f=Ext.create("cwm.widget.AutoLogWin",{title:I18N_Util.getMsg("titleAutoStartLog",{name:g}),name:g,type:"brokers",logType:"startup"})}}]}]});c.add(b);if(!Ext.cookieUtil.getAllBrokers()){Ext.getAllBrokersNameAndPort(function(d){a.loadData(d)})}else{a.loadData(Ext.cookieUtil.getAllBrokers())}},addAutoLogReportManage:function(){var b=this;var a=Ext.create("cwm.widget.AutoLogReportManage",{title:I18N_Util.getMsg("titleAutoLogReportManage"),width:700,margin:"20 0 0 0"});b.add(a)},editAutoStartup:function(e,b){if(typeof e!=="string"||e===""||typeof b!=="string"||b===""){Ext.Trace("Err: Fail to create setting win cause by wrong DB/broker name or type!");return}var f=this;var d=false,a=-1;if(e==="broker"){for(var c=0;c<Ext.cwm.autoStartupBrokers.length;c++){if(b===Ext.cwm.autoStartupBrokers[c]){d=true;a=c;break}}}else{if(e==="database"){for(var c=0;c<Ext.cwm.autoStartupDbs.length;c++){if(b===Ext.cwm.autoStartupDbs[c]){d=true;a=c;break}}}}var g=Ext.create("Ext.window.Window",{title:I18N_Util.getMsg("titleAutoStartupEditor",{name:b}),autoShow:true,bodyStyle:"border:0;background:transparent;",style:"border:0;background:#F3F3F3;",bodyPadding:10,modal:true,resizable:false,items:[{xtype:"form",bodyStyle:"border:0;background:transparent;",bodyPadding:5,buttonAlign:"center",fieldDefaults:{labelWidth:60,width:250},items:[{xtype:"checkbox",boxLabel:I18N_Util.getMsg("lblUseAutoStartup",{type:e}),name:"autoStartup",checked:d}],buttons:[{text:I18N_Util.getMsg("btnSave"),handler:function(i){try{var j=i.up("form");var h=j.getValues();var k=false;if(h.autoStartup==="on"){k=true}if(k===d){g.close();return}f.updateAutoStartup(e,b,k,a,g)}catch(l){Ext.Trace(l)}}},{text:I18N_Util.getMsg("btnCancel"),handler:function(h){g.close()}}]}]})},updateAutoStartup:function(c,b,e,a,f){if(typeof c!=="string"||c===""||typeof b!=="string"||b===""){Ext.Trace("Err: Fail to update auto startup status cause by wrong DB/broker name or type!");return}var d=this;var g={success:function(h,i){try{Ext.showSuccessWin(I18N_Util.getMsg("msgSucChangeAutoStartup"),function(){f.close();Ext.getAutoStart()})}catch(j){Ext.Trace(j)}}};if(c==="broker"){if(e===false){Ext.cwm.autoStartupBrokers.splice(a,1)}else{Ext.cwm.autoStartupBrokers.push(b)}Ext.setAutoStart("brokers",Ext.cwm.autoStartupBrokers,g)}else{if(c==="database"){if(e===false){Ext.cwm.autoStartupDbs.splice(a,1)}else{Ext.cwm.autoStartupDbs.push(b)}Ext.setAutoStart("databases",Ext.cwm.autoStartupDbs,g)}}},checkBrokerAuth:function(){var b=this;var a=b.down("#BrokerGrid");if(a){if(Ext.getCurCmUserBrokerAuth()==="admin"){a.show()}else{a.hide()}}},refreshDbList:function(){var b=this;var d=b.down("#DbAutoJobGrid");if(d){var e=new Array();var c;for(var a=0;a<Ext.dblist.length;a++){c=new Object();c.dbname=Ext.dblist[a]["name"];e.push(c)}d.getStore().loadData(e)}}});Ext.define("cwm.view.Brokers",{extend:"Ext.panel.Panel",alias:"widget.brokers",requires:["cwm.widget.broker.Status","cwm.widget.broker.GroupStatus"],id:"BrokerView",bodyStyle:"border: 0;background : transparent;",style:"padding: 0 10px; border: 0; background: transparent;",config:{brokersInfo:new Array()},defaults:{border:0},task:null,initComponent:function(){var a=this;a.callParent(arguments);a.groupStatus="ON";a.oldGroupStatus=a.groupStatus;a.addRefreshBar();a.createBrokerStatus();a.refreshItems("init")},createBrokerStatus:function(){var c=this;var a=Ext.getCurCmUserBrokerAuth();var d=Ext.create("Ext.panel.Panel",{bodyCls:"monitor_grid_title",items:[{xtype:"label",cls:"element",text:I18N_Util.getMsg("titleBrokerList")},{xtype:"button",id:"BrokerGroupStart",icon:Ext.ImagePath+"broker_start.png",tooltip:I18N_Util.getMsg("msgStartAllBrokers"),disabled:c.groupStatus==="ON"?true:false,hidden:a==="admin"?false:true,handler:function(){c.startAllBrokers()}},{xtype:"label",cls:"white_space",text:""},{xtype:"button",id:"BrokerGroupStop",icon:Ext.ImagePath+"broker_stop.png",tooltip:I18N_Util.getMsg("msgStopAllBrokers"),disabled:c.groupStatus!=="ON"?true:false,hidden:a==="admin"?false:true,handler:function(){c.stopAllBrokers()}}]});this.add(d);var b=Ext.create("cwm.widget.broker.GroupStatus",{});this.add(b)},addRefreshBar:function(){var e=this;var a=false;var b;var c;if(Ext.cwm.AutoRefreshBrokerInterval>0){c=Ext.cwm.AutoRefreshBrokerInterval}else{c=3;Ext.cwm.AutoRefreshBrokerInterval=c}if(Ext.cwm.AutoRefreshBrokerState===true){a=true;b=false;this.startAutoRefresh()}else{b=true}var d=Ext.create("Ext.toolbar.Toolbar",{style:"border:0; background:transparent;",items:[{xtype:"checkbox",name:"autoRefresh",padding:"0 0 3px 0",boxLabel:I18N_Util.getMsg("lblEnableAutoRefresh"),boxLabelAlign:"before",checked:a,width:135,listeners:{change:function(g,h,f){e.autoRefreshSwitch(g,h,f)}}},{xtype:"label",html:"&nbsp;&nbsp;&nbsp;&nbsp;"},{xtype:"label",id:"brokerNumFieldTxt1",html:"&nbsp;"+I18N_Util.getMsg("lblInterval")+"&nbsp;",hidden:b},{xtype:"numberfield",value:c,minValue:1,maxValue:600,width:50,allowBlank:false,allowDecimals:false,hidden:b},{xtype:"label",id:"brokerNumFieldTxt2",html:"&nbsp;"+I18N_Util.getMsg("lblSec"),hidden:b},{icon:Ext.ImagePath+"refresh.png",itemId:"Manually Refresh",text:I18N_Util.getMsg("lblManuRefresh"),scope:this,hidden:!b,handler:function(){e.refreshItems()}}]});this.add(d)},showDetail:function(a){if(!a){return}this.removeDetail();var b=Ext.create("cwm.widget.broker.Status",{});this.add(b);b.brokerName=a.brokerName;b.groupInfo=a.groupInfo;b.status=a.state;b.addItems()},removeDetail:function(){var a=this.down("brokerstatus");if(a){a.destroy()}},refreshItems:function(a){var b=this,d;var c=false;if(a==="auto"){c=true}else{if(a==="init"){d=Ext.createWaitWin()}}Ext.getBrokerInfo({success:function(h,j){if(a==="init"){d.close()}var n=Ext.decode(h.responseText);if(n&&n.status=="success"){var e=n.brokersinfo;var g=e[0].broker;if(!Ext.isArray(g)){return}b.groupStatus="OFF";for(var l=0;l<g.length;l++){if(g[l]["state"]==="ON"){b.groupStatus="ON";break}}b.refreshTitleBtn();if(c===true){g=b.getGroupDataDelta(g,Ext.cwm.oldBrokersInfo)}var f=b.down("brokergpstatus");if(f){f.groupStatus=b.groupStatus;f.refreshData(g,a)}var k=b.down("brokerstatus");if(k){k.refreshData(g,a)}var m=Ext.decode(h.responseText);Ext.cwm.oldBrokersInfo=m.brokersinfo[0].broker}else{if(n&&Ext.checkTokenStatus(n.note)){Ext.showFailureWin(n.note)}}},failure:function(e,f){if(a==="init"){d.close();Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+e.responseText)}}})},refreshTitleBtn:function(){if(this.groupStatus===this.oldGroupStatus){return}var b=this.down("#BrokerGroupStart");var a=this.down("#BrokerGroupStop");if(b&&a){b.setDisabled(this.groupStatus==="ON");a.setDisabled(this.groupStatus!=="ON")}this.oldGroupStatus=this.groupStatus},getGroupDataDelta:function(d,g){if(!Ext.isArray(d)||!Ext.isArray(g)){return d}for(var c=0;c<d.length;c++){if(d[c].state==="OFF"||g[c].state==="OFF"){continue}var b=parseInt(d[c].tran);var e=parseInt(g[c].tran);var f=parseInt(d[c].query);var a=parseInt(g[c].query);if(!isNaN(b)&&!isNaN(e)){d[c].tran=b-e}if(!isNaN(f)&&!isNaN(a)){d[c].query=f-a}if(d[c].tran<0){d[c].tran=0}if(d[c].query<0){d[c].query=0}}return d},startAllBrokers:function(){var a=this;Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmStartAllBrokers"),width:250,buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(b,c){if(b=="yes"){a.stopAutoRefresh();Ext.startAllBrokers({success:function(d,f){var e=Ext.decode(d.responseText);if(e&&e.status==="success"){a.refreshItems()}else{if(e&&e.note=="Error: Cannot create shared memory"){Ext.showFailureWin(I18N_Util.getMsg("msgBrokersAlreadyRun"))}else{if(e){if(!Ext.checkTokenStatus(e.note)){return}else{Ext.showFailureWin(e.note)}}}}a.checkAutoRefreshStatus()},failure:function(d,e){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText);a.checkAutoRefreshStatus()}})}}})},stopAllBrokers:function(){var a=this;Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmStopAllBrokers"),width:250,buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(b,c){if(b=="yes"){a.stopAutoRefresh();Ext.stopAllBrokers({success:function(d,f){var e=Ext.decode(d.responseText);if(e&&e.status==="success"){a.refreshItems()}else{if(e&&e.note=="Error: Cannot open shared memory"){Ext.showFailureWin(I18N_Util.getMsg("msgBrokersNotRun"))}else{if(e){if(!Ext.checkTokenStatus(e.note)){return}else{Ext.showFailureWin(e.note)}}}}a.checkAutoRefreshStatus()},failure:function(d,e){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+d.responseText);a.checkAutoRefreshStatus()}})}}})},checkAutoRefreshStatus:function(){var b=this.down('checkbox[name="autoRefresh"]');if(b){var a=b.getValue();if(a===true){this.startAutoRefresh()}}},startAutoRefresh:function(){var b=this;if(Ext.cwm.AutoRefreshBrokerInterval>0){var c=Ext.cwm.AutoRefreshBrokerInterval*1000;var a=0;this.task={run:function(){if(a>0){b.refreshItems("auto")}a++},interval:c};Ext.TaskManager.start(this.task)}},stopAutoRefresh:function(a){Ext.Trace("stopAutoRefresh");if(this.task){Ext.TaskManager.stop(this.task)}},autoRefreshSwitch:function(f,h,a){var d=this;var c=d.down('button[itemId="Manually Refresh"]');var b=d.down("numberfield");var g=d.down("#brokerNumFieldTxt1");var e=d.down("#brokerNumFieldTxt2");if(c&&b&&g&&e){if(h===true){c.hide();b.show();g.show();e.show();Ext.cwm.AutoRefreshBrokerInterval=b.getValue();d.startAutoRefresh();Ext.cwm.AutoRefreshBrokerState=true}else{c.show();b.hide();g.hide();e.hide();d.stopAutoRefresh();d.refreshItems();Ext.cwm.AutoRefreshBrokerState=false}}},refreshAuth:function(){var c=this;var d=this.down("#BrokerGroupStart");var a=this.down("#BrokerGroupStop");if(d&&a){if(Ext.getCurCmUserBrokerAuth()==="admin"){d.show();a.show()}else{d.hide();a.hide()}}var b=c.down("brokergpstatus");if(b){b.refreshAuth()}c.refreshItems()}});Ext.define("cwm.view.ChangeColumn",{extend:"Ext.panel.Panel",alias:"widget.changecolumn",requires:["cwm.widget.ColumnEditor"],margin:10,bodyStyle:"background : transparent; border : none",save:function(){var a=this;var b=this.colEditor.getSqls();if(b.length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidColumnName"));return}Ext.QueryByCCI(Ext.currentDb,b,{success:function(c,d){if(c.status==200){var e=Ext.decode(c.responseText);if(e.result[0].status===0){a.fireEvent("changeView")}else{Ext.showErrorWin(Ext.htmlEncode(e.result[0].note))}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+c.responseText)}}})},cancel:function(){this.fireEvent("changeView")},initComponent:function(){this.callParent(arguments);this.addEvents("changeView","cancelchange");var c=this;var g=Ext.dblist[Ext.getDbIndex(Ext.currentDb)].tables[Ext.getTableIndx(Ext.currentDb,c.tbname)];var b=g.fields;var a=new Array();for(var d=0;d<b.length;d++){var h=new Object();h.name=b[d].name;a.push(h)}c.oldValue.fdnames=a;this.colEditor=Ext.create("cwm.widget.ColumnEditor",{viewtitle:I18N_Util.getMsg("titleEditCol"),oldValue:c.oldValue,newValue:{},tbname:c.tbname,width:550});this.add(this.colEditor);var e=Ext.create("Ext.panel.Panel",{border:0,width:200,height:20,layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",text:I18N_Util.getMsg("btnSave"),width:60,handler:function(){c.save()}},{xtype:"button",text:I18N_Util.getMsg("btnCancel"),width:60,margin:"0 0 0 10",handler:function(){c.cancel()}}]});this.add(e)}});Ext.define("cwm.view.CMUserManagement",{extend:"Ext.panel.Panel",alias:"widget.cmusermanagement",requires:["cwm.widget.dbquery.FieldRow"],bodyStyle:"border: 0;background : transparent;",style:"padding: 0 10px; border: 0; background: transparent;",defaults:{border:0},initComponent:function(){var a=this;a.addEvents("AddUserDetail","RemoveUserDetail");a.callParent(arguments);a.gridHeight=200;a.formWidth=700;a.userlist=new Array();a.dblist=new Array();a.brokerPorts=new Array();a.authStatus=[{type:"none"},{type:"admin"},{type:"monitor"}];a.commonStatStore=Ext.create("Ext.data.Store",{fields:["type"],data:a.authStatus,autoLoad:true});a.dbCreateAuthStatStore=Ext.create("Ext.data.Store",{fields:["type"],data:[a.authStatus[0]],autoLoad:true});a.addUserGrid();a.refresh(true);if(!Ext.cookieUtil.getAllBrokers()){Ext.getAllBrokersNameAndPort()}},addUserGrid:function(){var b=this;var c=Ext.create("Ext.panel.Panel",{bodyCls:"monitor_grid_title",width:b.formWidth,items:[{xtype:"label",cls:"element",text:I18N_Util.getMsg("titleCmsUserOverview")},{xtype:"button",icon:Ext.ImagePath+"s_sync.png",tooltip:I18N_Util.getMsg("msgRefresh"),handler:function(){b.refresh(true)}}]});var a=Ext.create("Ext.grid.Panel",{bodyStyle:"background: transparent;",cls:"infoPanel",width:b.formWidth,height:b.gridHeight,autoScroll:true,itemId:"CMUserManagementGrid",enableColumnMove:false,enableColumnHide:false,store:Ext.create("Ext.data.Store",{model:"cwm.model.CMUserList",autoDestroy:true,sorters:[{property:"@id",direction:"ASC"}]}),columns:[{text:I18N_Util.getMsg("lblUserId"),width:120,dataIndex:"@id",renderer:function(d){if(d===null){return""}return Ext.htmlEncode(d)}},{text:I18N_Util.getMsg("lblDbCreateAuth"),width:150,dataIndex:"dbcreate"},{text:I18N_Util.getMsg("lblBrokerAuth"),width:120,dataIndex:"casauth"},{text:I18N_Util.getMsg("lblStatusMonitorAuth"),width:160,dataIndex:"statusmonitorauth"},{header:I18N_Util.getMsg("lblAction"),xtype:"actioncolumn",sortable:false,items:[{icon:Ext.ImagePath+"user_edit.png",tooltip:I18N_Util.getMsg("msgEditUser"),getClass:function(f,e,g){var d=g.get("@id");if(d==="admin"){return"x-hide-display"}},handler:function(e,g,d){var f=e.store.getAt(g);if(f.get("@id")==="admin"){return}b.addUserDetail(f)}},{icon:Ext.ImagePath+"user_delete.png",tooltip:I18N_Util.getMsg("msgRemoveUser"),getClass:function(f,e,g){var d=g.get("@id");if(d==="admin"){return"x-hide-display"}},handler:function(g,i,e){var h=g.store.getAt(i);var f=h.get("@id");if(f==="admin"){return}var d=I18N_Util.getMsg("msgCfmRemoveUser",{userId:f});Ext.Msg.confirm(I18N_Util.getMsg("titleConfirm"),d,function(j){if(j=="yes"){Ext.deleteDbmtUser(f,{success:function(k,m){var l=Ext.decode(k.responseText);if(l&&l.status==="success"){Ext.showSuccessWin(I18N_Util.getMsg("msgSucRemoveUser"));b.refresh(true)}else{if(l&&Ext.checkTokenStatus(l.note)){Ext.showFailureWin(l.note)}}},failure:function(k,l){Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer")+"<br>"+k.responseText)}})}})}}]}]});a.addDocked({xtype:"toolbar",dock:"bottom",ui:"footer",items:[{icon:Ext.ImagePath+"user_add.png",text:I18N_Util.getMsg("btnAdd"),tooltip:I18N_Util.getMsg("msgAddUser"),id:"UserAddBtn",scope:this,handler:function(){b.addUserDetail()}},{icon:Ext.ImagePath+"s_success.png",text:I18N_Util.getMsg("btnSave"),id:"UserDetailSave",tooltip:I18N_Util.getMsg("msgSave"),hidden:true,handler:function(){b.submit()}},{icon:Ext.ImagePath+"exit.png",text:I18N_Util.getMsg("btnCancel"),id:"UserDetailCancel",tooltip:I18N_Util.getMsg("msgCancel"),hidden:true,handler:function(){var d=b.down("#CMUserDetailForm");if(d){b.remove(d,true);b.fireEvent("RemoveUserDetail",b,null)}}}]});b.add(c);b.add(a)},addUserDetail:function(h){var k=this;var b=k.down("#CMUserDetailForm");if(b){k.remove(b,true)}var g=400;var c={cls:"infoPanel",padding:"10px 0 0 0",bodyStyle:"padding: 10px 0 10px 5px;",width:k.formWidth,fieldDefaults:{labelAlign:"left",labelWidth:200,width:g,labelHeight:20,msgTarget:"under"},itemId:"CMUserDetailForm",layout:{type:"table",columns:2},items:[{xtype:"textfield",name:"userId",maxLength:32,enforceMaxLength:true,fieldLabel:I18N_Util.getMsg("lblUserName"),value:typeof h!=="undefined"?h.get("@id"):"",disabled:typeof h!=="undefined"?true:false,listeners:{afterrender:function(i){if(typeof h==="undefined"){i.focus(300,true)}}}},{xtype:"label",width:k.formWidth-g-20,style:"display: inline-block; margin: 0 0 5px 5px;",html:I18N_Util.getMsg("msgMostChars",{count:32}),hidden:typeof h!=="undefined"?true:false},{xtype:"textfield",name:"pass",fieldLabel:I18N_Util.getMsg("lblPassword"),inputType:"password",autoEl:{onpaste:"return false;"},maxLength:32,enforceMaxLength:true,value:typeof h!=="undefined"?h.get("@passwd"):"",listeners:{afterrender:function(i){if(typeof h!=="undefined"){i.focus(300,true)}}}},{xtype:"label",width:k.formWidth-g-20,style:"display: inline-block; margin: 0 0 5px 5px;",html:I18N_Util.getMsg("msgMostChars",{count:32})},{xtype:"textfield",name:"confirmPass",fieldLabel:I18N_Util.getMsg("lblConfirmPass"),inputType:"password",autoEl:{onpaste:"return false;"},maxLength:32,enforceMaxLength:true,value:typeof h!=="undefined"?h.get("@passwd"):""},{xtype:"label",width:k.formWidth-g-20,style:"display: inline-block; margin: 0 0 5px 5px;",html:I18N_Util.getMsg("msgMostChars",{count:32})},{xtype:"combo",store:k.dbCreateAuthStatStore,name:"dbCreateAuth",fieldLabel:I18N_Util.getMsg("lblDbCreateAuth"),queryMode:"local",editable:false,displayField:"type",valueField:"type",value:typeof h!=="undefined"?h.get("dbcreate"):k.authStatus[0]["type"],colspan:2},{xtype:"combo",store:k.commonStatStore,name:"brokerAuth",fieldLabel:I18N_Util.getMsg("lblBrokerAuth"),queryMode:"local",editable:false,displayField:"type",valueField:"type",value:typeof h!=="undefined"?h.get("casauth"):k.authStatus[0]["type"],colspan:2},{xtype:"combo",store:k.commonStatStore,name:"statusMonitorAuth",fieldLabel:I18N_Util.getMsg("lblStatusMonitorAuth"),queryMode:"local",editable:false,displayField:"type",valueField:"type",value:typeof h!=="undefined"?h.get("statusmonitorauth"):k.authStatus[0]["type"],colspan:2}]};if(h){c.title=I18N_Util.getMsg("titleEditUser",{userId:h.get("@id")});c.type="edit";c.userId=h.get("@id")}else{c.title=I18N_Util.getMsg("titleAddUser");c.type="add";c.userId=""}var a=Ext.create("Ext.form.Panel",c);k.add(a);if(k.brokerPorts.length<1){var j=Ext.cookieUtil.getAllBrokers();var f;if(Ext.isArray(j)){for(var e=0;e<j.length;e++){f=new Object();f.value=j[e]["port"];f.name=f.value;k.brokerPorts.push(f)}}}var d=Ext.create("Ext.grid.Panel",{padding:"10px 0 0 0",bodyStyle:"background: transparent; border: 0",title:I18N_Util.getMsg("titleDbAuth"),cls:"infoPanel",height:k.gridHeight,width:k.formWidth-20,colspan:2,itemId:"CMUserDbAuthGrid",enableColumnMove:false,enableColumnHide:false,store:Ext.create("Ext.data.Store",{model:"cwm.model.DbAuthForCMUser",autoDestroy:true}),selModel:{selType:"cellmodel"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,listeners:{beforeedit:function(i){if(i.field!=="connected"&&i.record.get("connected")!=="Yes"){return false}},edit:function(l,i){if(i.field==="connected"&&i.value==="Yes"&&i.originalValue==="No"){i.record.set("@dbid","dba");i.record.set("brokerip","localhost");i.record.set("brokerport",30000)}if(i.field==="connected"&&i.value==="No"&&i.originalValue==="Yes"){i.record.set("@dbid","");i.record.set("brokerip","");i.record.set("brokerport","")}}}})],columns:[{text:I18N_Util.getMsg("lblDb"),width:120,sortable:true,dataIndex:"dbname"},{text:I18N_Util.getMsg("lblAuth"),width:80,sortable:true,dataIndex:"connected",editor:{xtype:"combobox",editable:false,store:["Yes","No"]}},{text:I18N_Util.getMsg("lblDbUser"),width:100,sortable:false,dataIndex:"@dbid",renderer:function(i){if(i===null){return""}return Ext.htmlEncode(i)},editor:{xtype:"textfield",validator:function(i){if(Ext.String.trim(i)==""||i.indexOf(";")!==-1){return I18N_Util.getMsg("msgInvalidDbUser")}return true}}},{text:I18N_Util.getMsg("lblBrokerIp"),width:120,sortable:false,dataIndex:"brokerip",renderer:function(i){if(i===null){return""}return Ext.htmlEncode(i)},editor:{xtype:"textfield",validator:function(i){if(Ext.String.trim(i)==""||i.indexOf(";")!==-1){return I18N_Util.getMsg("msgInvalidIpOrHost")}return true}}},{text:I18N_Util.getMsg("lblBrokerPort"),width:160,sortable:false,dataIndex:"brokerport",editor:{xtype:"combobox",valueField:"value",displayField:"name",store:Ext.create("Ext.data.Store",{fields:["name","value"],data:k.brokerPorts,autoLoad:true,autoDestroy:true}),validator:function(i){if(!i.match(/^[1-9]\d{0,4}$/)){return I18N_Util.getMsg("msgInvalidPort")}return true}}}]});a.add(d);k.loadDbAuthDataToContainer(d,h);k.fireEvent("AddUserDetail",k,null)},refresh:function(a){var d=this;var b=d.down("#CMUserManagementGrid");if(b){Ext.getDbmtUserInfo({success:function(e,g){var f=Ext.decode(e.responseText);if(f&&f.status==="success"){if(Ext.isArray(f.dblist)&&f.dblist.length>0&&Ext.isArray(f.dblist[0].dbs)){d.dblist=f.dblist[0].dbs}if(Ext.isArray(f.userlist)&&f.userlist.length>0&&Ext.isArray(f.userlist[0].user)){d.userlist=f.userlist[0].user}else{return}b.getStore().loadData(d.userlist)}else{if(f&&Ext.checkTokenStatus(f.note)){Ext.showFailureWin(f.note)}}}});var c=d.down("#CMUserDetailForm");if(c&&a===true){d.remove(c,true);d.fireEvent("RemoveUserDetail",d,null)}else{}}},loadDbAuthDataToContainer:function(a,m){if(!a){return}var o=this;try{if(m&&Ext.isArray(m.get("dbauth"))&&m.get("dbauth").length>0&&Ext.isArray(m.get("dbauth")[0]["auth_info"])&&m.get("dbauth")[0]["auth_info"].length>0){var k=m.get("dbauth")[0]["auth_info"];var b=new Array();var h,c,d,l=k.length;for(var g=0;g<o.dblist.length;g++){d=false;for(var f=0;f<k.length&&l>0;f++){if(o.dblist[g]["dbname"]===k[f]["dbname"]){h=new Object();h.dbname=k[f]["dbname"];h.connected="Yes";h["@dbid"]=k[f]["@dbid"];c=k[f]["dbbrokeraddress"].split(/,\s*/g);h.brokerip=c[0];h.brokerport=c[1];b.push(h);l--;d=true;break}}if(d===false){b.push(o.dblist[g])}}a.getStore().loadData(b)}else{a.getStore().loadData(o.dblist)}}catch(n){Ext.Trace(n)}},submit:function(){var k=this;var a=k.down("#CMUserDetailForm");var b=k.down("#CMUserDbAuthGrid");if(a&&b){var l="";var h=new Object();var n=a.getValues();if(!n){return}else{if(a.type==="add"&&!n.userId.match(/^[a-zA-Z]\w{3,}$/)||n.userId==="admin"){l=I18N_Util.getMsg("msgInvalidUserNamePrompt")}else{if(!n.pass.match(/^\S{4,}$/)||n.pass==="admin"){l=I18N_Util.getMsg("msgInvalidPassPrompt")}else{if(n.pass!==n.confirmPass){l=I18N_Util.getMsg("msgInvalidConfirmPass")}}}}if(l===""){h.targetid=a.type==="add"?n.userId:a.userId;h.password=n.pass;h.casauth=n.brokerAuth;h.dbcreate=n.dbCreateAuth;h.statusmonitorauth=n.statusMonitorAuth;h.dbauth=new Array();var d;var m=b.getStore();var g=m.getCount();for(var c=0;c<g;c++){var f=m.getAt(c);if(f.get("connected")==="Yes"){d=new Object();d.dbname=f.get("dbname");d.dbid=f.get("@dbid");d.dbbrokeraddress=f.get("brokerip");d.dbbrokeraddress+=","+f.get("brokerport");h.dbauth.push(d)}}}if(l!==""){Ext.showWarningWin(l)}else{var p=new JSEX();var j=function(){Ext.deleteDbmtUser(h.targetid,{success:function(i,r){var q=Ext.decode(i.responseText);if(q&&q.status==="success"){p.next()}else{if(q&&Ext.checkTokenStatus(q.note)){Ext.showFailureWin(q.note)}}}})};var o=function(){Ext.addDbmtUser(h,{success:function(i,r){var q=Ext.decode(i.responseText);if(q&&q.status==="success"){p.next()}else{if(q&&Ext.checkTokenStatus(q.note)){Ext.showFailureWin(q.note)}}}})};var e=function(){if(h.dbauth.length>0){Ext.updateDbmtUser(h,{success:function(i,r){var q=Ext.decode(i.responseText);if(q&&q.status==="success"){Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"));k.refresh(true)}else{if(q&&Ext.checkTokenStatus(q.note)){Ext.showFailureWin(q.note)}}}})}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"));k.refresh(true)}};if(a.type==="edit"){p.push(j)}p.push(o);p.push(e);p.exec()}}}});Ext.define("cwm.view.DatabaseListView",{extend:"Ext.panel.Panel",alias:"widget.dblistview",margin:10,id:"DatabaseListView",initComponent:function(){var a=this;a.callParent(arguments);a.addItems()},addItems:function(){var c=this;var a=Ext.create("Ext.panel.Panel",{layout:"column",bodyStyle:"border : none;",hidden:Ext.cookieUtil.getDbmtUserName()==="admin"?false:true,items:[{xtype:"image",src:Ext.ImagePath+"s_db.png"},{xtype:"panel",bodyStyle:"border : none;",html:'<span style="color:#235A81;font-weight:bold;">'+I18N_Util.getMsg("msgCreateDb")+"</span>"}]});c.add(a);var b;if(!Ext.cwm.isCreateDbNeedCharset()){b=Ext.create("Ext.form.Panel",{cls:"infoPanel",layout:"column",margin:"10 0 10 0",bodyStyle:"border: none;",hidden:Ext.cookieUtil.getDbmtUserName()==="admin"?false:true,items:[{xtype:"textfield",itemId:"dbNameField"},{xtype:"button",text:I18N_Util.getMsg("btnCreate"),margin:"0 0 0 10",scope:this,handler:function(){var e=c.down("#dbNameField");if(e){var d=e.getValue();c.createDb(e.getValue())}}}]})}else{b=Ext.create("Ext.form.Panel",{cls:"infoPanel",buttonAlign:"left",bodyStyle:"padding: 0 0 0 5px; border: none;",margin:"10 0 10 0",layout:{type:"table",columns:2},itemId:"createDbForm",hidden:Ext.cookieUtil.getDbmtUserName()==="admin"?false:true,items:[{xtype:"label",text:"Database Name:"},{xtype:"textfield",margin:"0 0 0 10",itemId:"dbNameField",name:"dbName",width:180},{xtype:"fieldset",title:"Charset",collapsible:false,colspan:2,layout:{type:"table",columns:2},defaults:{xtype:"radio",name:"charset",margin:"5 0 5 10",labelWidth:130},items:[{boxLabel:"en_US.iso88591",inputValue:"en_US.iso88591",margin:"5 0 5 0",checked:true},{boxLabel:"en_US.utf8",inputValue:"en_US.utf8"},{boxLabel:"ko_KR.euckr",inputValue:"ko_KR.euckr",margin:"5 0 5 0"},{boxLabel:"ko_KR.utf8",inputValue:"ko_KR.utf8"},{boxLabel:"User defined",inputValue:"input",margin:"5 0 5 0",handler:function(f,e){var d=c.down("#charsetField");if(d){d.setDisabled(!e);if(e){d.focus(false,300)}}}},{xtype:"textfield",itemId:"charsetField",name:"charsetVal",disabled:true}]}],buttons:[{text:I18N_Util.getMsg("btnCreate"),handler:function(){var f=c.down("#createDbForm");if(f){var d=f.getValues();if(!d){return}var e=d.dbName;var g=d.charset;if(g==="input"){if(Ext.isEmpty(d.charsetVal)||Ext.String.trim(d.charsetVal)===""){Ext.showWarningWin(I18N_Util.getMsg("msgFailMissCharset"),function(){var h=c.down("#charsetField");if(h){h.focus(false,300)}});return}g=Ext.String.trim(d.charsetVal)}c.createDb(e,g)}}}]})}c.add(b)},createDbListView:function(b){var c=new Ext.selection.CheckboxModel();var a=Ext.cookieUtil.getDbmtUserName();var b=Ext.create("Ext.grid.Panel",{id:"dbListViewGrid",height:400,store:Ext.create("Ext.data.Store",{autoLoad:true,model:"cwm.model.DbListView",data:Ext.createDbListObj(),proxy:{type:"memory",reader:{type:"json"}}}),enableColumnHide:false,autoFill:true,border:0,cls:"struct-grid",columns:[{text:I18N_Util.getMsg("lblDb"),dataIndex:"name"},{text:I18N_Util.getMsg("lblDbStatus"),dataIndex:"isOpened",style:"text-align:center",width:100,renderer:function(f,e,d){if(f==true){return'<div style="text-align:center">'+I18N_Util.getMsg("msgDbStatusOnline")+"</div>"}return'<div class="x-item-grayed" style="text-align:center">'+I18N_Util.getMsg("msgDbStatusOffline")+"</div>"}},{sortable:false,xtype:"actioncolumn",header:I18N_Util.getMsg("lblAction"),width:120,style:"text-align:center",items:[{xtype:"label",cls:"white_space",text:""},{icon:Ext.ImagePath+"s_rights.png",tooltip:I18N_Util.getMsg("msgCheckUserPrivilege"),handler:function(g,j,f){var i=g.getStore().getAt(j);var d=i.get("name");var e=Ext.ComponentQuery.query("dblist")[0];if(e){var h=e.down('panel[itemName="'+d+'"]');if(h){e.sendEvent("LpListItemClicked",{name:h.itemName,type:h.type,opened:h.isOpened,checkPrivilege:true})}}}},{xtype:"label",cls:"white_space",text:""},{icon:Ext.ImagePath+"menu_start.png",tooltip:I18N_Util.getMsg("msgStartDb"),getClass:function(e,d,h){if(a!=="admin"){return"x-hide-display"}var g=h.get("name");var f=Ext.checkDbOpenState(g);if(f){return"x-item-disabled"}},handler:function(e,i,d){var h=e.getStore().getAt(i);var g=h.get("name");var f=Ext.checkDbOpenState(g);if(!f){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmStartDb",{dbname:g}),closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(k,l,j){if(k=="yes"){Ext.runDb(g,true,{success:function(m,p){var q=new JSEX();var o=function(){if(Ext.cookieUtil.getDbmtUserName()!=="admin"){Ext.getCurCmUserAuthInfo({success:function(r,s){q.next()}})}else{q.next()}};var n=function(){Ext.getDatabaseList({success:function(r,s){Ext.RefreshDatabaseList()},failure:function(r,s){}})};q.push(o);q.push(n);q.exec()},failure:function(m,n){}})}}})}}},{xtype:"label",cls:"white_space",text:""},{icon:Ext.ImagePath+"menu_stop.png",tooltip:I18N_Util.getMsg("msgStopDb"),getClass:function(e,d,h){if(a!=="admin"){return"x-hide-display"}var g=h.get("name");var f=Ext.checkDbOpenState(g);if(!f){return"x-item-disabled"}},handler:function(e,i,d){var h=e.getStore().getAt(i);var g=h.get("name");var f=Ext.checkDbOpenState(g);if(f){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmStopDb",{dbname:g}),closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(k,l,j){if(k=="yes"){Ext.runDb(g,false,{success:function(m,p){var q=new JSEX();var o=function(){if(Ext.cookieUtil.getDbmtUserName()!=="admin"){Ext.getCurCmUserAuthInfo({success:function(r,s){q.next()}})}else{q.next()}};var n=function(){Ext.getDatabaseList({success:function(r,s){Ext.RefreshDatabaseList()},failure:function(r,s){}})};q.push(o);q.push(n);q.exec()},failure:function(m,n){}})}}})}}},{xtype:"label",cls:"white_space",text:""},{icon:Ext.ImagePath+"b_drop.png",tooltip:I18N_Util.getMsg("msgDropDb"),getClass:function(e,d,f){if(a!=="admin"){return"x-hide-display"}},handler:function(f,k,e){var j=f.getStore().getAt(k);var i=j.get("name");var h=Ext.checkDbOpenState(i);var g=function(l,o){var p=new JSEX();var n=function(){if(Ext.cookieUtil.getDbmtUserName()!=="admin"){Ext.getCurCmUserAuthInfo({success:function(q,r){p.next()}})}else{p.next()}};var m=function(){Ext.getDatabaseList({success:function(q,r){Ext.RefreshDatabaseList()},failure:function(q,r){}})};p.push(n);p.push(m);p.exec()};var d=function(l,m){};Ext.Msg.show({title:I18N_Util.getMsg("titleWarning"),msg:'<span style="color:red;white-space: nowrap;">'+I18N_Util.getMsg("msgCfmDropDb",{dbname:i})+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(o,p,n){if(o=="yes"){var m=function(){var q=Ext.checkDbOpenState(i);Ext.deleteDb(i,{success:g,failure:d},q)};var l=Ext.cookieUtil.getDbmtUserName();Ext.create("cwm.widget.DropDbVerify",{username:l,title:I18N_Util.getMsg("titleCMSUserAuth"),fn:function(r,s,q){if(r==="ok"){Ext.VerifyAdminPassword(s,q,function(t){if(t){m();var u=Ext.getCmp("adminAuthWin");if(u!=null){u.close()}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrPass"))}})}}}).show()}}})}}]}]});this.add(b)},refresh:function(){var b=this;var a=b.down("#dbListViewGrid");if(a){a.getStore().loadData(Ext.createDbListObj())}},createDb:function(d,e){var c=this;var b=c.down("#dbNameField");if(d.length>16){Ext.showWarningWin(I18N_Util.getMsg("msgDbNameTooLong"),function(){if(b){b.focus(false,300)}});return}for(var a=0;a<Ext.dblist.length;a++){if(Ext.dblist[a].name===d){Ext.showWarningWin(I18N_Util.getMsg("msgDbNameDuplicate"),function(){if(b){b.focus(false,300)}});return}}if(!Ext.VerifyTextInput(d)){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidDbName"),function(){if(b){b.focus(false,300)}});return}Ext.createDb(d,e,{success:function(f,i){if(b){b.setValue("")}var j=new JSEX();var h=function(){if(Ext.cookieUtil.getDbmtUserName()!=="admin"){Ext.getCurCmUserAuthInfo({success:function(k,l){j.next()}})}else{j.next()}};var g=function(){Ext.getDatabaseList({success:function(k,o){var m=Ext.getCmp("dbListViewGrid");if(m){var l=m.getStore();l.loadData(Ext.createDbListObj())}var n=Ext.getCmp("leftPanel");if(n){n.refresh()}},failure:function(k,l){}})};j.push(h);j.push(g);Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){j.exec()})},failure:function(f,g){}})}});Ext.define("cwm.view.DbQuery",{extend:"Ext.panel.Panel",alias:"widget.dbquery",requires:["cwm.widget.dbquery.FieldRow","cwm.widget.dbquery.QueryArea","cwm.widget.dbquery.SqlCreator","cwm.widget.dbquery.UseTables"],bodyStyle:"border: 0; background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;",autoDestroy:true,autoScroll:true,defaults:{border:0,autoScroll:true},addItems:function(){var c=this;var b=Ext.create("cwm.widget.dbquery.SqlCreator");var a=Ext.create("Ext.panel.Panel",{layout:"hbox",id:"dbquery_tablesAndQueryArea",border:0,align:top,padding:"20px 0",items:[{xtype:"usetables"},{xtype:"panel",style:"background: transparent; border: 0;",bodyStyle:"background: transparent; border: 0;",width:40},{xtype:"queryarea"}]});c.add(b);c.add(a)},getTables:function(){var a=this;Ext.getTablesByCCI({success:function(e,f){var g=Ext.decode(e.responseText);if(g&&g.status=="1000"){var b=g.result;var d=b[0].values;if(Ext.isArray(d)){var h=a.down("usetables");var c=a.down("dbsqlcreator");if(h&&c){h.updateSelectsData(d);c.initColumnData(d)}}}else{if(g){if(Ext.checkDbLoginStatusWhenCCI(g.status,g.note)){Ext.showErrorWin(Ext.htmlEncode(g.note))}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInGetTable"))}}},failure:function(b,c){Ext.showErrorWin(I18N_Util.getMsg("msgErrInGetTable"))}})},initComponent:function(){this.callParent(arguments);this.addItems();this.getTables()}});Ext.define("cwm.view.DbSearch",{extend:"Ext.panel.Panel",alias:"widget.dbsearch",requires:["cwm.widget.dbsearch.Criteria","cwm.widget.dbsearch.ResultList"],bodyStyle:"border: 0; background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;",defaults:{border:0},isSearchCriteriaBtnAdded:false,isDbResultGridAdded:false,additems:function(){var a=Ext.create("cwm.widget.dbsearch.ResultList");var b=Ext.create("cwm.widget.dbsearch.Criteria");this.add(a);this.add(b)},addCriteriaSwitchBtn:function(){var b=this;var a=Ext.create("Ext.button.Button",{text:I18N_Util.getMsg("btnShowSearchCriteria"),id:"criteriaswitchbtn",isCriteriaShow:false,handler:function(c){if(c.isCriteriaShow){c.isCriteriaShow=false;c.setText(I18N_Util.getMsg("btnShowSearchCriteria"));var d=b.down("dbsearchcriteria");if(d){d.hide()}}else{c.isCriteriaShow=true;c.setText(I18N_Util.getMsg("btnHideSearchCriteria"));var d=b.down("dbsearchcriteria");if(d){d.show()}}}});b.add(a);b.doLayout();b.isSearchCriteriaBtnAdded=true},changeCriteriaSwitchBtn:function(a){if(typeof a!=="boolean"){a=false}var b=this.down("#criteriaswitchbtn");if(b){if(a){b.isCriteriaShow=true;b.setText(I18N_Util.getMsg("btnHideSearchCriteria"))}else{b.isCriteriaShow=false;b.setText(I18N_Util.getMsg("btnShowSearchCriteria"))}}},refreshResultList:function(b,c){if(typeof b==="undefined"||typeof c==="undefined"){var a=this.down("dbresultlist");if(a){a.hide();this.doLayout()}}else{var a=this.down("dbresultlist");if(a){a.refreshItems(b,c);a.show();this.doLayout()}}},showResultGrid:function(c){if(typeof c==="undefined"){return}this.removeResultGrid();c+=" LIMIT "+Ext.cwm.sqlLimitCount;var a="sqlEditorPanel_search";var b=Ext.create("cwm.view.QueryEditorView",{queryTextareaDomId:a,initQueryStatements:c,bodyStyle:"border: 0;background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;"});this.add(b);b.showSqlEditor(true);b.runSql(b,c)},removeResultGrid:function(){var a=this.down("queryEditorView");if(a){a.destroy()}},deleteResult:function(a){if(typeof a==="undefined"){return}},initComponent:function(){this.callParent(arguments);this.additems();this.refreshResultList()}});Ext.define("cwm.view.DbStruct",{extend:"Ext.panel.Panel",alias:"widget.dbstruct",requires:["cwm.widget.CForm","cwm.widget.createTableWnd","cwm.widget.SqlMessage"],component:{menu:0,dynPanel:1},items:[{xtype:"ctabbar",itemId:"DBStructTabBar",component:{btnStruct:0,btnSQl:1,btnSearch:2,btnQuery:3,btnPrivileges:4,btnExport:5,btnImport:6,btnOperations:7},items:[{xtype:"ctab",icon:Ext.ImagePath+"b_props.png",text:I18N_Util.getMsg("lblStructure"),itemId:"Structure"},{xtype:"ctab",icon:Ext.ImagePath+"b_sql.png",itemId:"SQL",text:I18N_Util.getMsg("lblSql")},{xtype:"ctab",icon:Ext.ImagePath+"b_search.png",itemId:"Search",text:I18N_Util.getMsg("lblSearch")},{xtype:"ctab",icon:Ext.ImagePath+"b_tblanalyse.png",itemId:"Query",text:I18N_Util.getMsg("lblQuery")},{xtype:"ctab",icon:Ext.ImagePath+"s_rights.png",itemId:"Privileges",text:I18N_Util.getMsg("lblPrivileges")},{xtype:"ctab",icon:Ext.ImagePath+"b_tblexport.png",itemId:"Export",text:I18N_Util.getMsg("lblExport")},{xtype:"ctab",icon:Ext.ImagePath+"b_tblimport.png",itemId:"Import",text:I18N_Util.getMsg("lblImport")},{xtype:"ctab",icon:Ext.ImagePath+"b_tblops.png",itemId:"Operations",text:I18N_Util.getMsg("lblOperations")}],listeners:{render:function(a){a.getComponent(a.component.btnStruct).on("click",function(){a.fireEvent("click",a.component.btnStruct);a.setActive(a.component.btnStruct)});a.getComponent(a.component.btnExport).on("click",function(){a.fireEvent("click",a.component.btnExport);a.setActive(a.component.btnExport)});a.getComponent(a.component.btnImport).on("click",function(){a.fireEvent("click",a.component.btnImport);a.setActive(a.component.btnImport)});a.getComponent(a.component.btnSQl).on("click",function(){a.fireEvent("click",a.component.btnSQl);a.setActive(a.component.btnSQl)});a.getComponent(a.component.btnSearch).on("click",function(){a.fireEvent("click",a.component.btnSearch);a.setActive(a.component.btnSearch)});a.getComponent(a.component.btnQuery).on("click",function(){a.fireEvent("click",a.component.btnQuery);a.setActive(a.component.btnQuery)});a.getComponent(a.component.btnPrivileges).on("click",function(){a.fireEvent("click",a.component.btnPrivileges);a.setActive(a.component.btnPrivileges)});a.getComponent(a.component.btnOperations).on("click",function(){a.fireEvent("click",a.component.btnOperations);a.setActive(a.component.btnOperations)})}}}],listeners:{render:function(a){a.getComponent(a.component.menu).on("click",function(d){var c=a.getComponent(a.component.menu).component;var b=a.items.length;if(d==c.btnStruct){for(var f=1;f<b;f++){var e=a.getComponent(1);if(e){a.remove(e,true)}}a.message=undefined;a.createStructure(true)}else{if(d==c.btnExport){for(var f=1;f<b;f++){var e=a.getComponent(1);if(e){a.remove(e,true)}}var h=Ext.create("cwm.view.Export",{dbname:a.dbname,type:"db"});a.add(h)}else{if(d==c.btnImport){for(var f=1;f<b;f++){var e=a.getComponent(1);if(e){a.remove(e,true)}}var g=Ext.create("cwm.view.Import",{dbname:a.dbname,type:"db"});a.add(g)}else{if(d==c.btnOperations){for(var f=1;f<b;f++){var e=a.getComponent(1);if(e){a.remove(e,true)}}var j=Ext.create("cwm.view.Operations",{dbname:a.dbname});j.create("db");a.add(j)}}}}})}},refresh:function(a){this.refreshWindow(a)},refreshWindow:function(b){var a=this;var c=Ext.getDbIndex(this.dbname);Ext.getTableList(Ext.currentDb,{success:function(d,i){var e=Ext.getCmp("leftPanel");if(e){e.refresh()}var g=Ext.dblist[c].tables;var f=a.getComponent("tables-grid");f.getStore().loadData(g);var h=Ext.getCmp("db-struct-sum-panel");if(h){a.makeTotalCountOfTablesStatusMsg(h,g.length)}}})},createStructure:function(h){var d=this;var b=20;var f=Ext.getDbIndex(this.dbname);var i=Ext.dblist[f].tables;var g=Ext.create("Ext.data.Store",{model:"cwm.model.TableListView",autoLoad:true,data:i,proxy:{type:"memory",reader:{type:"json"}}});var k=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none; font-size:2em; color : #777777;text-shadow: 0 1px 0 #FFFFFF;",margin:"0 0 0 10",html:I18N_Util.getMsg("titleTables")});var j=new Ext.selection.CheckboxModel();var c=Ext.create("Ext.grid.Panel",{store:g,enableColumnHide:false,autoFill:true,itemId:"tables-grid",border:0,margin:"0 10 0 10",cls:"struct-grid",selModel:j,autoExpandColumn:"name",columns:[{text:I18N_Util.getMsg("lblColTableName"),dataIndex:"name",width:200,sortable:false,renderer:function(m){if(m===null){return""}return Ext.htmlEncode(m)}},{text:I18N_Util.getMsg("lblOwner"),dataIndex:"owner",sortable:false},{sortable:false,xtype:"actioncolumn",width:120,header:I18N_Util.getMsg("lblAction"),items:[{icon:Ext.ImagePath+"b_browse.png",tooltip:I18N_Util.getMsg("msgViewTableRecords"),handler:function(o,q,m){var p=o.getStore().getAt(q);var n=p.get("name");d.fireEvent("browsetable",n,d)}},{icon:Ext.ImagePath+"b_props.png",tooltip:I18N_Util.getMsg("msgViewTableStruct"),handler:function(o,q,m){var p=o.getStore().getAt(q);var n=p.get("name");d.fireEvent("browsestruct",n,d)}},{icon:Ext.ImagePath+"b_insrow.png",tooltip:I18N_Util.getMsg("msgInsertNewRec"),handler:function(o,q,m){var p=o.getStore().getAt(q);var n=p.get("name");d.fireEvent("insertrecord",n)}},{icon:Ext.ImagePath+"bd_empty.png",tooltip:I18N_Util.getMsg("msgTruncateTable"),handler:function(n,o,m){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:'<span style="color:red;white-space: nowrap;">'+I18N_Util.getMsg("msgCfmTruncateTable",{tablename:Ext.htmlEncode(n.getStore().getAt(o).get("name"))})+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(r,t,q){if(r=="yes"){var s=function(){var v=n.getStore().getAt(o);var u=v.get("name");Ext.TruncateTables(Ext.currentDb,[u])};var p=Ext.cookieUtil.getDbUserName(Ext.currentDb);Ext.create("cwm.widget.DropDbVerify",{username:p,title:I18N_Util.getMsg("titleDbUserAuth"),fn:function(v,w,u){if(v==="ok"){Ext.userLogin(d.dbname,w,u,{success:function(x,y){Ext.cookieUtil.setDbUserPwd(d.dbname,u);s();var z=Ext.getCmp("adminAuthWin");if(z!=null){z.close()}}})}}}).show()}}})}},{icon:Ext.ImagePath+"b_drop.png",tooltip:I18N_Util.getMsg("msgDropTable"),handler:function(n,o,m){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:'<span style="color:red;white-space: nowrap;">'+I18N_Util.getMsg("msgCfmDropTable",{tablename:Ext.htmlEncode(n.getStore().getAt(o).get("name"))})+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(r,s,q){if(r=="yes"){var t=function(){var w=n.getStore().getAt(o);var u=w.get("name");var v='DROP TABLE "'+u+'"';Ext.QueryByCCI(Ext.currentDb,[v],{success:function(x,z){var A=Ext.decode(x.responseText);if(A.result[0].status!=0){var y=Ext.htmlEncode(A.result[0].note);Ext.showErrorWin('<span style="color:red">'+I18N_Util.getMsg("msgErrOccur")+"</span><br><br>"+I18N_Util.getMsg("msgErrDetail")+'<br><br><div style="overflow:auto; height:100px">'+y+"</div>");return}if(A.status==1000){Ext.getTableList(Ext.currentDb,{success:function(B,E){Ext.showSuccessWin(I18N_Util.getMsg("msgSucDrop"));var C=Ext.getCmp("leftPanel");if(C){C.refresh()}var D=Ext.getCmp("rightPanel");D.refresh()}})}else{Ext.showErrorWin(Ext.htmlEncode(A.note))}}})};var p=Ext.cookieUtil.getDbUserName(Ext.currentDb);Ext.create("cwm.widget.DropDbVerify",{username:p,title:I18N_Util.getMsg("titleDbUserAuth"),fn:function(v,w,u){if(v==="ok"){Ext.userLogin(d.dbname,w,u,{success:function(x,y){Ext.cookieUtil.setDbUserPwd(d.dbname,u);t();var z=Ext.getCmp("adminAuthWin");if(z!=null){z.close()}}})}}}).show()}}})}}]}],listeners:{cellclick:function(m,p,n,o){if(n==1){}}},dockedItems:[{xtype:"toolbar",dock:"bottom",border:0,cls:"struct-grid-footer",ui:"footer",items:[{xtype:"panel",bodyStyle:"background : transparent; border : none",html:'<span style="color:#235A81;font-weight:bold">'+I18N_Util.getMsg("msgWithSelected")+":</span>"},{xtype:"button",text:"Empty",tooltip:I18N_Util.getMsg("msgTruncateSelectedTables"),icon:Ext.ImagePath+"bd_empty.png",handler:function(){var p=j.getSelection();if(p.length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgFailMissTable"));return}var o=new Array();for(var n=0;n<p.length;n++){var m=p[n].get("name");o.push(m)}Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:'<span style="color:red;white-space: nowrap;">'+I18N_Util.getMsg("msgCfmTruncateSelectedTables")+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(s,t,r){if(s=="yes"){var q=Ext.cookieUtil.getDbUserName(Ext.currentDb);Ext.create("cwm.widget.DropDbVerify",{username:q,title:I18N_Util.getMsg("titleDbUserAuth"),fn:function(v,w,u){if(v==="ok"){Ext.userLogin(d.dbname,w,u,{success:function(x,y){Ext.cookieUtil.setDbUserPwd(d.dbname,u);Ext.TruncateTables(Ext.currentDb,o);var z=Ext.getCmp("adminAuthWin");if(z!=null){z.close()}}})}}}).show()}}})}},{xtype:"button",text:"Drop",tooltip:I18N_Util.getMsg("msgDropSelectedTables"),id:"drop-table-button",icon:Ext.ImagePath+"b_drop.png",handler:function(){var p=j.getSelection();var n="";if(p.length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgFailMissTable"));return}var o=new Array();for(var m=0;m<p.length;m++){n=p[m].get("name");var q='DROP TABLE "'+n+'";';o.push(q)}Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:'<span style="color:red;white-space: nowrap;">'+I18N_Util.getMsg("msgCfmDropSelectedTables")+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(t,v,s){if(t=="yes"){var u=function(){Ext.QueryByCCI(Ext.currentDb,o,{success:function(w,z){var A=Ext.decode(w.responseText);if(A.status==1000){var y="";for(var x=0;x<A.result.length;x++){if(A.result[x].status!=0){y+=Ext.htmlEncode(A.result[x].note)+"<br>"}}if(y.length>0){Ext.showErrorWin('<span style="color:red">'+I18N_Util.getMsg("msgErrOccur")+"</span><br><br>"+I18N_Util.getMsg("msgErrDetail")+'<br><br><div style="overflow:auto; height:100px">'+y+"</div>",function(){Ext.getTableList(Ext.currentDb,{success:function(B,E){var D=Ext.getCmp("leftPanel");if(D){D.refresh()}c.getSelectionModel().deselectAll();c.getStore().loadData(i);var C=Ext.getCmp("db-struct-sum-panel");if(C){d.makeTotalCountOfTablesStatusMsg(C,i.length)}}})})}else{Ext.getTableList(Ext.currentDb,{success:function(B,E){var D=Ext.getCmp("leftPanel");if(D){D.refresh()}c.getSelectionModel().deselectAll();c.getStore().loadData(i);var C=Ext.getCmp("db-struct-sum-panel");if(C){d.makeTotalCountOfTablesStatusMsg(C,i.length)}Ext.showSuccessWin(I18N_Util.getMsg("msgSucDrop"))}})}}else{Ext.showErrorWin(Ext.htmlEncode(A.note))}}})};var r=Ext.cookieUtil.getDbUserName(Ext.currentDb);Ext.create("cwm.widget.DropDbVerify",{username:r,title:I18N_Util.getMsg("titleDbUserAuth"),fn:function(x,y,w){if(x==="ok"){Ext.userLogin(d.dbname,y,w,{success:function(z,A){Ext.cookieUtil.setDbUserPwd(d.dbname,w);u();var B=Ext.getCmp("adminAuthWin");if(B!=null){B.close()}}})}}}).show()}}})}},{xtype:"panel",width:150,id:"db-struct-sum-panel",html:d.makeTotalCountOfTablesStatusMsg(null,i.length),bodyStyle:"background:transparent; border-left: white solid 1px;",border:0}]}]});var e=Ext.create("cwm.widget.CForm",{title:I18N_Util.getMsg("titleCreateTable"),margin:"20 10 0 10",items:[{xtype:"panel",margin:10,layout:"column",border:0,bodyStyle:"background : transparent",items:[{xtype:"textfield",id:"dbstruct-table-name",fieldLabel:I18N_Util.getMsg("lblTableName"),regex:/^[\w-]+$/,labelWidth:80,width:200,invalidText:I18N_Util.getMsg("msgInvalidTableName"),labelStyle:"color : #444444; text-shadow: 0 1px 0 #FFFFFF;"},{xtype:"numberfield",id:"dbstruct-field-count",fieldLabel:I18N_Util.getMsg("lblColumnNumber"),margin:"0 20 0 20",allowBlank:false,allowDecimals:false,minValue:1,maxValue:b,value:1,labelWidth:100,width:150,labelStyle:"color : #444444;text-shadow: 0 1px 0 #FFFFFF;"}]},{xtype:"panel",border:0,buttonAlign:"left",buttons:[{xtype:"button",text:I18N_Util.getMsg("btnGo"),handler:function(){var o=Ext.getCmp("dbstruct-table-name");var t=Ext.getCmp("dbstruct-field-count");if(typeof o=="undefined"||o==null||typeof t=="undefined"||t==null){return}if(!o.isValid()||o.getValue().length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidTableName"));return}else{if(!t.isValid()){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidColumnNum"));return}}var m=o.getValue();var u=t.getValue();var s=false;var r=Ext.getDbIndex(Ext.currentDb);var n=Ext.dblist[r].tables;for(var q=0;q<n.length;q++){if(m.toLowerCase()===n[q].name.toLowerCase()){s=true;break}}if(s){Ext.showErrorWin(I18N_Util.getMsg("msgTableNameDuplicate"));return}o.setValue("");t.setValue(1);var p=Ext.create("cwm.widget.createTableWnd",{title:I18N_Util.getMsg("titleCreateTable"),tbname:m,colCount:u});p.insertBlankRow(true);for(var q=1;q<u;q++){p.insertBlankRow(false)}p.show()}}]}],height:150});var l=Ext.create("Ext.Component",{margin:10,autoEl:{tag:"hr"}});var a=Ext.create("Ext.toolbar.Toolbar",{style:"background : transparent; border : none",margin:10,cls:"transparent-toolbar",items:[{xtype:"button",text:I18N_Util.getMsg("btnPrintView"),icon:Ext.ImagePath+"b_print.png"},{xtype:"button",margin:"0 0 0 5",text:I18N_Util.getMsg("btnDataDict"),icon:Ext.ImagePath+"b_tblanalyse.png"}]});if(typeof this.result!="undefined"&&typeof this.result.status!="undefined"){this.add(Ext.create("cwm.widget.SqlMessage",{icon:Ext.ImagePath+"s_success.png",result:this.result}))}this.add(k);this.add(c);this.add(l);this.add(e);if(typeof h!=="undefined"&&h!==null&&h===true){this.refreshWindow()}},addDbSearch:function(){this.removeStructure();var a=Ext.create("cwm.view.DbSearch",{});this.add(a)},removeDbSearch:function(){var a=this.down("dbsearch");if(a){a.destroy()}},addDbQuery:function(){this.removeStructure();var a=Ext.create("cwm.view.DbQuery",{});this.add(a)},removeDbQuery:function(){var a=this.down("dbquery");if(a){a.destroy()}},addPrivileges:function(){this.removeStructure();var a=Ext.create("cwm.view.Privileges",{});this.add(a)},removePrivileges:function(){var a=this.down("privileges");if(a){a.destroy()}},addQueryEditor:function(c){this.removeStructure();var a="sqlEditorPanel";var b=Ext.create("cwm.view.QueryEditorView",{queryTextareaDomId:a,initQueryStatements:"",region:"center",bodyStyle:"border: 0;background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;"});this.add(b)},addQueryEditorWithAutoRun:function(c){this.removeStructure();var a="sqlEditorPanel";var d='SELECT * FROM "'+c.tbname+'"';var b=Ext.create("cwm.view.QueryEditorView",{queryTextareaDomId:a,initQueryStatements:d,region:"center",bodyStyle:"border: 0;background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;"});this.add(b);b.showSqlEditor(false);b.runSql(b,d);var e=this.down("ctabbar");if(e){e.setActiveById("SQL")}},removeStructure:function(){var c=this.items.length;for(var a=c-1;a>0;a--){var b=this.getComponent(a);if(b){this.remove(b,true)}}},initComponent:function(){this.addEvents("browsetable","browsestruct","insertrecord");this.callParent(arguments);Ext.getCmp("shortcutBtnSql").show()},makeTotalCountOfTablesStatusMsg:function(b,a){var c='<font color="#235A81">';if(a>1){c+=I18N_Util.getMsg("msgTotalMoreTablesStatus")}else{c+=I18N_Util.getMsg("msgTotalOneTableStatus")}c+="</font>";if(b){b.update(new Ext.XTemplate(c).apply({value:a}));return null}else{return new Ext.XTemplate(c).apply({value:a})}}});Ext.define("cwm.view.Export",{extend:"Ext.panel.Panel",alias:"widget.export",requires:["cwm.widget.Selector"],margin:10,width:700,bodyStyle:"background : transparent; border : none",exportFormat:[{name:"SQL"},{name:"CSV"},{name:"loaddb"}],url:"/files/",exportParameter:{method:"quick",format:"SQL",maxlen:100,exportTables:null,dumpOption:"both"},initParameter:function(){this.exportParameter.format="SQL";this.exportParameter.maxlen=100;this.exportParameter.exportTables=null;this.exportParameter.dumpOption="both"},createTitleAndExportMethod:function(){var b=this;var c=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",component:{content:0},update:function(d){this.getComponent(this.component.content).update(d)},items:[{xtype:"component",update:function(d){this.autoEl.html=d},padding:"10 0 10 3",cls:"title_long_text",autoEl:{tag:"h2",style:"color : #777777; font-size:2em;font-weight:normal;text-shadow:0 1px #ffffff"}}]});if(typeof b.type!=="undefined"&&b.type!=null&&b.type==="db"){c.update(I18N_Util.getMsg("titleExportFromDb")+' <font color="blue">"'+b.dbname+'"</font>')}else{c.update(I18N_Util.getMsg("titleExportFromTable")+' <font color="blue">"'+Ext.htmlEncode(b.tbname)+'"</font>')}var a=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none;",margin:"20 0 30 0",items:[this.createTitle(I18N_Util.getMsg("titleExportMethod")),{xtype:"radio",boxLabel:I18N_Util.getMsg("lblQuickExport"),style:"margin-left:30px",checked:true,name:"method",listeners:{render:function(d){d.on("change",function(f,h,e,g){if(h){b.showQuickOptions();b.exportParameter.method="quick"}})}}},{xtype:"radio",style:"margin-left:30px",boxLabel:I18N_Util.getMsg("lblCustomExport"),name:"method",listeners:{render:function(d){d.on("change",function(f,h,e,g){if(h){b.showCustomOptions();b.exportParameter.method="custom"}})}}}]});this.add(c);this.add(a)},showCustomOptions:function(){this.clearDynArea();this.initParameter();var a=this;if(typeof a.type!=="undefined"&&a.type!=null&&a.type==="db"){a.createDatabaseOptions()}else{a.createTableOptions()}},createTitle:function(b){var a=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",items:[{xtype:"component",margin:" 0 10 0 10",autoEl:{tag:"h3",style:"color:#444444; border-bottom: 1px solid #999999; ",html:b}}]});return a},createDatabaseOptions:function(){var a=this;var h=this.createTitle(I18N_Util.getMsg("titleTables"));var e=Ext.getDbIndex(this.dbname);var d=Ext.dblist[e].tables;var b=new Array();for(var c=0;c<d.length;c++){b.push(d[c].name)}var g=Ext.create("cwm.widget.Selector",{width:300,height:200,margin:"0 0 30 0",items:b});g.updateData=function(){a.exportParameter.exportTables=g.getSelected()};g.addListener("selectChange",function(i){a.exportParameter.exportTables=i});var f=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",margin:"0 0 2 0",layout:"column",items:[{xtype:"component",autoEl:{tag:"a",style:"color:#235a81",html:I18N_Util.getMsg("lblSelectAll")},listeners:{render:function(i){i.getEl().on("mouseover",function(){i.getEl().setStyle("cursor","pointer")});i.getEl().on("click",function(j){g.selectAll(true)})}}},{xtype:"panel",bodyStyle:"background : transparent; border : none",html:"&nbsp;/&nbsp;"},{xtype:"component",autoEl:{tag:"a",style:"color:#235a81",html:I18N_Util.getMsg("lblUnselectAll")},listeners:{render:function(i){i.getEl().on("mouseover",function(){i.getEl().setStyle("cursor","pointer")});i.getEl().on("click",function(j){g.selectAll(false)})}}}]});this.add(h);this.add(f);this.add(g);g.selectAll(true);this.createFormatParameter()},createFormatParameter:function(){var c=this;this.add(this.createTitle(I18N_Util.getMsg("titleFormat")));var a=Ext.create("Ext.data.Store",{fields:["name"],data:c.exportFormat});var e=Ext.create("Ext.form.ComboBox",{store:a,editable:false,value:"SQL",queryMode:"local",displayField:"name",name:" ",margin:"0 0 30 20"});var d=Ext.create("Ext.form.field.Number",{fieldLabel:'<img data-qtip="0 - unlimited" src="'+Ext.ImagePath+'b_docs.png"> '+I18N_Util.getMsg("lblRecNumLimit"),allowBlank:false,allowDecimals:false,minValue:0,maxValue:c.maxRecs,labelWidth:150,value:c.exportParameter.maxlen,width:250,margin:"0 0 30 0"});d.updateData=function(){c.exportParameter.maxlen=d.getValue()};d.addListener("change",function(h,j,g,i){c.exportParameter.maxlen=j});var f=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",items:[{xtype:"radiogroup",columns:1,fieldLabel:I18N_Util.getMsg("lblDumpTable"),margin:"0 0 30 30",width:300,cls:"dump-options",height:60,vertical:true,items:[{boxLabel:I18N_Util.getMsg("lbl_structure"),name:"tboption",inputValue:"1",listeners:{change:function(j,g,i,h){if(g){d.disable()}else{d.enable()}}}},{boxLabel:I18N_Util.getMsg("lblData"),name:"tboption",inputValue:"2"},{boxLabel:I18N_Util.getMsg("lblStructAndData"),name:"tboption",inputValue:"3",checked:true}]}]});var b=this.createTitle(I18N_Util.getMsg("titleDataDumpOpt"));e.addListener("change",function(h,j,g,i){c.exportParameter.format=j;if(j==="loaddb"){d.hide();b.hide();f.down("radiogroup").setValue({tboption:["3"]});f.down("radiogroup").enable()}else{if(j==="CSV"){d.show();b.show();f.down("radiogroup").setValue({tboption:["2"]});f.down("radiogroup").disable()}else{d.show();b.show();f.down("radiogroup").enable();f.down("radiogroup").setValue({tboption:["3"]})}}});e.updateData=function(){c.exportParameter.format=e.getValue()};this.add(e);this.add(this.createTitle(I18N_Util.getMsg("titleFormatSpecOpt")));f.down("radiogroup").addListener("change",function(h,j,g,i){if(j.tboption==="1"){c.exportParameter.dumpOption="schema"}else{if(j.tboption==="2"){c.exportParameter.dumpOption="object"}else{if(j.tboption==="3"){c.exportParameter.dumpOption="both"}}}});f.updateData=function(){var g=f.down("radiogroup").getValue();if(g.tboption==="1"){c.exportParameter.dumpOption="schema"}else{if(g.tboption==="2"){c.exportParameter.dumpOption="object"}else{if(g.tboption==="3"){c.exportParameter.dumpOption="both"}}}};this.add(f);this.add(b);this.add(d);this.add(Ext.create("Ext.button.Button",{width:50,height:30,text:I18N_Util.getMsg("btnGo"),handler:function(){c.execute()}}))},createTableOptions:function(){var b=Ext.create("Ext.form.field.Radio",{margin:"0 0 10 30",boxLabel:I18N_Util.getMsg("lblDumpSomeRow")});var a=Ext.create("Ext.form.field.Text",{margin:"0 0 10 50",value:0,fieldLabel:I18N_Util.getMsg("lblNumOfRow")});var d=Ext.create("Ext.form.field.Text",{margin:"0 0 10 50",value:0,fieldLabel:I18N_Util.getMsg("lblRowBeginAt")});var c=Ext.create("Ext.form.field.Radio",{margin:"0 0 10 30",checked:true,boxLabel:I18N_Util.getMsg("lblDumpAllRow")});this.createFormatParameter()},clearDynArea:function(){var b=this;var a=b.items.length;for(var c=2;c<a;c++){var d=b.getComponent(2);b.remove(d,true)}},showQuickOptions:function(){var b=this;this.clearDynArea();this.initParameter();this.add(this.createTitle(I18N_Util.getMsg("titleFormat")));var a=Ext.create("Ext.data.Store",{fields:["name"],data:b.exportFormat});var c=Ext.create("Ext.form.ComboBox",{store:a,editable:false,value:"SQL",name:" ",queryMode:"local",displayField:"name",margin:"0 0 30 20"});this.add(c);c.addListener("change",function(e,g,d,f){b.exportParameter.format=g});this.add(Ext.create("Ext.button.Button",{width:50,height:30,text:I18N_Util.getMsg("btnGo"),handler:function(){b.execute()}}))},exportTables:function(){var m=this;if(this.exportParameter.format==="loaddb"){var g="";var c=m.url+Ext.htmlEncode(m.dbname)+"_schema";var n=m.url+Ext.htmlEncode(m.dbname)+"_objects";var k=m.url+Ext.htmlEncode(m.dbname)+"_indexes";Ext.ExportTables(m.dbname,m.exportParameter.exportTables,m.exportParameter.dumpOption,g,{success:function(i,o){try{var q=new Array();if(m.exportParameter.dumpOption==="schema"){q.push({name:m.dbname+"_schema",path:c});q.push({name:m.dbname+"_indexes",path:k})}else{if(m.exportParameter.dumpOption==="object"){q.push({name:m.dbname+"_objects",path:n})}else{q.push({name:m.dbname+"_schema",path:c});q.push({name:m.dbname+"_indexes",path:k});q.push({name:m.dbname+"_objects",path:n})}}Ext.ShowFileDownloadWin(q)}catch(p){Ext.Trace(p)}}})}else{if(m.exportParameter.exportTables==null){var j=Ext.getDbIndex(m.dbname);var l=Ext.dblist[j].tables;m.exportParameter.exportTables=new Array();for(var e=0;e<l.length;e++){m.exportParameter.exportTables.push(l[e].name)}}var h=m.exportParameter.format==="SQL"?0:1;var a=m.exportParameter.maxlen;var f=3;if(m.exportParameter.dumpOption==="schema"){f=2}else{if(m.exportParameter.dumpOption==="object"){f=1}}if(f!==2&&(a>this.maxRecs||typeof a!=="number")){Ext.showWarningWin(I18N_Util.getMsg("msgInValidRecNumLimit"));return}else{if(f===2){a=0}}var d=Ext.cwm.isExportDbSupportPath();var b;if(d){var b=m.dbname}Ext.ExportDb(m.dbname,b,m.exportParameter.exportTables,h,a,f,{success:function(i,p){var s=Ext.decode(i.responseText);var r,q,o,t;if(d){r=(h===0)?".sql":".csv";q="files/"+Ext.htmlEncode(b)+r;o={name:b+r,path:q}}else{t=s.export_filename;q="files/"+Ext.htmlEncode(t);o={name:t,path:q}}Ext.ShowFileDownloadWin([o])}})}},exportRows:function(){var i=this;if(this.exportParameter.format==="loaddb"){var f=i.dbname+"_"+i.tbname;var c=i.url+Ext.htmlEncode(f)+"_schema";var j=i.url+Ext.htmlEncode(f)+"_objects";var h=i.url+Ext.htmlEncode(f)+"_indexes";Ext.ExportTables(i.dbname,[i.tbname],i.exportParameter.dumpOption,f,{success:function(k,l){try{var n=new Array();if(i.exportParameter.dumpOption==="schema"){n.push({name:f+"_schema",path:c});n.push({name:f+"_indexes",path:h})}else{if(i.exportParameter.dumpOption==="object"){n.push({name:f+"_objects",path:j})}else{n.push({name:f+"_schema",path:c});n.push({name:f+"_indexes",path:h});n.push({name:f+"_objects",path:j})}}Ext.ShowFileDownloadWin(n)}catch(m){Ext.Trace(m)}}})}else{var g=(i.exportParameter.format==="SQL"?0:1);var a=i.exportParameter.maxlen;var e=1;if(i.exportParameter.format==="SQL"){if(i.exportParameter.dumpOption==="schema"){e=2}else{if(i.exportParameter.dumpOption==="both"){e=3}}}if(e!==2&&(a>this.maxRecs||typeof a!=="number")){Ext.showWarningWin(I18N_Util.getMsg("msgInValidRecNumLimit"));return}else{if(e===2){a=0}}var d=Ext.cwm.isExportDbSupportPath();var b;if(d){b=i.dbname+"_"+i.tbname}Ext.ExportDb(i.dbname,b,[i.tbname],g,a,e,{success:function(k,m){var p=Ext.decode(k.responseText);var o,n,l,q;if(d){o=(g===0)?".sql":".csv";n="files/"+Ext.htmlEncode(b)+o;l={name:b+o,path:n}}else{q=p.export_filename;n="files/"+Ext.htmlEncode(q);l={name:q,path:n}}Ext.ShowFileDownloadWin([l])}})}},execute:function(){for(var b=0;b<this.items.length;b++){var a=this.getComponent(b);if("updateData" in a){a.updateData()}}if(Ext.isArray(this.exportParameter.exportTables)&&this.exportParameter.exportTables.length===0){Ext.showWarningWin(I18N_Util.getMsg("msgFailMissTable"));return}if(this.type==="db"){this.exportTables()}else{this.exportRows()}},initComponent:function(){this.callParent(arguments);this.maxRecs=1000000000;this.createTitleAndExportMethod();this.showQuickOptions()}});Ext.define("cwm.view.Import",{extend:"Ext.form.Panel",alias:"widget.import",bodyStyle:"background : transparent; border: none",margin:10,width:700,importFormat:[{name:"SQL"},{name:"CSV"}],importFormatForDb:[{name:"SQL"},{name:"loaddb"}],importParameter:{format:"SQL",csvsqlFile:null},fileUpload:true,verifyImportFileSuffix:function(){try{var i=this.importParameter.format;if(i==="SQL"){var d=this.importParameter.csvsqlFile;if(d.toLowerCase().lastIndexOf(".sql")==(d.length-4)||d.toLowerCase().lastIndexOf(".txt")==(d.length-4)){return true}}else{if(i==="CSV"){var d=this.importParameter.csvsqlFile;if(d.toLowerCase().lastIndexOf(".csv")==(d.length-4)){return true}}else{if(i==="loaddb"){var f=this.importParameter.schemaFile;var b=this.importParameter.objectFile;var a=this.importParameter.indexesFile;var g=false;var c=false;if(typeof f!="undefined"&&f!=null&&f.length>0){c=true;if(f.toLowerCase().lastIndexOf("_schema")==(f.length-7)){g=true;if(typeof a!=null&&a!=null&&a.length>0){if(a.toLowerCase().lastIndexOf("_indexes")!=(a.length-8)){return false}}}else{return false}}if(typeof b!="undefined"&&b!=null&&b.length>0){if(b.toLowerCase().lastIndexOf("_objects")==(b.length-8)){if(c){if(g){return true}}else{return true}}else{return false}}if(g){return true}}}}}catch(h){Ext.Trace(h);return false}return false},createViewTitle:function(){var a=this;var b=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",component:{content:0},update:function(d){this.getComponent(this.component.content).update(d)},items:[{xtype:"component",update:function(d){this.autoEl.html=d},padding:"10 0 10 3",cls:"title_long_text",autoEl:{tag:"h2",style:"color : #777777; font-size:2em;font-weight:normal;text-shadow:0 1px #ffffff"}}]});if(typeof a.type!=="undefined"&&a.type!=null&&a.type==="db"){b.update(I18N_Util.getMsg("titleImportToDb")+' <font color="blue">"'+a.dbname+'"</font>')}else{b.update(I18N_Util.getMsg("titleImportToTable")+' <font color="blue">"'+Ext.htmlEncode(a.tbname)+'"</font>')}this.add(b)},createTitle:function(b){var a=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",items:[{xtype:"component",margin:" 0 10 0 10",autoEl:{tag:"h3",style:"color:#444444; border-bottom: 1px solid #999999; ",html:b}}]});return a},getFileName:function(b){if(typeof b!="undefined"&&b!=null&&b.length>0){var a=b.lastIndexOf("\\");if(a>=0){return b.substring(a+1,b.length)}else{a=b.lastIndexOf("/");if(a>=0){return b.substring(a+1,b.length)}else{return b}}}return b},createFileImportPartial:function(){var b=this;var c=this.createTitle(I18N_Util.getMsg("titleFileToImport"));this.add(c);var a=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none",updateData:function(){for(var e=0;e<this.items.length;e++){var d=this.getComponent(e);if("updateData" in d){d.updateData()}}},addImportFilePartial:function(k){var f=this.items.length;for(var g=1;g<f;g++){var j=this.getComponent(1);if(j!=null){this.remove(j,true)}}if(b.importParameter.format==="loaddb"){var e=Ext.create("Ext.form.field.File",{width:400,bodyStyle:"background : transparent; border: none",fieldLabel:I18N_Util.getMsg("lblSchemaFile"),margin:"0 0 5 0",labelWidth:80,buttonText:I18N_Util.getMsg("lblBrowse")+"..."});e.addListener("change",function(i,n){var m=b.getFileName(n);e.setRawValue(m)});e.updateData=function(){b.importParameter.schemaFile=b.getFileName(e.getValue());b.importParameter.readyToGo=true};var d=Ext.create("Ext.form.field.File",{width:400,bodyStyle:"background : transparent; border: none",fieldLabel:I18N_Util.getMsg("lblObjectFile"),margin:"0 0 5 0",labelWidth:80,buttonText:I18N_Util.getMsg("lblBrowse")+"..."});d.addListener("change",function(i,n){var m=b.getFileName(n);d.setRawValue(m)});d.updateData=function(){b.importParameter.objectFile=b.getFileName(d.getValue());b.importParameter.readyToGo=true};var l=Ext.create("Ext.form.field.File",{width:400,bodyStyle:"background : transparent; border: none",fieldLabel:I18N_Util.getMsg("lblIndexFile"),margin:"0 0 20 0",labelWidth:80,buttonText:I18N_Util.getMsg("lblBrowse")+"..."});l.addListener("change",function(i,n){var m=b.getFileName(n);l.setRawValue(m)});l.updateData=function(){b.importParameter.indexesFile=b.getFileName(l.getValue())};this.add(e);this.add(d);this.add(l)}else{var h=Ext.create("Ext.form.field.File",{width:400,bodyStyle:"background : transparent; border: none",fieldLabel:I18N_Util.getMsg("lblBrowseComputer"),labelWidth:140,margin:"0 0 20 0",buttonText:I18N_Util.getMsg("lblBrowse")+"..."});h.addListener("change",function(i,n){var m=b.getFileName(n);h.setRawValue(m)});h.updateData=function(){b.importParameter.csvsqlFile=b.getFileName(h.getValue());b.importParameter.readyToGo=true};this.add(h)}},items:[{xtype:"panel",margin:"0 0 20 0",bodyStyle:"background : transparent; border : none"}]});a.addImportFilePartial(this.importParameter.format);this.add(a);this.filePanel=a;var b=this;this.add(Ext.create("Ext.button.Button",{width:50,height:30,text:I18N_Util.getMsg("btnGo"),handler:function(){b.execute()}}))},createFormatPartial:function(c){var d=this;var f=this.createTitle(I18N_Util.getMsg("titleFormat"));this.add(f);var b=[];if(typeof c!=="undefined"&&c===true){b=this.importFormatForDb}else{b=this.importFormat}var a=Ext.create("Ext.data.Store",{fields:["name"],data:b});var e=Ext.create("Ext.form.ComboBox",{store:a,editable:false,value:"SQL",queryMode:"local",displayField:"name",name:" ",margin:"0 0 30 20"});e.addListener("change",function(h,j,g,i){d.importParameter.format=j;d.filePanel.addImportFilePartial(d.importParameter.format)});e.updateData=function(){d.importParameter.format=e.getValue()};this.add(e)},execute:function(){for(var b=0;b<this.items.length;b++){var e=this.getComponent(b);if("updateData" in e){e.updateData()}}var j=this;var g=true;if(this.importParameter.format==="loaddb"){if(!(this.importParameter.schemaFile==null||this.importParameter.schemaFile==="")||!(this.importParameter.objectFile==null||this.importParameter.objectFile==="")){g=true}else{g=false}}else{if(this.importParameter.csvsqlFile==null||this.importParameter.csvsqlFile===""){g=false}else{g=true}}if(!g){Ext.showErrorWin(I18N_Util.getMsg("msgFailMissFile"));return}if(!j.verifyImportFileSuffix()){Ext.showErrorWin(I18N_Util.getMsg("msgUnsupportFileFormat"));return}this.importParameter.readyToGo=false;var a=this.getForm();if(a.isValid()){var f=new JSEX();var c=Ext.cookieUtil.getEnvInfo();var h="+T";if(j.importParameter.format==="loaddb"){f.push(function(){if(j.importParameter.schemaFile==null||j.importParameter.schemaFile===""){f.next()}else{Ext.DeleteFile(h+j.importParameter.schemaFile,{success:function(i,k){f.next()},failure:function(i,k){f.end()}})}});f.push(function(){if(j.importParameter.objectFile==null||j.importParameter.objectFile===""){f.next()}else{Ext.DeleteFile(h+j.importParameter.objectFile,{success:function(i,k){f.next()},failure:function(i,k){f.end()}})}});f.push(function(){if(j.importParameter.indexesFile==null||j.importParameter.indexesFile===""){f.next()}else{Ext.DeleteFile(h+j.importParameter.indexesFile,{success:function(i,k){f.next()},failure:function(i,k){f.end()}})}})}if(j.importParameter.format!=="loaddb"){f.push(function(){Ext.DeleteFile(h+j.importParameter.csvsqlFile,{success:function(i,k){f.next()},failure:function(i,k){f.end()}})})}var d=function(){try{var k="?";if(j.importParameter.format==="loaddb"){k+="fname="+j.importParameter.schemaFile+"&fname="+j.importParameter.objectFile+"&fname="+j.importParameter.indexesFile}else{k+="fname="+Ext.htmlEncode(j.importParameter.csvsqlFile)}a.submit({url:"/upload"+k,standardSubmit:true,waitMsg:I18N_Util.getMsg("msgUploading")+"...",timeout:0,success:function(u,m){var s=I18N_Util.getMsg("msgSucOper");var x=new JSEX();var t=function(){Ext.runDb(j.dbname,false,{success:function(o,y){x.next()}})};var l=null;if(j.importParameter.format==="loaddb"){l=function(){Ext.ImportTables(j.dbname,j.importParameter.schemaFile,j.importParameter.objectFile,j.importParameter.indexesFile,{success:function(o,z){var D=Ext.decode(o.responseText);var C=true;for(var y=0;y<D.line.length;y++){var B=D.line[y];if(B.indexOf("ERROR:")>=0){C=false;break}}if(C){x.next()}else{var A="";if(Ext.isArray(D.line)){for(var y=0;y<D.line.length;y++){A+=Ext.htmlEncode(D.line[y])+" "}}else{A=D.line.toString()}Ext.showWarningWin(A,function(E){Ext.runDb(j.dbname,true,{success:function(F,G){}})});x.end()}}})}}else{var v=j.importParameter.format==="SQL"?0:1;var r=j.type==="db"?null:j.tbname;l=function(){Ext.ImportDb(j.dbname,r,v,j.importParameter.csvsqlFile,{success:function(o,z){if(v===1){var A=Ext.decode(o.responseText);s=I18N_Util.getMsg("msgImportCsvComplete")+"<br>"+I18N_Util.getMsg("msgSucCnt",{cnt:A.success_cnt})+"<br>"+I18N_Util.getMsg("msgFailCnt",{cnt:A.fail_cnt});if(A.fail_cnt>0&&Ext.isArray(A.result)){s+="<br><br>"+I18N_Util.getMsg("msgErrDetail")+'<br><div class="error_message">';for(var y=0;y<A.result.length;y++){s+=Ext.htmlEncode(A.result[y])+"<br>"}s+="</div>"}}x.next()},failure:function(o,y){x.end()}})}}var n=function(){Ext.runDb(j.dbname,true,{success:function(o,y){x.next()}})};var q=function(){Ext.getTableList(j.dbname,{success:function(o,z){var y=Ext.getCmp("leftPanel");if(y){y.refresh()}x.next()}})};if(j.importParameter.format==="loaddb"){x.push(t)}x.push(l);if(j.importParameter.format==="loaddb"){x.push(n)}x.push(q);if(j.type!=="db"){var w=function(){Ext.getTableInfoByCCI(Ext.currentDb,j.tbname,{success:function(o,y){x.next()}})};x.push(w)}var p=function(){j.initParameter();Ext.showSuccessWin(s)};x.push(p);x.exec()},failure:function(l,m){f.end();Ext.showErrorWin(I18N_Util.getMsg("msgFail2Upload"))}})}catch(i){Ext.Trace(i);f.end()}};f.push(d);f.exec()}},initParameter:function(){this.importParameter.format="SQL";this.importParameter.csvsqlFile=null;this.importParameter.schemaFile=null;this.importParameter.objectFile=null;this.importParameter.readyToGo=false},initComponent:function(){this.callParent(arguments);this.initParameter();this.createViewTitle();this.createFormatPartial(this.type==="db");this.createFileImportPartial()}});Ext.define("cwm.view.Insert",{extend:"Ext.form.Panel",alias:"widget.insert",requires:["cwm.widget.dbquery.FieldRow"],margin:10,bodyStyle:"background : transparent; border : none",tableName:null,dbname:null,createView:function(a){var d=this;if(Ext.isArray(a)&&a.length>0){d.addHeader();d.addColumnRows(a);d.addDockedItems();for(var c=0;c<d.initRecs;c++){d.validFieldIndexs.push(c)}d.indexCount=d.initRecs}else{var b=Ext.create("Ext.panel.Panel",{cls:"infoPanel",title:I18N_Util.getMsg("titleInsertRecs"),width:500,items:[{html:I18N_Util.getMsg("msgNoColInTable"),cls:"dbauth_info",bodyCls:"body"}]});d.add(b)}},addHeader:function(){var b=this,a,c;a=Ext.create("cwm.widget.dbquery.FieldRow",{id:"Insert_Header",fieldCount:b.initRecs-1,bodyStyle:"background: #cccccc; border: 0; padding: 0 3px"});b.add(a);a.addLabel(I18N_Util.getMsg("lblColumn"),"");a.addLabel(I18N_Util.getMsg("lblType"),"");c=new Object();c.minWidth=120;c.maxWidth=b.maxFieldWidth;a.addLabel(I18N_Util.getMsg("lblValue"),"",c);if(b.initRecs-1>0){c=new Object();c.fieldType="Ext.form.field.Checkbox";c.boxLabel=I18N_Util.getMsg("lblValue");c.boxLabelAlign="before";c.name="header";c.minWidth=b.minFieldWidth;c.maxWidth=b.maxFieldWidth;a.addFields(c)}else{a.fieldConf={margin:2,boxLabel:I18N_Util.getMsg("lblValue"),boxLabelAlign:"before",minWidth:b.minFieldWidth,maxWidth:b.maxFieldWidth};a.fieldType="Ext.form.field.Checkbox";a.fieldName="header"}},addColumnRows:function(b){var f=this;var e,a,g,d;f.sqlWithNoRecs='INSERT INTO "'+f.tableName+'" (';if(!Ext.isArray(b)){return}for(var c=0;c<b.length;c++){d=new Object();d.name=b[c].name;d.type=b[c].type;this.columnsInfo.push(d);f.sqlWithNoRecs+='"'+d.name+'",';if(c%2==0){a="transparent"}else{a="#DFDFDF"}e=Ext.create("cwm.widget.dbquery.FieldRow",{id:"Insert_CRow"+c,fieldCount:f.initRecs,bodyStyle:"background: "+a+"; border: 0; padding: 2px 3px"});f.add(e);e.labelMinWidth=120;e.addLabel(d.name,"");e.addLabel(d.type,"");g=new Object();g.fieldType="Ext.form.field.Text";g.name="value_"+c;g.minWidth=f.minFieldWidth;g.maxWidth=f.maxFieldWidth;e.addFields(g)}f.sqlWithNoRecs=f.sqlWithNoRecs.substring(0,f.sqlWithNoRecs.length-1)+") "},addDockedItems:function(){var b=this;var a=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom",ui:"footer",cls:"struct-grid-toolbar",border:0,items:[{text:I18N_Util.getMsg("btnSave"),handler:function(){b.submit()}},{text:I18N_Util.getMsg("btnAdd"),handler:function(){b.addFields()}},{xtype:"numberfield",name:"addrecs",value:1,minValue:1,allowBlank:false,allowDecimals:false,maxValue:4,width:40},{xtype:"label",text:I18N_Util.getMsg("lblRecs")},{text:I18N_Util.getMsg("lblRemove"),tooltip:I18N_Util.getMsg("msgRemoveSelectRec"),handler:function(){b.removeRecords()}}]});b.addDocked(a)},submit:function(){var g=this;var h=g.getForm().getValues();var e,d=new Array(),f=new Array(),a=false;for(var c=0;c<g.items.length-1;c++){for(var b=0;b<g.validFieldIndexs.length;b++){if(c===0){d.push("(");f.push(true)}e=g.validFieldIndexs[b];if(h["value_"+c+"_"+e]!==""){f[b]=false;d[b]+=Ext.DbUtil.TranslateFieldValue(this.columnsInfo[c]["type"],h["value_"+c+"_"+e])+", "}else{d[b]+="DEFAULT, "}}}var k=this.sqlWithNoRecs+"VALUES ";for(var c=0;c<d.length;c++){k+=d[c].substring(0,d[c].length-2)+"), ";if(f[c]===true){a=true}}k=k.substring(0,k.length-2);if(a===true){Ext.Msg.show({title:I18N_Util.getMsg("titleWarning"),msg:'<span style="white-space: nowrap;">'+I18N_Util.getMsg("msgCfmRecMissValue")+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(j,l,i){if(j=="yes"){g.fireEvent("insertrow",g,g.dbname,g.tableName,k)}}})}else{g.fireEvent("insertrow",g,g.dbname,g.tableName,k)}},removeRecords:function(){var f=this;var b=f.getForm().getValues();var d,h,g,a=new Array();for(var e=0;e<f.items.length;e++){h=f.getComponent(e);if(h){for(var c=f.validFieldIndexs.length-1;c>=1;c--){d=f.validFieldIndexs[c]-1;if(b["header_"+d]=="on"){g=h.getComponent(c+2);if(g){h.remove(g,true)}}}}}a.push(f.validFieldIndexs[0]);for(var e=1;e<f.validFieldIndexs.length;e++){d=f.validFieldIndexs[e]-1;if(b["header_"+d]!=="on"){a.push(f.validFieldIndexs[e])}}f.validFieldIndexs=a},addFields:function(){var d=this;var a=d.getForm().getValues();var c=parseInt(a.addrecs);if(c+d.validFieldIndexs.length>d.maxRecs){Ext.showWarningWin(I18N_Util.getMsg("msgFailAtMostRec",{max:d.maxRecs}));c=d.maxRecs-d.validFieldIndexs.length}if(c<1){return}for(var b=0;b<c;b++){d.validFieldIndexs.push(d.indexCount+b)}d.indexCount+=c;for(var b=0;b<d.items.length;b++){row=d.getComponent(b);if(row){row.addFields({count:c,addType:"added"})}}},initComponent:function(){this.addEvents("insertrow");this.callParent(arguments);this.validFieldIndexs=new Array();this.indexCount=0;this.initRecs=1;this.maxRecs=5;this.minFieldWidth=60;this.maxFieldWidth=235;this.sqlWithNoRecs=null;this.columnsInfo=new Array()}});Ext.define("cwm.view.LeftPanel",{extend:"Ext.panel.Panel",alias:"widget.leftPanel",id:"leftPanel",component:{dynPanel:2},requires:["cwm.widget.LeftPanelToolBar","cwm.widget.TableLists"],bodyStyle:"background : url(resources/images/left_nav_bg.png) repeat-y right 0% #f3f3f3; overflow-x: hidden; overflow-y: auto;",items:[{xtype:"imagecomponent",border:0,id:"logo",margin:"20 10 10 30",width:120,src:"resources/images/logo_cubrid.png"},{xtype:"lptoolbar",style:"border : 0; margin-left : 20px; background : transparent",id:"LeftPanelToolBar",border:0}],removeLists:function(){var a=this.getComponent(this.component.dynPanel);this.remove(a,true)},createTableLists:function(b){try{var a=Ext.create("cwm.widget.TableLists",{style:"margin-left : 10px;",border:0});this.add(a)}catch(c){Ext.Trace(c)}},createDbLists:function(b){this.removeLists();var a=Ext.create("cwm.widget.DbList",{margin:10,border:0,data:Ext.dblist});a.createList();this.add(a)},refresh:function(){try{var a=this.getComponent(this.component.dynPanel);if(a){a.refresh()}}catch(b){Ext.Trace(b)}},initComponent:function(){this.callParent(arguments)}});Ext.define("cwm.view.Monitor",{extend:"Ext.panel.Panel",alias:"widget.monitor",requires:["cwm.widget.DynamicChart"],bodyStyle:"border: 0; background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;",defaults:{border:0},id:"monitorView",interval:Ext.cwm.monitorInterval*1000,initParams:function(){this.dbName="";this.task=null;this.chartInViewWidth=300;this.chartInViewHeight=150;this.winWidth=800;this.winHeight=500;this.winMinWidth=this.winWidth;this.winMinHeight=this.winHeight;this.chartInWinWidth=400;this.chartInWinHeight=150;this.columnInWinWidth=120;this.columnInWinHeight=this.chartInWinHeight;this.pieInWinWidth=this.chartInWinWidth;this.pieInWinHeight=this.chartInWinHeight;this.gridHeight=270;this.totalMem=1024;this.totalSpace=10240;this.firstCpuAndMemLoading=true;this.firstSpaceLoading=true;this.cpuData=new Array();this.memData=new Array();this.spaceData=new Array();this.dbStatusData=new Array();this.cpuChartData=new Array();this.memChartData=new Array();this.spaceChartData=new Object();this.curDetailWinType="";this.labelTitle={font:"10px Arial"};this.cpuChartXAxisTitle=null;this.memChartXAxisTitle=null;this.spaceChartXAxisTitle=null;this.gaugeHeightInView=this.chartInViewHeight;this.gaugeWidthInView=this.chartInViewWidth;this.gaugeHeightInWin=this.chartInWinHeight;this.gaugeWidthInWin=250;this.gaugeBaseColor="#ddd";this.gaugeInnerColor="#829909";this.gaugeOuterColor="#ED1A24";this.tipDismissDelay=0;this.areaStrokeColor=Ext.cwm.monitorAreaColorSet[1]},addComponents:function(){var a=this;a.addChartsBoxInView();a.addCpuGridToContainer(a,{id:"cpuGridInView",isWin:false});a.addMemGridToContainer(a,{id:"memGridInView",isWin:false});a.addSpaceGridToContainer(a,{id:"spaceGridInView",isWin:false});a.addDbStatusGridToContainer(a,{id:"statusGridInView",isWin:false});a.refreshSpaceInfo(function(){a.refreshDbStatus("init")});a.startGetCpuAndMemDataTask()},addChartsBoxInView:function(){var e=Ext.create("Ext.panel.Panel",{id:"titleBoxInView",border:0,layout:"hbox",items:[{xtype:"label",cls:"monitor_chart_title",width:this.chartInViewWidth,text:I18N_Util.getMsg("lblCPU")},{xtype:"label",cls:"monitor_chart_title",width:this.chartInViewWidth,text:I18N_Util.getMsg("lblMem")},{xtype:"label",cls:"monitor_chart_title",width:this.chartInViewWidth,text:I18N_Util.getMsg("lblDiskSpace")}]});this.add(e);var a=Ext.create("Ext.panel.Panel",{id:"chartsBox",layout:"hbox",border:0});this.add(a);var d=Ext.create("cwm.widget.ChartBox",{id:"cpuChartBox"});var c=Ext.create("cwm.widget.ChartBox",{id:"memChartBox"});var b=Ext.create("cwm.widget.ChartBox",{id:"spaceChartBox"});a.add(d);a.add(c);a.add(b);this.cpuChartData=this.getCpuFakeData();this.memChartData=this.getMemFakeData();this.spaceChartData=this.getSpaceFakeData();this.addCpuGaugeToContainer(d,{id:"cpuGaugeInView",height:this.gaugeHeightInView,width:this.gaugeWidthInView});this.addMemGaugeToContainer(c,{id:"memGaugeInView",height:this.gaugeHeightInView,width:this.gaugeWidthInView});this.addSpaceGaugeToContainer(b,{id:"spaceGaugeInView",height:this.gaugeHeightInView,width:this.gaugeWidthInView})},addCpuGaugeToContainer:function(a,d){if(!(d&&typeof d.id==="string"&&typeof d.height==="number"&&typeof d.width==="number")||!a){return}var c,b;b=Ext.create("Ext.data.Store",{model:"cwm.model.CpuChart",data:new Array(),autoLoad:true,autoDestroy:true});c=Ext.create("Ext.chart.Chart",{width:d.width,height:d.height,id:d.id,animate:true,shadow:true,store:b,insetPadding:25,axes:[{type:"gauge",position:"gauge",minimum:0,maximum:100,steps:10,margin:7}],series:[{type:"gauge",field:"sysTotalCpuUsage",donut:30,colorSet:[this.gaugeInnerColor,this.gaugeBaseColor]},{type:"gauge",field:"dbTotalCpuUsage",donut:30,colorSet:[this.gaugeOuterColor,this.gaugeBaseColor],style:{opacity:0.5},tips:{trackMouse:true,width:150,dismissDelay:this.tipDismissDelay,renderer:function(f,e){this.setTitle(I18N_Util.getMsg("msgCpuUsage",{sysTotalCpuUsage:f.get("sysTotalCpuUsage"),sysUserCpuUsage:f.get("sysUserCpuUsage"),sysKernelCpuUsage:f.get("sysKernelCpuUsage"),sysIoWaitUsage:f.get("sysIoWaitUsage"),dbTotalCpuUsage:f.get("dbTotalCpuUsage"),dbUserCpuUsage:f.get("dbUserCpuUsage"),dbKernelCpuUsage:f.get("dbKernelCpuUsage"),date:Ext.Date.format(f.get("date"),"H:i:s")}))}}}]});a.add(c)},addCpuChartToContainer:function(b,d){if(!(d&&typeof d.id==="string"&&typeof d.height==="number"&&typeof d.width==="number")||!b){return}var a,e,c=new Date();e=Ext.create("Ext.data.Store",{model:"cwm.model.CpuChart",data:new Array(),autoLoad:true,autoDestroy:true});a=Ext.create("cwm.widget.DynamicChart",{width:d.width,height:d.height,theme:"Monitor:gradients",id:d.id,animate:false,store:e,axes:[{type:"Numeric",minimum:0,maximum:100,majorTickSteps:0,position:"left",fields:["sysTotalCpuUsage","dbTotalCpuUsage","sysTotalCpuUsageForShow"],title:false,label:{renderer:function(f){return""+f+"%"}}},{type:"Time",position:"bottom",fields:"date",dateFormat:"",constrain:true,fromDate:Ext.Date.add(c,Ext.Date.SECOND,-Ext.cwm.monitorInterval*Ext.cwm.chartTimeLength),toDate:c,labelTitle:this.labelTitle,title:"Waiting...",label:{renderer:function(f){return""}}}],series:[{type:"area",axis:["left"],xField:"date",yField:["dbTotalCpuUsage","sysTotalCpuUsageForShow"],style:{opacity:0.86,stroke:this.areaStrokeColor,lineWidth:0},tips:{trackMouse:true,width:150,dismissDelay:this.tipDismissDelay,renderer:function(g,f){this.setTitle(I18N_Util.getMsg("msgCpuUsage",{sysTotalCpuUsage:g.get("sysTotalCpuUsage"),sysUserCpuUsage:g.get("sysUserCpuUsage"),sysKernelCpuUsage:g.get("sysKernelCpuUsage"),sysIoWaitUsage:g.get("sysIoWaitUsage"),dbTotalCpuUsage:g.get("dbTotalCpuUsage"),dbUserCpuUsage:g.get("dbUserCpuUsage"),dbKernelCpuUsage:g.get("dbKernelCpuUsage"),date:Ext.Date.format(g.get("date"),"H:i:s")}))}}}]});b.add(a);a.data=this.cpuChartData},addMemGaugeToContainer:function(a,e){if(!(e&&typeof e.id==="string"&&typeof e.height==="number"&&typeof e.width==="number")||!a){return}var c=this;var d,b;b=Ext.create("Ext.data.Store",{model:"cwm.model.MemChart",data:new Array(),autoLoad:true,autoDestroy:true});d=Ext.create("Ext.chart.Chart",{width:e.width,height:e.height,id:e.id,animate:true,shadow:true,store:b,insetPadding:25,axes:[{type:"gauge",position:"gauge",minimum:0,maximum:100,steps:10,margin:7}],series:[{type:"gauge",field:"sysPhyUsage",donut:30,colorSet:[this.gaugeInnerColor,this.gaugeBaseColor]},{type:"gauge",field:"dbPhyUsage",donut:30,colorSet:[this.gaugeOuterColor,this.gaugeBaseColor],style:{opacity:0.5},tips:{trackMouse:true,width:200,dismissDelay:this.tipDismissDelay,renderer:function(i,h){var f=c.convertSizeToStr(i.get("sysPhyMemUsed"));var g=c.convertSizeToStr(i.get("dbPhyMemUsed"));var j=c.convertSizeToStr(i.get("sysPhyMemTotal"));this.setTitle(I18N_Util.getMsg("msgMemUsageInGauge",{sysPhyMemUsed:f,sysPhyUsage:i.get("sysPhyUsage"),dbPhyMemUsed:g,dbPhyUsage:i.get("dbPhyUsage"),sysPhyMemTotal:j,date:Ext.Date.format(i.get("date"),"H:i:s")}))}}}]});a.add(d)},addMemChartToContainer:function(a,f){if(!(f&&typeof f.id==="string"&&typeof f.height==="number"&&typeof f.width==="number")||!a){return}var e=this;var c,d,b=new Date();c=Ext.create("Ext.data.Store",{model:"cwm.model.MemChart",data:new Array(),autoLoad:true,autoDestroy:true});d=Ext.create("cwm.widget.DynamicChart",{width:f.width,height:f.height,id:f.id,theme:"Monitor:gradients",animate:false,store:c,axes:[{type:"Numeric",minimum:0,maximum:this.totalMem,majorTickSteps:0,position:"left",fields:["sysPhyMemUsed","dbPhyMemUsed","sysPhyMemUsedForShow"],title:false,label:{renderer:function(h){var g=Math.round(h/1024*10)/10;return""+g+"GB"}}},{type:"Time",position:"bottom",fields:"date",dateFormat:"",constrain:true,fromDate:Ext.Date.add(b,Ext.Date.SECOND,-Ext.cwm.monitorInterval*Ext.cwm.chartTimeLength),toDate:b,labelTitle:this.labelTitle,title:I18N_Util.getMsg("titleWaiting"),label:{renderer:function(g){return""}}}],series:[{type:"area",axis:["left"],xField:"date",yField:["dbPhyMemUsed","sysPhyMemUsedForShow"],style:{opacity:0.86,stroke:this.areaStrokeColor,lineWidth:0},tips:{trackMouse:true,width:200,dismissDelay:this.tipDismissDelay,renderer:function(l,k){var g=e.convertSizeToStr(l.get("sysPhyMemUsed"));var h=e.convertSizeToStr(l.get("dbPhyMemUsed"));var j=l.get("sysPhyMemTotal");var i=Math.round(l.get("sysPhyMemUsed")/j*100);var m=Math.round(l.get("dbPhyMemUsed")/j*100);this.setTitle(I18N_Util.getMsg("msgMemUsageInChart",{sysPhyMemUsed:g,sysPhyUsage:i,dbPhyMemUsed:h,dbPhyUsage:m,date:Ext.Date.format(l.get("date"),"H:i:s")}))}}}]});a.add(d);d.data=this.memChartData},addSpaceGaugeToContainer:function(a,d){if(!(d&&typeof d.id==="string"&&typeof d.height==="number"&&typeof d.width==="number")||!a){return}var c=this;var e,b;b=Ext.create("Ext.data.Store",{model:"cwm.model.SpaceChart",data:new Array(),autoLoad:true,autoDestroy:true});e=Ext.create("Ext.chart.Chart",{width:d.width,height:d.height,id:d.id,animate:true,shadow:true,store:b,insetPadding:25,axes:[{type:"gauge",position:"gauge",minimum:0,maximum:100,steps:10,margin:7}],series:[{type:"gauge",field:"sysSpaceUsage",donut:30,colorSet:[this.gaugeInnerColor,this.gaugeBaseColor]},{type:"gauge",field:"dbSpaceUsage",donut:30,colorSet:[this.gaugeOuterColor,this.gaugeBaseColor],style:{opacity:0.5},tips:{trackMouse:true,width:200,dismissDelay:this.tipDismissDelay,renderer:function(h,g){var f=c.convertSizeToStr(h.get("sysUsedSize"));var j=c.convertSizeToStr(h.get("dbUsedSize"));var i=c.convertSizeToStr(h.get("sysTotalSize"));this.setTitle(I18N_Util.getMsg("msgDiskSpaceUsageInGauge",{sysUsedSize:f,sysSpaceUsage:h.get("sysSpaceUsage"),dbUsedSize:j,dbSpaceUsage:h.get("dbSpaceUsage"),sysTotalSize:i,date:Ext.Date.format(h.get("date"),"H:i:s")}))}}}]});a.add(e)},addSpacePieToContainer:function(b,e){if(!b||!(e&&typeof e.id==="string")){return}var d=this;var c=Ext.create("Ext.data.Store",{fields:["name","value"],data:[{name:"Waiting...",value:1}],autoLoad:true,autoDestroy:true});var a=Ext.create("Ext.chart.Chart",{width:e.width,height:e.height,id:e.id,animate:true,shadow:true,store:c,legend:{position:"right"},theme:"Base:gradients",series:[{type:"pie",showInLegend:true,field:"value",title:["Waiting"],tips:{trackMouse:true,width:250,dismissDelay:this.tipDismissDelay,renderer:function(i,h){var g=0,f=0;c.each(function(j){g+=j.get("value")});f=Math.round(i.get("value")/g*10000)/100;sizeStr=d.convertSizeToStr(i.get("value"));this.setTitle(I18N_Util.getMsg("msgDiskSpaceUsageInPie",{name:i.get("name"),size:sizeStr,percent:f}))}}}]});b.add(a)},addCpuGridToContainer:function(a,i){if(!a||!(i&&typeof i.id==="string"&&typeof i.isWin==="boolean")){return}var g=this,f,c,e;var h={bodyCls:"monitor_grid_title",items:[{xtype:"label",cls:"element",text:I18N_Util.getMsg("titleCpu")}]};e=Ext.create("Ext.data.Store",{model:"cwm.model.CpuGrid",data:[],groupField:"group",sortOnLoad:false,autoLoad:true,autoDestroy:true});var b=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}"});var d={id:i.id,border:0,cls:"infoPanel",padding:"0 0 5px",features:[b],enableColumnMove:false,sortableColumns:false,enableColumnHide:false,store:e,columns:[{text:I18N_Util.getMsg("lblType"),dataIndex:"type"},{text:I18N_Util.getMsg("lblUserCpu"),align:"right",dataIndex:"userCpuUsage",renderer:function(j){if(typeof j==="number"){return""+j+"%"}}},{text:I18N_Util.getMsg("lblKernelCpu"),align:"right",dataIndex:"kernelCpuUsage",renderer:function(j){if(typeof j==="number"){return""+j+"%"}}},{text:I18N_Util.getMsg("lblIoWait"),align:"right",dataIndex:"IoWaitUsage",renderer:function(j){if(j===""){return"--"}else{if(typeof j==="number"){return""+j+"%"}}}},{text:I18N_Util.getMsg("lblTotalCpu"),align:"right",dataIndex:"totalCpuUsage",renderer:function(j){if(typeof j==="number"){return""+j+"%"}}}],listeners:{afterrender:function(j){if(i.isWin!==true){b.disable()}}}};if(i.isWin===true){}else{h.items.push({xtype:"button",icon:Ext.ImagePath+"broker_detail.png",tooltip:I18N_Util.getMsg("msgMoreDetail"),handler:function(){g.createDetailWin("cpu")}})}f=Ext.create("Ext.panel.Panel",h);a.add(f);c=Ext.create("Ext.grid.Panel",d);a.add(c)},addMemGridToContainer:function(b,i){if(!b||!(i&&typeof i.id==="string"&&typeof i.isWin==="boolean")){return}var g=this,f,a,c;var h={bodyCls:"monitor_grid_title",items:[{xtype:"label",cls:"element",text:I18N_Util.getMsg("titleMem")}]};c=Ext.create("Ext.data.Store",{model:"cwm.model.MemGrid",data:[],groupField:"group",sortOnLoad:false,autoLoad:true,autoDestroy:true});var d=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}"});var e={id:i.id,border:0,cls:"infoPanel",padding:"0 0 5px",features:[d],enableColumnMove:false,sortableColumns:false,enableColumnHide:false,store:c,columns:[{text:I18N_Util.getMsg("lblType"),dataIndex:"type"},{text:I18N_Util.getMsg("lblPhyMemUsed"),align:"right",dataIndex:"phyMemUsed",renderer:function(j){if(typeof j==="number"){return""+j+" MB"}}},{text:I18N_Util.getMsg("lblPhyMemTotal"),align:"right",dataIndex:"phyMemTotal",renderer:function(j){if(j===""){return"--"}else{if(typeof j==="number"){return""+j+" MB"}}}},{text:I18N_Util.getMsg("lblSwapMemUsed"),align:"right",dataIndex:"swapMemUsed",renderer:function(j){if(j===""){return"--"}else{if(typeof j==="number"){return""+j+" MB"}}}},{text:I18N_Util.getMsg("lblSwapMemTotal"),align:"right",dataIndex:"swapMemTotal",renderer:function(j){if(j===""){return"--"}else{if(typeof j==="number"){return""+j+" MB"}}}},{text:I18N_Util.getMsg("lblVirtualMem"),align:"right",dataIndex:"virtualMemUsed",renderer:function(j){if(j===""){return"--"}else{if(typeof j==="number"){return""+j+" MB"}}}}],listeners:{afterrender:function(j){if(i.isWin!==true){d.disable()}}}};if(i.isWin===true){}else{h.items.push({xtype:"button",icon:Ext.ImagePath+"broker_detail.png",tooltip:I18N_Util.getMsg("msgMoreDetail"),handler:function(){g.createDetailWin("mem")}})}f=Ext.create("Ext.panel.Panel",h);b.add(f);a=Ext.create("Ext.grid.Panel",e);b.add(a)},addSpaceGridToContainer:function(a,i){if(!a||!(i&&typeof i.id==="string"&&typeof i.isWin==="boolean")){return}var g=this;var h={bodyCls:"monitor_grid_title",items:[{xtype:"label",cls:"element",text:I18N_Util.getMsg("titleDiskSpace")},{xtype:"button",icon:Ext.ImagePath+"s_sync.png",tooltip:I18N_Util.getMsg("msgRefreshDiskSpaceInfo"),handler:function(){g.refreshSpaceInfo()}},{xtype:"label",cls:"element",itemId:"DbSpaceUpdateTime",text:I18N_Util.getMsg("msgLatestUpdateTime")}]};var e=Ext.create("Ext.data.Store",{model:"cwm.model.SpaceGrid",data:[],groupField:"group",sortOnLoad:false,autoLoad:true,autoDestroy:true});var c=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}"});var d={id:i.id,border:0,cls:"infoPanel",padding:"0 0 5px",enableColumnMove:false,sortableColumns:false,enableColumnHide:false,features:[c],store:e,columns:[{text:I18N_Util.getMsg("lblType"),dataIndex:"type"},{text:I18N_Util.getMsg("lblUsedRate"),align:"right",dataIndex:"usage",renderer:function(j){if(j===""){return"--"}else{if(typeof j==="number"){return""+j+"%"}}}},{text:I18N_Util.getMsg("lblUsedSize"),align:"right",dataIndex:"usedsize",renderer:function(j){if(j===""){return"--"}else{if(typeof j==="number"){return""+j+" MB"}}}},{text:I18N_Util.getMsg("lblFreeSize"),align:"right",dataIndex:"freesize",renderer:function(j){if(j===""){return"--"}else{if(typeof j==="number"){return""+j+" MB"}}}},{text:I18N_Util.getMsg("lblTotalSize"),align:"right",dataIndex:"totalsize",renderer:function(j){if(j===""){return"--"}else{if(typeof j==="number"){return""+j+" MB"}}}}],listeners:{afterrender:function(j){if(i.isWin!==true){c.disable()}}}};if(i.isWin===true){}else{h.items.splice(1,0,{xtype:"button",icon:Ext.ImagePath+"broker_detail.png",tooltip:I18N_Util.getMsg("msgMoreDetail"),handler:function(){g.createDetailWin("space")}});h.items.splice(2,0,{xtype:"label",cls:"white_space",text:""})}var f=Ext.create("Ext.panel.Panel",h);a.add(f);var b=Ext.create("Ext.grid.Panel",d);a.add(b)},addDbStatusGridToContainer:function(a,g){var e=this;var h={bodyCls:"monitor_grid_title",items:[{xtype:"label",cls:"element",text:"Database Status"},{xtype:"button",icon:Ext.ImagePath+"s_sync.png",tooltip:I18N_Util.getMsg("msgRefreshDiskSpaceInfo"),handler:function(){e.refreshDbStatus()}},{xtype:"label",cls:"element",itemId:"DbStatusUpdateTime",text:I18N_Util.getMsg("msgLatestUpdateTime")}]};var b=Ext.create("Ext.data.Store",{model:"cwm.model.DbStatus",autoDestroy:true});var d={id:g.id,border:0,cls:"infoPanel",padding:"0 0 5px",enableColumnMove:false,sortableColumns:false,enableColumnHide:false,store:b,columns:[{text:I18N_Util.getMsg("lblDb"),dataIndex:"dbname"},{text:I18N_Util.getMsg("lblDbStatus"),dataIndex:"status",align:"center",width:80,renderer:function(k,j,i){if(k==true){return'<div style="text-align:center">'+I18N_Util.getMsg("msgDbStatusOnline")+"</div>"}return'<div class="x-item-grayed" style="text-align:center">'+I18N_Util.getMsg("msgDbStatusOffline")+"</div>"}},{text:I18N_Util.getMsg("lblCpuUsage"),dataIndex:"cpuPct",width:80,renderer:function(i){if(i===""){return"--"}else{if(typeof i==="number"){return""+i+"%"}}}},{text:I18N_Util.getMsg("lblMemUsage"),dataIndex:"memPct",renderer:function(i){if(i===""){return"--"}else{if(typeof i==="number"){return""+i+"%"}}}},{text:I18N_Util.getMsg("lblCAS"),dataIndex:"cascnt",width:60,renderer:function(i){if(i===""){return"0"}else{return i}}},{text:I18N_Util.getMsg("lblBQPS"),dataIndex:"qps",width:60,renderer:function(i){if(i===""){return"0"}else{return i}}},{text:I18N_Util.getMsg("lblBLQS"),dataIndex:"lqs",width:60,renderer:function(i){if(i===""){return"0"}else{return i}}},{text:I18N_Util.getMsg("lblTranLock"),dataIndex:"tranLock",renderer:function(i){if(i===""){return"0"}else{return i}}},{text:I18N_Util.getMsg("lblFreeDataSpace"),dataIndex:"data",width:150,renderer:function(i){if(i===""){return"--"}else{return i}}},{text:I18N_Util.getMsg("lblFreeIndexSpace"),dataIndex:"index",width:150,renderer:function(i){if(i===""){return"--"}else{return i}}},{text:I18N_Util.getMsg("lblFreeGenericSpace"),dataIndex:"generic",width:150,renderer:function(i){if(i===""){return"--"}else{return i}}},{text:I18N_Util.getMsg("lblTemp"),dataIndex:"temp",renderer:function(i){if(i===""){return"--"}else{if(typeof i==="number"){return""+i+" MB"}}}},{text:I18N_Util.getMsg("lblActiveLog"),dataIndex:"activeLog",renderer:function(i){if(i===""){return"--"}else{if(typeof i==="number"){return""+i+" MB"}}}}]};var f=Ext.create("Ext.panel.Panel",h);a.add(f);var c=Ext.create("Ext.grid.Panel",d);a.add(c)},createDetailWin:function(h){if(typeof h!=="string"){return}var c=this,e,a,f,d,g,b;if(h.indexOf("cpu")>-1){this.curDetailWinType="cpu";d={id:"cpuDetailWin",title:I18N_Util.getMsg("titleCpuDetail"),bodyPadding:"0 10px",width:this.winWidth,height:this.winHeight,minWidth:this.winMinWidth,minHeight:this.winMinHeight};g={id:"cpuChartInWin",height:this.chartInWinHeight,width:this.chartInWinWidth};b={id:"cpuGridInWin",isWin:true};gaugeProperty={id:"cpuGaugeInWin",height:this.gaugeHeightInWin,width:this.gaugeWidthInWin};e=Ext.create("cwm.widget.MonitorDetailWin",d);f=Ext.create("Ext.panel.Panel",{id:"cpuTitleInWin",border:0,layout:"hbox",items:[{xtype:"label",cls:"monitor_chart_title",width:this.gaugeWidthInWin,text:I18N_Util.getMsg("titleCpuCur")},{xtype:"label",cls:"monitor_chart_title",width:this.chartInWinWidth,text:I18N_Util.getMsg("titleCpuContinue")}]});e.add(f);a=Ext.create("Ext.panel.Panel",{border:0,layout:"hbox"});e.add(a);this.addCpuGaugeToContainer(a,gaugeProperty);this.addCpuChartToContainer(a,g);this.addCpuGridToContainer(e,b);this.synchronizeDetailWin()}else{if(h.indexOf("mem")>-1){this.curDetailWinType="mem";d={id:"memDetailWin",title:I18N_Util.getMsg("titleMemDetail"),bodyPadding:"0 10px",width:this.winWidth,height:this.winHeight,minWidth:this.winMinWidth,minHeight:this.winMinHeight};g={id:"memChartInWin",height:this.chartInWinHeight,width:this.chartInWinWidth};b={id:"memGridInWin",isWin:true};gaugeProperty={id:"memGaugeInWin",height:this.gaugeHeightInWin,width:this.gaugeWidthInWin};e=Ext.create("cwm.widget.MonitorDetailWin",d);f=Ext.create("Ext.panel.Panel",{id:"memTitleInWin",border:0,layout:"hbox",items:[{xtype:"label",cls:"monitor_chart_title",width:this.gaugeWidthInWin,text:I18N_Util.getMsg("titleMemCur")},{xtype:"label",cls:"monitor_chart_title",width:this.chartInWinWidth,text:I18N_Util.getMsg("titleMemContinue")}]});e.add(f);a=Ext.create("Ext.panel.Panel",{border:0,layout:"hbox"});e.add(a);this.addMemGaugeToContainer(a,gaugeProperty);this.addMemChartToContainer(a,g);this.addMemGridToContainer(e,b);this.synchronizeDetailWin()}else{if(h.indexOf("space")>-1){this.curDetailWinType="space";d={id:"spaceDetailWin",title:I18N_Util.getMsg("titleDiskSpaceDetail"),bodyPadding:"0 10px",width:this.winWidth,height:this.winHeight,minWidth:this.winMinWidth,minHeight:this.winMinHeight};gaugeProperty={id:"spaceGaugeInWin",height:this.gaugeHeightInWin,width:this.gaugeWidthInWin};pieProperty={id:"spacePieInWin",height:this.pieInWinHeight,width:this.pieInWinWidth};b={id:"spaceGridInWin",isWin:true};e=Ext.create("cwm.widget.MonitorDetailWin",d);f=Ext.create("Ext.panel.Panel",{id:"spaceTitleInWin",border:0,layout:"hbox",items:[{xtype:"label",cls:"monitor_chart_title",width:this.gaugeWidthInWin,text:I18N_Util.getMsg("titleSpaceUsed")},{xtype:"label",cls:"monitor_chart_title",width:this.chartInWinWidth,text:I18N_Util.getMsg("titleSpaceUsedRate")}]});e.add(f);a=Ext.create("Ext.panel.Panel",{border:0,layout:"hbox"});e.add(a);this.addSpaceGaugeToContainer(a,gaugeProperty);this.addSpacePieToContainer(a,pieProperty);this.addSpaceGridToContainer(e,b);this.synchronizeDetailWin("space")}}}},getCpuFakeData:function(){var c=Ext.cwm.chartTimeLength+1,d=new Array(),a=new Date(),e,b;for(b=0;b<c;b++){e=new Object();e.date=Ext.Date.add(a,Ext.Date.SECOND,Ext.cwm.monitorInterval*(-c+b));e.dbTotalCpuUsage=0;e.sysTotalCpuUsageForShow=0;d.push(e)}return d},getMemFakeData:function(){var c=Ext.cwm.chartTimeLength+1,d=new Array(),a=new Date(),e,b;for(b=0;b<c;b++){e=new Object();e.date=Ext.Date.add(a,Ext.Date.SECOND,Ext.cwm.monitorInterval*(-c+b));e.dbPhyMemUsed=0;e.sysPhyMemUsed="init";e.sysPhyMemUsedForShow=0;d.push(e)}return d},getSpaceFakeData:function(){var b=2,c=new Array(),d,a;for(a=0;a<b;a++){d=new Object();d.sysUsedSizeForShow=0;d.dbUsedSize=0;d.bottom=a;c.push(d)}return c},getHostPerformanceData:function(c){var a=this,b=a.getIsSendReq();if(b===true){Ext.getHostStat({success:function(d,e){Ext.cwm.monitorTaskReq.isLastSuc=true;if(c&&typeof c.success==="function"){c.success(d,e)}},failure:function(d,e){Ext.cwm.monitorTaskReq.isLastSuc=true;a.loadCpuAndMemDataWithOld()}})}else{a.loadCpuAndMemDataWithOld()}},getDbPerformanceData:function(c){if(typeof c!=="string"){c=this.dbName}var b=this,a,d=false;Ext.getDbProcStat(c,{success:function(e,f){Ext.cwm.monitorTaskReq.isLastSuc=true;a=Ext.decode(e.responseText);if(a&&a.status==="success"&&Ext.isArray(a.dbstat)){Ext.sortArray(a.dbstat,"dbname");d=b.computeDbPerformanceData(a.dbstat,Ext.cwm.oldDbProcStat,c);Ext.cwm.oldDbProcStat=a.dbstat;if(d===true&&b.cpuData.length>0&&b.memData.length>0){b.loadCpuAndMemData()}else{b.loadCpuAndMemDataWithOld()}}else{if(a&&a.status==="success"&&!a.dbstat){b.createDbPDataWithNoActiveDb();b.loadCpuAndMemData()}else{b.loadCpuAndMemDataWithOld()}}},failure:function(e,f){Ext.cwm.monitorTaskReq.isLastSuc=true;b.loadCpuAndMemDataWithOld()}})},getDbSpaceData:function(f,c,e){if(!Ext.isArray(f)||!Ext.isArray(c)){return}var b=this,a,d=Ext.createWaitWin();Ext.getDbSpace(f,{success:function(g,h){d.close();a=Ext.decode(g.responseText);if(a&&a.status==="success"){b.computeDbSpaceData(a,c);b.loadSpaceInfo();b.refreshDbSpaceUpdateTime()}else{if(a&&Ext.checkTokenStatus(a.note)){Ext.showFailureWin(I18N_Util.getMsg("msgFail2GetDbSpaceInfo",{note:a.note}))}}if(Ext.isFunction(e)){e()}},failure:function(g,h){d.close()}})},getSysDiskInfo:function(c){var b=this,a;if(typeof c==="function"){waitWin=Ext.createWaitWin()}Ext.getSysDiskInfo({success:function(d,e){a=Ext.decode(d.responseText);if(a&&a.status==="success"){b.computeDiskSpaceData(a.disk_info)}else{if(a&&Ext.checkTokenStatus(a.note)){Ext.showFailureWin(a.note)}}if(typeof c==="function"){waitWin.close();c()}},failure:function(d,e){if(typeof c==="function"){waitWin.close()}}})},getIsSendReq:function(){var a=false;if(Ext.cwm.monitorTaskReq.isLastSuc===true){a=true;Ext.cwm.monitorTaskReq.isLastSuc=false}return a},computeHostPerformanceData:function(b,g){if(!b||!g){return}var d=new Object(),f=new Object(),c=1024*1024;d.sysCpuUserDlt=parseInt(b.cpu_user)-parseInt(g.cpu_user);d.sysCpuKernelDlt=parseInt(b.cpu_kernel)-parseInt(g.cpu_kernel);d.sysCpuIoWaitDlt=parseInt(b.cpu_iowait)-parseInt(g.cpu_iowait);d.sysCpuIdleDlt=parseInt(b.cpu_idle)-parseInt(g.cpu_idle);if(d.sysCpuUserDlt<0||d.sysCpuKernelDlt<0||d.sysCpuIoWaitDlt<0||d.sysCpuIdleDlt<0){return false}d.sysCpuTotalDlt=d.sysCpuUserDlt+d.sysCpuKernelDlt+d.sysCpuIoWaitDlt+d.sysCpuIdleDlt;d.type=I18N_Util.getMsg("titleMonChartSystem");d.group=I18N_Util.getMsg("lblTotal");d.userCpuUsage=Math.round(d.sysCpuUserDlt/d.sysCpuTotalDlt*10000)/100;d.kernelCpuUsage=Math.round(d.sysCpuKernelDlt/d.sysCpuTotalDlt*10000)/100;d.IoWaitUsage=Math.round(d.sysCpuIoWaitDlt/d.sysCpuTotalDlt*10000)/100;d.totalCpuUsage=Math.round((d.userCpuUsage+d.kernelCpuUsage+d.IoWaitUsage)*100)/100;if(d.totalCpuUsage>100){d.totalCpuUsage=100}this.cpuData.push(d);f.type=I18N_Util.getMsg("titleMonChartSystem");f.group=I18N_Util.getMsg("lblTotal");f.phyMemFree=Math.round(parseInt(b.mem_phy_free)/c*100)/100;f.phyMemTotal=Math.round(parseInt(b.mem_phy_total)/c*100)/100;f.phyMemUsed=Math.round((f.phyMemTotal-f.phyMemFree)*100)/100;f.swapMemFree=Math.round(parseInt(b.mem_swap_free)/c*100)/100;f.swapMemTotal=Math.round(parseInt(b.mem_swap_total)/c*100)/100;f.swapMemUsed=Math.round((f.swapMemTotal-f.swapMemFree)*100)/100;this.memData.push(f);if(this.firstCpuAndMemLoading===true){this.firstCpuAndMemLoading=false;var a=this.totalMem;this.totalMem=f.phyMemTotal;if(a!==this.totalMem){if(this.curDetailWinType==="mem"){var e=Ext.getCmp("memDetailWin");if(e){this.changeChartYAxis("memChartInWin",e,this.totalMem)}}}}return true},computeDbPerformanceData:function(n,e,j){if(!n||!e||typeof j!=="string"){return}var b=new Object(),c,d,l,m,h,f,a=this.cpuData[0]["sysCpuTotalDlt"],g=a-this.cpuData[0]["sysCpuIdleDlt"],k=1024*1024;if(j===""){h=new Object();h.group=I18N_Util.getMsg("lblTotal");h.type=I18N_Util.getMsg("titleMonChartAllDatabase");h.dbCpuUserDlt=0;h.dbCpuKernelDlt=0;h.userCpuUsage=0;h.kernelCpuUsage=0;h.totalCpuUsage=0;f=new Object();f.group=I18N_Util.getMsg("lblTotal");f.type=I18N_Util.getMsg("titleMonChartAllDatabase");f.phyMemUsed=0;f.virtualMemUsed=0;for(d=0;d<e.length;d++){c=e[d]["dbname"];b[c]=e[d]}for(d=0;d<n.length;d++){if(Ext.isAuthedDb(n[d]["dbname"])!==true){continue}c=n[d]["dbname"];l=new Object();l.type=c;l.group=I18N_Util.getMsg("lblActiveDb");if(typeof b[c]!=="undefined"){l.dbCpuUserDlt=parseInt(n[d]["cpu_user"])-parseInt(b[c]["cpu_user"]);l.dbCpuKernelDlt=parseInt(n[d]["cpu_kernel"])-parseInt(b[c]["cpu_kernel"]);if(l.dbCpuKernelDlt<0||l.dbCpuUserDlt<0){return false}}else{l.dbCpuUserDlt=parseInt(n[d]["cpu_user"]);l.dbCpuKernelDlt=parseInt(n[d]["cpu_kernel"])}if(l.dbCpuUserDlt+l.dbCpuKernelDlt>g){return false}l.userCpuUsage=Math.round(l.dbCpuUserDlt/a*10000)/100;l.kernelCpuUsage=Math.round(l.dbCpuKernelDlt/a*10000)/100;l.totalCpuUsage=Math.round((l.userCpuUsage+l.kernelCpuUsage)*100)/100;this.cpuData.push(l);m=new Object();m.type=c;m.group=I18N_Util.getMsg("lblActiveDb");m.phyMemUsed=Math.round(parseInt(n[d]["mem_physical"])/k*100)/100;m.virtualMemUsed=Math.round(parseInt(n[d]["mem_virtual"])/k*100)/100;this.memData.push(m);h.dbCpuUserDlt+=l.dbCpuUserDlt;h.dbCpuKernelDlt+=l.dbCpuKernelDlt;h.userCpuUsage+=l.userCpuUsage;h.kernelCpuUsage+=l.kernelCpuUsage;h.totalCpuUsage+=l.totalCpuUsage;f.phyMemUsed+=m.phyMemUsed;f.virtualMemUsed+=m.virtualMemUsed}h.dbCpuUserDlt=Math.round(h.dbCpuUserDlt*100)/100;h.dbCpuKernelDlt=Math.round(h.dbCpuKernelDlt*100)/100;h.userCpuUsage=Math.round(h.userCpuUsage*100)/100;h.kernelCpuUsage=Math.round(h.kernelCpuUsage*100)/100;h.totalCpuUsage=Math.round(h.totalCpuUsage*100)/100;f.phyMemUsed=Math.round(f.phyMemUsed*100)/100;f.virtualMemUsed=Math.round(f.virtualMemUsed*100)/100;this.cpuData.splice(1,0,h);this.memData.splice(1,0,f)}else{}return true},createDbPDataWithNoActiveDb:function(){dbCpuTotal=new Object();dbCpuTotal.group=I18N_Util.getMsg("lblTotal");dbCpuTotal.type=I18N_Util.getMsg("titleMonChartAllDatabase");dbCpuTotal.dbCpuUserDlt=0;dbCpuTotal.dbCpuKernelDlt=0;dbCpuTotal.userCpuUsage=0;dbCpuTotal.kernelCpuUsage=0;dbCpuTotal.totalCpuUsage=0;dbMemTotal=new Object();dbMemTotal.group=I18N_Util.getMsg("lblTotal");dbMemTotal.type=I18N_Util.getMsg("titleMonChartAllDatabase");dbMemTotal.phyMemUsed=0;dbMemTotal.virtualMemUsed=0;this.cpuData.push(dbCpuTotal);this.memData.push(dbMemTotal)},computeDiskSpaceData:function(g){if(!Ext.isArray(g)){return}var c=0,e=0,b=1024*1024,f=new Object();for(var d=0;d<g.length;d++){c+=parseInt(g[d]["free_size"]);e+=parseInt(g[d]["total_size"])}if(isNaN(c)||isNaN(e)){alert("get disk space info error!");return}f.type=I18N_Util.getMsg("titleMonChartSystem");f.totalsize=Math.round(e/b*100)/100;f.freesize=Math.round(c/b*100)/100;f.usedsize=f.totalsize-f.freesize;f.usedsize=Math.round(f.usedsize*100)/100;f.usage=Math.round(f.usedsize/f.totalsize*10000)/100;f.group=I18N_Util.getMsg("lblTotal");this.spaceData.push(f);if(this.firstSpaceLoading===true){this.firstSpaceLoading=false;var a=this.totalSpace;this.totalSpace=f.totalsize;if(a!==this.totalSpace){this.changeChartYAxis("spaceChartInView",this,this.totalSpace);if(this.curDetailWinType==="space"){var h=Ext.getCmp("spaceDetailWin");if(h){this.changeChartYAxis("spaceChartInWin",h,this.totalSpace)}}}}},computeDbSpaceData:function(r,h){if(!r||!Ext.isArray(h)){return}var c=1024*1024,u=new Object();u.group=I18N_Util.getMsg("lblTotal");u.type=I18N_Util.getMsg("titleMonChartAllDatabase");u.freesize=0;u.usedsize=0;u.totalsize=0;for(var q=0;q<h.length;q++){var m=new Object();m.dbname=h[q].dbname;if(Ext.isArray(r[h[q].dbname])&&r[h[q].dbname][0]){var n=r[h[q].dbname][0];m.logpagesize=parseInt(n.logpagesize);m.pagesize=parseInt(n.pagesize);var p=n.spaceinfo;if(isNaN(m.logpagesize)||isNaN(m.pagesize)){continue}if(m.logpagesize<=0||m.pagesize<=0){continue}var d=new Object();var k=Ext.isArray(p);var b=new Object();var a=new Object();for(var o=0;k&&o<p.length;o++){var l=parseInt(p[o].freepage);var v=parseInt(p[o].totalpage);var g=new Object();if(!isNaN(v)&&p[o].type==="Archive_log"){a.type=p[o].type;a.group=I18N_Util.getMsg("lblDb")+": "+m.dbname;a.totalpage=v;a.totalsize=Math.round(v*m.logpagesize/c*100)/100;continue}if(!isNaN(v)&&p[o].type==="Active_log"){b.type=p[o].type;b.group=I18N_Util.getMsg("lblDb")+": "+m.dbname;b.totalpage=v;b.totalsize=Math.round(v*m.logpagesize/c*100)/100;continue}if(o!==0&&typeof d[p[o].type]!=="undefined"&&!isNaN(l)&&!isNaN(v)){g=d[p[o].type];g.freepage+=l;g.totalpage+=v}else{if(!isNaN(l)&&!isNaN(v)){g=new Object();g.freepage=l;g.totalpage=v;d[p[o].type]=g}}}for(var e in d){var s=d[e];var t=new Object();t.group=I18N_Util.getMsg("lblDb")+": "+m.dbname;t.type=e;t.freepage=s.freepage;t.totalpage=s.totalpage;t.usedpage=s.totalpage-s.freepage;t.freesize=Math.round(s.freepage*m.pagesize/c*100)/100;t.usedsize=Math.round((s.totalpage-s.freepage)*m.pagesize/c*100)/100;t.totalsize=Math.round(s.totalpage*m.pagesize/c*100)/100;t.usage=Math.round(t.usedsize/t.totalsize*10000)/100;u.freesize+=t.freesize;u.totalsize+=t.totalsize;this.spaceData.push(t)}u.totalsize+=b.totalsize;this.spaceData.push(b);u.totalsize+=a.totalsize;this.spaceData.push(a)}}u.usedsize=u.totalsize-u.freesize;u.freesize=Math.round(u.freesize*100)/100;u.usedsize=Math.round(u.usedsize*100)/100;u.totalsize=Math.round(u.totalsize*100)/100;u.usage=Math.round(u.usedsize/u.totalsize*10000)/100;var f=this.spaceData.splice(0,1);Ext.sortArray(this.spaceData,"group");this.spaceData.splice(0,0,f[0],u)},computeCasDataPerDb:function(p,b){if(!(Ext.isArray(p)&&Ext.isArray(b))){return}var n=this;var q,c,d=new Object(),m,l,a,g,f,e,s,r,o,h;for(g=0;g<b.length;g++){q=b[g]["asinfo"];if(g<p.length){c=p[g]["asinfo"];if(Ext.isArray(q)&&Ext.isArray(c)){for(f=0;f<q.length;f++){if(q[f]["as_dbname"]!==""){l=0,a=0,m=q[f]["as_dbname"];for(e=0;e<q.length;e++){if(q[f]["as_id"]===c[e]["as_id"]){s=parseInt(q[f]["as_num_query"]);r=parseInt(c[e]["as_num_query"]);o=parseInt(q[f]["as_long_query"]);h=parseInt(c[e]["as_long_query"]);if(!isNaN(s)&&!isNaN(r)){l=s-r}if(!isNaN(o)&&!isNaN(h)){a=o-h}l=l<0?0:l;a=a<0?0:a;break}}if(!d[m]){d[m]={cascnt:1,qps:l,lqs:a}}else{d[m]["cascnt"]++;d[m]["qps"]+=l;d[m]["lqs"]+=a}}}}else{if(Ext.isArray(q)){for(f=0;f<q.length;f++){if(q[f]["as_dbname"]!==""){l=0,a=0,m=q[f]["as_dbname"];s=parseInt(q[f]["as_num_query"]);o=parseInt(q[f]["as_long_query"]);if(!isNaN(s)){l=s}if(!isNaN(o)){a=o}if(!d[m]){d[m]={cascnt:1,qps:l,lqs:a}}else{d[m]["cascnt"]++;d[m]["qps"]+=l;d[m]["lqs"]+=a}}}}}}}for(g=0;g<n.dbStatusData.length;g++){m=n.dbStatusData[g]["dbname"];if(d[m]){n.dbStatusData[g]["cascnt"]=d[m]["cascnt"];n.dbStatusData[g]["qps"]=d[m]["qps"];n.dbStatusData[g]["lqs"]=d[m]["lqs"]}}},constructDbStatusData:function(f){var e=this;var d,c,b,a;for(d=0;d<e.dbStatusData.length;d++){dbName=e.dbStatusData[d]["dbname"];if(e.dbStatusData[d]["status"]===true){for(c=2;c<e.cpuData.length;c++){if(e.cpuData[c]["type"]===dbName){e.dbStatusData[d]["cpuPct"]=e.cpuData[c]["totalCpuUsage"]}}for(b=2;b<e.memData.length;b++){if(e.memData[b]["type"]===dbName){e.dbStatusData[d]["memPct"]=Math.round((e.memData[b]["phyMemUsed"]/e.totalMem)*10000)/100}}}for(a=2;a<e.spaceData.length;a++){if(e.spaceData[a]["group"]===I18N_Util.getMsg("lblDb")+": "+dbName){if(e.spaceData[a]["type"]==="DATA"){e.dbStatusData[d]["data"]=e.spaceData[a]["freesize"]+" MB/"+Math.round((100-e.spaceData[a]["usage"])*100)/100+"%"}if(e.spaceData[a]["type"]==="INDEX"){e.dbStatusData[d]["index"]=e.spaceData[a]["freesize"]+" MB/"+Math.round((100-e.spaceData[a]["usage"])*100)/100+"%"}if(e.spaceData[a]["type"]==="GENERIC"){e.dbStatusData[d]["generic"]=e.spaceData[a]["freesize"]+" MB/"+Math.round((100-e.spaceData[a]["usage"])*100)/100+"%"}if(e.spaceData[a]["type"]==="TEMP"){e.dbStatusData[d]["temp"]=e.spaceData[a]["totalsize"]}if(e.spaceData[a]["type"]==="Active_log"){e.dbStatusData[d]["activeLog"]=e.spaceData[a]["totalsize"]}}}}if(Ext.isFunction(f)){f()}},loadCpuAndMemData:function(){var f=this.down("#cpuGaugeInView"),d=this.down("#memGaugeInView"),c=this.down("#cpuGridInView"),a=this.down("#memGridInView"),h=new Object(),i=new Object(),g=new Date();if(f&&d&&c&&a&&Ext.isArray(this.cpuData)&&this.cpuData.length>=2&&Ext.isArray(this.memData)&&this.memData.length>=2){var b=new Array();b.push(this.cpuData[0]);b.push(this.cpuData[1]);c.getStore().loadData(b);var e=new Array();e.push(this.memData[0]);e.push(this.memData[1]);a.getStore().loadData(e);h.date=g;h.sysUserCpuUsage=this.cpuData[0]["userCpuUsage"];h.sysKernelCpuUsage=this.cpuData[0]["kernelCpuUsage"];h.sysIoWaitUsage=this.cpuData[0]["IoWaitUsage"];h.sysTotalCpuUsage=this.cpuData[0]["totalCpuUsage"];h.dbUserCpuUsage=this.cpuData[1]["userCpuUsage"];h.dbKernelCpuUsage=this.cpuData[1]["kernelCpuUsage"];h.dbTotalCpuUsage=this.cpuData[1]["totalCpuUsage"];h.sysTotalCpuUsageForShow=h.sysTotalCpuUsage-h.dbTotalCpuUsage;i.date=g;i.sysPhyMemFree=this.memData[0]["phyMemFree"];i.sysPhyMemUsed=this.memData[0]["phyMemUsed"];i.sysPhyMemTotal=this.memData[0]["phyMemTotal"];i.dbPhyMemUsed=this.memData[1]["phyMemUsed"];i.sysPhyUsage=Math.round(i.sysPhyMemUsed/i.sysPhyMemTotal*10000)/100;i.dbPhyUsage=Math.round(i.dbPhyMemUsed/i.sysPhyMemTotal*10000)/100;i.sysPhyMemUsedForShow=i.sysPhyMemUsed-i.dbPhyMemUsed;f.store.loadData([h]);d.store.loadData([i]);this.storeChartData(h,i);this.synchronizeDetailWin()}},loadSpaceInfo:function(){var d=this.down("#spaceGaugeInView"),a=this.down("#spaceGridInView"),c=new Object(),b=new Array();if(d&&a&&this.spaceData.length>=2){c.date=new Date();c.sysFreeSize=this.spaceData[0]["freesize"];c.sysUsedSize=this.spaceData[0]["usedsize"];c.sysTotalSize=this.spaceData[0]["totalsize"];c.sysSpaceUsage=this.spaceData[0]["usage"];c.dbUsedSize=this.spaceData[1]["usedsize"];c.dbSpaceUsage=Math.round(c.dbUsedSize/this.spaceData[0]["totalsize"]*10000)/100;c.sysUsedSizeForShow=Math.round((c.sysUsedSize-c.dbUsedSize)*100)/100;this.spaceChartData=c;d.store.loadData([c]);b.push(this.spaceData[0]);b.push(this.spaceData[1]);a.getStore().loadData(b);this.synchronizeDetailWin("space")}},loadCpuAndMemDataWithOld:function(){var d=this,b=new Date(),a=d.down("#cpuGaugeInView"),e=d.down("#memGaugeInView"),f,c;if(a&&e){f=Ext.clone(d.cpuChartData[d.cpuChartData.length-1]);f.date=b;c=Ext.clone(d.memChartData[d.memChartData.length-1]);c.date=b;a.store.loadData([f]);e.store.loadData([c]);d.storeChartData(f,c);d.synchronizeDetailWin("old")}},synchronizeDetailWin:function(e){if(this.curDetailWinType===""){return}var s,t;if(this.curDetailWinType==="cpu"&&e!=="space"){s=Ext.getCmp("cpuDetailWin");if(s){var l=s.down("#cpuChartInWin");var h=s.down("#cpuGridInWin");var o=s.down("#cpuGaugeInWin");if(l&&h&&o){l.updateTimeAxis();var g=l.axes.get(1);var u=this.cpuChartData[this.cpuChartData.length-1];this.cpuChartXAxisTitle=I18N_Util.getMsg("titleCpuChart",{sysTotalCpuUsage:u.sysTotalCpuUsage,dbTotalCpuUsage:u.dbTotalCpuUsage});g.setTitle(this.cpuChartXAxisTitle);var p=this.cpuChartData[this.cpuChartData.length-1];o.store.loadData([p]);if(e!=="old"){t=this.cpuData;h.getStore().loadData(t)}}}}else{if(this.curDetailWinType==="mem"&&e!=="space"){s=Ext.getCmp("memDetailWin");if(s){var q=s.down("#memChartInWin");var j=s.down("#memGridInWin");var r=s.down("#memGaugeInWin");if(q&&j&&r){q.updateTimeAxis();var m=q.axes.get(1);var i=this.memChartData[this.memChartData.length-1];this.memChartXAxisTitle=I18N_Util.getMsg("titleMemChart",{sysPhyMemUsed:i.sysPhyMemUsed,dbPhyMemUsed:i.dbPhyMemUsed});m.setTitle(this.memChartXAxisTitle);var n=this.memChartData[this.memChartData.length-1];r.store.loadData([n]);if(e!=="old"){t=this.memData;j.getStore().loadData(t)}}}}else{if(this.curDetailWinType==="space"&&e==="space"){s=Ext.getCmp("spaceDetailWin");if(s){var c=s.down("#spaceGridInWin");var d=s.down("#spaceGaugeInWin");var a=s.down("#spacePieInWin");if(d&&a&&c){var k=this.spaceChartData;d.store.loadData([k]);var b=[{name:I18N_Util.getMsg("titleDiskFree"),value:this.spaceChartData.sysFreeSize},{name:I18N_Util.getMsg("titleDiskDbUsed"),value:this.spaceChartData.dbUsedSize},{name:I18N_Util.getMsg("titleDiskOtherUsed"),value:this.spaceChartData.sysUsedSizeForShow}];a.store.loadData(b);var f=a.series.getAt(0);f.title=[I18N_Util.getMsg("titleSpacePieFree",{value:this.convertSizeToStr(this.spaceChartData.sysFreeSize)}),I18N_Util.getMsg("titleSpacePieDb",{value:this.convertSizeToStr(this.spaceChartData.dbUsedSize)}),I18N_Util.getMsg("titleSpacePieOther",{value:this.convertSizeToStr(this.spaceChartData.sysUsedSizeForShow)})];a.redraw();t=this.spaceData;c.getStore().loadData(t)}}}}}},startGetCpuAndMemDataTask:function(){var a=this;a.task={run:function(){a.getHostPerformanceData({success:function(b,c){a.cpuData=new Array();a.memData=new Array();json=Ext.decode(b.responseText);if(json&&json.status==="success"){isValid=a.computeHostPerformanceData(json,Ext.cwm.oldHostStat);Ext.cwm.oldHostStat=json;if(isValid===true){a.getDbPerformanceData()}else{a.loadCpuAndMemDataWithOld()}}else{a.loadCpuAndMemDataWithOld()}}})},interval:a.interval};Ext.TaskManager.start(a.task)},storeChartData:function(e,b){if(!e||!b){return}var d=this;d.cpuChartData.push(e);d.memChartData.push(b);var a=d.cpuChartData.length-Ext.cwm.chartTimeLength;if(a>0){Ext.Array.splice(d.cpuChartData,0,a)}var c=d.memChartData.length-Ext.cwm.chartTimeLength;if(c>0){Ext.Array.splice(d.memChartData,0,c)}},refreshSpaceInfo:function(f){var c=this,d=new Array(),b,a=new Object(),e=new Array();this.spaceData=new Array();if(Ext.dblist.length<1){var f=function(){var g=new Object();g.group=I18N_Util.getMsg("lblTotal");g.type=I18N_Util.getMsg("titleMonChartAllDatabase");g.freesize=0;g.usedsize=0;g.totalsize=0;g.usage=0;c.spaceData.push(g);c.loadSpaceInfo()};c.getSysDiskInfo(f);if(Ext.isFunction(f)){f()}}else{c.getSysDiskInfo();for(b=0;b<Ext.dblist.length;b++){a[Ext.dblist[b]["name"]]=Ext.dblist[b]["name"];d.push({dbname:Ext.dblist[b]["name"]})}e.push(a);c.getDbSpaceData(e,d,function(){if(Ext.isFunction(f)){f()}})}},refreshDbStatus:function(h){var g=this;g.dbStatusData=new Array();var i=new JSEX();var a=function(){Ext.getCurCmUserAuthInfo({success:function(j,k){i.next()}})};var f=function(){Ext.getDatabaseList({success:function(j,k){i.next()}})};var e=function(){g.refreshSpaceInfo(function(){i.next()})};var b=function(){Ext.getDbLockInfo(function(){var j,k;for(k=0;k<Ext.dblist.length;k++){j=new Object();j.dbname=Ext.dblist[k].name;j.status=Ext.dblist[k].isOpened;j.tranLock=Ext.dblist[k].lockNum;g.dbStatusData.push(j)}i.next()})};var c=function(){var j="";var l=Ext.cookieUtil.getAllBrokers();if(Ext.isArray(l)){for(var k=0;k<l.length;k++){j+=l[k]["name"]+","}j=j.substring(0,j.length-1)}else{i.next()}var n=new Array(),m=new Array();Ext.getBrokerStatus(j,{success:function(p,q){var r=Ext.decode(p.responseText);if(Ext.isArray(r.broker)){n=r.broker}else{if(Ext.isArray(r.asinfo)&&r.bname===j){n=[{asinfo:r.asinfo,bname:r.bname,time:r.time}]}else{if(!Ext.isArray(r.asinfo)&&r.bname===j){n=[{asinfo:null,bname:r.bname,time:r.time}]}}}var o=new Ext.util.DelayedTask(function(){Ext.getBrokerStatus(j,{success:function(s,t){var u=Ext.decode(s.responseText);if(Ext.isArray(u.broker)){m=u.broker}else{if(Ext.isArray(u.asinfo)&&u.bname===j){m=[{asinfo:u.asinfo,bname:u.bname,time:u.time}]}}g.computeCasDataPerDb(n,m);i.next()},failure:function(s,t){i.next()}})});o.delay(1000)},failure:function(o,p){i.next()}})};var d=function(){g.constructDbStatusData(function(){var j=g.down("#statusGridInView");if(j){j.getStore().loadData(g.dbStatusData)}g.dbStatusData=new Array();g.refreshDbStatusUpdateTime()})};if(h==="init"){i.push(b);i.push(c);i.push(d);i.exec()}else{i.push(a);i.push(f);i.push(e);i.push(b);i.push(c);i.push(d);i.exec()}},changeChartYAxis:function(d,a,c){if(!d||typeof d!=="string"||!a||typeof c!=="number"){return}var b=a.down("#"+d);if(b){b.axes.get(0).maximum=c;b.redraw()}},stopTask:function(){Ext.cwm.monitorTaskReq.isLastSuc=true;if(this.task){Ext.TaskManager.stop(this.task)}},convertSizeToStr:function(b){if(isNaN(b)){return b}var a;var c=1024;if(b>=c){a=""+Math.round(b/c*100)/100+" GB"}else{a=""+b+" MB"}return a},refreshDbSpaceUpdateTime:function(){var b=this;var a=b.down("#DbSpaceUpdateTime");if(a){a.setText(I18N_Util.getMsg("msgLatestUpdateTime")+Ext.Date.format(new Date(),"Y/m/d H:i:s"))}},refreshDbStatusUpdateTime:function(){var b=this;var a=b.down("#DbStatusUpdateTime");if(a){a.setText(I18N_Util.getMsg("msgLatestUpdateTime")+Ext.Date.format(new Date(),"Y/m/d H:i:s"))}},initComponent:function(){this.callParent(arguments);this.initParams();this.addComponents();if(!Ext.cookieUtil.getAllBrokers()){Ext.getAllBrokersNameAndPort()}}});Ext.define("cwm.view.Operations",{extend:"Ext.panel.Panel",alias:"widget.operations",margin:10,component:{dynPanel:0},bodyStyle:"background : transparent; border : none",requires:["cwm.widget.createTableWnd","cwm.widget.DropDbVerify","cwm.widget.BackupPanel"],updateTableName:function(a){this.up("tablestruct").tableName=a;this.tablename=a;Ext.getTableInfoByCCI(this.dbname,a,{success:function(b,c){}})},createDbOperation:function(){var b=this;var d=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none;",layout:"column",margin:"0 0 10 0",items:[{xtype:"panel",title:I18N_Util.getMsg("titleCreateTable"),layout:"column",cls:"infoPanel",items:[{xtype:"panel",border:0,layout:"column",items:[{xtype:"textfield",id:"operation-table-name",margin:10,fieldLabel:I18N_Util.getMsg("lblTableName"),labelWidth:80,width:200,regex:/^[\w-]+$/,invalidText:I18N_Util.getMsg("msgInvalidTableName")},{xtype:"numberfield",id:"operation-field-count",margin:10,labelWidth:100,width:150,allowBlank:false,allowDecimals:false,minValue:1,maxValue:20,value:1,fieldLabel:I18N_Util.getMsg("lblColumnNumber")}]},{xtype:"button",margin:10,text:I18N_Util.getMsg("btnGo"),handler:function(){var f=Ext.getCmp("operation-table-name");var m=Ext.getCmp("operation-field-count");if(typeof f=="undefined"||f==null||typeof m=="undefined"||m==null){return}if(!f.isValid()||f.getValue().length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidTableName"));return}else{if(!m.isValid()){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidColumnNum"));return}}var j=f.getValue();var g=m.getValue();var l=false;var k=Ext.getDbIndex(Ext.currentDb);var e=Ext.dblist[k].tables;for(var h=0;h<e.length;h++){if(j.toLowerCase()===e[h].name.toLowerCase()){l=true;break}}if(l){Ext.showErrorWin(I18N_Util.getMsg("msgTableNameDuplicate"));return}f.setValue("");m.setValue(1);var n=Ext.create("cwm.widget.createTableWnd",{title:I18N_Util.getMsg("titleCreateTable"),tbname:j,colCount:g});n.insertBlankRow(true);for(var h=1;h<g;h++){n.insertBlankRow(false)}n.show()}}]}]});var c=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none;",layout:"column",margin:"0 0 10 10",hidden:Ext.cookieUtil.getDbmtUserName()==="admin"?false:true,items:[{xtype:"panel",title:I18N_Util.getMsg("titleRemoveDb"),width:200,cls:"infoPanel",items:[{xtype:"button",margin:10,text:'<font color="red">'+I18N_Util.getMsg("btnDropDb")+"</font>",handler:function(){Ext.Msg.show({title:I18N_Util.getMsg("titleWarning"),msg:'<span style="color:red;white-space: nowrap;">'+I18N_Util.getMsg("msgCfmDropDb",{dbname:b.dbname})+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(h,i,f){if(h=="yes"){var g=function(){Ext.deleteDb(b.dbname,{success:function(j,m){try{var n=new JSEX();var l=function(){if(Ext.cookieUtil.getDbmtUserName()!=="admin"){Ext.getCurCmUserAuthInfo({success:function(p,q){n.next()}})}else{n.next()}};var k=function(){Ext.getDatabaseList({success:function(p,s){var q=Ext.getCmp("leftPanel");q.removeLists();q.createDbLists(Ext.dblist);var r=Ext.getCmp("rightPanel");r.goHome();Ext.currentDb="";var t=Ext.getCmp("bread-crumb-navigator");if(t){t.clear()}}})};n.push(l);n.push(k);n.exec()}catch(o){Ext.Trace("operation in database:"+o)}}},true)};var e=Ext.cookieUtil.getDbmtUserName();Ext.create("cwm.widget.DropDbVerify",{username:e,title:I18N_Util.getMsg("titleCMSUserAuth"),fn:function(k,l,j){if(k==="ok"){Ext.VerifyAdminPassword(l,j,function(m){if(m){g();var n=Ext.getCmp("adminAuthWin");if(n!=null){n.close()}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrPass"))}})}}}).show()}}})}}]}]});var a=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none; margin-right : 10px",layout:"column",margin:"0 0 10 0",items:[d,c]});this.add(a)},createTableOperation:function(){var a=this;var c=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none; margin-right : 10px",layout:"column",margin:"0 0 10 0",items:[{xtype:"panel",cls:"infoPanel",title:I18N_Util.getMsg("titleTableOpt"),width:300,items:[{xtype:"textfield",margin:10,labelWidth:120,value:a.tablename,regex:/^[\w-]+$/,invalidText:I18N_Util.getMsg("msgInvalidTableName"),fieldLabel:I18N_Util.getMsg("lblRenameTableTo")},{xtype:"button",margin:10,text:I18N_Util.getMsg("btnGo"),handler:function(){var e=this.up("panel").getComponent(0).getValue();if(!Ext.VerifyTextInput(e)){Ext.showErrorWin(I18N_Util.getMsg("msgInvalidTableName"));return}var f='RENAME TABLE "'+a.tablename+'" AS "'+e+'"';var d=function(){Ext.QueryByCCIWithWaitBox(Ext.currentDb,[f],{success:function(g,h){var i=Ext.decode(g.responseText);if(i.status!=1000){if(Ext.checkDbLoginStatusWhenCCI(i.status,i.note)){Ext.showErrorWin(Ext.htmlEncode(i.note))}return}if(i.result[0].status!=0){Ext.showErrorWin(Ext.htmlEncode(i.result[0].note));return}Ext.getTableList(Ext.currentDb,{success:function(j,l){var k=Ext.getCmp("leftPanel");if(k){k.refresh()}var m=Ext.getCmp("bread-crumb-navigator");if(m){m.setTable(Ext.currentDb,e)}Ext.showSuccessWin(I18N_Util.getMsg("msgSucRenameTable"),function(){a.updateTableName(e)})}})}})};Ext.Msg.show({title:"Warning",msg:'<span style="white-space:nowrap;">'+I18N_Util.getMsg("msgCfmRenameTable",{oldname:Ext.htmlEncode(a.tablename),newname:Ext.htmlEncode(e)})+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(h,i,g){if(h=="yes"){d()}}})}}]}]});var b=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none; margin-right : 10px",layout:"column",margin:"0 0 10 0",items:[{xtype:"panel",title:I18N_Util.getMsg("titleDelTableOrData"),width:240,cls:"infoPanel",items:[{xtype:"button",margin:10,text:'<font color="red">'+I18N_Util.getMsg("btnTruncateTable")+"</font>",handler:function(){Ext.Msg.show({title:"Warning",msg:'<span style="color:red;white-space: nowrap;">'+I18N_Util.getMsg("msgCfmTruncateTable",{tablename:Ext.htmlEncode(a.tablename)})+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(f,g,e){if(f=="yes"){var d=Ext.cookieUtil.getDbUserName(Ext.currentDb);Ext.create("cwm.widget.DropDbVerify",{username:d,title:I18N_Util.getMsg("titleDbUserAuth"),fn:function(i,j,h){if(i==="ok"){Ext.userLogin(a.dbname,j,h,{success:function(k,l){Ext.cookieUtil.setDbUserPwd(a.dbname,h);Ext.TruncateTables(a.dbname,[a.tablename]);var m=Ext.getCmp("adminAuthWin");if(m!=null){m.close()}}})}}}).show()}}})}},{xtype:"button",margin:10,text:'<font color="red">'+I18N_Util.getMsg("btnDropTable")+"</font>",handler:function(){Ext.Msg.show({title:"Warning",msg:'<span style="color:red;white-space: nowrap;">'+I18N_Util.getMsg("msgCfmDropTable",{tablename:Ext.htmlEncode(a.tablename)})+"</span>",closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(f,g,e){if(f=="yes"){var h=function(){var i='DROP TABLE "'+a.tablename+'";';Ext.QueryByCCI(a.dbname,[i],{success:function(j,l){var m=Ext.decode(j.responseText);if(m.status==1000){if(m.result[0].status!=0){var k=Ext.htmlEncode(m.result[0].note);Ext.showErrorWin('<span style="color:red">'+I18N_Util.getMsg("msgErrOccur")+"</span><br><br>"+I18N_Util.getMsg("msgErrDetail")+'<br><br><div style="overflow:auto; height:100px">'+k+"</div>");return}Ext.getTableList(a.dbname,{success:function(n,q){Ext.showSuccessWin(I18N_Util.getMsg("msgSucDrop"));var r=Ext.getCmp("bread-crumb-navigator");if(r){r.setDatabase(a.dbname)}var o=Ext.getCmp("leftPanel");if(o){o.refresh()}var p=Ext.getCmp("rightPanel");p.showTablesOfDatabase(a.dbname)}})}else{Ext.showErrorWin(Ext.htmlEncode(m.note))}}})};var d=Ext.cookieUtil.getDbUserName(Ext.currentDb);Ext.create("cwm.widget.DropDbVerify",{username:d,title:I18N_Util.getMsg("titleDbUserAuth"),fn:function(j,k,i){if(j==="ok"){Ext.userLogin(a.dbname,k,i,{success:function(l,m){Ext.cookieUtil.setDbUserPwd(a.dbname,i);h();var n=Ext.getCmp("adminAuthWin");if(n!=null){n.close()}}})}}}).show()}}})}}]}]});this.add(c);this.add(b)},createBackupPlanEditor:function(c){var b=this;var a=Ext.create("cwm.widget.BackupPlanEditor",{initVal:c});a.addListener("onok",function(){b.create("db")});this.add(a)},create:function(f,a){var g=this;var d=this.items.length;for(var c=0;c<d;c++){var b=this.getComponent(0);if(b){this.remove(b,true)}}if(typeof f!="undefined"&&f==="db"){this.createDbOperation();var e=Ext.create("cwm.widget.BackupPanel",{});this.add(e);e.addListener("addbkupplan",function(h){g.create("planeditor",h)});e.getPlans(this.dbname)}else{if(typeof f!="undefined"&&f==="table"){this.createTableOperation()}else{this.createBackupPlanEditor(a)}}},initComponent:function(){this.callParent(arguments)}});Ext.define("cwm.view.Privileges",{extend:"Ext.panel.Panel",alias:"widget.privileges",requires:["cwm.widget.privileges.UserList","cwm.widget.privileges.AddUser","cwm.widget.privileges.EditUser","cwm.widget.privileges.ChangeDbUserPwd","cwm.widget.privileges.DbAuth","cwm.widget.privileges.DbUserGroup","cwm.widget.privileges.NewUserInf",],bodyStyle:"border: 0;background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;",defaults:{border:0},items:[{itemId:"titleBar",html:'<div class="privileges"><h2>'+I18N_Util.getMsg("titleDbUserOverview")+"</h2></div>"}],createUserList:function(b){var c=this;var a=Ext.create("cwm.widget.privileges.UserList",{dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",hidden:!c.isDba,items:[{icon:Ext.ImagePath+"user_add.png",text:I18N_Util.getMsg("btnAdd"),tooltip:I18N_Util.getMsg("msgAddUser"),scope:this,handler:function(){c.createAddUser()}}]}]});this.add(a)},createEditUser:function(b){var c=this;var a=Ext.create("cwm.widget.privileges.EditUser",{isDba:c.isDba,loginUser:Ext.cwm.curDbUser,userName:b.get("name"),id:"EditUserWin"});this.add(a)},createAddUser:function(){var a=Ext.create("cwm.widget.privileges.AddUser",{id:"AddUserWin"});this.add(a)},initComponent:function(){this.callParent(arguments);this.isDba=Ext.cwm.curDbUserIsDba;this.createUserList()}});var SYS_COL_ROW_OID="~SYS_ROW_OID~",SYS_COL_ROW_NUM="~SYS_ROW_NUM~",SYS_COL_ERR_INF="~SYS_ERROR_INFO~";Ext.define("cwm.view.QueryEditorView",{extend:"Ext.panel.Panel",CCI_URL:Ext.cciApi,alias:"widget.queryEditorView",itemId:"queryEditorView",border:0,layout:"auto",initComponent:function(){this.callParent(arguments);var b=Ext.create("Ext.panel.Panel",{itemId:"queryEditorPanel",height:150,border:0,layout:{type:"hbox",align:"stretch"}});var a=Ext.create("Ext.toolbar.Toolbar",{itemId:"helperToolBar",border:0});b.add({itemId:"helperButtonBarPanel",border:0,bodyStyle:"border: 0px;",style:"background: none repeat scroll 0 0 #F3F3F3;",defaults:{width:80,margin:"0 2 2 0"},layout:{type:"vbox"},hidden:true});b.add({itemId:"queryEditorTextareaPanel",margin:"0",style:"border: 1px solid #000000;",border:0,flex:4,anchor:"100%",html:'<textarea id="'+this.queryTextareaDomId+'" style="width:100%; height:100%; resize:none"></textarea>',queryTextareaDomId:this.queryTextareaDomId,initQueryStatements:this.initQueryStatements,editorInstance:null,listeners:{afterrender:function(h,f){var e=Ext.getDom(h.queryTextareaDomId);e.focus();var g=CodeMirror.fromTextArea(e,{lineNumbers:true,matchBrackets:true,mode:"text/x-cubrid",indentUnit:4,lineWrapping:true,autofocus:true,matchBrackets:true});g.setValue(h.initQueryStatements);g.setOption("lineNumbers",true);h.editorInstance=g}}});this.add(b);this.enableMetaTable=false;if(this.metaTableName!=null&&Ext.String.trim(this.metaTableName)!=""){this.enableMetaTable=true}if(this.enableMetaTable){this.addMetaTableNavigator(this.metaTableName,b)}var c=Ext.create("Ext.toolbar.Toolbar",{itemId:"queryEditorToolBar",margin:"0 0 0 80",border:0});var d=b.down("#queryEditorTextareaPanel");this.add({itemId:"queryEditorButtonBarPanel",border:0,bodyStyle:"border: 0px;",style:"background: none repeat scroll 0 0 #ffffff;",buttonAlign:"left",buttons:c});c.add({text:I18N_Util.getMsg("btnRun"),tooltip:I18N_Util.getMsg("msgExecSqlScript"),itemId:"buttonRun",handler:function(e,f){var h=b.up("#queryEditorView");var g=h.getSelectedSQLScript();h.runSql(h,g)}});c.add({text:I18N_Util.getMsg("btnClear"),tooltip:I18N_Util.getMsg("msgClearSqlScript"),itemId:"buttonClear",handler:function(f,h){var i=b.up("#queryEditorView");var g=i.getEditorTextareaPanel();var e=g.editorInstance;e.setValue("")}});c.add({itemId:"buttonHide",text:I18N_Util.getMsg("btnHide"),tooltip:I18N_Util.getMsg("msgHideSqlEditor"),handler:function(e,f){var h=b.up("#queryEditorView");var g=h.down("#queryEditorPanel");h.showSqlEditor(g.isHidden())}})},showSqlEditor:function(b){var f=this;var e=f.down("#queryEditorPanel");var g=f.down("#helperButtonBarPanel");var c=f.down("#buttonRun");var d=f.down("#buttonClear");var a=f.down("#buttonHide");if(b){e.show();g.show();a.setText(I18N_Util.getMsg("btnHide"));a.setTooltip(I18N_Util.getMsg("msgHideSqlEditor"));c.show();d.show()}else{e.hide();g.hide();a.setText(I18N_Util.getMsg("btnShow"));a.setTooltip(I18N_Util.getMsg("msgShowSqlEditor"));c.hide();d.hide()}},getEditorTextareaPanel:function(){return this.down("#queryEditorPanel").down("#queryEditorTextareaPanel")},getSelectedSQLScript:function(){var b=this.getEditorTextareaPanel();var a=b.editorInstance;var c=a.getSelection();if(c==""){c=a.getValue()}return c},extractQuerys:function(d){var g=new Array();for(var a=0;a<d.length;a++){var b=d.charAt(a);if(b=='"'||b=="'"){for(a++;a<d.length;a++){if(d.charAt(a)==b){break}}continue}if(b=="-"){var f=a+1;b=d.charAt(f);if(b=="-"){var e=d.indexOf("\n",f);if(e<0){d=d.substring(0,f-1)}else{d=d.substring(0,f-1)+d.substring(e)}}continue}if(b==";"){var c=d.substring(0,a);c=Ext.String.trim(c);if(c!=""){g.push(this.limitQuerySql(c))}d=d.substring(a+1);a=-1;continue}}d=Ext.String.trim(d);if(d!=""){g.push(this.limitQuerySql(d))}return g},limitQuerySql:function(e){if(typeof e!=="string"||Ext.String.trim(e)===""){return e}var f=this;var h=Ext.String.trim(e).toLowerCase();var j=/^select\s$/;if(h.length<7||!j.test(h.substring(0,7))||!f.isHasFromClause(h)){return e}var g=new Array();var c=new Array();var a,b;for(var d=0;d<h.length;d++){a=h.charAt(d);if(a==="("){c.push(d)}else{if(a===")"){if(c.length<=0){return e}b=c.pop();g.push({type:"BRACKET",start:b,end:d})}else{if(d-1>0&&a=="'"&&h.charAt(d-1)!="\\"){b=d;d=f.getSingleQuoteEndPos(h,d+1);if(d<0){return e}g.push({type:"SINGLE_QUOTE",start:b,end:d})}else{if(d-1>0&&a=='"'&&e.charAt(d-1)!="\\"){b=d;d=f.getDoubleQuoteEndPos(e,d+1);if(d<0){return e}g.push({type:"DOUBLE_QUOTE",start:b,end:d})}}}}}if(c.length>0||f.isHasOuterClause(h,g)||f.isHasOuterByClause(h,g)||f.isHasOuterJoinClause(h,g)||f.isHasAggregationFunction(h,g)||f.isHasOuterMultiClause(h,g)||f.isHasKeyWord(h,g)||!f.isHasFromClause(h,g)){return e}return e+=" LIMIT "+Ext.cwm.sqlLimitCount},isHasOuterClause:function(m,h){var a=["where","union","difference","intersect"];var n=/^\s$/;for(var c=0;c<a.length;c++){var g=a[c];var d=0;var f=0;while(d<m.length&&(f=m.indexOf(g,d))>0){d=f+g.length;var j=" ";if(f>1){j=m.charAt(f-1)}var e=" ";if(d<m.length){e=m.charAt(d)}if(n.test(j)&&n.test(e)){var b=true;for(var l=0;l<h.length;l++){if(h[l].start<f&&f<h[l].end){b=false;break}}if(b){return true}}}}return false},isHasOuterByClause:function(n,j){var a=["order","group","connect"];var o=/^\s$/;for(var b=0;b<a.length;b++){var g=a[b];var c=0;var f=0;while(c<n.length&&(f=n.indexOf(g,c))>=0){c=f+g.length;var d=-1;if(c<n.length){d=n.indexOf("by",c)}if(d>0&&o.test(n.substring(c,d))){c=d+2;var l=" ";if(f>1){l=n.charAt(f-1)}var e=" ";if(c<n.length){e=n.charAt(c)}if(o.test(l)&&o.test(e)){var h=true;for(var m=0;m<j.length;m++){if(j[m].start<f&&f<j[m].end){h=false;break}}if(h){return true}}}}}return false},isHasOuterJoinClause:function(o,l){var c=["left","right"];var p=/^\s$/;for(var b=0;b<c.length;b++){var j=c[b];var d=0;var h=0;while(d<o.length&&(h=o.indexOf(j,d))>=0){d=h+j.length;var e=-1;if(d<o.length){e=o.indexOf("outer",d)}if(e>0&&p.test(o.substring(d,e))){d=e+5;var f=-1;if(d<o.length){f=o.indexOf("join",d)}if(f>0&&p.test(o.substring(d,f))){d=f+4;var m=" ";if(h>1){m=o.charAt(h-1)}var g=" ";if(d<o.length){g=o.charAt(d)}if(p.test(m)&&p.test(g)){var a=true;for(var n=0;n<l.length;n++){if(l[n].start<h&&h<l[n].end){a=false;break}}if(a){return true}}}}}}return false},isHasAggregationFunction:function(n,j){var e=["sum","count","min","max","avg","stddev","variance","unique","distinct"];var o=/^\s$/,a=/^\($/;for(var c=0;c<e.length;c++){var f=e[c];var d=0;var h=0;while(d<n.length&&(h=n.indexOf(f,d))>0){d=h+f.length;var l=" ";if(h>1){l=n.charAt(h-1)}var g=" ";if(d<n.length){g=n.charAt(d)}if(o.test(l)&&(o.test(g)||a.test(g))){var b=true;for(var m=0;m<j.length;m++){if(j[m].start<h&&h<j[m].end){b=false;break}}if(b){return true}}}}return false},isHasOuterMultiClause:function(q,l){var e=[["with","increment","for"],["with","decrement","for"],["start","with"]];var r=/^\s$/;for(var c=0;c<e.length;c++){var n=e[c];var d=0;var j=0;var f;while(d<q.length&&(j=q.indexOf(n[0],d))>0){var h="";for(var a=0;a<n.length;a++){h+=n[a]+"s+"}h+=".+";f=new RegExp(h,"g");if(!f.test(q.substring(j))){d=j+n[0].length;continue}d=q.indexOf(n[n.length-1],j)+n[n.length-1].length;var o=" ";if(j>1){o=q.charAt(j-1)}var g=" ";if(d<q.length){g=q.charAt(d)}if(r.test(o)&&r.test(g)){var b=true;for(var p=0;p<l.length;p++){if(l[p].start<j&&j<l[p].end){b=false;break}}if(b){return true}}}}return false},isHasKeyWord:function(n,g){var d=["unique","distinct","limit"];var o=/^\s$/;var p=/^\"$/;var a=/^\*$/;for(var b=0;b<d.length;b++){var l=d[b];var c=0;var f=0;while(c<n.length&&(f=n.indexOf(l,c))>0){c=f+l.length;var j=" ";if(f>1){j=n.charAt(f-1)}var e=" ";if(c<n.length){e=n.charAt(c)}if(o.test(j)&&(o.test(e)||p.test(e)||a.test(e))){var h=true;for(var m=0;m<g.length;m++){if(g[m].start<f&&f<g[m].end){h=false;break}}if(h){return true}}}}return false},isHasFromClause:function(j,f){var d="from";var k=/^\s$/;var b=0;var c=0;while(b<j.length&&(c=j.indexOf(d,b))>0){if(!Ext.isArray(f)){return true}b=c+d.length;var g=" ";if(c>1){g=j.charAt(c-1)}var e=" ";if(b<j.length){e=j.charAt(b)}if(k.test(g)&&k.test(e)){var a=true;for(var h=0;h<f.length;h++){if(f[h].start<c&&c<f[h].end){a=false;break}}if(a){return true}}}return false},getSingleQuoteEndPos:function(b,c){for(var a=c;a<b.length;a++){if(b.charAt(a)==="'"&&b.charAt(a+1)!=="\\"){return a}}return -1},getDoubleQuoteEndPos:function(b,c){for(var a=c;a<b.length;a++){if(b.charAt(a)==='"'&&b.charAt(a+1)!=="\\"){return a}}return -1},getOuterUsingClausePos:function(j,f){var c=0;var d=0;var k=/^\s$/;while(c<j.length&&(d=j.indexOf("using",c))>=0){c=d+5;var a=-1;if(c<j.length){a=j.indexOf("index",c)}if(a>0&&k.test(j.substring(c,a))){c=a+5;var g=" ";if(d>1){g=j.charAt(d-1)}var e=" ";if(c<j.length){e=j.charAt(c)}if(k.test(g)&&k.test(e)){var b=true;for(var h=0;h<f.length;h++){if(f[h].start<d&&d<f[h].end){b=false;break}}if(b){return d}}}}return -1},addToolBarButton:function(b){var c=this.down("#queryEditorButtonBarPanel");var a=c.down("#queryEditorToolBar");a.add(b)},runSql:function(e,d){var f=e.extractQuerys(d);if(f==null||f.length<=0){return}var a=e.ownerCt;if(a!=null&&a.isXType("window")&&!a.isMaximized){a.setHeight("80%")}e.remove("queryResultView");var c=Ext.create("Ext.panel.Panel",{region:"center",itemId:"queryResultView",border:0});e.add(c);var b=function(h){if(!e.serverResponseStatusOK(h)){return}var m=h.result;if(m==null){return}var g=null;var k=true;var o="";e.sqlExecResultArr=m;for(var j=0;j<m.length;j++){if(m[j].status==0){if(m[j].stmt_type==21){g=j;o+=Ext.htmlEncode(f[j])+'; <span style="color:green">-- '+I18N_Util.getMsg("msgSucSqlReturnInfo",{count:m[j].exec_retval,interval:(m[j].__EXEC_TIME*0.001).toFixed(3)})+'</span>&nbsp;&nbsp;<span style="cursor:pointer; color:#235A81" onclick="Ext.getCmp(\''+e.id+"').showQueryPlan("+j+');">['+I18N_Util.getMsg("lblExplainSql")+"]</span><br>"}else{o+=Ext.htmlEncode(f[j])+'; <span style="color:green">-- '+I18N_Util.getMsg("msgSucSqlReturnInfo",{count:m[j].exec_retval,interval:(m[j].__EXEC_TIME*0.001).toFixed(3)})+"</span><br>"}}else{k=false;var n=Ext.create("Ext.panel.Panel",{margin:"0 0 5 0",bodyStyle:"background-color : pink;",layout:"column",items:[{padding:"5 5 5 5",border:0,height:80,autoScroll:true,bodyStyle:"background : transparent;",html:'<img src="'+Ext.ImagePath+'s_error.png"/><div>'+I18N_Util.getMsg("msgErrSqlInfo",{status:m[j].status,note:Ext.htmlEncode(m[j].note)})+"</div><br><div>"+I18N_Util.getMsg("msgErrSqlStmt",{sql:Ext.htmlEncode(f[j])})+"</div>"}]});c.add(n);return}}if(k){var n=Ext.create("Ext.panel.Panel",{margin:"0 0 5 0",bodyStyle:"background : #EBF8A4",layout:"column",items:[{xtype:"image",padding:"5 5 5 5",src:Ext.ImagePath+"s_success.png"},{padding:"5 5 5 5",border:0,bodyStyle:"background : transparent",html:I18N_Util.getMsg("msgSucExecSql")}]});c.add(n);var l=Ext.create("Ext.panel.Panel",{border:0,margin:"0 0 5 0",height:80,autoScroll:true,bodyStyle:"background: #F3F3F3;",html:'<div style="padding: 5px;">'+o+"</div>"});c.add(l);if(g!=null){e.showQueryResultGrid(c,f[g],Ext.cwm.queryDefaultPageSize,1)}}};this.executeSqlRemoteWithQueryPlan(f,0,0,0,0,b)},showQueryResultGrid:function(b,e,a,d){a=Math.floor(a);d=Math.floor(d);var f=b.up("#queryEditorView");var c=function(B){if(!f.serverResponseStatusOK(B)){return}if(e==null||Ext.String.trim(e)==""){return}var y=B.result[0];if(y.status!=0){return}if(y.values==null){y.values=[]}var K=y.values.length;var O=y.exec_retval;if(O==null){O=0}var r=Math.ceil(O/a);if(r<=0){r=1}var v=d;if(d<=0){v=1}else{if(d>r){v=r}}var n=(v-1)*a;var I=(v>1);var m=(v>1);var G=(v<r);var g=(v<r);var J=b.down("#queryResultMsg");if(J==null){J=Ext.create("Ext.panel.Panel",{itemId:"queryResultMsg",margin:"5 0 5 0",bodyStyle:"background : #EBF8A4",layout:"column",items:[{xtype:"image",padding:"5 5 5 5",src:Ext.ImagePath+"s_success.png"},{xtype:"panel",itemId:"infoPanel",padding:"5 5 5 5",border:0,bodyStyle:"background : transparent"}]});b.add(J)}var s=""+(n+1)+" - "+(n+K);if(K==0){s=0}J.down("#infoPanel").update(I18N_Util.getMsg("msgSucSqlReturnRec",{showRange:s,totalCount:O,interval:(y.__EXEC_TIME*0.001).toFixed(3)}));var p=b.down("#querySqlResultPrompt");if(p==null){p=Ext.create("Ext.panel.Panel",{itemId:"querySqlResultPrompt",border:0,margin:"0 0 5 0",height:50,autoScroll:true,bodyStyle:"background: #F3F3F3;"});b.add(p)}p.update('<div style="padding: 5px;">'+Ext.htmlEncode(e)+"</div>");var F=y.attribute==null?[]:y.attribute;var t=[{text:I18N_Util.getMsg("lblNO"),dataIndex:SYS_COL_ROW_NUM,width:40}];var N=[{name:SYS_COL_ROW_NUM},{name:SYS_COL_ROW_OID}];var C=false;var k=new Ext.util.HashMap();var o=[];var H=[];for(var M=0;M<F.length;M++){k.add(F[M].class_name,null);if(F[M].is_primary_key==1){o.push(""+M)}else{if(F[M].is_unique_key==1){H.push(""+M)}}var w={text:'<span title="'+Ext.htmlEncode(F[M].name)+'">'+Ext.htmlEncode(F[M].name)+"</span>",dataIndex:""+M,editor:{xtype:"textareafield",height:28,listeners:{afterrender:function(){this.inputEl.swallowEvent(["keypress","keydown"])}}},renderer:function(i){if(i===null){return'<span style="font-weight:bold">(NULL)</span>'}return Ext.htmlEncode(i)}};if(F.length<2){w.width=180}t.push(w);N.push({name:""+M})}var q=k.getKeys();if(q.length==1&&Ext.String.trim(q[0])!=""){C=true}delete q;delete k;Ext.define("CubridRecord",{extend:"Ext.data.Model",cubrid_table:F[0].class_name,cubrid_columns:F,cubrid_pk:o,cubrid_uk:H,fields:N});var L=[];var x=y.values;var E=y.oid;for(var D=0;D<x.length;D++){var z={};z[SYS_COL_ROW_NUM]=n+D+1;var A=E[D];if(f.isValidCubridOID(A)){}else{A=""}z[SYS_COL_ROW_OID]=A;for(var j=0;j<F.length;j++){z[""+j]=x[D][j]}L.push(z)}var Q=Ext.create("Ext.data.Store",{model:"CubridRecord",data:L});b.remove("resultGridPanel");var P=26*x.length+60;if(P<=260){P=260}var l={mode:"MULTI",onRowMouseDown:function(R,i,T,S,U){this.selectWithEvent(i,U)}};var h=new Ext.selection.RowModel(l);var u=Ext.create("Ext.grid.Panel",{itemId:"resultGridPanel",style:"background: #ffffff;",cls:"struct-grid",store:Q,height:P,autoScroll:true,border:0,title:"",enableColumnHide:false,selModel:h,plugins:!C?[]:[Ext.create("Ext.grid.plugin.RowEditing",{pluginId:"editorPlugin",clicksToEdit:2,clicksToMoveEditor:2,autoCancel:true,listeners:{edit:f.eventOnRowEditInGrid}})],columns:t,viewConfig:!C?{}:{getRowClass:function(i,U,S,R){var T=i.get(SYS_COL_ERR_INF);if(T!=null){return"error_row"}},listeners:{render:f.createGridRowTooltip}},dockedItems:[{xtype:"toolbar",style:"background: #D9EFF7;",cls:"query_editor_tbr",dock:"top",items:[{xtype:"button",tooltip:I18N_Util.getMsg("msgFirstPage"),icon:Ext.ImagePath+(I?"page-first.gif":"page-first-disabled.gif"),disabled:!I,handler:function(i,R){f.showQueryResultGrid(b,e,a,1)}},{xtype:"button",tooltip:I18N_Util.getMsg("msgPreviousPage"),icon:Ext.ImagePath+(m?"page-prev.gif":"page-prev-disabled.gif"),disabled:!m,handler:function(i,R){f.showQueryResultGrid(b,e,a,v-1)}},{xtype:"button",tooltip:I18N_Util.getMsg("msgNextPage"),icon:Ext.ImagePath+(G?"page-next.gif":"page-next-disabled.gif"),disabled:!G,handler:function(i,R){f.showQueryResultGrid(b,e,a,v+1)}},{xtype:"button",tooltip:I18N_Util.getMsg("msgLastPage"),icon:Ext.ImagePath+(g?"page-last.gif":"page-last-disabled.gif"),disabled:!g,handler:function(i,R){f.showQueryResultGrid(b,e,a,r)}},"-",{xtype:"button",tooltip:I18N_Util.getMsg("msgRefresh"),icon:Ext.ImagePath+"refresh.png",handler:function(i,R){f.showQueryResultGrid(b,e,a,v)}},"-",{xtype:"displayfield",value:"&nbsp;"+I18N_Util.getMsg("lblPage")+" "},{xtype:"numberfield",hideTrigger:true,width:30,value:v,originValue:v,allowDecimals:false,minValue:1,maxValue:r,validateOnBlur:false,validateOnChange:false,enableKeyEvents:true,listeners:{blur:function(R,i){R.setValue(R.originValue)},focus:function(R,i){R.setValue("")},specialkey:function(R,i){if(i.getKey()==i.ENTER){var S=R.getValue();if(S>r){S=r}else{if(S<1){S=v}}f.showQueryResultGrid(b,e,a,S)}},keypress:function(U,T,R){var i=U.getValue();var S=T.getKey()-T.ZERO;if(S<0||S>9){return}if(i*10+S>U.maxValue){T.stopEvent()}}}},{xtype:"displayfield",value:"&nbsp;/&nbsp;"+r+"&nbsp;"},"-",{xtype:"displayfield",value:"&nbsp;"+I18N_Util.getMsg("lblPageSize")+" "},{xtype:"numberfield",hideTrigger:true,allowDecimals:false,width:30,minValue:1,maxValue:Ext.cwm.queryMaxPageSize,value:a,originValue:a,validateOnBlur:false,validateOnChange:false,enableKeyEvents:true,listeners:{blur:function(R,i){R.setValue(R.originValue)},focus:function(R,i){R.setValue("")},specialkey:function(S,R){if(R.getKey()==R.ENTER){var i=S.getValue();if(i>S.maxValue){i=S.maxValue}else{if(i<S.minValue){i=a}}f.showQueryResultGrid(b,e,i,1);Ext.cwm.queryDefaultPageSize=i}},keypress:function(U,T,R){var i=U.getValue();var S=T.getKey()-T.ZERO;if(S<0||S>9){return}if(i*10+S>U.maxValue){T.stopEvent()}}}},{xtype:"displayfield",value:"&nbsp;"},"-",{xtype:"button",itemId:"btnDeleteRecords",hidden:!C,disabled:true,tooltip:I18N_Util.getMsg("msgDelSelectedRecs"),icon:Ext.ImagePath+"b_drop.png",handler:function(i,R){f.eventOnDeleteRowSelectedInGrid(i,R,u)}}]}],listeners:{selectionchange:function(i,S,R){var T=b.down("#btnDeleteRecords");if(S.length>0){T.setDisabled(false)}else{T.setDisabled(true)}}}});b.add(u)};this.executeSqlRemote([e],(d-1)*a+1,a,0,0,c)},ajaxRequest:function(b,a,c){var d=Ext.createWaitWin();Ext.Ajax.request({method:"POST",async:(c!=false),url:this.CCI_URL,jsonData:Ext.encode(b),callback:function(h,j,f){d.close();try{if(j){var g=Ext.decode(f.responseText);if(Ext.checkDbLoginStatusWhenCCI(g.status,g.note)){a(g)}}else{Ext.showErrorWin(I18N_Util.getMsg("msgErrInServer"))}}catch(i){Ext.Trace("System error: "+i)}}})},executeSqlRemoteProxy:function(k,h,b,g,e,i,j){var d=new Object();var a=Ext.currentDb;var c=Ext.cookieUtil.getDbUserName(a);var f=Ext.cookieUtil.getDbUserPwd(a);d.task="sql";d.bip=Ext.cookieUtil.getDbBrokerIp(a);d.bport=Ext.cookieUtil.getDbBrokerPort(a);d.dbname=a;d.dbid=c;d.dbpasswd=f;d.charset="UTF-8";d.stmt=k;d.dump_plan=h;d.fetch_offset=b;d.fetch_size=g;d.autocommit=e;d.error_continue=i;this.ajaxRequest(d,j)},executeSqlRemote:function(f,d,b,c,e,a){this.executeSqlRemoteProxy(f,0,d,b,c,e,a)},executeSqlRemoteWithQueryPlan:function(f,d,b,c,e,a){this.executeSqlRemoteProxy(f,1,d,b,c,e,a)},getSQLWhereClause:function(b){var c=b.cubrid_pk;if(c.length<1){c=b.cubrid_uk}for(var d=0;d<c.length;d++){var f=new String(c[d]);var e=b.get(f);if(b.isModified(f)){e=b.modified[f]}if(e===null){c=[];break}}if(c.length<1){for(var f in b.data){if(f.indexOf("~SYS_")==0){continue}c.push(f)}}var a="";for(var d=0;d<c.length;d++){var f=new String(c[d]);var e=b.get(f);if(b.isModified(f)){e=b.modified[f]}if(a!=""){a+=" AND "}if(e===null){a+='"'+b.cubrid_columns[f].name+'" IS NULL'}else{a+='"'+b.cubrid_columns[f].name+"\"='"+new String(e).replace(/\'/gi,"''")+"'"}}return a+=" LIMIT 1;"},executeUpdateRecordRemote:function(c,l){if(c==null||c.length<=0){return}var h=[];for(var f=0;f<c.length;f++){var e=c[f];var m=e.getChanges();if(m.length<=0){continue}var b='UPDATE "'+e.cubrid_table+'" SET ';var n=null;for(var j in m){var k=new String(m[j]);if(e.modified[j]===null&&k.length==0){e.set(j,null);continue}var a='"'+e.cubrid_columns[j].name+"\"='"+k.replace(/\'/gi,"''")+"'";if(n==null){n=a}else{n+=","+a}}if(n!=null){b+=n+" WHERE "+this.getSQLWhereClause(e);h.push(b)}}var d="";if(h.length<=0){return}for(var f=0;f<h.length;f++){d+=Ext.htmlEncode(h[f])+"<br><br>"}var g=this;Ext.Msg.confirm(I18N_Util.getMsg("titleConfirm"),'<span style="color:red">'+I18N_Util.getMsg("msgCfmUpdateRecs",{count:h.length})+"</span><br><br>"+I18N_Util.getMsg("msgExecSql")+'<br><br><div style="overflow:auto; height:60px">'+d+"</div>",function(i){if(i=="yes"){g.executeSqlRemote(h,0,0,0,1,l)}})},executeDeleteRecordRemote:function(c,a){if(c==null||c.length<=0){return}var g=[];for(var e=0;e<c.length;e++){var h=c[e];var b='DELETE FROM "'+h.cubrid_table+'" WHERE '+this.getSQLWhereClause(h);g.push(b)}var d="";for(var e=0;e<g.length;e++){d+=Ext.htmlEncode(g[e])+"<br><br>"}var f=this;Ext.Msg.confirm(I18N_Util.getMsg("titleConfirm"),'<span style="color:red">'+I18N_Util.getMsg("msgCfmDelRecs",{count:c.length})+"</span><br><br>"+I18N_Util.getMsg("msgExecSql")+'<br><br><div style="overflow:auto; height:100px">'+d+"</div>",function(i){if(i=="yes"){f.executeSqlRemote(g,0,0,0,1,a)}})},executeOidGetRemote:function(b,j){if(b==null||b.length<=0){return}var c=new Object();var a=Ext.currentDb;var e=Ext.cookieUtil.getDbUserName(a);var g=Ext.cookieUtil.getDbUserPwd(a);c.task="oid_get";c.bip=Ext.cookieUtil.getDbBrokerIp(a);c.bport=Ext.cookieUtil.getDbBrokerPort(a);c.dbname=a;c.dbid=e;c.dbpasswd=g;c.charset="UTF-8";c.oids=[];for(var f=0;f<b.length;f++){var d=b[f];var h=d.get(SYS_COL_ROW_OID);c.oids.push({oid:h})}this.ajaxRequest(c,j)},executeOidPutRemote:function(b,m){if(b==null||b.length<=0){return}var c=new Object();var a=Ext.currentDb;var e=Ext.cookieUtil.getDbUserName(a);var h=Ext.cookieUtil.getDbUserPwd(a);c.task="oid_put";c.bip=Ext.cookieUtil.getDbBrokerIp(a);c.bport=Ext.cookieUtil.getDbBrokerPort(a);c.dbname=a;c.dbid=e;c.dbpasswd=h;c.charset="UTF-8";c.oids=[];for(var g=0;g<b.length;g++){var d=b[g];var j=d.get(SYS_COL_ROW_OID);var f=[];var l=[];var n=d.getChanges();for(var k in n){f.push(k);l.push(n[k])}if(f.length<=0){continue}c.oids.push({oid:j,attribute:f,value:l})}this.ajaxRequest(c,m)},executeOidDeleteRemote:function(b,j){if(b==null||b.length<=0){return}var c=new Object();var a=Ext.currentDb;var e=Ext.cookieUtil.getDbUserName(a);var g=Ext.cookieUtil.getDbUserPwd(a);c.task="oid_del";c.bip=Ext.cookieUtil.getDbBrokerIp(a);c.bport=Ext.cookieUtil.getDbBrokerPort(a);c.dbname=a;c.dbid=e;c.dbpasswd=g;c.charset="UTF-8";c.oids=[];for(var f=0;f<b.length;f++){var d=b[f];var h=d.get(SYS_COL_ROW_OID);c.oids.push(h)}this.ajaxRequest(c,j)},addMetaTableNavigator:function(c,a){function b(h){var n=a.up("#queryEditorView");if(!n.serverResponseStatusOK(h)){return}var m=[];try{m=h.result[0].values}catch(k){return}var f="";for(var j=0;j<m.length;j++){f+="<option>"+Ext.htmlEncode(m[j][0])+"</option>"}var d=Ext.create("Ext.toolbar.Toolbar",{width:38,itemId:"metaColumnToolBar",style:"border: 0px;background: none repeat scroll 0 0 #FFFFFF;",border:0});a.add(d);var g=a.down("#queryEditorTextareaPanel").editorInstance;d.add({text:"<<",width:35,tooltip:I18N_Util.getMsg("msgInsertColsIntoEditor"),itemId:"buttonMove",handler:function(p,r){try{var i=n.getMetaCloumns(true);var q=n.getMetaCloumnString(i);if(q==null||Ext.String.trim(q)==""){return}g.replaceSelection(q)}catch(s){Ext.Trace(s)}}});a.add({flex:1,border:0,html:'<div style="width:100%; height:100%;">'+I18N_Util.getMsg("msgColumns")+'<br><select id="select_meta_column" multiple="multiple" style="width:90%; height:90%;">'+f+"</select></div>"});var o=n.down("#helperButtonBarPanel");o.show();var l=o;l.add({xtype:"button",text:"SELECT *",handler:function(e,i){g.setValue('SELECT * FROM "'+n.metaTableName+'" WHERE 1 LIMIT '+Ext.cwm.sqlLimitCount+";")}});l.add({xtype:"button",text:"SELECT",handler:function(i,q){var e=n.getMetaCloumns(false);var p=n.getMetaCloumnString(e);g.setValue("SELECT "+p+' FROM "'+n.metaTableName+'" WHERE 1 LIMIT '+Ext.cwm.sqlLimitCount+";")}});l.add({xtype:"button",text:"INSERT",handler:function(r,t){var e=n.getMetaCloumns(false);var s=n.getMetaCloumnString(e);var p="";for(var q=0;q<e.length;q++){if(Ext.String.trim(p)!=""){p+=", "}p+="[value"+q+"]"}g.setValue('INSERT INTO "'+n.metaTableName+'"('+s+") VALUES ("+p+");")}});l.add({xtype:"button",text:"UPDATE",handler:function(r,s){var e=n.getMetaCloumns(false);var p="";for(var q=0;q<e.length;q++){if(Ext.String.trim(p)!=""){p+=", "}p+=e[q]+"=[value"+q+"]"}g.setValue('UPDATE "'+n.metaTableName+'" SET '+p+" WHERE 1 LIMIT 1;")}});l.add({xtype:"button",text:"DELETE",handler:function(e,i){g.setValue('DELETE FROM "'+n.metaTableName+'" WHERE 0 LIMIT 1;')}})}this.executeSqlRemote(['DESC "'+c+'"'],1,-1,0,0,b)},getMetaCloumns:function(e){var a=Ext.getDom("select_meta_column");var c=[];if(a==null){return c}var b=a.options;for(var d=0;d<b.length;d++){if(!e||b[d].selected){c.push('"'+b[d].text+'"')}}return c},getMetaCloumnString:function(a){if(a==null){return null}var b="";for(var c=0;c<a.length;c++){if(Ext.String.trim(b)!=""){b+=", "}b+=a[c]}return b},isValidCubridOID:function(a){if(a==null||Ext.String.trim(a)==""){return false}if(Ext.String.trim(a)=="@0|0|0"){return false}return true},serverResponseStatusOK:function(a){if(a.status!=1000){Ext.showErrorWin(Ext.htmlEncode(a.note));return false}return true},eventOnRowEditInGrid:function(c,d,b){var a=c.record;a.set(SYS_COL_ERR_INF,null);if(!a.dirty){return}var e=c.grid.up("#queryEditorView");function f(i){if(!e.serverResponseStatusOK(i)){return}var g=i.result;if(g==null||g.length<=0){return}var h=g[0];if(h.status==0){a.commit()}else{a.set(SYS_COL_ERR_INF,'<span style="color:red">'+I18N_Util.getMsg("msgErrOnUpdate")+"</span><br> "+I18N_Util.getMsg("msgErrInfo",{info:h.status})+"<br>"+Ext.htmlEncode(h.note))}}e.executeUpdateRecordRemote([a],f)},eventOnDeleteRowSelectedInGrid:function(d,b,e){if(e==null||d==null){return}var i=e.up("#queryEditorView");var c=e.getPlugin("editorPlugin");if(c!=null){c.cancelEdit()}var f=e.getSelectionModel();var g=f.getSelection();var a=e.getStore();function h(n){if(!i.serverResponseStatusOK(n)){return}var q=n.result;if(q==null||q.length<=0){return}var m=[];for(var o=0;o<q.length;o++){var l=q[o];var p=g[o];if(l.status==0){m.push(p)}else{p.set(SYS_COL_ERR_INF,'<span style="color:red">'+I18N_Util.getMsg("msgErrOnDelete")+"</span><br> "+I18N_Util.getMsg("msgErrInfo",{info:l.status})+"<br>"+Ext.htmlEncode(l.note))}}var j=m.length;var r=g.length-j;a.remove(m);var k="";if(j>0){k+=I18N_Util.getMsg("msgSucDelRecs",{count:j})}if(r>0){k+='<br><span style="color:red">'+I18N_Util.getMsg("msgFail2DelRecs",{count:r})+"</span>"}Ext.Msg.show({title:I18N_Util.getMsg("msgInfo"),msg:k,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}i.executeDeleteRecordRemote(g,h)},createGridRowTooltip:function(a){a.tip=Ext.create("Ext.tip.ToolTip",{target:a.el,delegate:a.itemSelector,trackMouse:true,renderTo:Ext.getBody(),dismissDelay:5000,listeners:{beforeshow:function(d){var b=a.getRecord(d.triggerElement);var c=b.get(SYS_COL_ERR_INF);if(c!=null){d.update(c)}else{d.update(I18N_Util.getMsg("msgDbClickToEdit"))}}}})},showQueryPlan:function(a){var b=new String(Ext.htmlEncode(this.sqlExecResultArr[a].query_plan));b=b.replace(/(.*:)[\r\n]|[\n]/g,'<span style="color:red">$1</span><br>');b=b.replace(/\n/g,"<br>");var c=Ext.create("Ext.window.Window",{itemId:"queryPlanWindow",minWidth:300,minHeight:200,width:600,height:400,defaults:{autoScroll:true},autoScroll:true,title:"Query Explain",maximizable:true,closable:true,border:0,modal:true,buttonAlign:"center",buttons:[{text:"Close",handler:function(e,d){e.up("#queryPlanWindow").close()}}],html:b});c.show()}});Ext.define("cwm.view.Report",{extend:"Ext.panel.Panel",alias:"widget.report",id:"ReportView",bodyStyle:"border: 0;background : transparent;",style:"padding: 0 10px; border: 0; background: transparent;",defaults:{border:0},initComponent:function(){var a=this;a.callParent(arguments);a.panelWidth=700;a.commonTimeFormat="YmdHis";a.addDbLogQuery();a.addBrokerLogQuery();a.checkBrokerAuth()},addDbLogQuery:function(){var b=this;var a=Ext.create("cwm.widget.LogPeriodForm",{title:I18N_Util.getMsg("titleDbLogQuery"),width:b.panelWidth,itemId:"DbLogQueryForm",idPrefix:"db",logType:[{name:I18N_Util.getMsg("lblError"),value:"err"},{name:I18N_Util.getMsg("lblBackup"),value:"backup"},{name:I18N_Util.getMsg("lblAddVol"),value:"addvol"}]});b.add(a)},addBrokerLogQuery:function(){var b=this;var a=Ext.create("cwm.widget.LogPeriodForm",{title:I18N_Util.getMsg("titleBrokerLogQuery"),width:b.panelWidth,itemId:"BrokerLogQueryForm",idPrefix:"broker",logType:[{name:I18N_Util.getMsg("lblStartOrStop"),value:"start-stop"}]});b.add(a)},addLogGrid:function(d,c,g,h,a){var f=this;var e=f.down("logreportgrid");if(e){f.remove(e,true)}var b=Ext.create("cwm.widget.LogReportGrid",{title:I18N_Util.getMsg("titleLog"),width:f.panelWidth,type:d,logType:g,name:c,start:h,end:a});f.add(b);b.getDataFromSys(c,h,a)},checkBrokerAuth:function(){var b=this;var a=b.down("#BrokerLogQueryForm");if(a){if(Ext.getCurCmUserBrokerAuth()==="admin"){a.show()}else{a.hide()}}},refreshDbList:function(){var b=this;var a=b.down("#DbLogQueryForm");if(a){a.refreshDbList()}}});Ext.define("cwm.view.RHome",{extend:"Ext.panel.Panel",alias:"widget.rhome",requires:["cwm.widget.CTabbar","cwm.widget.CTab","cwm.common.CookieUtil"],border:0,component:{menu:0,dynPanel:1},menuComponent:{databases:0,variables:1,brokers:2,monitors:3,cmusermanagement:4,automation:5},id:"cubrid-manager-home-view",items:[{xtype:"ctabbar",items:[{xtype:"ctab",icon:Ext.ImagePath+"s_db.png",itemId:"Databases",text:I18N_Util.getMsg("lblDbs")},{xtype:"ctab",icon:Ext.ImagePath+"s_vars.png",itemId:"Variables",text:I18N_Util.getMsg("lblVars")},{xtype:"ctab",icon:Ext.ImagePath+"broker.png",itemId:"Brokers",text:I18N_Util.getMsg("lblBrokers")},{xtype:"ctab",icon:Ext.ImagePath+"status_group.png",itemId:"Monitors",text:I18N_Util.getMsg("lblMonitors")},{xtype:"ctab",icon:Ext.ImagePath+"s_rights.png",itemId:"CMUserManagement",text:I18N_Util.getMsg("lblUsers")},{xtype:"ctab",icon:Ext.ImagePath+"b_tblops.png",itemId:"Automation",text:I18N_Util.getMsg("lblAutomation")},{xtype:"ctab",icon:Ext.ImagePath+"b_search.png",itemId:"Report",text:I18N_Util.getMsg("lblReport")}]},{defaultType:"container",layout:{type:"table",columns:2},border:0,items:[{xtype:"panel",title:I18N_Util.getMsg("titleInfoCDbServer"),width:500,height:300,cls:"infoPanel",margin:10,rowspan:2,layout:{type:"table",columns:2},defaults:{bodyStyle:"padding:5px; border : none"},items:[{xtype:"panel",width:150,html:'<span style="color:#235A81">'+I18N_Util.getMsg("msgCVer")+"</span>"},{xtype:"panel",id:"cubrid-ver",html:""},{xtype:"panel",html:'<span style="color:#235A81">'+I18N_Util.getMsg("msgBrokerVer")+"</span>"},{xtype:"panel",id:"broker-ver"},{xtype:"panel",html:'<span style="color:#235A81">'+I18N_Util.getMsg("msgOS")+"</span>"},{xtype:"panel",id:"os-ver"},{xtype:"panel",html:'<span style="color:#235A81">'+I18N_Util.getMsg("msgCPath")+"</span>"},{xtype:"panel",id:"cubrid-path"},{xtype:"panel",html:'<span style="color:#235A81">'+I18N_Util.getMsg("msgDbPath")+"</span>"},{xtype:"panel",id:"database-path"}]},{xtype:"panel",title:I18N_Util.getMsg("titleInfoCMServer"),width:400,height:120,cls:"infoPanel",cellCls:"tablelayout_valign_top",margin:10,layout:{type:"table",columns:2},defaults:{bodyStyle:"padding:5px; border : none"},items:[{xtype:"panel",width:150,html:'<span style="color:#235A81">'+I18N_Util.getMsg("msgManagerServerVer")+"</span>"},{xtype:"panel",id:"cms-ver",html:""}]},{xtype:"panel",title:I18N_Util.getMsg("titleInfoCWM"),width:400,height:160,cls:"infoPanel",cellCls:"tablelayout_valign_bottom",margin:10,layout:{type:"table",columns:2},defaults:{bodyStyle:"padding:5px; border : none"},items:[{xtype:"panel",width:150,html:'<span style="color:#235A81">'+I18N_Util.getMsg("msgWMVer")+"</span>"},{xtype:"panel",html:Ext.cwm.prodVersion},{xtype:"panel",html:'<span style="color:#235A81">'+I18N_Util.getMsg("msgCheckUpdate")+"</span>"},{layout:{type:"table",columns:2},items:[{xtype:"button",icon:Ext.ImagePath+"refresh.png",listeners:{afterrender:function(){doCWMVersionUpdate()}},handler:function(a,b){doCWMVersionUpdate()}},{id:"cwm-update-info",border:0,width:300,html:""}]}]}]}],clearMenuActive:function(){try{for(var a=0;a<this.getComponent(this.component.menu).items.length;a++){var b=this.getComponent(this.component.menu).getComponent(a);if(b){b.setActive(false)}}}catch(c){Ext.Trace(c)}},clearContainer:function(){var a=this.items.length;for(var b=1;b<a;b++){var c=this.getComponent(this.component.dynPanel);if(c){this.remove(c,true)}}},listeners:{render:function(a){try{a.getComponent(a.component.menu).getComponent(a.menuComponent.databases).on("click",function(){a.clearMenuActive();a.getComponent(a.component.menu).getComponent(a.menuComponent.databases).setActive(true);a.clearContainer();var c=Ext.create("cwm.view.DatabaseListView",{border:0});c.createDbListView();a.add(c)});a.getComponent(a.component.menu).getComponent(a.menuComponent.variables).on("click",function(){a.clearMenuActive();a.getComponent(a.component.menu).getComponent(a.menuComponent.variables).setActive(true);a.clearContainer();var d=Ext.create("cwm.view.Variables",{border:0});a.add(d);var c=new EventProxy();c.assignAll("cm","cubrid","cubrid_broker",function(){var k=new Array();for(var g=0;g<arguments[1].length;g++){var l=arguments[1][g].pv;for(var e=0;e<l.length;e++){if(l[e].pn.fulltrim()==="cubrid_port_id"){var h={};h.pv=l[e].pv;h.paragroup="Database Ports";h.pn="cubrid_port_id";k.push(h)}}}for(var g=0;g<arguments[2].length;g++){var l=arguments[2][g].pv;for(var e=0;e<l.length;e++){if(l[e].pn.fulltrim()==="BROKER_PORT"){var h={};h.pv=l[e].pv;h.paragroup="Broker Ports";h.pn="BROKER_PORT ["+arguments[2][g].pn+"]";k.push(h)}}}for(var g=0;g<arguments[0].length;g++){if(arguments[0][g]["pn"].fulltrim()==="cm_port"){var h={};h.paragroup="Manager Ports";h.pn="cm_port";h.pv=""+arguments[0][g].pv+", "+(parseInt(arguments[0][g].pv)+1);k.push(h);break}}var f=Ext.decode(Ext.util.Cookies.get("cmsEnvInfo"));k.push({pn:"cm_internal_port",pv:f.https_cm_port,paragroup:"Manager Ports"});k.push({pn:"cm_httpd_port",pv:f.https_port,paragroup:"Manager Ports"});d.renderPortsInfo(k);d.renderCubridInfo(arguments[1]);d.renderBrokerInfo(arguments[2]);d.renderCmInfo(arguments[0])});Ext.GetAllSysParam("getallsysparam","cubridconf",{success:function(e,f){var g=Ext.decode(e.responseText);var h=IniToJson(g.conflist[0].confdata);c.trigger("cubrid",h)}});Ext.GetAllSysParam("getallsysparam","cmconf",{success:function(e,f){var g=Ext.decode(e.responseText);var h=IniToJson(g.conflist[0].confdata);c.trigger("cm",h)}});Ext.GetAllSysParam("getaddbrokerinfo","brokerconf",{success:function(e,f){var g=Ext.decode(e.responseText);var h=IniToJson(g.conflist[0].confdata);c.trigger("cubrid_broker",h)}})})}catch(b){Ext.Trace(b)}}},addFavorites:function(){var a=Ext.create("cwm.widget.Favorites",{});this.add(a)},addBrokers:function(){this.clearMenuActive();this.clearContainer();var a=Ext.create("cwm.view.Brokers",{});this.add(a)},addMonitor:function(){this.clearMenuActive();this.clearContainer();var a=Ext.create("cwm.view.Monitor",{});this.add(a)},addCMUserManagement:function(){this.clearMenuActive();this.clearContainer();var a=Ext.create("cwm.view.CMUserManagement",{});this.add(a)},addAutomation:function(){this.clearMenuActive();this.clearContainer();var a=Ext.create("cwm.view.Automation",{});this.add(a)},addReport:function(){this.clearMenuActive();this.clearContainer();var a=Ext.create("cwm.view.Report",{});this.add(a)},setEnv:function(){var b=Ext.cookieUtil.getEnvInfo();if(b==null){return}Ext.getCmp("cubrid-ver").update(b.CUBRIDVER);Ext.getCmp("cubrid-path").update(b.CUBRID);Ext.getCmp("broker-ver").update(b.BROKERVER);Ext.getCmp("database-path").update(b.CUBRID_DATABASES);Ext.getCmp("os-ver").update(b.osinfo);var a=Ext.util.Cookies.get("cmsEnvInfo");if(a==null){return}a=Ext.decode(a);Ext.getCmp("cms-ver").update(a.CMS_VER)},refreshCtabBar:function(){var c=this;var h=Ext.cookieUtil.getDbmtUserName();if(h==="admin"){return}var i=c.down("ctabbar");if(i){var a=i.down("#Brokers");var b=i.down("#Monitors");var e=i.down("#CMUserManagement");var g=i.down("#Databases");var d=i.down("#Variables");var f=i.down("#Automation");if(a&&b&&e&&g&&d&&f){e.hide();g.hide();d.hide();f.hide();if(!Ext.cwm.curCmUserAuth){a.hide();b.hide();return}if(Ext.cwm.curCmUserAuth.casauth!=="none"){a.show()}else{a.hide()}if(Ext.cwm.curCmUserAuth.statusmonitorauth!=="none"){b.show()}else{b.hide()}}}},initComponent:function(){this.callParent(arguments);this.addFavorites();if(typeof Ext.cookieUtil!="undefined"){this.setEnv()}if(this.init!==true){this.refreshCtabBar()}}});Ext.define("cwm.view.RightPanel",{extend:"Ext.panel.Panel",alias:"widget.rightpanel",layout:"anchor",bodyStyle:"background : white; border : none; overflow-x: hidden; overflow-y: auto;",defaults:{margin:"0 10 0 0"},id:"rightPanel",requires:["cwm.widget.BreadCrumb"],component:{dynPanel:1},goHome:function(){var a=this.getComponent(this.component.dynPanel);if(a){this.remove(a,true)}var b=Ext.create("cwm.view.RHome",{border:0});b.setEnv();this.add(b);Ext.getCmp("shortcutBtnSql").hide()},showTablesOfDatabase:function(c,a){var b=this.getComponent(this.component.dynPanel);if(b){this.remove(b,true)}var e=Ext.create("cwm.view.DbStruct",{border:0,dbname:c,result:a});e.createStructure();this.add(e);var d=e.down("ctabbar");if(d){d.setActiveById("Structure")}},refresh:function(){try{var a=this.getComponent(this.component.dynPanel);if(!!a&&!!a.refresh&&typeof(a.refresh)=="function"){a.refresh()}}catch(b){Ext.Trace(b)}},createInsertView:function(a){var b=this.getComponent(this.component.dynPanel);if(b){this.remove(b,true)}var d=Ext.create("cwm.view.TableStructure",{border:0,dbname:Ext.currentDb,tableName:a});d.createInsert();this.add(d);var c=d.down("ctabbar");if(c){c.setActiveById("Insert")}},showDatabaseListView:function(){var b=this.getComponent(this.component.dynPanel);if(b){this.remove(b,true)}var a=Ext.create("cwm.view.DatabaseListView",{border:0});this.add(a)},showSchemaOfTable:function(f,b){var i=f;var d=b;try{var c=this.getComponent(this.component.dynPanel);if(c){this.remove(c,true)}var a=Ext.create("cwm.view.TableStructure",{border:0,dbname:i,tableName:d});a.createStructure();this.add(a);var h=a.down("ctabbar");if(h){h.setActiveById("Structure")}}catch(g){Ext.Trace(g)}},showTableInfo:function(g,a,d){try{var b=this.getComponent(this.component.dynPanel);if(b){this.remove(b,true)}var c=Ext.create("cwm.view.TableStructure",{border:0,dbname:g,tableName:a});if(typeof d!="undefined"&&d!=null&&"name" in d){if(d.name==="SQL"){c.addQueryEditorWithAutoRun(d.sql)}}this.add(c)}catch(f){Ext.Trace(f)}},initComponent:function(){var a=Ext.create("cwm.widget.BreadCrumb",{border:0,anchor:"100%"});a.createCrumb({icon:"resources/images/s_host.png",text:I18N_Util.getMsg("lblHome")},true);var b=Ext.create("cwm.view.RHome",{border:0,init:true});this.items=[a,b];this.callParent(arguments)},addBrokers:function(a){var b=Ext.create("cwm.view.Brokers",{});this.add(b)},removeBrokers:function(){var a=this.down("brokers");if(a){a.destroy()}},removeDblistview:function(){var a=this.down("dblistview");if(a){a.destroy()}},addPrivileges:function(c,b){var a=this.getComponent(this.component.dynPanel);if(a){this.remove(a,true);Ext.Trace("addPrivileges: reomve ")}var e=Ext.create("cwm.view.DbStruct",{border:0,dbname:c,message:b});e.addPrivileges();this.add(e);var d=e.down("ctabbar");if(d){d.setActiveById("Privileges")}}});Ext.define("cwm.view.TableSearch",{extend:"Ext.form.Panel",alias:"widget.tablesearch",requires:["cwm.widget.tablesearch.Criteria","cwm.widget.tablesearch.Options"],bodyStyle:"border: 0; background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;",defaults:{border:0},buttonAlign:"right",tableName:"",items:[{html:'<div class="privileges"><h2>Do a "query by example" (wildcard: "%")</h2></div>'},{xtype:"tbsearchcriteria"},{xtype:"tbsearchoptions"}],buttons:[{text:"GO",action:"submit"}],getData:function(b){var a="DESC "+this.tableName;sqls=[a];Ext.QueryByCCI(Ext.currentDb,sqls,{success:function(e,g){var f=Ext.decode(e.responseText);if(f){if(f.status=="1000"){var c=f.result;if(c[0].status==0){var d=c[0].values;if(b.loadData()){b.loadData(d)}}}}},failure:function(c,d){}})},submit:function(){this.getForm().getValues()},initComponent:function(){this.callParent(arguments);var b=this.down("tbsearchcriteria");var a=this.down("tbsearchoptions")}});Ext.define("cwm.view.TableStructure",{extend:"Ext.panel.Panel",alias:"widget.tablestruct",requires:["cwm.widget.CForm","cwm.widget.FieldsEditor","cwm.widget.InputWindow"],component:{menu:0,dynView:1},renamePrimaryKey:function(g,e,d){var b=this;var f=new Array();f.push('ALTER TABLE "'+b.tableName+'" DROP CONSTRAINT "'+g+'"');var a="",c;for(c=0;c<d.length;c++){a+='"'+d[c]+'", '}f.push('ALTER TABLE "'+b.tableName+'" ADD PRIMARY KEY "'+e+'"('+a.substring(0,a.length-2)+")");Ext.QueryByCCI(Ext.currentDb,f,{success:function(h,i){var k=Ext.decode(h.responseText);if(k.result[1].status!=0){var j=Ext.htmlEncode(k.result[1].note);if(g.length>80){j='<div class="msg_long_text">'+j+"</div>"}Ext.showErrorWin(j)}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){b.refreshWindow()})}}})},renameUnique:function(g,e,d){var b=this;var f=new Array();f.push('ALTER TABLE "'+b.tableName+'" DROP CONSTRAINT "'+g+'"');var a="",c;for(c=0;c<d.length;c++){a+='"'+d[c]+'", '}f.push('CREATE UNIQUE INDEX "'+e+'" ON "'+b.tableName+'"('+a.substring(0,a.length-2)+")");Ext.QueryByCCI(Ext.currentDb,f,{success:function(h,i){var k=Ext.decode(h.responseText);if(k.result[1].status!=0){var j=Ext.htmlEncode(k.result[1].note);if(g.length>80){j='<div class="msg_long_text">'+j+"</div>"}Ext.showErrorWin(j)}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){b.refreshWindow()})}}})},renameIndex:function(g,e,d){var b=this;var f=new Array();f.push('ALTER TABLE "'+b.tableName+'" DROP INDEX "'+g+'"');var a="",c;for(c=0;c<d.length;c++){a+='"'+d[c]+'", '}f.push('CREATE INDEX "'+e+'" ON "'+b.tableName+'"('+a.substring(0,a.length-2)+")");Ext.QueryByCCI(Ext.currentDb,f,{success:function(h,i){var k=Ext.decode(h.responseText);if(k.result[1].status!=0){var j=Ext.htmlEncode(k.result[1].note);if(g.length>80){j='<div class="msg_long_text">'+j+"</div>"}Ext.showErrorWin(j)}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){b.refreshWindow()})}}})},items:[{xtype:"ctabbar",component:{btnBrowse:0,btnStruct:1,btnSql:2,btnInsert:3,btnExport:4,btnImport:5,btnOp:6},items:[{xtype:"ctab",icon:Ext.ImagePath+"b_browse.png",text:I18N_Util.getMsg("lblBrowse"),itemId:"Browse"},{xtype:"ctab",icon:Ext.ImagePath+"b_props.png",text:I18N_Util.getMsg("lblStructure"),itemId:"Structure"},{xtype:"ctab",icon:Ext.ImagePath+"b_sql.png",text:I18N_Util.getMsg("lblSql"),itemId:"SQL"},{xtype:"ctab",icon:Ext.ImagePath+"b_insrow.png",text:I18N_Util.getMsg("lblInsert"),itemId:"Insert"},{xtype:"ctab",icon:Ext.ImagePath+"b_tblexport.png",text:I18N_Util.getMsg("lblExport"),itemId:"Export"},{xtype:"ctab",icon:Ext.ImagePath+"b_tblimport.png",text:I18N_Util.getMsg("lblImport"),itemId:"Import"},{xtype:"ctab",icon:Ext.ImagePath+"b_tblops.png",text:I18N_Util.getMsg("lblOper"),itemId:"Operation"}],listeners:{render:function(a){a.getComponent(a.component.btnStruct).on("click",function(){a.fireEvent("click",a.component.btnStruct);a.setActive(a.component.btnStruct)});a.getComponent(a.component.btnBrowse).on("click",function(){a.fireEvent("click",a.component.btnBrowse);a.setActive(a.component.btnBrowse)});a.getComponent(a.component.btnSql).on("click",function(){a.fireEvent("click",a.component.btnSql);a.setActive(a.component.btnSql)});a.getComponent(a.component.btnExport).on("click",function(){a.fireEvent("click",a.component.btnExport);a.setActive(a.component.btnExport)});a.getComponent(a.component.btnImport).on("click",function(){a.fireEvent("click",a.component.btnImport);a.setActive(a.component.btnImport)});a.getComponent(a.component.btnOp).on("click",function(){a.fireEvent("click",a.component.btnOp);a.setActive(a.component.btnOp)});a.getComponent(a.component.btnInsert).on("click",function(){a.fireEvent("click",a.component.btnInsert);a.setActive(a.component.btnInsert)})}}}],listeners:{render:function(a){a.getComponent(a.component.menu).on("click",function(c){var b=a.getComponent(a.component.menu).component;switch(c){case b.btnBrowse:a.addQueryEditorWithAutoRun();break;case b.btnStruct:var d=a.getComponent(a.component.dynView);if(d){a.remove(d,true)}a.createStructure(true);break;case b.btnInsert:var d=a.getComponent(a.component.dynView);if(d){a.remove(d,true)}a.createInsert();break;case b.btnImport:var d=a.getComponent(a.component.dynView);if(d){a.remove(d,true)}var g=Ext.create("cwm.view.Import",{dbname:a.dbname,tbname:a.tableName,type:"table"});a.add(g);break;case b.btnSql:var d=a.getComponent(a.component.dynView);if(d){a.remove(d,true)}var e="sqlEditorPanelForTable";var f=Ext.create("cwm.view.QueryEditorView",{queryTextareaDomId:e,initQueryStatements:'SELECT * FROM "'+a.tableName+'" WHERE 1 LIMIT '+Ext.cwm.sqlLimitCount+";",metaTableName:a.tableName,region:"center",bodyStyle:"border: 0;background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;"});a.add(f);break;case b.btnExport:var d=a.getComponent(a.component.dynView);if(d){a.remove(d,true)}var h=Ext.create("cwm.view.Export",{dbname:a.dbname,tbname:a.tableName,type:"table"});a.add(h);break;case b.btnOp:var d=a.getComponent(a.component.dynView);if(d){a.remove(d,true)}var i=Ext.create("cwm.view.Operations",{dbname:a.dbname,tablename:a.tableName});i.create("table");a.add(i);break;default:break}})}},refreshWindow:function(){var a=this;Ext.getTableInfoByCCI(Ext.currentDb,this.tableName,{success:function(b,c){a.fireEvent("refresh",Ext.currentDb,a.tableName)}})},createInsert:function(){var a=this;Ext.getTableInfoByCCI(this.dbname,this.tableName,{success:function(c,g){var f=Ext.create("cwm.view.Insert",{dbname:a.dbname,tableName:a.tableName,bodyStyle:"background : transparent; border : none"});var e=Ext.getDbIndex(a.dbname);var d=Ext.getTableIndx(a.dbname,a.tableName);var b=Ext.dblist[e].tables[d].fields;f.createView(b);a.add(f)}})},updateTableName:function(a){this.tableName=a},createStructure:function(h){var z=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none"});var i=this;var p=Ext.create("Ext.panel.Panel",{margin:10,bodyStyle:"background : #EBF8A4",layout:"column",items:[{xtype:"image",padding:"10 0 10 10",src:Ext.ImagePath+"s_success.png"},{xtype:"panel",padding:"10 10 10 4",border:0,bodyStyle:"background : transparent",html:I18N_Util.getMsg("msgCReturnEmptySet")}]});var a=I18N_Util.getMsg("titleColsOfTable",{name:Ext.htmlEncode(this.tableName)});var C=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none; font-size:2em; color : #777777;text-shadow: 0 1px 0 #FFFFFF;",margin:"0 0 0 10",bodyCls:"title_long_text",html:a});var t=new Ext.selection.CheckboxModel();var g=Ext.getDbIndex(this.dbname);var b=Ext.getTableIndx(this.dbname,this.tableName);if(-1==g||-1==b){Ext.Trace("TableStructure: can not found the table: "+this.tableName+"in database: "+this.dbname);return}var u=Ext.dblist[g].tables[b].fields;this.tbStore=Ext.create("Ext.data.Store",{model:"cwm.model.TableStructure",data:u});var s=Ext.create("Ext.grid.Panel",{store:this.tbStore,enableColumnHide:false,autoFill:true,border:0,margin:"0 10 0 10",cls:"struct-grid",selModel:t,getSelectedFieldNames:function(){var E=[];var D=t.getSelection();for(var k=0;k<D.length;k++){var f=D[k].get("name");E.push(f)}return E},columns:[{text:"#",dataIndex:"index",sortable:false,width:30},{text:I18N_Util.getMsg("lblColumn"),dataIndex:"name",width:140,sortable:false,renderer:function(D,k,f){if(D===null){return""}if(f.get("pkey")===true){return'<div class="x-item-highlighted" style="font-color: red">'+Ext.htmlEncode(D)+"</div>"}else{return Ext.htmlEncode(D)}}},{text:I18N_Util.getMsg("lblType"),dataIndex:"type",width:150,sortable:false},{text:I18N_Util.getMsg("lblAutoIncrement"),dataIndex:"autoIncrement",width:100,sortable:false,align:"center",renderer:function(E,D,f){if(E=="y"){var k=I18N_Util.getMsg("msgAutoIncrQtip",{seed:f.get("aiSeed"),increment:f.get("aiIncrement"),curVal:f.get("aiCurrentVal")});return'<img data-qwidth="200" data-qtitle="'+I18N_Util.getMsg("titleAutoIncrDetail")+'" data-qtip="'+k+'" src="'+Ext.ImagePath+'s_success.png"></img>'}else{if(E=="n"){}}return""}},{text:I18N_Util.getMsg("lblNotNull"),dataIndex:"notnull",width:60,sortable:false,align:"center",renderer:function(f){if(f=="y"){return'<img src="'+Ext.ImagePath+'s_success.png"></img>'}else{if(f=="n"){}}return""}},{text:I18N_Util.getMsg("lblDefault"),dataIndex:"default",width:120,sortable:false,renderer:function(f){if(f===null){return""}return Ext.htmlEncode(f)}},{sortable:false,xtype:"actioncolumn",header:I18N_Util.getMsg("lblAction"),width:130,items:[{icon:Ext.ImagePath+"b_edit.png",tooltip:I18N_Util.getMsg("msgEditCol"),handler:function(D,I,f){var H=D.getStore().getAt(I);var F=H.get("name");var E=H.get("type");var G=H.get("default");var k=H.get("notnull");i.showColumnEditor(F,E,k==="y"?true:false,G,H)}},{icon:Ext.ImagePath+"b_drop.png",tooltip:I18N_Util.getMsg("msgDropCol"),handler:function(k,H,f){var F=k.getStore().getAt(H);var E=F.get("name");var D=i;function G(){if(D){Ext.DropColumns(Ext.currentDb,D.tableName,[E],{success:function(I,J){var K=Ext.decode(I.responseText);if(K.result[0].status!=0){Ext.showErrorWin(Ext.htmlEncode(K.result[0].note),function(){})}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){D.refreshWindow()})}}})}}Ext.showConfirmWin(I18N_Util.getMsg("msgCfmDropCol",{cname:Ext.htmlEncode(E)}),function(J,K,I){if(J=="yes"){G()}})}},{icon:Ext.ImagePath+"bd_primary.png",tooltip:I18N_Util.getMsg("msgSetPKeyOnCol"),handler:function(k,F,f){var E=k.getStore().getAt(F);var D=E.get("name");Ext.showConfirmWin(I18N_Util.getMsg("msgCfmSetPKeyOnCol",{cname:Ext.htmlEncode(D)}),function(H,I,G){if(H=="yes"){Ext.AddPrimaryKey(Ext.currentDb,i.tableName,[D],{success:function(J,L){var N=Ext.decode(J.responseText);var O="";for(var K=0;K<N.result.length;K++){if(N.result[K].status!=0){O+=Ext.htmlEncode(N.result[K].note)}}if(O.length>0){var M=O;if(D.length>80){M='<div class="msg_long_text">'+M+"</div>"}Ext.showErrorWin(M,function(){i.refreshWindow()})}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){i.refreshWindow()})}}})}})}},{icon:Ext.ImagePath+"b_unique.png",tooltip:I18N_Util.getMsg("msgAddUKeyOnCol"),handler:function(k,F,f){var E=k.getStore().getAt(F);var D=E.get("name");Ext.showConfirmWin(I18N_Util.getMsg("msgCfmAddUKeyOnCol",{cname:Ext.htmlEncode(D)}),function(H,I,G){if(H=="yes"){Ext.CreateUniques(Ext.currentDb,i.tableName,[D],{success:function(J,K){var M=Ext.decode(J.responseText);if(M.result[0].status!=0){var L=Ext.htmlEncode(M.result[0].note);if(D.length>80){L='<div class="msg_long_text">'+L+"</div>"}Ext.showErrorWin(L)}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){i.refreshWindow()})}}})}})}},{icon:Ext.ImagePath+"b_index.png",tooltip:I18N_Util.getMsg("msgAddIndexOnCol"),handler:function(k,F,f){var E=k.getStore().getAt(F);var D=E.get("name");Ext.showConfirmWin(I18N_Util.getMsg("msgCfmAddIndexOnCol",{cname:Ext.htmlEncode(D)}),function(H,I,G){if(H=="yes"){Ext.CreateIndexes(Ext.currentDb,i.tableName,[D],{success:function(J,K){var M=Ext.decode(J.responseText);if(M.result[0].status!=0){var L=Ext.htmlEncode(M.result[0].note);if(D.length>80){L='<div class="msg_long_text">'+L+"</div>"}Ext.showErrorWin(L)}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){i.refreshWindow()})}}})}})}}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",border:0,cls:"struct-grid-toolbar",ui:"footer",items:[{xtype:"panel",html:'<span style="color:#235A81;font-weight:bold">'+I18N_Util.getMsg("lblWithSelected")+"</span>",width:120,margin:"0 0 0 0",bodyStyle:"background : transparent; border : none"},{xtype:"button",text:I18N_Util.getMsg("btnDrop"),tooltip:I18N_Util.getMsg("msgDropSelectCols"),icon:Ext.ImagePath+"b_drop.png",handler:function(){var k=s.getSelectedFieldNames();if(k.length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgMissCols"));return}function f(){var D=s.getSelectedFieldNames();Ext.DropColumns(Ext.currentDb,i.tableName,D,{success:function(E,G){var H=Ext.decode(E.responseText);var I="";for(var F=0;F<H.result.length;F++){if(H.result[F].status!=0){I+=Ext.htmlEncode(H.result[F].note)+"\r\n"}}if(I.length>0){Ext.showErrorWin(I,function(){i.refreshWindow()})}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){i.refreshWindow()})}}})}Ext.showConfirmWin(I18N_Util.getMsg("msgCfmDropSelectCols"),function(E,F,D){if(E=="yes"){f()}})}},{xtype:"button",text:I18N_Util.getMsg("btnPrimary"),tooltip:I18N_Util.getMsg("msgSetPKeyOnSelectCols"),icon:Ext.ImagePath+"bd_primary.png",handler:function(){var f=s.getSelectedFieldNames();if(f.length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgMissCols"));return}Ext.showConfirmWin(I18N_Util.getMsg("msgCfmSetPKeyOnSelectCols"),function(D,E,k){if(D=="yes"){Ext.AddPrimaryKey(Ext.currentDb,i.tableName,f,{success:function(F,H){var I=Ext.decode(F.responseText);var J="";for(var G=0;G<I.result.length;G++){if(I.result[G].status!=0){J+=Ext.htmlEncode(I.result[G].note)}}if(J.length>0){Ext.showErrorWin(J,function(){i.refreshWindow()})}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){i.refreshWindow()})}}})}})}},{xtype:"button",text:I18N_Util.getMsg("btnUnique"),tooltip:I18N_Util.getMsg("msgSetUKeyOnSelectCols"),icon:Ext.ImagePath+"b_unique.png",handler:function(){var f=s.getSelectedFieldNames();if(f.length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgMissCols"));return}Ext.showConfirmWin(I18N_Util.getMsg("msgCfmAddUKeyOnSelectCols"),function(D,E,k){if(D=="yes"){Ext.CreateUniques(Ext.currentDb,i.tableName,f,{success:function(F,G){var H=Ext.decode(F.responseText);if(H.result[0].status!=0){Ext.showErrorWin(Ext.htmlEncode(H.result[0].note))}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){i.refreshWindow()})}}})}})}},{xtype:"button",text:I18N_Util.getMsg("btnIndex"),tooltip:I18N_Util.getMsg("msgSetIndexOnSelectCols"),icon:Ext.ImagePath+"b_index.png",handler:function(){var f=s.getSelectedFieldNames();if(f.length<=0){Ext.showWarningWin(I18N_Util.getMsg("msgMissCols"));return}Ext.showConfirmWin(I18N_Util.getMsg("msgCfmAddIndexOnSelectCols"),function(D,E,k){if(D=="yes"){Ext.CreateIndexes(Ext.currentDb,i.tableName,f,{success:function(F,G){var H=Ext.decode(F.responseText);if(H.result[0].status!=0){Ext.showErrorWin(Ext.htmlEncode(H.result[0].note))}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){i.refreshWindow()})}}})}})}}]}]});var o=Ext.create("Ext.Component",{margin:"10 10 10 10",autoEl:{tag:"hr"},color:"black"});var q=Ext.create("Ext.toolbar.Toolbar",{style:"background : transparent; border : none",margin:10,cls:"transparent-toolbar",items:[{xtype:"button",text:I18N_Util.getMsg("btnPrintView"),icon:Ext.ImagePath+"b_print.png"},{xtype:"button",margin:"0 0 0 5",text:I18N_Util.getMsg("btnRelationView"),icon:Ext.ImagePath+"b_relations.png"},{xtype:"button",margin:"0 0 0 5",text:I18N_Util.getMsg("btnProposeTableStruct"),icon:Ext.ImagePath+"b_tblanalyse.png"}]});var m=new Array();for(var w=0;w<u.length;w++){var y=new Object();y.name=u[w].name;y.value=y.name;m.push(y)}var x=Ext.create("Ext.data.Store",{fields:["name","value"],data:m});var n="";if(u!=null&&u[0]!=null){n=u[0].name}var r=20;var v=Ext.create("Ext.panel.Panel",{margin:10,border:0,component:{columnNumber:2,endRadio:4,beginRadio:5,afterRadio:6,colNameCmb:7},layout:"column",items:[{xtype:"image",margin:"3 0 0 0",src:Ext.ImagePath+"b_insrow.png"},{html:I18N_Util.getMsg("lblAdd"),xtype:"panel",margin:"3 0 0 0",bodyStyle:"background : transparent; border : none"},{xtype:"numberfield",margin:"0 5 0 5 ",value:1,allowBlank:false,allowDecimals:false,minValue:1,maxValue:r,width:50},{xtype:"panel",html:I18N_Util.getMsg("lblColumns"),border:0,margin:"3 0 0 10"},{xtype:"radio",name:"pose",margin:"0 10 0 10",checked:true,boxLabel:I18N_Util.getMsg("lblAtEnd")},{xtype:"radio",name:"pose",margin:"0 0 0 10",boxLabel:I18N_Util.getMsg("lblAtBegining")},{xtype:"radio",margin:"0 10 0 10",name:"pose",itemId:"chkafter",boxLabel:I18N_Util.getMsg("lblAfterCol")},{xtype:"combo",store:x,margin:"0 10 0 0",queryMode:"local",editable:true,forceSelection:true,typeAhead:true,value:n,displayField:"name",valueField:"value",tpl:'<tpl for="."><div class="x-boundlist-item combo_item" role="option">{[Ext.htmlEncode(values.name)]}</div></tpl>',listConfig:{maxHeight:800,height:800,cls:(Ext.isIE9||Ext.isIE7)?"cwm_combo_boundlist":""},listeners:{focus:function(f){f.ownerCt.down("#chkafter").setValue(true)}},setHiddenValue:function(D){var G=this,F;if(!G.hiddenDataEl){return}D=Ext.Array.from(D);var I=G.hiddenDataEl.dom,H=I.childNodes,k=H[0],f=D.length,E=H.length;if(!k&&f>0){G.hiddenDataEl.update(Ext.DomHelper.markup({tag:"input",type:"hidden",name:G.name+"-hidden"}));E=1;k=I.firstChild}while(E>f){I.removeChild(H[0]);--E}while(E<f){I.appendChild(k.cloneNode(true));++E}for(F=0;F<f;F++){H[F].value=D[F]}}},{xtype:"button",text:I18N_Util.getMsg("btnGo"),handler:function(){try{var J=i;if(J){var L=v.getComponent(v.component.beginRadio);var E=v.getComponent(v.component.afterRadio);var F=v.getComponent(v.component.colNameCmb);var K=v.component.columnNumber;var f=v.getComponent(K);if(f==null||!f.isValid()){Ext.showErrorWin(msgInvalidColumnNum);return}var H=null;var k=null;if(L.getValue()){H="FIRST"}else{if(E.getValue()){k=F.getValue();H="AFTER"}}var D=Ext.create("cwm.view.AddFields",{layout:"fit",aftercol:k,tableName:J.tableName,beforeOrAfter:H});D.insertBlankRow(true);var G=1;while(G<f.getValue()){G++;D.insertBlankRow(false)}J.remove(J.component.dynView,true);J.add(D)}}catch(I){Ext.Trace(I)}}}]});var A=Ext.create("Ext.panel.Panel",{bodyStyle:"background : transparent; border : none; font-size:2em; color : #777777;text-shadow: 0 1px 0 #FFFFFF;",margin:"0 0 0 10",html:I18N_Util.getMsg("titleIndexs")});this.indexStore=Ext.create("Ext.data.Store",{model:"cwm.model.IndexTable",autoLoad:true,data:[],proxy:{type:"memory",reader:{type:"json"}}});var e=Ext.create("Ext.grid.Panel",{store:this.indexStore,enableColumnHide:false,autoFill:true,id:"table-structure-index-table",border:0,margin:"0 10px 10px",cls:"struct-grid",columns:[{sortable:false,xtype:"actioncolumn",header:I18N_Util.getMsg("lblAction"),width:50,items:[{icon:Ext.ImagePath+"b_edit.png",tooltip:I18N_Util.getMsg("msgEditKeyOrIndex"),handler:function(D,H,k){var G=e.getStore().getAt(H);var F=G.get("idxname");var f=F.length>80?F.substring(0,80)+"...":F;if(G.get("unique")=="YES"&&G.get("pk")=="YES"){var E=G.get("columns");Ext.create("cwm.widget.InputWindow",{title:I18N_Util.getMsg("titleConfirm"),message:I18N_Util.getMsg("msgRenamePKeyTo",{name:Ext.htmlEncode(f)}),fn:function(I,J){if(I=="ok"&&J.length>0){if(Ext.VerifyTextInput(J)){i.renamePrimaryKey(F,J,E.split(","))}else{Ext.showWarningWin(I18N_Util.getMsg("msgInvalidInputName",{name:Ext.htmlEncode(J)}))}}}}).show()}else{if(G.get("unique")=="YES"){var E=G.get("columns");Ext.create("cwm.widget.InputWindow",{title:I18N_Util.getMsg("titleConfirm"),message:I18N_Util.getMsg("msgRenameUKeyTo",{name:Ext.htmlEncode(f)}),fn:function(I,J){if(I=="ok"&&J.length>0){if(Ext.VerifyTextInput(J)){i.renameUnique(F,J,E.split(","))}else{Ext.showWarningWin(I18N_Util.getMsg("msgInvalidInputName",{name:Ext.htmlEncode(J)}))}}}}).show()}else{var E=G.get("columns");Ext.create("cwm.widget.InputWindow",{title:I18N_Util.getMsg("titleConfirm"),message:I18N_Util.getMsg("msgRenameIndexTo",{name:Ext.htmlEncode(f)}),fn:function(I,J){if(I=="ok"&&J.length>0){if(Ext.VerifyTextInput(J)){i.renameIndex(F,J,E.split(","))}else{Ext.showWarningWin(I18N_Util.getMsg("msgInvalidInputName",{name:Ext.htmlEncode(J)}))}}}}).show()}}}},{icon:Ext.ImagePath+"b_drop.png",tooltip:I18N_Util.getMsg("msgDropKeyOrIndex"),handler:function(D,G,k){var F=e.getStore().getAt(G);var E=F.get("idxname");function f(){if(F.get("unique")=="YES"||F.get("pk")=="YES"||F.get("fk")=="YES"){sql='ALTER TABLE "'+i.tableName+'" DROP CONSTRAINT "'+E+'"'}else{sql='ALTER TABLE "'+i.tableName+'" DROP INDEX "'+E+'"'}Ext.QueryByCCI(Ext.currentDb,[sql],{success:function(H,I){var K=Ext.decode(H.responseText);if(K.result[0].status!=0){var J=Ext.htmlEncode(K.result[0].note);if(E.length>80){J='<div class="msg_long_text">'+J+"</div>"}Ext.showErrorWin(J)}else{Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"),function(){i.refreshWindow()})}}})}Ext.showConfirmWin(I18N_Util.getMsg("msgCfmDropIndex",{name:Ext.htmlEncode(E)}),function(I,J,H){if(I=="yes"){f()}})}}]},{sortable:false,text:I18N_Util.getMsg("lblName"),width:150,dataIndex:"idxname",renderer:function(f){if(f===null){return""}return Ext.htmlEncode(f)}},{sortable:false,text:I18N_Util.getMsg("lblPKey"),dataIndex:"pk",align:"center",renderer:function(f){if(f=="YES"){return'<img src="'+Ext.ImagePath+'s_success.png"></img>'}else{if(f=="NO"){}}return""}},{sortable:false,text:I18N_Util.getMsg("lblUnique"),dataIndex:"unique",align:"center",renderer:function(f){if(f=="YES"){return'<img src="'+Ext.ImagePath+'s_success.png"></img>'}else{if(f=="NO"){}}return""}},{sortable:false,text:I18N_Util.getMsg("lblForeignKey"),dataIndex:"fk",align:"center",renderer:function(f){if(f=="YES"){return'<img src="'+Ext.ImagePath+'s_success.png"></img>'}else{if(f=="NO"){}}return""}},{sortable:false,text:I18N_Util.getMsg("lblReverse"),dataIndex:"reverse",align:"center",renderer:function(f){if(f=="YES"){return'<img src="'+Ext.ImagePath+'s_success.png"></img>'}else{if(f=="NO"){}}return""}},{sortable:false,text:I18N_Util.getMsg("lblOnCols"),width:200,dataIndex:"columns",renderer:function(f){if(f===null){return""}return Ext.htmlEncode(f)}},{sortable:false,text:I18N_Util.getMsg("lblIndexRules"),width:200,dataIndex:"idxRules",renderer:function(f){if(f===null){return""}return Ext.htmlEncode(f)}}]});var d=true;var c=Ext.create("Ext.panel.Panel",{id:"partition-title",bodyStyle:"background : transparent; border : none; font-size:2em; color : #777777;text-shadow: 0 1px 0 #FFFFFF;",margin:"0 0 0 10",html:"Partitions:",hidden:d});var j=Ext.create("Ext.data.Store",{model:"cwm.model.Partition",autoLoad:true,data:[],proxy:{type:"memory",reader:{type:"json"}}});var l=Ext.create("Ext.grid.Panel",{store:j,autoFill:true,id:"partition-grid",border:0,margin:"0 10 0 10",cls:"struct-grid",hidden:d,enableColumnMove:false,sortableColumns:false,enableColumnHide:false,columns:[{text:I18N_Util.getMsg("lblClassName"),dataIndex:"part_name",renderer:function(f){if(f===null){return""}return Ext.htmlEncode(f)}},{text:I18N_Util.getMsg("lblPartName"),dataIndex:"part_name",renderer:function(f){if(f===null){return""}return Ext.htmlEncode(f)}},{text:I18N_Util.getMsg("lblPartClassName"),width:150,dataIndex:"part_classname",renderer:function(f){if(f===null){return""}return Ext.htmlEncode(f)}},{text:I18N_Util.getMsg("lblPartType"),dataIndex:"type"},{text:I18N_Util.getMsg("lblPartExpr"),dataIndex:"expr",renderer:function(f){if(f===null){return""}return Ext.htmlEncode(f)}},{text:I18N_Util.getMsg("lblPartValue"),width:200,dataIndex:"values",renderer:function(f){if(f===null){return""}return Ext.htmlEncode(f)}}]});z.add(C);z.add(s);z.add(v);z.add(o);z.add(A);z.add(e);z.add(c);z.add(l);z.component={message:0,structGrid:1,addColumnBar:2,indexGrid:5};this.add(z);var B=this;B.loadIndexAndPartToStructure();if(typeof h!=="undefined"&&h!==null&&h===true){Ext.getTableInfoByCCI(this.dbname,this.tableName,{success:function(k,F){var E=Ext.getDbIndex(B.dbname);var D=Ext.getTableIndx(B.dbname,B.tableName);if(-1==E||-1==D){Ext.Trace("TableStructure: can not found the table: "+B.tableName+"in database: "+B.dbname);return}var f=Ext.dblist[E].tables[D].fields;s.getStore().loadData(f);B.loadIndexAndPartToStructure()}})}},addQueryEditorWithAutoRun:function(f){this.removeStructure();var a=this.tableName;var b="sqlEditorPanel_tblBrowser";var d;if(typeof f!=undefined&&f!=null){d=f}else{d='SELECT * FROM "'+a+'"'}var c=Ext.create("cwm.view.QueryEditorView",{queryTextareaDomId:b,initQueryStatements:d,bodyStyle:"border: 0;background : transparent;",style:"padding: 5px 10px 10px; border: 0; background: transparent;"});this.add(c);c.showSqlEditor(false);c.runSql(c,d);var e=this.getComponent(this.component.menu);if("setActive" in e){e.setActive(e.component.btnSql)}},createSearch:function(){var b=this;var a=Ext.create("cwm.view.TableSearch",{tableName:this.tableName});b.add(a)},removeStructure:function(){var c=this.items.length;for(var a=c-1;a>0;a--){var b=this.getComponent(a);if(b){this.remove(b,true)}}},showColumnEditor:function(a,g,c,f,e){var i=this;this.removeStructure();var b="";var h="";if(g.indexOf("(")===-1){b=g.toUpperCase()}else{b=g.substring(0,g.indexOf("(")).toUpperCase();h=g.substring(g.indexOf("(")+1,g.lastIndexOf(")"))}switch(b){case"CHARACTER VARYING":b="VARCHAR";break;case"CHARACTER":b="CHAR";break;case"NATIONAL CHARACTER":b="NCHAR";break;case"NATIONAL CHARACTER VARYING":b="NCHAR VARYING";break;case"MULTISET_OF":b="MULTISET";break;case"SEQUENCE_OF":b="SEQUENCE";break;case"SET_OF":b="SET";break}var d=Ext.create("cwm.view.ChangeColumn",{oldValue:{colname:a,type:b,lenValue:h,notNullValue:c,defValue:f,autoIncrement:e.get("autoIncrement")==="y",aiSeed:e.get("aiSeed"),aiIncrement:e.get("aiIncrement"),aiCurrentVal:e.get("aiCurrentVal")},tbname:i.tableName});d.addListener("changeView",function(){var l=new JSEX();var j=function(){Ext.getTableInfoByCCI(i.dbname,i.tableName,{success:function(m,n){l.next()}})};var k=function(){i.removeContentView();i.createStructure()};l.push(j);l.push(k);l.exec()});this.add(d)},removeContentView:function(){this.removeStructure()},refreshPartitionInfo:function(c){var b=this;var d="SELECT * FROM db_partition WHERE class_name='"+b.tableName.replace(/\'/gi,"''")+"'";var a=new Array();Ext.QueryByCCI(Ext.currentDb,[d],{success:function(g,k){var m=Ext.decode(g.responseText);if(m.status!==1000){return}else{if(m.status===1000){var f=m.result[0]["values"];var l=true;if(!Ext.isArray(f)){c.getStore().loadData(a)}else{var e;for(var j=0;j<f.length;j++){l=false;e=new Object();e.classname=f[j][0];e.part_name=f[j][1];e.part_classname=f[j][2];e.type=f[j][3];e.expr=f[j][4];e.values=f[j][5];a.push(e)}c.getStore().loadData(a)}Ext.dblist[dbIdx].tables[tbIdx]["partitions"]=a;var h=b.down("#partition-title");if(l===true){c.hide();if(h){h.hide()}}else{c.show();if(h){h.show()}}}}}})},removePartition:function(){var a=this;var b='ALTER TABLE "'+a.tableName+'" REMOVE PARTITIONING';Ext.QueryByCCI(Ext.currentDb,[b],{success:function(c,e){var f=Ext.decode(c.responseText);if(f.status!==1000){return}else{if(f.status===1000){if(f.result[0]["status"]==0){Ext.showSuccessWin(I18N_Util.getMsg("msgSucOper"))}else{Ext.showFailureWin(Ext.htmlEncode(f.result[0]["note"]))}var d=a.down("#partition-grid");if(d){a.refreshPartitionInfo(d)}}}}})},loadIndexAndPartToStructure:function(){var f=this;var e=Ext.getDbIndex(f.dbname);var b=Ext.getTableIndx(f.dbname,f.tableName);if(-1==e||-1==b){Ext.Trace("TableStructure: can not found the table: "+f.tableName+"in database: "+f.dbname);return}var i=f.down("#table-structure-index-table");i.getStore().loadData(Ext.dblist[e].tables[b].indexes);var g=f.down("#partition-grid");var d=Ext.dblist[e].tables[b]["partitions"];g.getStore().loadData(d);var c=f.down("#partition-title");var a=d.length>0?false:true;if(a===true){g.hide();if(c){c.hide()}}else{g.show();if(c){c.show()}var h=g.down("toolbar");if(h){h.show()}}},initComponent:function(){this.addEvents("refresh");this.callParent(arguments)}});Ext.define("cwm.view.Variables",{extend:"Ext.panel.Panel",alias:"widget.variables",margin:10,width:700,border:0,update:function(){},renderPortsInfo:function(c){var a=Ext.create("Ext.data.Store",{fields:["pn","pv","paragroup"],groupField:"paragroup",data:c,remoteSort:true,groupOnSort:false,remoteGroup:true,proxy:{type:"memory",reader:{type:"json"}}});var b=Ext.create("Ext.grid.Panel",{title:I18N_Util.getMsg("titlePortSetting"),enableColumnHide:false,cls:"infoPanel",margin:"10 0 10 0",autoFill:true,forceFit:true,border:0,store:a,features:[{ftype:"grouping"}],columns:[{header:I18N_Util.getMsg("lblPortName"),sortable:false,width:300,dataIndex:"pn"},{header:I18N_Util.getMsg("lblPortValue"),sortable:false,width:300,dataIndex:"pv"}]});this.add(b)},renderCubridInfo:function(g){var k=new Array();for(var e=0;e<g.length;e++){var h=g[e].pv;for(var b=0;b<h.length;b++){var f=h[b];f.paragroup=g[e].pn;k.push(f)}}var a=Ext.create("Ext.data.Store",{fields:["pn","pv","paragroup"],groupField:"paragroup",data:k,remoteSort:true,groupOnSort:false,remoteGroup:true,proxy:{type:"memory",reader:{type:"json"}}});var c=Ext.create("Ext.grid.Panel",{title:I18N_Util.getMsg("titleCVars"),enableColumnHide:false,margin:"10 0 10 0",cls:"infoPanel",forceFit:true,autoFill:true,border:0,store:a,features:[{ftype:"grouping"}],columns:[{header:I18N_Util.getMsg("lblParamName"),sortable:false,width:300,dataIndex:"pn"},{header:I18N_Util.getMsg("lblParamValue"),sortable:false,width:300,dataIndex:"pv"}]});this.add(c)},renderBrokerInfo:function(g){var k=new Array();for(var e=0;e<g.length;e++){var h=g[e].pv;for(var b=0;b<h.length;b++){var f=h[b];f.paragroup=g[e].pn;k.push(f)}}var a=Ext.create("Ext.data.Store",{fields:["pn","pv","paragroup"],groupField:"paragroup",data:k,remoteSort:true,groupOnSort:false,remoteGroup:true,proxy:{type:"memory",reader:{type:"json"}}});var c=Ext.create("Ext.grid.Panel",{title:I18N_Util.getMsg("titleBrokerVars"),enableColumnHide:false,cls:"infoPanel",autoFill:true,forceFit:true,border:0,store:a,features:[{ftype:"grouping"}],columns:[{header:I18N_Util.getMsg("lblParamName"),sortable:false,width:300,dataIndex:"pn"},{header:I18N_Util.getMsg("lblParamValue"),sortable:false,width:300,dataIndex:"pv"}]});this.add(c)},renderCmInfo:function(c){var a=Ext.create("Ext.data.Store",{fields:["pn","pv"],data:c,proxy:{type:"memory",reader:{type:"json"}}});var b=Ext.create("Ext.grid.Panel",{title:I18N_Util.getMsg("titleCMVars"),enableColumnHide:false,autoFill:true,border:0,forceFit:true,cls:"infoPanel",store:a,columns:[{header:I18N_Util.getMsg("lblParamName"),width:300,sortable:false,dataIndex:"pn"},{header:I18N_Util.getMsg("lblParamValue"),width:300,sortable:false,dataIndex:"pv"}]});this.add(b)}});Ext.define("cwm.controller.App",{extend:"Ext.app.Controller",views:["LeftPanel","RightPanel","RHome","DbStruct","TableStructure","DatabaseListView","Privileges","QueryEditorView","AddFields","Export","DbSearch","Brokers","DbQuery","Import","Operations","Variables","TableSearch","Monitor","ChangeColumn","CMUserManagement","Automation"],models:["DbListView","Broker","TableListView","createTableWindow","DbAuth","UsersList","TableStructure","IndexTable","DbUserGroup","AddFields","BrokerDetailInf","BrokerDetailStatus","MonitorDbList","CpuGrid","MemGrid","CpuChart","MemChart","SpaceChart","SpaceGrid","Partition","CMUserList","DbAuthForCMUser","AutoBackupLog","AutoStartupLog","AutoAddVolLog","BrokerLog","DbErrLog","DbStatus","AutoLogReport"],stores:["BackupLevel","BackupPlan","BackupPeriodType","BackupPeriodDetail","BackupPeriodHour","BackupPeriodMin"],requires:["cwm.widget.DbLogin"],init:function(){var a=this;this.control({lptoolbar:{GotoHome:function(){try{var b=Ext.getCmp("leftPanel");b.removeLists();b.createDbLists(Ext.dblist);var c=Ext.getCmp("rightPanel");c.goHome();Ext.currentDb="";var f=Ext.getCmp("bread-crumb-navigator");if(f){f.clear()}}catch(d){Ext.Trace("Go Home btn clicked:"+d)}},ChangePasswd:function(b){Ext.create("cwm.widget.ChangeUserPassword",{})},Logout:function(){Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmLogout"),width:250,buttons:Ext.Msg.YESNO,icon:Ext.Msg.INFO,fn:function(b,c){if(b=="yes"){Ext.cookieUtil.clearSessionCookies();location.reload(false)}}})},GotoQueryWin:function(){a.showQueryWindow()},GotoDoc:function(){window.open("http://www.cubrid.org/documentation")},LeftPanelRefresh:function(){if(Ext.currentDb==""){var d=new JSEX();var c=function(){if(Ext.cookieUtil.getDbmtUserName()!=="admin"){Ext.getCurCmUserAuthInfo({success:function(e,f){d.next()}})}else{d.next()}};var b=function(){Ext.getDatabaseList({success:function(){Ext.RefreshDatabaseList()}})};d.push(c);d.push(b);d.exec()}else{Ext.getTableList(Ext.currentDb,{success:function(e,g){var f=Ext.getCmp("leftPanel");if(f){f.refresh()}}})}}},rhome:{listDatabasesInRightPanel:function(){var b=Ext.getCmp("rightPanel");if(b){b.showDatabaseListView()}}},insert:{insertrow:function(d,f,c,e){var b=d.up("tablestruct");if(b){b.addQueryEditorWithAutoRun(e)}}},addfields:{exit:function(d,b){var c=Ext.getCmp("rightPanel");if(c){c.showSchemaOfTable(d,b)}}},tablestruct:{refresh:function(d,b){var c=Ext.getCmp("rightPanel");if(c){c.showSchemaOfTable(d,b)}},browsetable:function(b,c){c.addQueryEditorWithAutoRun({tbname:b})},browsestruct:function(b,c){Ext.getTableInfoByCCI(Ext.currentDb,b,{success:function(d,f){var e=Ext.getCmp("rightPanel");e.showSchemaOfTable(Ext.currentDb,b)}})}},dbstruct:{refresh:function(d,b){var c=Ext.getCmp("rightPanel");if(c){c.showSchemaOfTable(d,b)}},browsetable:function(b,c){c.addQueryEditorWithAutoRun({tbname:b})},browsestruct:function(b,c){Ext.getTableInfoByCCI(Ext.currentDb,b,{success:function(d,f){var e=Ext.getCmp("rightPanel");e.showSchemaOfTable(Ext.currentDb,b);var g=Ext.getCmp("bread-crumb-navigator");if(g){g.setTable(Ext.currentDb,b)}}})},insertrecord:function(b){var d=Ext.getCmp("bread-crumb-navigator");if(d){d.setTable(Ext.currentDb,b)}var c=Ext.getCmp("rightPanel");if("createInsertView" in c){c.createInsertView(b)}}},lptblist:{createNewTable:function(b){var c=Ext.create("cwm.widget.createTableWnd",{border:0,title:I18N_Util.getMsg("titleCreateTable")});c.insertBlankRow(true);c.show()},tableChange:function(b){Ext.getTableInfoByCCI(Ext.currentDb,b,{success:function(c,e){var d=Ext.getCmp("rightPanel");d.showSchemaOfTable(Ext.currentDb,b);var f=Ext.getCmp("bread-crumb-navigator");if(f){f.setTable(Ext.currentDb,b)}}})},dbLogout:function(d){try{var b=Ext.getCmp("leftPanel");b.removeLists();b.createDbLists(Ext.dblist);var c=Ext.getCmp("rightPanel");c.goHome();Ext.currentDb="";Ext.cookieUtil.setDbLoginStatus(d,false);Ext.cookieUtil.setDbUserIsDba(d,false);Ext.cwm.curDbUser="";Ext.cwm.curDbUserIsDba=false;var g=Ext.getCmp("bread-crumb-navigator");if(g){g.clear()}}catch(f){Ext.Trace("Go Home btn clicked:"+f)}}},dblist:{LpListItemClicked:function(j){var l=new JSEX();var i=function(){Ext.getValidBrokerNameAndPort(function(){l.next()})};var f=function(m){var o=Ext.getUserNameAndPassword(m.name);var n=Ext.cookieUtil.getDbLoginStatus(m.name);if(typeof n!="undefined"&&n!=null&&n==true){l.next(m);Ext.cwm.curDbUser=Ext.cookieUtil.getDbUserName(m.name);Ext.cwm.curDbUserIsDba=Ext.cookieUtil.getDbUserIsDba(m.name)}else{var p=Ext.create("cwm.widget.DbLogin",{dbname:m.name,callback:function(q,r){l.next(m)},cancel:function(){l.end()}});p.show()}};var c=function(m){if(m.opened){l.next(m)}else{Ext.Msg.show({title:I18N_Util.getMsg("titleConfirm"),msg:I18N_Util.getMsg("msgCfmStartDbInDbList",{dbname:m.name}),closable:false,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(o,p,n){if(o=="yes"){m.needRefreshDbList=true;Ext.runDb(m.name,true,{success:function(q,r){l.next(m)},failure:function(q,r){l.end()}})}else{if(m.needRefreshDbList){Ext.RefreshDatabaseList()}l.end()}}})}};var d=function(m){if(m.needRefreshDbList){Ext.getDatabaseList({success:function(n,o){Ext.RefreshDatabaseList();l.next(m)}})}else{l.next(m)}};var g=function(m){Ext.currentDb=m.name;var n=Ext.getCmp("bread-crumb-navigator");if(n){n.setDatabase(m.name)}Ext.getTableList(m.name,{success:function(o,p){l.next(m)}})};var b=function(m){var n=Ext.getCmp("leftPanel");var o=Ext.getCmp("rightPanel");n.removeLists();n.createTableLists(m.name);if(m.checkPrivilege===true){o.addPrivileges(m.name)}else{o.showTablesOfDatabase(m.name)}};var k=function(m){Ext.getTableInfoByCCI(Ext.currentDb,m.name,{success:function(n,p){var o=Ext.getCmp("rightPanel");o.showSchemaOfTable(Ext.currentDb,m.name);var q=Ext.getCmp("bread-crumb-navigator");if(q){q.setTable(Ext.currentDb,m.name)}}})};var e=function(){if(Ext.cookieUtil.getDbmtUserName()!=="admin"){Ext.getCurCmUserAuthInfo({success:function(m,n){l.next()}})}else{l.next()}};var h=function(m){Ext.getDatabaseList({success:function(n,o){var p=Ext.getDbIndex(m.name);if(typeof Ext.dblist[p]==="undefined"){Ext.showErrorWin(I18N_Util.getMsg("msgDbNotExist"));l.end()}else{m.needRefreshDbList=m.opened!==Ext.dblist[p].isOpened;m.opened=Ext.dblist[p].isOpened;l.next(m)}}})};if(j.type==="db"){l.push(i);l.push(e);l.push(h,j);l.push(c);l.push(d);l.push(f);l.push(g);l.push(b)}else{l.push(k,j)}l.exec()}},breadcrumb:{CrumbClicked:function(f,c){if(f==="host"){try{var b=Ext.getCmp("leftPanel");b.removeLists();b.createDbLists(Ext.dblist);var d=Ext.getCmp("rightPanel");d.goHome();Ext.currentDb="";var h=Ext.getCmp("bread-crumb-navigator");if(h){h.clear()}}catch(g){Ext.Trace("Go Home btn clicked:"+g)}}else{if(f==="db"){var h=Ext.getCmp("bread-crumb-navigator");if(h){h.setDatabase(c)}Ext.getTableList(c,{success:function(e,k){var i=Ext.getCmp("leftPanel");var j=Ext.getCmp("rightPanel");i.removeLists();i.createTableLists(c);j.showTablesOfDatabase(c)}})}else{if(f==="table"){var d=Ext.getCmp("rightPanel");d.showSchemaOfTable(Ext.currentDb,c)}}}}},"login button[action=submit]":{click:this.loginSubmit},viewport:{render:this.showLoginView},"changeuserpwd button[action=submit]":{click:this.changeUserPwd},"changeuserpwd button[action=cancel]":{click:this.cancelChangeUserPwd},'ctab[itemId="Brokers"]':{render:this.ctabBrokers},'ctab[itemId="Monitors"]':{render:this.ctabMonitor},'ctab[itemId="CMUserManagement"]':{render:this.userManagement},'ctab[itemId="Automation"]':{render:this.ctabAutomation},'ctab[itemId="Report"]':{render:this.ctabReport},'ctab[itemId="Search"]':{render:this.ctabSearch},'ctab[itemId="Query"]':{render:this.ctabQuery},'ctab[itemId="Privileges"]':{render:this.ctabPrivileges},'ctab[itemId="SQL"]':{render:this.ctabSQLEditor},brokers:{beforedestroy:function(b){b.stopAutoRefresh();Ext.cwm.oldBrokersInfo=null;Ext.cwm.oldBrokerStatus=null}},"brokers > toolbar > numberfield":{spin:function(d,c){var b;if(!d.validate()){if(!d.getValue()){b=1}else{b=d.maxValue}}else{b=d.getValue();if(c==="up"){b+=1}else{if(c==="down"){b-=1}}}var e=d.up("brokers");if(e){e.stopAutoRefresh("restart");Ext.cwm.AutoRefreshBrokerInterval=b;e.startAutoRefresh()}},specialkey:function(d,c){if(c.getKey()==c.ENTER){if(!d.validate()){return}var b=d.getValue();var f=d.up("brokers");if(f){f.stopAutoRefresh("restart");Ext.cwm.AutoRefreshBrokerInterval=b;f.startAutoRefresh()}}},blur:function(c){if(!c.validate()){return}var b=c.getValue();var d=c.up("brokers");if(d){d.stopAutoRefresh("restart");Ext.cwm.AutoRefreshBrokerInterval=b;d.startAutoRefresh()}}},"userlist button[action=dropUser]":{click:this.dropUser},"editUser > changedbuserpwd button[action=submit]":{click:this.changeDbUserPwd},"editUser > dbusergp button[action=submit]":{click:this.changeDbUserGroup},"editUser > dbauth button[action=submit]":{click:this.changeDbAuth},"adduser button[action=submit]":{click:this.addDbUser},"dbauth > headercontainer":{headerclick:this.dbAuthHeaderClick},"dbauth > headercontainer > checkcolumn":{checkchange:this.dbAuthCheckChange},"dbsearchcriteria button[action=submit]":{click:this.dbSearchSubmit},"dbquery > dbsqlcreator":{beforedestroy:function(b){b.dbColumnData=null;b.columnStore=null;b.tables=null}},"fieldrow > combo":{beforeselect:function(e,b,c,d){if(b.data&&b.data.value===""){e.reset()}},select:function(e,c,d){var b=c[0];if(b.data&&b.data.value===""){e.reset()}}},monitor:{beforedestroy:this.monitorClean},"monitor > #chartsBox > chartbox":{click:function(c,d){var b=c.up("monitor");if(b&&d.id){b.createDetailWin(d.id)}},mouseover:function(b,c){b.body.setStyle("background","#EAEBEC")},mouseout:function(b,c){b.body.setStyle("background","transparent")}},monitordetailwin:{beforeclose:function(c){var b=Ext.getCmp("monitorView");b.curDetailWinType=""}},cmusermanagement:{AddUserDetail:function(e){var d=e.down("#UserDetailSave");var c=e.down("#UserDetailCancel");var b=e.down("#UserAddBtn");if(d&&c&&b){d.show();c.show();b.disable()}},RemoveUserDetail:function(e){var d=e.down("#UserDetailSave");var c=e.down("#UserDetailCancel");var b=e.down("#UserAddBtn");if(d&&c&&b){d.hide();c.hide();b.enable()}}},"report > logperiodform":{}})},showLoginView:function(){try{var d=Ext.cookieUtil.getToken();var a=Ext.ComponentQuery.query("viewport")[0];if(!d){a.down("leftPanel").hide();a.down("rightpanel").hide();Ext.create("cwm.widget.Login",{})}else{a.down("leftPanel").show();a.down("rightpanel").show();a.down("favorites").refresh();var f=new JSEX();var c=function(){Ext.getCurCmUserAuthInfo({success:function(e,h){f.next()}})};var b=function(){Ext.getDatabaseList({success:function(e,i){var h=Ext.getCmp("leftPanel");if(h){h.createDbLists(Ext.dblist)}},failure:function(){}})};f.push(c);f.push(b);f.exec()}}catch(g){Ext.Trace(g)}},changeUserPwd:function(a){var b=a.up("changeuserpwd");b.submitForm()},cancelChangeUserPwd:function(a){a.up("changeuserpwd").destroy()},changeDbUserPwd:function(b){var a=b.up("changedbuserpwd");a.submitForm()},changeDbUserGroup:function(a){var b=a.up("dbusergp");b.submitForm()},changeDbAuth:function(b){var a=b.up("dbauth");a.submitForm()},addDbUser:function(a){var b=a.up("adduser");b.submitForm()},dbAuthHeaderClick:function(c,d,a,h){if(Ext.cwm.curDbUserIsDba!==true){return}if(d.dataIndex==="table"){return}var g=c.up("dbauth");if(!g){return}var f;if(h.nodeName==="SPAN"){for(var e=0;e<h.childNodes.length;e++){if(h.childNodes[e].nodeName==="IMG"){f=h.childNodes[e];break}}}else{if(h.nodeName==="IMG"){f=h}}if(!f){return}var b=false;if(f.src.indexOf("unchecked")!==-1){b=true;f.src=Ext.ImagePath+"checked.gif"}else{f.src=Ext.ImagePath+"unchecked.gif"}var j=g.getStore();if(g.userName==="PUBLIC"){j.each(function(i){if(i.get("isSystemClass")!=="YES"){i.set(d.dataIndex,b)}})}else{j.each(function(i){i.set(d.dataIndex,b)})}},dbAuthCheckChange:function(d,g,e){var f=d.up("dbauth");if(!f){return}else{if(Ext.cwm.curDbUserIsDba!==true){var b=f.getStore();var a=b.getAt(g);a.set(d.dataIndex,!e)}else{if(f.userName==="PUBLIC"){var b=f.getStore();var a=b.getAt(g);var c=a.get("isSystemClass");if(c==="YES"){a.set(d.dataIndex,!e)}}}}},loginSubmit:function(e){var a=e.up("login");var h=a.down('textfield[name="username"]').getValue();var c=a.down('textfield[name="password"]').getValue();if(h===""){Ext.showWarningWin(I18N_Util.getMsg("msgInvalidUserName"));return}var d=false;if(c==="admin"){d=true}Ext.dbmtUserName=h;Ext.dbmtUserPwd=c;var f=this;var g=function(i,k){try{var m=Ext.decode(i.responseText);if(m.status=="failure"){throw (m.note)}Ext.cookieUtil.setToken(m.token);Ext.cookieUtil.setDbmtUserName(h);Ext.cookieUtil.setLastDbmtUserName(h);Ext.getEnv(function(){Ext.getCMSEnv(function(){var n=Ext.getCmp("cubrid-manager-home-view");if("setEnv" in n){n.setEnv()}})});var j=m.note;if(m.status!="failure"){e.up("login").destroy();f.showLoginView()}else{Ext.showFailureWin(j)}}catch(l){Ext.Trace(l)}};var b=function(i,j){};Ext.connectCMServer(d,a,f,{success:g,failure:b})},ctabBrokers:function(a){a.body.on("click",function(){var b=a.up("rhome");if(b){b.addBrokers();a.setActive(true);b.doLayout()}})},ctabMonitor:function(a){a.body.on("click",function(){var b=a.up("rhome");if(b){b.addMonitor();a.setActive(true);b.doLayout()}})},userManagement:function(a){a.body.on("click",function(){var b=a.up("rhome");if(b){b.addCMUserManagement();a.setActive(true);b.doLayout()}})},ctabAutomation:function(a){a.body.on("click",function(){var b=a.up("rhome");if(b){b.addAutomation();a.setActive(true);b.doLayout()}})},ctabReport:function(a){a.body.on("click",function(){var b=a.up("rhome");if(b){b.addReport();a.setActive(true);b.doLayout()}})},ctabSearch:function(a){a.body.on("click",function(){var c=a.up("dbstruct");if(c){c.addDbSearch();c.doLayout();return}var b=a.up("tablestruct");if(b){}})},ctabQuery:function(a){a.body.on("click",function(){var b=a.up("dbstruct");if(b){b.addDbQuery();b.doLayout()}})},ctabPrivileges:function(a){a.body.on("click",function(){var b=a.up("dbstruct");if(b){b.addPrivileges();b.doLayout()}})},ctabSQLEditor:function(a){a.body.on("click",function(){a.setActive(true);var b=a.up("dbstruct");if(b==null){return}b.removeStructure();b.addQueryEditor();b.doLayout()})},showQueryWindow:function(){var b="sqlEditorWin";var c=Ext.create("cwm.view.QueryEditorView",{queryTextareaDomId:b,initQueryStatements:"",region:"center"});c.addToolBarButton({text:I18N_Util.getMsg("btnClose"),tooltip:I18N_Util.getMsg("msgCloseWin"),handler:function(e,d){e.ownerCt.ownerCt.ownerCt.ownerCt.close()}});var a=Ext.create("Ext.window.Window",{width:"55%",minWidth:500,minHeight:180,y:60,defaults:{autoScroll:true},title:I18N_Util.getMsg("titleSqlQueryWin"),id:"SQLQueryWin",maximizable:true,closable:true,border:0,modal:true,style:"background: none repeat scroll 0 0 #F3F3F3;",bodyStyle:"background: none repeat scroll 0 0 #F3F3F3;",layout:"border",items:[c],listeners:{maximize:function(e,d){e.isMaximized=true},restore:function(e,d){e.isMaximized=null}}});a.show();return a},dbSearchSubmit:function(a){try{var b=a.up("form").getForm();var d=b.getValues();var f=a.up("dbsearchcriteria");if(f){f.submit(d)}}catch(c){Ext.Trace(c)}},monitorClean:function(a){Ext.cwm.oldDbProcStat=null;Ext.cwm.oldHostStat=null;a.cpuData=null;a.memData=null;a.spaceData=null;a.cpuChartData=null;a.memChartData=null;a.spaceChartData=null;if(a){a.stopTask()}}});Ext.application({name:"cwm",appFolder:"app",controllers:["App"],views:["LeftPanel","RightPanel","RHome","Login","DbStruct","TableStructure","DatabaseListView","AddFields","Insert","Brokers"],models:["DbListView","TableListView","createTableWindow","TableStructure","IndexTable","AddFields"],stores:[],requires:["cwm.common.CookieUtil"],launch:function(){this.viewport=Ext.create("Ext.container.Viewport",{layout:"border",style:"background: none repeat scroll 0 0 #FFFFFF;",items:[{region:"west",xtype:"leftPanel",border:0,width:200},{defaultType:"container",layout:"fit",region:"center",autoScroll:true,items:[{xtype:"rightpanel",border:0,minWidth:900}]}]});var a=function(){Ext.get("loading").remove()};Ext.defer(a,0)}});
